cscope 15 $HOME/mysql_config               0000448653
	@ha_innodb.cc

35 
	~<sql_èbÀ.h
>

38 
	~<sql_a˛.h
>

39 
	~<debug_sync.h
>

40 
	~<my_ba£.h
>

41 
	~<mysys_îr.h
>

42 
	~<mysql/önodb_¥iv.h
>

43 
	~<my_check_›t.h
>

47 
	~"univ.i
"

48 
	~"buf0dump.h
"

49 
	~"buf0Ãu.h
"

50 
	~"buf0Êu.h
"

51 
	~"buf0dblwr.h
"

52 
	~"bå0£a.h
"

53 
	~"os0fûe.h
"

54 
	~"os0thªad.h
"

55 
	~"§v0°¨t.h
"

56 
	~"§v0§v.h
"

57 
	~"åx0rﬁl.h
"

58 
	~"åx0åx.h
"

60 
	~"åx0sys.h
"

61 
	~"må0må.h
"

62 
	~"ªm0ty≥s.h
"

63 
	~"row0ös.h
"

64 
	~"row0mysql.h
"

65 
	~"row0£l.h
"

66 
	~"row0upd.h
"

67 
	~"log0log.h
"

68 
	~"lock0lock.h
"

69 
	~"di˘0¸ó.h
"

70 
	~"bå0cur.h
"

71 
	~"bå0bå.h
"

72 
	~"f•0f•.h
"

73 
	~"sync0sync.h
"

74 
	~"fû0fû.h
"

75 
	~"åx0xa.h
"

76 
	~"row0mîge.h
"

77 
	~"di˘0boŸ.h
"

78 
	~"di˘0°©s.h
"

79 
	~"di˘0°©s_bg.h
"

80 
	~"ha_¥ŸŸy≥s.h
"

81 
	~"ut0mem.h
"

82 
	~"ibuf0ibuf.h
"

83 
	~"di˘0di˘.h
"

84 
	~"§v0m⁄.h
"

85 
	~"≠i0≠i.h
"

86 
	~"≠i0misc.h
"

87 
	~"∑rs0∑rs.h
"

88 
	~"·s0·s.h
"

89 
	~"·s0ty≥s.h
"

90 
	~"row0imp‹t.h
"

91 
	~"row0quõs˚.h
"

92 #ifde‡
UNIV_DEBUG


93 
	~"åx0purge.h
"

95 
	~"·s0¥iv.h
"

96 
	~"∑ge0zù.h
"

98 
íum_tx_isﬁ©i⁄
 
thd_gë_åx_isﬁ©i⁄
(c⁄° 
THD
* 
thd
);

100 
	~"ha_önodb.h
"

101 
	~"i_s.h
"

103 #i‚de‡
MYSQL_PLUGIN_IMPORT


104 
	#MYSQL_PLUGIN_IMPORT


	)

108 
mysql_muãx_t
 
	gönoba£_sh¨e_muãx
;

110 
ul⁄g
 
	gcommô_thªads
 = 0;

111 
mysql_c⁄d_t
 
	gcommô_c⁄d
;

112 
mysql_muãx_t
 
	gcommô_c⁄d_m
;

113 
boﬁ
 
	gönodb_öôed
 = 0;

115 
	#INSIDE_HA_INNOBASE_CC


	)

117 
	#EQ_CURRENT_THD
(
thd
Ë(—hdË=
cuºít_thd
)

	)

119 
h™dÀπ⁄
* 
	gönodb_ht⁄_±r
;

121 c⁄° 
	gAUTOINC_OLD_STYLE_LOCKING
 = 0;

122 c⁄° 
	gAUTOINC_NEW_STYLE_LOCKING
 = 1;

123 c⁄° 
	gAUTOINC_NO_LOCKING
 = 2;

125 
	gönoba£_múr‹ed_log_groups
;

126 
	gönoba£_log_buf„r_size
;

127 
	gönoba£_addôi⁄Æ_mem_poﬁ_size
;

128 
	gönoba£_fûe_io_thªads
;

129 
	gönoba£_›í_fûes
;

130 
	gönoba£_autoöc_lock_mode
;

131 
ul⁄g
 
	gönoba£_commô_c⁄cuºícy
 = 0;

132 
ul⁄g
 
	gönoba£_ªad_io_thªads
;

133 
ul⁄g
 
	gönoba£_wrôe_io_thªads
;

134 
	gönoba£_buf„r_poﬁ_ö°™˚s
 = 1;

136 
	gönoba£_buf„r_poﬁ_size
, 
	gönoba£_log_fûe_size
;

140 
uöt
 
	gönoba£_ﬁd_blocks_p˘
;

144 
uöt
 
	gönoba£_ch™ge_buf„r_max_size
 = 
CHANGE_BUFFER_DEFAULT_SIZE
;

149 * 
	gönoba£_d©a_home_dú
 = 
NULL
;

150 * 
	gönoba£_d©a_fûe_∑th
 = 
NULL
;

151 * 
	gönoba£_fûe_f‹m©_«me
 = 
NULL
;

152 * 
	gönoba£_ch™ge_buf„rög
 = 
NULL
;

153 * 
	gönoba£_íabÀ_m⁄ô‹_cou¡î
 = 
NULL
;

154 * 
	gönoba£_dißbÀ_m⁄ô‹_cou¡î
 = 
NULL
;

155 * 
	gönoba£_ª£t_m⁄ô‹_cou¡î
 = 
NULL
;

156 * 
	gönoba£_ª£t_Æl_m⁄ô‹_cou¡î
 = 
NULL
;

159 #i‡
SSD_CACHE_FACE


160 
my_boﬁ
 
	gönoba£_u£_ssd_ˇche
 = 
FALSE
;

161 * 
	gönoba£_ssd_ˇche_fûe
 = 
NULL
;

162 
	gönoba£_ssd_ˇche_size
 = 0;

163 
ul⁄g
 
	gönoba£_ssd_ˇche_sˇn_dïth
 = 0;

169 * 
	gönoba£_fûe_f‹m©_max
 = 
NULL
;

171 * 
	gönoba£_fûe_Êush_mëhod
 = 
NULL
;

175 * 
	gönoba£_£rvî_°›w‹d_èbÀ
 = 
NULL
;

180 
ul⁄g
 
	gönoba£_Á°_shutdown
 = 1;

181 
my_boﬁ
 
	gönoba£_fûe_f‹m©_check
 = 
TRUE
;

182 #ifde‡
UNIV_LOG_ARCHIVE


183 
my_boﬁ
 
	gönoba£_log_¨chive
 = 
FALSE
;

184 * 
	gönoba£_log_¨ch_dú
 = 
NULL
;

186 
my_boﬁ
 
	gönoba£_u£_doubÀwrôe
 = 
TRUE
;

187 
my_boﬁ
 
	gönoba£_u£_checksums
 = 
TRUE
;

188 
my_boﬁ
 
	gönoba£_locks_unß„_f‹_bölog
 = 
FALSE
;

189 
my_boﬁ
 
	gönoba£_rﬁlback_⁄_timeout
 = 
FALSE
;

190 
my_boﬁ
 
	gönoba£_¸óã_°©us_fûe
 = 
FALSE
;

191 
my_boﬁ
 
	gönoba£_°©s_⁄_mëad©a
 = 
TRUE
;

192 
my_boﬁ
 
	gönoba£_œrge_¥efix
 = 
FALSE
;

193 
my_boﬁ
 
	gönodb_›timize_fuŒãxt_⁄ly
 = 
FALSE
;

195 * 
	göã∫Æ_önoba£_d©a_fûe_∑th
 = 
NULL
;

197 * 
	gönodb_vîsi⁄_°r
 = (*Ë
INNODB_VERSION_STR
;

202 c⁄° * 
	gönodb_°©s_mëhod_«mes
[] = {

206 
NuŒS


211 
TYPELIB
 
	gönodb_°©s_mëhod_ty≥lib
 = {

212 
¨øy_ñemíts
(
önodb_°©s_mëhod_«mes
) - 1,

214 
önodb_°©s_mëhod_«mes
,

215 
NULL


219 c⁄° * 
	gönodb_checksum_Æg‹ôhm_«mes
[] = {

226 
NuŒS


231 
TYPELIB
 
	gönodb_checksum_Æg‹ôhm_ty≥lib
 = {

232 
¨øy_ñemíts
(
önodb_checksum_Æg‹ôhm_«mes
) - 1,

234 
önodb_checksum_Æg‹ôhm_«mes
,

235 
NULL


243 
	#INNOBASE_WAKE_INTERVAL
 32

	)

244 
ul⁄g
 
	gönoba£_a˘ive_cou¡î
 = 0;

246 
hash_èbÀ_t
* 
	gönoba£_›í_èbÀs
;

249 c⁄° * 
	gönoba£_ch™ge_buf„rög_vÆues
[
IBUF_USE_COUNT
] = {

260 c⁄° 
_·_v·
 
	g·_v·_ªsu…
 = {
NULL
,

261 
önoba£_·s_föd_ønkög
,

262 
önoba£_·s_˛o£_ønkög
,

263 
önoba£_·s_ªåõve_ønkög
,

264 
NULL
};

266 c⁄° 
_·_v·_ext
 
	g·_v·_ext_ªsu…
 = {
önoba£_·s_gë_vîsi⁄
,

267 
önoba£_·s_Êags
,

268 
önoba£_·s_ªåõve_docid
,

269 
önoba£_·s_cou¡_m©ches
};

271 #ifde‡
HAVE_PSI_INTERFACE


274 
mysql_pfs_key_t
 
	gönoba£_sh¨e_muãx_key
;

275 
mysql_pfs_key_t
 
	gcommô_c⁄d_muãx_key
;

276 
mysql_pfs_key_t
 
	gcommô_c⁄d_key
;

278 
PSI_muãx_öfo
 
	gÆl_±hªad_muãxes
[] = {

279 {&
commô_c⁄d_muãx_key
, "commit_cond_mutex", 0},

280 {&
önoba£_sh¨e_muãx_key
, "innobase_share_mutex", 0}

283 
PSI_c⁄d_öfo
 
	gÆl_önodb_c⁄ds
[] = {

284 {&
commô_c⁄d_key
, "commit_cond", 0}

287 #ifde‡
UNIV_PFS_MUTEX


291 
PSI_muãx_öfo
 
	gÆl_önodb_muãxes
[] = {

292 {&
autoöc_muãx_key
, "autoinc_mutex", 0},

293 #i‚de‡
PFS_SKIP_BUFFER_MUTEX_RWLOCK


294 {&
buf„r_block_muãx_key
, "buffer_block_mutex", 0},

296 {&
buf_poﬁ_muãx_key
, "buf_pool_mutex", 0},

297 {&
buf_poﬁ_zù_muãx_key
, "buf_pool_zip_mutex", 0},

298 {&
ˇche_œ°_ªad_muãx_key
, "cache_last_read_mutex", 0},

299 {&
di˘_f‹eign_îr_muãx_key
, "dict_foreign_err_mutex", 0},

300 {&
di˘_sys_muãx_key
, "dict_sys_mutex", 0},

301 {&
fûe_f‹m©_max_muãx_key
, "file_format_max_mutex", 0},

302 {&
fû_sy°em_muãx_key
, "fil_system_mutex", 0},

303 {&
Êush_li°_muãx_key
, "flush_list_mutex", 0},

304 {&
·s_bg_thªads_muãx_key
, "fts_bg_threads_mutex", 0},

305 {&
·s_dñëe_muãx_key
, "fts_delete_mutex", 0},

306 {&
·s_›timize_muãx_key
, "fts_optimize_mutex", 0},

307 {&
·s_doc_id_muãx_key
, "fts_doc_id_mutex", 0},

308 {&
·s_∂l_tokíize_muãx_key
, "fts_pll_tokenize_mutex", 0},

309 {&
log_Êush_‹dî_muãx_key
, "log_flush_order_mutex", 0},

310 {&
hash_èbÀ_muãx_key
, "hash_table_mutex", 0},

311 {&
ibuf_bôm≠_muãx_key
, "ibuf_bitmap_mutex", 0},

312 {&
ibuf_muãx_key
, "ibuf_mutex", 0},

313 {&
ibuf_≥ssimi°ic_ö£π_muãx_key
,

315 #i‚de‡
HAVE_ATOMIC_BUILTINS


316 {&
£rvî_muãx_key
, "server_mutex", 0},

318 {&
log_sys_muãx_key
, "log_sys_mutex", 0},

319 #ifde‡
UNIV_MEM_DEBUG


320 {&
mem_hash_muãx_key
, "mem_hash_mutex", 0},

322 {&
mem_poﬁ_muãx_key
, "mem_pool_mutex", 0},

323 {&
muãx_li°_muãx_key
, "mutex_list_mutex", 0},

324 {&
∑ge_zù_°©_≥r_ödex_muãx_key
, "page_zip_stat_per_index_mutex", 0},

325 {&
purge_sys_bh_muãx_key
, "purge_sys_bh_mutex", 0},

326 {&
ªcv_sys_muãx_key
, "recv_sys_mutex", 0},

327 {&
ªcv_wrôî_muãx_key
, "recv_writer_mutex", 0},

328 {&
r£g_muãx_key
, "rseg_mutex", 0},

329 #ifde‡
UNIV_SYNC_DEBUG


330 {&
rw_lock_debug_muãx_key
, "rw_lock_debug_mutex", 0},

332 {&
rw_lock_li°_muãx_key
, "rw_lock_list_mutex", 0},

333 {&
rw_lock_muãx_key
, "rw_lock_mutex", 0},

334 {&
§v_di˘_tmpfûe_muãx_key
, "srv_dict_tmpfile_mutex", 0},

335 {&
§v_önodb_m⁄ô‹_muãx_key
, "srv_innodb_monitor_mutex", 0},

336 {&
§v_misc_tmpfûe_muãx_key
, "srv_misc_tmpfile_mutex", 0},

337 {&
§v_m⁄ô‹_fûe_muãx_key
, "srv_monitor_file_mutex", 0},

338 #ifde‡
UNIV_SYNC_DEBUG


339 {&
sync_thªad_muãx_key
, "sync_thread_mutex", 0},

341 {&
buf_dblwr_muãx_key
, "buf_dblwr_mutex", 0},

342 {&
åx_undo_muãx_key
, "trx_undo_mutex", 0},

343 {&
§v_sys_muãx_key
, "srv_sys_mutex", 0},

344 {&
lock_sys_muãx_key
, "lock_mutex", 0},

345 {&
lock_sys_waô_muãx_key
, "lock_wait_mutex", 0},

346 {&
åx_muãx_key
, "trx_mutex", 0},

347 {&
§v_sys_èsks_muãx_key
, "srv_threads_mutex", 0},

349 #i‚de‡
PFS_SKIP_EVENT_MUTEX


350 {&
evít_os_muãx_key
, "event_os_mutex", 0},

352 {&
os_muãx_key
, "os_mutex", 0},

353 #i‚de‡
HAVE_ATOMIC_BUILTINS


354 {&
§v_c⁄c_muãx_key
, "srv_conc_mutex", 0},

356 #i‚de‡
HAVE_ATOMIC_BUILTINS_64


357 {&
m⁄ô‹_muãx_key
, "monitor_mutex", 0},

359 {&
ut_li°_muãx_key
, "ut_list_mutex", 0},

360 {&
åx_sys_muãx_key
, "trx_sys_mutex", 0},

361 {&
zù_∑d_muãx_key
, "zip_pad_mutex", 0},

365 #ifde‡
UNIV_PFS_RWLOCK


369 
PSI_rwlock_öfo
 
	gÆl_önodb_rwlocks
[] = {

370 #ifde‡
UNIV_LOG_ARCHIVE


371 {&
¨chive_lock_key
, "archive_lock", 0},

373 {&
bå_£¨ch_œtch_key
, "btr_search_latch", 0},

374 #i‚de‡
PFS_SKIP_BUFFER_MUTEX_RWLOCK


375 {&
buf_block_lock_key
, "buf_block_lock", 0},

377 #ifde‡
UNIV_SYNC_DEBUG


378 {&
buf_block_debug_œtch_key
, "buf_block_debug_latch", 0},

380 {&
di˘_›î©i⁄_lock_key
, "dict_operation_lock", 0},

381 {&
fû_•a˚_œtch_key
, "fil_space_latch", 0},

382 {&
checkpoöt_lock_key
, "checkpoint_lock", 0},

383 {&
·s_ˇche_rw_lock_key
, "fts_cache_rw_lock", 0},

384 {&
·s_ˇche_öô_rw_lock_key
, "fts_cache_init_rw_lock", 0},

385 {&
åx_i_s_ˇche_lock_key
, "trx_i_s_cache_lock", 0},

386 {&
åx_purge_œtch_key
, "trx_purge_latch", 0},

387 {&
ödex_åì_rw_lock_key
, "index_tree_rw_lock", 0},

388 {&
ödex_⁄löe_log_key
, "index_online_log", 0},

389 {&
di˘_èbÀ_°©s_key
, "dict_table_stats", 0},

390 {&
hash_èbÀ_rw_lock_key
, "hash_table_locks", 0}

394 #ifde‡
UNIV_PFS_THREAD


398 
PSI_thªad_öfo
 
	gÆl_önodb_thªads
[] = {

399 {&
åx_rﬁlback_˛ón_thªad_key
, "trx_rollback_clean_thread", 0},

400 {&
io_h™dÀr_thªad_key
, "io_handler_thread", 0},

401 {&
§v_lock_timeout_thªad_key
, "srv_lock_timeout_thread", 0},

402 {&
§v_îr‹_m⁄ô‹_thªad_key
, "srv_error_monitor_thread", 0},

403 {&
§v_m⁄ô‹_thªad_key
, "srv_monitor_thread", 0},

404 {&
§v_ma°î_thªad_key
, "srv_master_thread", 0},

405 {&
§v_purge_thªad_key
, "srv_purge_thread", 0},

406 {&
buf_∑ge_˛ó√r_thªad_key
, "page_cleaner_thread", 0},

407 {&
ªcv_wrôî_thªad_key
, "recv_writer_thread", 0}

411 #ifde‡
UNIV_PFS_IO


414 
PSI_fûe_öfo
 
	gÆl_önodb_fûes
[] = {

415 {&
önodb_fûe_d©a_key
, "innodb_data_file", 0},

416 {&
önodb_fûe_log_key
, "innodb_log_file", 0},

417 {&
önodb_fûe_ãmp_key
, "innodb_temp_file", 0}

423 #ifde‡
__WIN__


424 
	#n‹mÆize_èbÀ_«me
(
n‹m_«me
, 
«me
) \

425 
	`n‹mÆize_èbÀ_«me_low
(
n‹m_«me
, 
«me
, 
TRUE
)

	)

427 
	#n‹mÆize_èbÀ_«me
(
n‹m_«me
, 
«me
) \

428 
	`n‹mÆize_èbÀ_«me_low
(
n‹m_«me
, 
«me
, 
FALSE
)

	)

432 
ib_cb_t
 
	gönodb_≠i_cb
[] = {

433 (
ib_cb_t
Ë
ib_curs‹_›í_èbÀ
,

434 (
ib_cb_t
Ë
ib_curs‹_ªad_row
,

435 (
ib_cb_t
Ë
ib_curs‹_ö£π_row
,

436 (
ib_cb_t
Ë
ib_curs‹_dñëe_row
,

437 (
ib_cb_t
Ë
ib_curs‹_upd©e_row
,

438 (
ib_cb_t
Ë
ib_curs‹_movëo
,

439 (
ib_cb_t
Ë
ib_curs‹_fú°
,

440 (
ib_cb_t
Ë
ib_curs‹_√xt
,

441 (
ib_cb_t
Ë
ib_curs‹_œ°
,

442 (
ib_cb_t
Ë
ib_curs‹_£t_m©ch_mode
,

443 (
ib_cb_t
Ë
ib_£c_£¨ch_tu∂e_¸óã
,

444 (
ib_cb_t
Ë
ib_˛u°_ªad_tu∂e_¸óã
,

445 (
ib_cb_t
Ë
ib_tu∂e_dñëe
,

446 (
ib_cb_t
Ë
ib_tu∂e_c›y
,

447 (
ib_cb_t
Ë
ib_tu∂e_ªad_u8
,

448 (
ib_cb_t
Ë
ib_tu∂e_wrôe_u8
,

449 (
ib_cb_t
Ë
ib_tu∂e_ªad_u16
,

450 (
ib_cb_t
Ë
ib_tu∂e_wrôe_u16
,

451 (
ib_cb_t
Ë
ib_tu∂e_ªad_u32
,

452 (
ib_cb_t
Ë
ib_tu∂e_wrôe_u32
,

453 (
ib_cb_t
Ë
ib_tu∂e_ªad_u64
,

454 (
ib_cb_t
Ë
ib_tu∂e_wrôe_u64
,

455 (
ib_cb_t
Ë
ib_tu∂e_ªad_i8
,

456 (
ib_cb_t
Ë
ib_tu∂e_wrôe_i8
,

457 (
ib_cb_t
Ë
ib_tu∂e_ªad_i16
,

458 (
ib_cb_t
Ë
ib_tu∂e_wrôe_i16
,

459 (
ib_cb_t
Ë
ib_tu∂e_ªad_i32
,

460 (
ib_cb_t
Ë
ib_tu∂e_wrôe_i32
,

461 (
ib_cb_t
Ë
ib_tu∂e_ªad_i64
,

462 (
ib_cb_t
Ë
ib_tu∂e_wrôe_i64
,

463 (
ib_cb_t
Ë
ib_tu∂e_gë_n_cﬁs
,

464 (
ib_cb_t
Ë
ib_cﬁ_£t_vÆue
,

465 (
ib_cb_t
Ë
ib_cﬁ_gë_vÆue
,

466 (
ib_cb_t
Ë
ib_cﬁ_gë_mëa
,

467 (
ib_cb_t
Ë
ib_åx_begö
,

468 (
ib_cb_t
Ë
ib_åx_commô
,

469 (
ib_cb_t
Ë
ib_åx_rﬁlback
,

470 (
ib_cb_t
Ë
ib_åx_°¨t
,

471 (
ib_cb_t
Ë
ib_åx_ªÀa£
,

472 (
ib_cb_t
Ë
ib_åx_°©e
,

473 (
ib_cb_t
Ë
ib_curs‹_lock
,

474 (
ib_cb_t
Ë
ib_curs‹_˛o£
,

475 (
ib_cb_t
Ë
ib_curs‹_√w_åx
,

476 (
ib_cb_t
Ë
ib_curs‹_ª£t
,

477 (
ib_cb_t
Ë
ib_›í_èbÀ_by_«me
,

478 (
ib_cb_t
Ë
ib_cﬁ_gë_«me
,

479 (
ib_cb_t
Ë
ib_èbÀ_åunˇã
,

480 (
ib_cb_t
Ë
ib_curs‹_›í_ödex_usög_«me
,

481 (
ib_cb_t
Ë
ib_˛o£_thd
,

482 (
ib_cb_t
Ë
ib_cfg_gë_cfg
,

483 (
ib_cb_t
Ë
ib_curs‹_£t_memˇched_sync
,

484 (
ib_cb_t
Ë
ib_curs‹_£t_˛u°î_ac˚ss
,

485 (
ib_cb_t
Ë
ib_curs‹_commô_åx
,

486 (
ib_cb_t
Ë
ib_cfg_åx_Àvñ
,

487 (
ib_cb_t
Ë
ib_tu∂e_gë_n_u£r_cﬁs
,

488 (
ib_cb_t
Ë
ib_curs‹_£t_lock_mode
,

489 (
ib_cb_t
Ë
ib_curs‹_˛ór_åx
,

490 (
ib_cb_t
Ë
ib_gë_idx_fõld_«me
,

491 (
ib_cb_t
Ë
ib_åx_gë_°¨t_time
,

492 (
ib_cb_t
Ë
ib_cfg_bk_commô_öãrvÆ
,

493 (
ib_cb_t
Ë
ib_curs‹_°mt_begö
,

494 (
ib_cb_t
Ë
ib_åx_ªad_⁄ly


503 
önodb_°›w‹d_èbÀ_vÆid©e
(

505 
THD
* 
thd
,

506 
°_mysql_sys_v¨
* 
v¨
,

508 * 
ßve
,

510 
°_mysql_vÆue
* 
vÆue
);

514 c⁄° 
	gönoba£_ödex_ª£rve_«me
[] = "GEN_CLUST_INDEX";

519 
ölöe


520 
ulöt


521 
önoba£_m≠_isﬁ©i⁄_Àvñ
(

523 
íum_tx_isﬁ©i⁄
 
iso
);

525 c⁄° 
	gönoba£_ht⁄_«me
[]= "InnoDB";

527 
MYSQL_THDVAR_BOOL
(
suµ‹t_xa
, 
PLUGIN_VAR_OPCMDARG
,

529  
NULL
, NULL,

530  
TRUE
);

532 
MYSQL_THDVAR_BOOL
(
èbÀ_locks
, 
PLUGIN_VAR_OPCMDARG
,

534  
NULL
, NULL,

535  
TRUE
);

537 
MYSQL_THDVAR_BOOL
(
°ri˘_mode
, 
PLUGIN_VAR_OPCMDARG
,

539 
NULL
, NULL, 
FALSE
);

541 
MYSQL_THDVAR_BOOL
(
·_íabÀ_°›w‹d
, 
PLUGIN_VAR_OPCMDARG
,

543 
NULL
, NULL,

544  
TRUE
);

546 
MYSQL_THDVAR_ULONG
(
lock_waô_timeout
, 
PLUGIN_VAR_RQCMDARG
,

548 
NULL
, NULL, 50, 1, 1024 * 1024 * 1024, 0);

550 
MYSQL_THDVAR_STR
(
·_u£r_°›w‹d_èbÀ
,

551 
PLUGIN_VAR_OPCMDARG
|
PLUGIN_VAR_MEMALLOC
,

553 
önodb_°›w‹d_èbÀ_vÆid©e
, 
NULL
, NULL);

555 
SHOW_VAR
 
	gönodb_°©us_v¨übÀs
[]= {

557 (*Ë&
exp‹t_v¨s
.
önodb_buf„r_poﬁ_dump_°©us
, 
SHOW_CHAR
},

559 (*Ë&
exp‹t_v¨s
.
önodb_buf„r_poﬁ_lﬂd_°©us
, 
SHOW_CHAR
},

561 (*Ë&
exp‹t_v¨s
.
önodb_buf„r_poﬁ_∑ges_d©a
, 
SHOW_LONG
},

563 (*Ë&
exp‹t_v¨s
.
önodb_buf„r_poﬁ_byãs_d©a
, 
SHOW_LONG
},

565 (*Ë&
exp‹t_v¨s
.
önodb_buf„r_poﬁ_∑ges_dúty
, 
SHOW_LONG
},

567 (*Ë&
exp‹t_v¨s
.
önodb_buf„r_poﬁ_byãs_dúty
, 
SHOW_LONG
},

569 (*Ë&
exp‹t_v¨s
.
önodb_buf„r_poﬁ_∑ges_Êushed
, 
SHOW_LONG
},

571 (*Ë&
exp‹t_v¨s
.
önodb_buf„r_poﬁ_∑ges_‰ì
, 
SHOW_LONG
},

572 #ifde‡
UNIV_DEBUG


574 (*Ë&
exp‹t_v¨s
.
önodb_buf„r_poﬁ_∑ges_œtched
, 
SHOW_LONG
},

577 (*Ë&
exp‹t_v¨s
.
önodb_buf„r_poﬁ_∑ges_misc
, 
SHOW_LONG
},

579 (*Ë&
exp‹t_v¨s
.
önodb_buf„r_poﬁ_∑ges_tŸÆ
, 
SHOW_LONG
},

581 (*Ë&
exp‹t_v¨s
.
önodb_buf„r_poﬁ_ªad_ahód_∫d
, 
SHOW_LONG
},

583 (*Ë&
exp‹t_v¨s
.
önodb_buf„r_poﬁ_ªad_ahód
, 
SHOW_LONG
},

585 (*Ë&
exp‹t_v¨s
.
önodb_buf„r_poﬁ_ªad_ahód_evi˘ed
, 
SHOW_LONG
},

587 (*Ë&
exp‹t_v¨s
.
önodb_buf„r_poﬁ_ªad_ªque°s
, 
SHOW_LONG
},

589 (*Ë&
exp‹t_v¨s
.
önodb_buf„r_poﬁ_ªads
, 
SHOW_LONG
},

591 (*Ë&
exp‹t_v¨s
.
önodb_buf„r_poﬁ_waô_‰ì
, 
SHOW_LONG
},

593 (*Ë&
exp‹t_v¨s
.
önodb_buf„r_poﬁ_wrôe_ªque°s
, 
SHOW_LONG
},

595 (*Ë&
exp‹t_v¨s
.
önodb_d©a_fsyncs
, 
SHOW_LONG
},

597 (*Ë&
exp‹t_v¨s
.
önodb_d©a_≥ndög_fsyncs
, 
SHOW_LONG
},

599 (*Ë&
exp‹t_v¨s
.
önodb_d©a_≥ndög_ªads
, 
SHOW_LONG
},

601 (*Ë&
exp‹t_v¨s
.
önodb_d©a_≥ndög_wrôes
, 
SHOW_LONG
},

603 (*Ë&
exp‹t_v¨s
.
önodb_d©a_ªad
, 
SHOW_LONG
},

605 (*Ë&
exp‹t_v¨s
.
önodb_d©a_ªads
, 
SHOW_LONG
},

607 (*Ë&
exp‹t_v¨s
.
önodb_d©a_wrôes
, 
SHOW_LONG
},

609 (*Ë&
exp‹t_v¨s
.
önodb_d©a_wrôãn
, 
SHOW_LONG
},

611 (*Ë&
exp‹t_v¨s
.
önodb_dblwr_∑ges_wrôãn
, 
SHOW_LONG
},

613 (*Ë&
exp‹t_v¨s
.
önodb_dblwr_wrôes
, 
SHOW_LONG
},

615 (*Ë&
exp‹t_v¨s
.
önodb_have_©omic_buûtös
, 
SHOW_BOOL
},

617 (*Ë&
exp‹t_v¨s
.
önodb_log_waôs
, 
SHOW_LONG
},

619 (*Ë&
exp‹t_v¨s
.
önodb_log_wrôe_ªque°s
, 
SHOW_LONG
},

621 (*Ë&
exp‹t_v¨s
.
önodb_log_wrôes
, 
SHOW_LONG
},

623 (*Ë&
exp‹t_v¨s
.
önodb_os_log_fsyncs
, 
SHOW_LONG
},

625 (*Ë&
exp‹t_v¨s
.
önodb_os_log_≥ndög_fsyncs
, 
SHOW_LONG
},

627 (*Ë&
exp‹t_v¨s
.
önodb_os_log_≥ndög_wrôes
, 
SHOW_LONG
},

629 (*Ë&
exp‹t_v¨s
.
önodb_os_log_wrôãn
, 
SHOW_LONGLONG
},

631 (*Ë&
exp‹t_v¨s
.
önodb_∑ge_size
, 
SHOW_LONG
},

633 (*Ë&
exp‹t_v¨s
.
önodb_∑ges_¸óãd
, 
SHOW_LONG
},

635 (*Ë&
exp‹t_v¨s
.
önodb_∑ges_ªad
, 
SHOW_LONG
},

637 (*Ë&
exp‹t_v¨s
.
önodb_∑ges_wrôãn
, 
SHOW_LONG
},

639 (*Ë&
exp‹t_v¨s
.
önodb_row_lock_cuºít_waôs
, 
SHOW_LONG
},

641 (*Ë&
exp‹t_v¨s
.
önodb_row_lock_time
, 
SHOW_LONGLONG
},

643 (*Ë&
exp‹t_v¨s
.
önodb_row_lock_time_avg
, 
SHOW_LONG
},

645 (*Ë&
exp‹t_v¨s
.
önodb_row_lock_time_max
, 
SHOW_LONG
},

647 (*Ë&
exp‹t_v¨s
.
önodb_row_lock_waôs
, 
SHOW_LONG
},

649 (*Ë&
exp‹t_v¨s
.
önodb_rows_dñëed
, 
SHOW_LONG
},

651 (*Ë&
exp‹t_v¨s
.
önodb_rows_ö£πed
, 
SHOW_LONG
},

653 (*Ë&
exp‹t_v¨s
.
önodb_rows_ªad
, 
SHOW_LONG
},

655 (*Ë&
exp‹t_v¨s
.
önodb_rows_upd©ed
, 
SHOW_LONG
},

657 (*Ë&
exp‹t_v¨s
.
önodb_num_›í_fûes
, 
SHOW_LONG
},

659 (*Ë&
exp‹t_v¨s
.
önodb_åunˇãd_°©us_wrôes
, 
SHOW_LONG
},

661 (*Ë&
exp‹t_v¨s
.
önodb_avaûabÀ_undo_logs
, 
SHOW_LONG
},

662 #ifde‡
UNIV_DEBUG


664 (*Ë&
exp‹t_v¨s
.
önodb_purge_åx_id_age
, 
SHOW_LONG
},

666 (*Ë&
exp‹t_v¨s
.
önodb_purge_võw_åx_id_age
, 
SHOW_LONG
},

668 {
NuŒS
, NuŒS, 
SHOW_LONG
}

675 
INNOBASE_SHARE
*

676 
gë_sh¨e
(

678 c⁄° * 
èbÀ_«me
);

684 
‰ì_sh¨e
(

686 
INNOBASE_SHARE
* 
sh¨e
);

693 
önoba£_˛o£_c⁄√˘i⁄
(

695 
h™dÀπ⁄
* 
ht⁄
,

696 
THD
* 
thd
);

705 
önoba£_commô
(

707 
h™dÀπ⁄
* 
ht⁄
,

708 
THD
* 
thd
,

711 
boﬁ
 
commô_åx
);

721 
önoba£_rﬁlback
(

723 
h™dÀπ⁄
* 
ht⁄
,

724 
THD
* 
thd
,

727 
boﬁ
 
rﬁlback_åx
);

737 
önoba£_rﬁlback_to_ßvïoöt
(

739 
h™dÀπ⁄
* 
ht⁄
,

740 
THD
* 
thd
,

743 * 
ßvïoöt
);

750 
boﬁ


751 
önoba£_rﬁlback_to_ßvïoöt_ˇn_ªÀa£_mdl
(

753 
h™dÀπ⁄
* 
ht⁄
,

754 
THD
* 
thd
);

763 
önoba£_ßvïoöt
(

765 
h™dÀπ⁄
* 
ht⁄
,

766 
THD
* 
thd
,

769 * 
ßvïoöt
);

777 
önoba£_ªÀa£_ßvïoöt
(

779 
h™dÀπ⁄
* 
ht⁄
,

780 
THD
* 
thd
,

783 * 
ßvïoöt
);

788 
h™dÀr
*

789 
önoba£_¸óã_h™dÀr
(

791 
h™dÀπ⁄
* 
ht⁄
,

792 
TABLE_SHARE
* 
èbÀ
,

793 
MEM_ROOT
* 
mem_roŸ
);

806 
önoba£_commô_c⁄cuºícy_öô_deÁu…
();

816 
önoba£_undo_logs_öô_deÁu…_max
();

823 
uöt


824 
önoba£_fûe_f‹m©_«me_lookup
(

826 c⁄° * 
f‹m©_«me
);

834 
önoba£_fûe_f‹m©_vÆid©e_™d_£t
(

836 c⁄° * 
f‹m©_max
);

843 
önoba£_xa_¥ï¨e
(

845 
h™dÀπ⁄
* 
ht⁄
,

846 
THD
* 
thd
,

849 
boﬁ
 
Æl
);

857 
önoba£_xa_ªcovî
(

859 
h™dÀπ⁄
* 
ht⁄
,

860 
XID
* 
xid_li°
,

861 
uöt
 
Àn
);

868 
önoba£_commô_by_xid
(

870 
h™dÀπ⁄
* 
ht⁄
,

871 
XID
* 
xid
);

879 
önoba£_rﬁlback_by_xid
(

881 
h™dÀπ⁄
* 
ht⁄
,

882 
XID
* 
xid
);

892 
önoba£_¸óã_curs‹_võw
(

894 
h™dÀπ⁄
* 
ht⁄
,

895 
THD
* 
thd
);

903 
önoba£_£t_curs‹_võw
(

905 
h™dÀπ⁄
* 
ht⁄
,

906 
THD
* 
thd
,

907 * 
curvõw
);

915 
önoba£_˛o£_curs‹_võw
(

917 
h™dÀπ⁄
* 
ht⁄
,

918 
THD
* 
thd
,

919 * 
curvõw
);

925 
önoba£_dr›_d©aba£
(

927 
h™dÀπ⁄
* 
ht⁄
,

928 * 
∑th
);

937 
önoba£_íd
(

939 
h™dÀπ⁄
* 
ht⁄
,

940 
ha_∑nic_fun˘i⁄
 
ty≥
);

950 
önoba£_°¨t_åx_™d_assign_ªad_võw
(

952 
h™dÀπ⁄
* 
ht⁄
,

953 
THD
* 
thd
);

961 
boﬁ


962 
önoba£_Êush_logs
(

964 
h™dÀπ⁄
* 
ht⁄
);

972 
önodb_show_°©us
(

974 
h™dÀπ⁄
* 
ht⁄
,

975 
THD
* 
thd
,

977 
°©_¥öt_‚
* 
°©_¥öt
);

982 
boﬁ


983 
önoba£_show_°©us
(

985 
h™dÀπ⁄
* 
ht⁄
,

986 
THD
* 
thd
,

988 
°©_¥öt_‚
* 
°©_¥öt
,

989 
ha_°©_ty≥
 
°©_ty≥
);

995 
önoba£_commô_low
(

997 
åx_t
* 
åx
);

1006 
önodb_íabÀ_m⁄ô‹_©_°¨tup
(

1008 * 
°r
);

1017 
n‹mÆize_èbÀ_«me_low
(

1019 * 
n‹m_«me
,

1021 c⁄° * 
«me
,

1022 
iboﬁ
 
£t_lowî_ˇ£
);

1030 
	$önoba£_commô_c⁄cuºícy_vÆid©e
(

1032 
THD
* 
thd
,

1033 
°_mysql_sys_v¨
* 
v¨
,

1035 * 
ßve
,

1037 
°_mysql_vÆue
* 
vÆue
)

1039 
ötbuf
;

1040 
ul⁄g
 
commô_c⁄cuºícy
;

1042 
	`DBUG_ENTER
("innobase_commit_concurrency_validate");

1044 i‡(
vÆue
->
	`vÆ_öt
(vÆue, &
ötbuf
)) {

1046 
	`DBUG_RETURN
(1);

1049 *
ªöãΩªt_ˇ°
<
ul⁄g
*>(
ßve
Ë
commô_c⁄cuºícy


1050 
°©ic_ˇ°
<
ul⁄g
>(
ötbuf
);

1054 
	`DBUG_RETURN
(!(!
commô_c⁄cuºícy
 =!
önoba£_commô_c⁄cuºícy
));

1055 
	}
}

1060 
h™dÀr
*

1061 
	$önoba£_¸óã_h™dÀr
(

1063 
h™dÀπ⁄
* 
ht⁄
,

1064 
TABLE_SHARE
* 
èbÀ
,

1065 
MEM_ROOT
* 
mem_roŸ
)

1067 (
	`√w
 (
mem_roŸ
Ë
	`ha_önoba£
(
ht⁄
, 
èbÀ
));

1068 
	}
}

1076 
ölöe


1078 
	$önodb_∑ge_size_vÆid©e
(

1080 
ul⁄g
 
∑ge_size
)

1082 
ul⁄g
 
n
;

1084 
	`DBUG_ENTER
("innodb_page_size_validate");

1086 
n
 = 
UNIV_PAGE_SIZE_SHIFT_MIN
;

1087 
n
 <
UNIV_PAGE_SIZE_SHIFT_MAX
;

1088 
n
++) {

1089 i‡(
∑ge_size
 =(
ul⁄g
Ë(1 << 
n
)) {

1090 
	`DBUG_RETURN
(
n
);

1094 
	`DBUG_RETURN
(0);

1095 
	}
}

1104 
UNIV_INTERN


1105 
iboﬁ


1106 
	$thd_is_ª∂iˇti⁄_¶ave_thªad
(

1108 
THD
* 
thd
)

1110 ((
iboﬁ
Ë
	`thd_¶ave_thªad
(
thd
));

1111 
	}
}

1117 
UNIV_INTERN


1118 
duøbûôy_¥›îtõs


1119 
	$thd_ªque°ed_duøbûôy
(

1121 c⁄° 
THD
* 
thd
)

1123 (
	`thd_gë_duøbûôy_¥›îty
(
thd
));

1124 
	}
}

1129 
UNIV_INTERN


1130 
iboﬁ


1131 
	$thd_åx_is_ªad_⁄ly
(

1133 
THD
* 
thd
)

1135 (
thd
 !0 && 
	`thd_tx_is_ªad_⁄ly
(thd));

1136 
	}
}

1142 
UNIV_INTERN


1143 
iboﬁ


1144 
	$thd_åx_is_auto_commô
(

1146 
THD
* 
thd
)

1148 (
thd
 !
NULL


1149 && !
	`thd_ã°_›ti⁄s
(

1150 
thd
,

1151 
OPTION_NOT_AUTOCOMMIT
 | 
OPTION_BEGIN
)

1152 && 
	`thd_is_£À˘
(
thd
));

1153 
	}
}

1158 
ölöe


1160 
	$önoba£_§v_c⁄c_íãr_önodb
(

1162 
åx_t
* 
åx
)

1164 i‡(
§v_thªad_c⁄cuºícy
) {

1165 i‡(
åx
->
n_tickës_to_íãr_önodb
 > 0) {

1170 --
åx
->
n_tickës_to_íãr_önodb
;

1172 } i‡(
åx
->
mysql_thd
 !
NULL


1173 && 
	`thd_is_ª∂iˇti⁄_¶ave_thªad
(
åx
->
mysql_thd
)) {

1175 
	`UT_WAIT_FOR
(

1176 
	`§v_c⁄c_gë_a˘ive_thªads
()

1177 < 
§v_thªad_c⁄cuºícy
,

1178 
§v_ª∂iˇti⁄_dñay
 * 1000);

1181 
	`§v_c⁄c_íãr_önodb
(
åx
);

1184 
	}
}

1189 
ölöe


1191 
	$önoba£_§v_c⁄c_exô_önodb
(

1193 
åx_t
* 
åx
)

1195 #ifde‡
UNIV_SYNC_DEBUG


1196 
	`ut_ad
(!
	`sync_thªad_Àvñs_n⁄em±y_åx
(
åx
->
has_£¨ch_œtch
));

1200 i‡(
åx
->
de˛¨ed_to_be_öside_önodb


1201 && 
åx
->
n_tickës_to_íãr_önodb
 == 0) {

1203 
	`§v_c⁄c_f‹˚_exô_önodb
(
åx
);

1205 
	}
}

1209 
ölöe


1211 
	$önoba£_§v_c⁄c_f‹˚_exô_önodb
(

1213 
åx_t
* 
åx
)

1215 #ifde‡
UNIV_SYNC_DEBUG


1216 
	`ut_ad
(!
	`sync_thªad_Àvñs_n⁄em±y_åx
(
åx
->
has_£¨ch_œtch
));

1220 i‡(
åx
->
de˛¨ed_to_be_öside_önodb
) {

1221 
	`§v_c⁄c_f‹˚_exô_önodb
(
åx
);

1223 
	}
}

1228 
UNIV_INTERN


1230 
	$£rvî_gë_ho°«me
()

1233 (
glob_ho°«me
);

1234 
	}
}

1242 
UNIV_INTERN


1243 
iboﬁ


1244 
	$thd_has_edôed_n⁄å™s_èbÀs
(

1246 
THD
* 
thd
)

1248 ((
iboﬁ
Ë
	`thd_n⁄_å™ß˘i⁄Æ_upd©e
(
thd
));

1249 
	}
}

1254 
UNIV_INTERN


1255 
iboﬁ


1256 
	$thd_is_£À˘
(

1258 c⁄° 
THD
* 
thd
)

1260 (
	`thd_sql_comm™d
(
thd
Ë=
SQLCOM_SELECT
);

1261 
	}
}

1267 
UNIV_INTERN


1268 
iboﬁ


1269 
	$thd_suµ‹ts_xa
(

1271 
THD
* 
thd
)

1274 (
	`THDVAR
(
thd
, 
suµ‹t_xa
));

1275 
	}
}

1280 
UNIV_INTERN


1281 
ul⁄g


1282 
	$thd_lock_waô_timeout
(

1284 
THD
* 
thd
)

1289 (
	`THDVAR
(
thd
, 
lock_waô_timeout
));

1290 
	}
}

1294 
UNIV_INTERN


1296 
	$thd_£t_lock_waô_time
(

1298 
THD
* 
thd
,

1299 
ulöt
 
vÆue
)

1301 i‡(
thd
) {

1302 
	`thd_°‹age_lock_waô
(
thd
, 
vÆue
);

1304 
	}
}

1309 
__©åibuã__
((
w¨n_unu£d_ªsu…
, 
n⁄nuŒ
))

1310 
ölöe


1311 
	gåx_t
*&

1312 
	$thd_to_åx
(

1314 
THD
* 
thd
)

1316 (*(
åx_t
**Ë
	`thd_ha_d©a
(
thd
, 
önodb_ht⁄_±r
));

1317 
	}
}

1326 
	$önoba£_ªÀa£_ãmp‹¨y_œtches
(

1328 
h™dÀπ⁄
* 
ht⁄
,

1329 
THD
* 
thd
)

1331 
	`DBUG_ASSERT
(
ht⁄
 =
önodb_ht⁄_±r
);

1333 i‡(!
önodb_öôed
) {

1338 
åx_t
* 
åx
 = 
	`thd_to_åx
(
thd
);

1340 i‡(
åx
 !
NULL
) {

1341 
	`åx_£¨ch_œtch_ªÀa£_if_ª£rved
(
åx
);

1345 
	}
}

1352 
ölöe


1354 
	$önoba£_a˘ive_smÆl
()

1357 
önoba£_a˘ive_cou¡î
++;

1359 i‡((
önoba£_a˘ive_cou¡î
 % 
INNOBASE_WAKE_INTERVAL
) == 0) {

1360 
	`§v_a˘ive_wake_ma°î_thªad
();

1362 
	}
}

1371 
	$c⁄vît_îr‹_code_to_mysql
(

1373 
dbîr_t
 
îr‹
,

1374 
ulöt
 
Êags
,

1375 
THD
* 
thd
)

1377 
îr‹
) {

1378 
DB_SUCCESS
:

1381 
DB_INTERRUPTED
:

1382 
	`my_îr‹
(
ER_QUERY_INTERRUPTED
, 
	`MYF
(0));

1385 
DB_FOREIGN_EXCEED_MAX_CASCADE
:

1386 
	`ut_ad
(
thd
);

1387 
	`push_w¨nög_¥ötf
(
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

1388 
HA_ERR_ROW_IS_REFERENCED
,

1394 "agaö", 
DICT_FK_MAX_RECURSIVE_LOAD
);

1398 
DB_ERROR
:

1402 
DB_DUPLICATE_KEY
:

1409 (
HA_ERR_FOUND_DUPP_KEY
);

1411 
DB_READ_ONLY
:

1412 if(
§v_f‹˚_ªcovîy
) {

1413 (
HA_ERR_INNODB_FORCED_RECOVERY
);

1415 (
HA_ERR_TABLE_READONLY
);

1417 
DB_FOREIGN_DUPLICATE_KEY
:

1418 (
HA_ERR_FOREIGN_DUPLICATE_KEY
);

1420 
DB_MISSING_HISTORY
:

1421 (
HA_ERR_TABLE_DEF_CHANGED
);

1423 
DB_RECORD_NOT_FOUND
:

1424 (
HA_ERR_NO_ACTIVE_RECORD
);

1426 
DB_DEADLOCK
:

1431 i‡(
thd
) {

1432 
	`thd_m¨k_å™ß˘i⁄_to_rﬁlback
(
thd
, 
TRUE
);

1435 (
HA_ERR_LOCK_DEADLOCK
);

1437 
DB_LOCK_WAIT_TIMEOUT
:

1442 i‡(
thd
) {

1443 
	`thd_m¨k_å™ß˘i⁄_to_rﬁlback
(

1444 
thd
, (
boﬁ
Ë
row_rﬁlback_⁄_timeout
);

1447 (
HA_ERR_LOCK_WAIT_TIMEOUT
);

1449 
DB_NO_REFERENCED_ROW
:

1450 (
HA_ERR_NO_REFERENCED_ROW
);

1452 
DB_ROW_IS_REFERENCED
:

1453 (
HA_ERR_ROW_IS_REFERENCED
);

1455 
DB_CANNOT_ADD_CONSTRAINT
:

1456 
DB_CHILD_NO_INDEX
:

1457 
DB_PARENT_NO_INDEX
:

1458 (
HA_ERR_CANNOT_ADD_FOREIGN
);

1460 
DB_CANNOT_DROP_CONSTRAINT
:

1462 (
HA_ERR_ROW_IS_REFERENCED
);

1466 
DB_CORRUPTION
:

1467 (
HA_ERR_CRASHED
);

1469 
DB_OUT_OF_FILE_SPACE
:

1470 (
HA_ERR_RECORD_FILE_FULL
);

1472 
DB_TEMP_FILE_WRITE_FAILURE
:

1473 (
HA_ERR_TEMP_FILE_WRITE_FAILURE
);

1475 
DB_TABLE_IN_FK_CHECK
:

1476 (
HA_ERR_TABLE_IN_FK_CHECK
);

1478 
DB_TABLE_IS_BEING_USED
:

1479 (
HA_ERR_WRONG_COMMAND
);

1481 
DB_TABLESPACE_DELETED
:

1482 
DB_TABLE_NOT_FOUND
:

1483 (
HA_ERR_NO_SUCH_TABLE
);

1485 
DB_TABLESPACE_NOT_FOUND
:

1486 (
HA_ERR_NO_SUCH_TABLE
);

1488 
DB_TOO_BIG_RECORD
: {

1491 
boﬁ
 
¥efix
 = (
	`di˘_tf_gë_f‹m©
(
Êags
Ë=
UNIV_FORMAT_A
);

1492 
	`my_¥ötf_îr‹
(
ER_TOO_BIG_ROWSIZE
,

1496 
	`MYF
(0),

1497 
	`∑ge_gë_‰ì_•a˚_of_em±y
(
Êags
 &

1498 
DICT_TF_COMPACT
) / 2,

1499 
¥efix
 ? "or using ROW_FORMAT=DYNAMIC "

1501 
¥efix
 ? 
DICT_MAX_FIXED_COL_LEN
 : 0);

1502 (
HA_ERR_TO_BIG_ROW
);

1506 
DB_TOO_BIG_FOR_REDO
:

1507 
	`my_¥ötf_îr‹
(
ER_TOO_BIG_ROWSIZE
, "%s" , 
	`MYF
(0),

1512 (
HA_ERR_TO_BIG_ROW
);

1514 
DB_TOO_BIG_INDEX_COL
:

1515 
	`my_îr‹
(
ER_INDEX_COLUMN_TOO_LONG
, 
	`MYF
(0),

1516 
	`DICT_MAX_FIELD_LEN_BY_FORMAT_FLAG
(
Êags
));

1517 (
HA_ERR_INDEX_COL_TOO_LONG
);

1519 
DB_NO_SAVEPOINT
:

1520 (
HA_ERR_NO_SAVEPOINT
);

1522 
DB_LOCK_TABLE_FULL
:

1527 i‡(
thd
) {

1528 
	`thd_m¨k_å™ß˘i⁄_to_rﬁlback
(
thd
, 
TRUE
);

1531 (
HA_ERR_LOCK_TABLE_FULL
);

1533 
DB_FTS_INVALID_DOCID
:

1534 (
HA_FTS_INVALID_DOCID
);

1535 
DB_FTS_EXCEED_RESULT_CACHE_LIMIT
:

1536 (
HA_ERR_FTS_EXCEED_RESULT_CACHE_LIMIT
);

1537 
DB_TOO_MANY_CONCURRENT_TRXS
:

1538 (
HA_ERR_TOO_MANY_CONCURRENT_TRXS
);

1539 
DB_UNSUPPORTED
:

1540 (
HA_ERR_UNSUPPORTED
);

1541 
DB_INDEX_CORRUPT
:

1542 (
HA_ERR_INDEX_CORRUPT
);

1543 
DB_UNDO_RECORD_TOO_BIG
:

1544 (
HA_ERR_UNDO_REC_TOO_BIG
);

1545 
DB_OUT_OF_MEMORY
:

1546 (
HA_ERR_OUT_OF_MEM
);

1547 
DB_TABLESPACE_EXISTS
:

1548 (
HA_ERR_TABLESPACE_EXISTS
);

1549 
DB_IDENTIFIER_TOO_LONG
:

1550 (
HA_ERR_INTERNAL_ERROR
);

1551 
DB_FTS_TOO_MANY_WORDS_IN_PHRASE
:

1552 (
HA_ERR_FTS_TOO_MANY_WORDS_IN_PHRASE
);

1554 
	}
}

1558 
UNIV_INTERN


1560 
	$önoba£_mysql_¥öt_thd
(

1562 
FILE
* 
f
,

1563 
THD
* 
thd
,

1564 
uöt
 
max_quîy_Àn
)

1567 
buf„r
[1024];

1569 
	`Âuts
(
	`thd_£curôy_c⁄ãxt
(
thd
, 
buf„r
,  buffer,

1570 
max_quîy_Àn
), 
f
);

1571 
	`putc
('\n', 
f
);

1572 
	}
}

1577 
UNIV_INTERN


1579 
	$önoba£_gë_îr_msg
(

1581 
îr‹_code
)

1583 (
	`my_gë_îr_msg
(
îr‹_code
));

1584 
	}
}

1588 
UNIV_INTERN


1590 
	$önoba£_gë_c£t_width
(

1592 
ulöt
 
c£t
,

1593 
ulöt
* 
mbmöÀn
,

1594 
ulöt
* 
mbmaxÀn
)

1596 
CHARSET_INFO
* 
cs
;

1597 
	`ut_ad
(
c£t
 <
MAX_CHAR_COLL_NUM
);

1598 
	`ut_ad
(
mbmöÀn
);

1599 
	`ut_ad
(
mbmaxÀn
);

1601 
cs
 = 
Æl_ch¨£ts
[
c£t
];

1602 i‡(
cs
) {

1603 *
mbmöÀn
 = 
cs
->mbminlen;

1604 *
mbmaxÀn
 = 
cs
->mbmaxlen;

1605 
	`ut_ad
(*
mbmöÀn
 < 
DATA_MBMAX
);

1606 
	`ut_ad
(*
mbmaxÀn
 < 
DATA_MBMAX
);

1608 
THD
* 
thd
 = 
cuºít_thd
;

1610 i‡(
thd
 && 
	`thd_sql_comm™d
—hdË=
SQLCOM_DROP_TABLE
) {

1614 i‡((
log_w¨nögs
)

1615 && (
c£t
 != 0)){

1617 
	`sql_¥öt_w¨nög
(

1618 "Unknow¿cﬁœti⁄ #%lu.", 
c£t
);

1622 
	`ut_a
(
c£t
 == 0);

1625 *
mbmöÀn
 = *
mbmaxÀn
 = 0;

1627 
	}
}

1631 
UNIV_INTERN


1633 
	$önoba£_c⁄vît_‰om_èbÀ_id
(

1635 
ch¨£t_öfo_°
* 
cs
,

1636 * 
to
,

1637 c⁄° * 
‰om
,

1638 
ulöt
 
Àn
)

1640 
uöt
 
îr‹s
;

1642 
	`°rc⁄vît
(
cs
, 
‰om
, &
my_ch¨£t_fûíame
, 
to
, (
uöt
Ë
Àn
, &
îr‹s
);

1643 
	}
}

1648 
UNIV_INTERN


1649 
my_boﬁ


1650 
	$önoba£_check_idítifõr_Àngth
(

1652 c⁄° * 
id
)

1655 
wñl_f‹med_îr‹
 = 0;

1656 
CHARSET_INFO
 *
cs
 = 
sy°em_ch¨£t_öfo
;

1657 
	`DBUG_ENTER
("innobase_check_identifier_length");

1659 
size_t
 
Àn
 = 
cs
->
c£t
->
	`wñl_f‹med_Àn
(

1660 
cs
, 
id
, id + 
	`°æí
(id),

1661 
NAME_CHAR_LEN
, &
wñl_f‹med_îr‹
);

1663 i‡(
wñl_f‹med_îr‹
 || 
Àn
 =
NAME_CHAR_LEN
) {

1664 
	`my_îr‹
(
ER_TOO_LONG_IDENT
, 
	`MYF
(0), 
id
);

1665 
	`DBUG_RETURN
(
åue
);

1667 
	`DBUG_RETURN
(
Ál£
);

1668 
	}
}

1672 
UNIV_INTERN


1674 
	$önoba£_c⁄vît_‰om_id
(

1676 
ch¨£t_öfo_°
* 
cs
,

1677 * 
to
,

1678 c⁄° * 
‰om
,

1679 
ulöt
 
Àn
)

1681 
uöt
 
îr‹s
;

1683 
	`°rc⁄vît
(
cs
, 
‰om
, 
sy°em_ch¨£t_öfo
, 
to
, (
uöt
Ë
Àn
, &
îr‹s
);

1684 
	}
}

1689 
UNIV_INTERN


1691 
	$önoba£_°rˇ£cmp
(

1693 c⁄° * 
a
,

1694 c⁄° * 
b
)

1696 i‡(!
a
) {

1697 i‡(!
b
) {

1702 } i‡(!
b
) {

1706 (
	`my_°rˇ£cmp
(
sy°em_ch¨£t_öfo
, 
a
, 
b
));

1707 
	}
}

1713 
UNIV_INTERN


1715 
	$önoba£_wûdˇ£cmp
(

1717 c⁄° * 
a
,

1718 c⁄° * 
b
)

1720 (
	`wûd_ˇ£_com∑ª
(
sy°em_ch¨£t_öfo
, 
a
, 
b
));

1721 
	}
}

1726 
UNIV_INTERN


1728 
	$önoba£_ba£«me
(

1730 c⁄° * 
∑th_«me
)

1732 c⁄° * 
«me
 = 
	`ba£_«me
(
∑th_«me
);

1734 ((
«me
) ?Çame : "null");

1735 
	}
}

1739 
UNIV_INTERN


1741 
	$önoba£_ˇ£dn_°r
(

1743 * 
a
)

1745 
	`my_ˇ£dn_°r
(
sy°em_ch¨£t_öfo
, 
a
);

1746 
	}
}

1751 
UNIV_INTERN


1752 
ch¨£t_öfo_°
*

1753 
	$önoba£_gë_ch¨£t
(

1755 
THD
* 
mysql_thd
)

1757 (
	`thd_ch¨£t
(
mysql_thd
));

1758 
	}
}

1763 
UNIV_INTERN


1765 
	$önoba£_gë_°mt
(

1767 
THD
* 
thd
,

1768 
size_t
* 
Àngth
)

1770 
LEX_STRING
* 
°mt
;

1772 
°mt
 = 
	`thd_quîy_°rög
(
thd
);

1773 *
Àngth
 = 
°mt
->length;

1774 (
°mt
->
°r
);

1775 
	}
}

1782 
UNIV_INTERN


1783 
ulöt


1784 
	$önoba£_gë_èbÀ_ˇche_size
()

1787 (
èbÀ_def_size
);

1788 
	}
}

1796 
UNIV_INTERN


1797 
ulöt


1798 
	$önoba£_gë_lowî_ˇ£_èbÀ_«mes
()

1801 (
lowî_ˇ£_èbÀ_«mes
);

1802 
	}
}

1807 
UNIV_INTERN


1809 
	$önoba£_mysql_tmpfûe
()

1812 
fd2
 = -1;

1813 
Fûe
 
fd
;

1815 
	`DBUG_EXECUTE_IF
(

1820 
fd
 = 
	`mysql_tmpfûe
("ib");

1822 i‡(
fd
 >= 0) {

1832 #ifde‡
_WIN32


1838 
HANDLE
 
hFûe
 = 
	`my_gë_osfh™dÀ
(
fd
);

1839 
HANDLE
 
hDup
;

1840 
BOOL
 
bOK
 = 
	`Du∂iˇãH™dÀ
(

1841 
	`GëCuºítPro˚ss
(),

1842 
hFûe
, 
	`GëCuºítPro˚ss
(),

1843 &
hDup
, 0, 
FALSE
, 
DUPLICATE_SAME_ACCESS
);

1844 i‡(
bOK
) {

1845 
fd2
 = 
	`_›í_osfh™dÀ
((
öçå_t
Ë
hDup
, 0);

1847 
	`my_osm≠îr
(
	`GëLa°Eº‹
());

1848 
fd2
 = -1;

1852 
fd2
 = 
	`dup
(
fd
);

1854 i‡(
fd2
 < 0) {

1855 
îrbuf
[
MYSYS_STRERROR_SIZE
];

1856 
	`DBUG_PRINT
("îr‹",("GŸÉº‹ %d o¿dup",
fd2
));

1857 
my_î∫o
=
î∫o
;

1858 
	`my_îr‹
(
EE_OUT_OF_FILERESOURCES
,

1859 
	`MYF
(
ME_BELL
+
ME_WAITTANG
),

1860 "ib*", 
my_î∫o
,

1861 
	`my_°ªº‹
(
îrbuf
, ”ºbuf), 
my_î∫o
));

1863 
	`my_˛o£
(
fd
, 
	`MYF
(
MY_WME
));

1865 (
fd2
);

1866 
	}
}

1871 
UNIV_INTERN


1872 
ulöt


1873 
	$önoba£_c⁄vît_°rög
(

1875 * 
to
,

1876 
ulöt
 
to_Àngth
,

1878 
CHARSET_INFO
* 
to_cs
,

1879 c⁄° * 
‰om
,

1880 
ulöt
 
‰om_Àngth
,

1881 
CHARSET_INFO
* 
‰om_cs
,

1883 
uöt
* 
îr‹s
)

1886 (
	`c›y_™d_c⁄vît
(

1887 (*Ë
to
, (
uöt32
Ë
to_Àngth
, 
to_cs
,

1888 (c⁄° *Ë
‰om
, (
uöt32
Ë
‰om_Àngth
, 
‰om_cs
,

1889 
îr‹s
));

1890 
	}
}

1901 
UNIV_INTERN


1902 
ulöt


1903 
	$önoba£_øw_f‹m©
(

1905 c⁄° * 
d©a
,

1906 
ulöt
 
d©a_Àn
,

1908 
ulöt
 
ch¨£t_cﬁl
,

1909 * 
buf
,

1910 
ulöt
 
buf_size
)

1915 
CHARSET_INFO
* 
d©a_cs
;

1916 
buf_tmp
[8192];

1917 
ulöt
 
buf_tmp_u£d
;

1918 
uöt
 
num_îr‹s
;

1920 
d©a_cs
 = 
Æl_ch¨£ts
[
ch¨£t_cﬁl
];

1922 
buf_tmp_u£d
 = 
	`önoba£_c⁄vît_°rög
(
buf_tmp
, (buf_tmp),

1923 
sy°em_ch¨£t_öfo
,

1924 
d©a
, 
d©a_Àn
, 
d©a_cs
,

1925 &
num_îr‹s
);

1927 (
	`ut_°r_sql_f‹m©
(
buf_tmp
, 
buf_tmp_u£d
, 
buf
, 
buf_size
));

1928 
	}
}

1948 
UNIV_INTERN


1949 
ul⁄gl⁄g


1950 
	$önoba£_√xt_autoöc
(

1952 
ul⁄gl⁄g
 
cuºít
,

1953 
ul⁄gl⁄g
 
√ed
,

1954 
ul⁄gl⁄g
 
°ï
,

1955 
ul⁄gl⁄g
 
off£t
,

1956 
ul⁄gl⁄g
 
max_vÆue
)

1958 
ul⁄gl⁄g
 
√xt_vÆue
;

1959 
ul⁄gl⁄g
 
block
 = 
√ed
 * 
°ï
;

1962 
	`ut_a
(
√ed
 > 0);

1963 
	`ut_a
(
block
 > 0);

1964 
	`ut_a
(
max_vÆue
 > 0);

1968 i‡(
off£t
 > 
block
) {

1969 
off£t
 = 0;

1977 i‡(
block
 >
max_vÆue


1978 || 
off£t
 > 
max_vÆue


1979 || 
cuºít
 >
max_vÆue


1980 || 
max_vÆue
 - 
off£t
 <= offset) {

1982 
√xt_vÆue
 = 
max_vÆue
;

1984 
	`ut_a
(
max_vÆue
 > 
cuºít
);

1986 
ul⁄gl⁄g
 
‰ì
 = 
max_vÆue
 - 
cuºít
;

1988 i‡(
‰ì
 < 
off£t
 || fªê- off£à<
block
) {

1989 
√xt_vÆue
 = 
max_vÆue
;

1991 
√xt_vÆue
 = 0;

1995 i‡(
√xt_vÆue
 == 0) {

1996 
ul⁄gl⁄g
 
√xt
;

1998 i‡(
cuºít
 > 
off£t
) {

1999 
√xt
 = (
cuºít
 - 
off£t
Ë/ 
°ï
;

2001 
√xt
 = (
off£t
 - 
cuºít
Ë/ 
°ï
;

2004 
	`ut_a
(
max_vÆue
 > 
√xt
);

2005 
√xt_vÆue
 = 
√xt
 * 
°ï
;

2007 
	`ut_a
(
√xt_vÆue
 >
√xt
);

2008 
	`ut_a
(
max_vÆue
 > 
√xt_vÆue
);

2011 i‡(
max_vÆue
 - 
√xt_vÆue
 >
block
) {

2013 
√xt_vÆue
 +
block
;

2015 i‡(
max_vÆue
 - 
√xt_vÆue
 >
off£t
) {

2016 
√xt_vÆue
 +
off£t
;

2018 
√xt_vÆue
 = 
max_vÆue
;

2021 
√xt_vÆue
 = 
max_vÆue
;

2025 
	`ut_a
(
√xt_vÆue
 != 0);

2026 
	`ut_a
(
√xt_vÆue
 <
max_vÆue
);

2028 (
√xt_vÆue
);

2029 
	}
}

2035 
	$önoba£_åx_öô
(

2037 
THD
* 
thd
,

2038 
åx_t
* 
åx
)

2040 
	`DBUG_ENTER
("innobase_trx_init");

2041 
	`DBUG_ASSERT
(
	`EQ_CURRENT_THD
(
thd
));

2042 
	`DBUG_ASSERT
(
thd
 =
åx
->
mysql_thd
);

2044 
åx
->
check_f‹eigns
 = !
	`thd_ã°_›ti⁄s
(

2045 
thd
, 
OPTION_NO_FOREIGN_KEY_CHECKS
);

2047 
åx
->
check_unique_£c⁄d¨y
 = !
	`thd_ã°_›ti⁄s
(

2048 
thd
, 
OPTION_RELAXED_UNIQUE_CHECKS
);

2050 
DBUG_VOID_RETURN
;

2051 
	}
}

2056 
UNIV_INTERN


2057 
åx_t
*

2058 
	$önoba£_åx_Æloˇã
(

2060 
THD
* 
thd
)

2062 
åx_t
* 
åx
;

2064 
	`DBUG_ENTER
("innobase_trx_allocate");

2065 
	`DBUG_ASSERT
(
thd
 !
NULL
);

2066 
	`DBUG_ASSERT
(
	`EQ_CURRENT_THD
(
thd
));

2068 
åx
 = 
	`åx_Æloˇã_f‹_mysql
();

2070 
åx
->
mysql_thd
 = 
thd
;

2072 
	`önoba£_åx_öô
(
thd
, 
åx
);

2074 
	`DBUG_RETURN
(
åx
);

2075 
	}
}

2082 
ölöe


2083 
åx_t
*

2084 
	$check_åx_exi°s
(

2086 
THD
* 
thd
)

2088 
åx_t
*& 
åx
 = 
	`thd_to_åx
(
thd
);

2090 
	`ut_ad
(
	`EQ_CURRENT_THD
(
thd
));

2092 i‡(
åx
 =
NULL
) {

2093 
åx
 = 
	`önoba£_åx_Æloˇã
(
thd
);

2094 } i‡(
	`UNIV_UNLIKELY
(
åx
->
magic_n
 !
TRX_MAGIC_N
)) {

2095 
	`mem_™Æyze_c‹ru±i⁄
(
åx
);

2096 
ut_îr‹
;

2099 
	`önoba£_åx_öô
(
thd
, 
åx
);

2101 (
åx
);

2102 
	}
}

2107 
ölöe


2108 
boﬁ


2109 
	$åx_is_ªgi°îed_f‹_2pc
(

2111 c⁄° 
åx_t
* 
åx
)

2113 (
åx
->
is_ªgi°îed
 == 1);

2114 
	}
}

2118 
ölöe


2120 
	$åx_ªgi°î_f‹_2pc
(

2122 
åx_t
* 
åx
)

2124 
åx
->
is_ªgi°îed
 = 1;

2125 
	`ut_ad
(
åx
->
owns_¥ï¨e_muãx
 == 0);

2126 
	}
}

2130 
ölöe


2132 
	$åx_dîegi°î_‰om_2pc
(

2134 
åx_t
* 
åx
)

2136 
åx
->
is_ªgi°îed
 = 0;

2137 
åx
->
owns_¥ï¨e_muãx
 = 0;

2138 
	}
}

2145 
boﬁ


2146 
	$åx_is_°¨ãd
(

2148 
åx_t
* 
åx
)

2150 (
åx
->
°©e
 !
TRX_STATE_NOT_STARTED
);

2151 
	}
}

2158 
UNIV_INTERN


2160 
	$önoba£_c›y_‰m_Êags_‰om_¸óã_öfo
(

2162 
di˘_èbÀ_t
* 
önodb_èbÀ
,

2163 c⁄° 
HA_CREATE_INFO
* 
¸óã_öfo
)

2165 
iboﬁ
 
ps_⁄
;

2166 
iboﬁ
 
ps_off
;

2168 i‡(
	`di˘_èbÀ_is_ãmp‹¨y
(
önodb_èbÀ
)) {

2170 
ps_⁄
 = 
FALSE
;

2171 
ps_off
 = 
TRUE
;

2173 
ps_⁄
 = 
¸óã_öfo
->
èbÀ_›ti⁄s


2174 & 
HA_OPTION_STATS_PERSISTENT
;

2175 
ps_off
 = 
¸óã_öfo
->
èbÀ_›ti⁄s


2176 & 
HA_OPTION_NO_STATS_PERSISTENT
;

2179 
	`di˘_°©s_£t_≥rsi°ít
(
önodb_èbÀ
, 
ps_⁄
, 
ps_off
);

2181 
	`di˘_°©s_auto_ªˇlc_£t
(

2182 
önodb_èbÀ
,

2183 
¸óã_öfo
->
°©s_auto_ªˇlc
 =
HA_STATS_AUTO_RECALC_ON
,

2184 
¸óã_öfo
->
°©s_auto_ªˇlc
 =
HA_STATS_AUTO_RECALC_OFF
);

2186 
önodb_èbÀ
->
°©s_ßm∂e_∑ges
 = 
¸óã_öfo
->stats_sample_pages;

2187 
	}
}

2194 
UNIV_INTERN


2196 
	$önoba£_c›y_‰m_Êags_‰om_èbÀ_sh¨e
(

2198 
di˘_èbÀ_t
* 
önodb_èbÀ
,

2199 c⁄° 
TABLE_SHARE
* 
èbÀ_sh¨e
)

2201 
iboﬁ
 
ps_⁄
;

2202 
iboﬁ
 
ps_off
;

2204 i‡(
	`di˘_èbÀ_is_ãmp‹¨y
(
önodb_èbÀ
)) {

2206 
ps_⁄
 = 
FALSE
;

2207 
ps_off
 = 
TRUE
;

2209 
ps_⁄
 = 
èbÀ_sh¨e
->
db_¸óã_›ti⁄s


2210 & 
HA_OPTION_STATS_PERSISTENT
;

2211 
ps_off
 = 
èbÀ_sh¨e
->
db_¸óã_›ti⁄s


2212 & 
HA_OPTION_NO_STATS_PERSISTENT
;

2215 
	`di˘_°©s_£t_≥rsi°ít
(
önodb_èbÀ
, 
ps_⁄
, 
ps_off
);

2217 
	`di˘_°©s_auto_ªˇlc_£t
(

2218 
önodb_èbÀ
,

2219 
èbÀ_sh¨e
->
°©s_auto_ªˇlc
 =
HA_STATS_AUTO_RECALC_ON
,

2220 
èbÀ_sh¨e
->
°©s_auto_ªˇlc
 =
HA_STATS_AUTO_RECALC_OFF
);

2222 
önodb_èbÀ
->
°©s_ßm∂e_∑ges
 = 
èbÀ_sh¨e
->stats_sample_pages;

2223 
	}
}

2227 
UNIV_INTERN


2228 
	gha_önoba£
::
	$ha_önoba£
(

2230 
h™dÀπ⁄
* 
ht⁄
,

2231 
TABLE_SHARE
* 
èbÀ_¨g
)

2232 :
	`h™dÀr
(
ht⁄
, 
èbÀ_¨g
),

2233 
	`öt_èbÀ_Êags
(
HA_REC_NOT_IN_SEQ
 |

2234 
HA_NULL_IN_KEY
 |

2235 
HA_CAN_INDEX_BLOBS
 |

2236 
HA_CAN_SQL_HANDLER
 |

2237 
HA_PRIMARY_KEY_REQUIRED_FOR_POSITION
 |

2238 
HA_PRIMARY_KEY_IN_READ_INDEX
 |

2239 
HA_BINLOG_ROW_CAPABLE
 |

2240 
HA_CAN_GEOMETRY
 | 
HA_PARTIAL_COLUMN_READ
 |

2241 
HA_TABLE_SCAN_ON_INDEX
 | 
HA_CAN_FULLTEXT
 |

2242 
HA_CAN_FULLTEXT_EXT
 | 
HA_CAN_EXPORT
),

2243 
	`°¨t_of_sˇn
(0),

2244 
	$num_wrôe_row
(0)

2245 {
	}
}

2249 
UNIV_INTERN


2250 
	gha_önoba£
::~
	$ha_önoba£
()

2253 
	}
}

2259 
UNIV_INTERN
 
ölöe


2261 
ha_önoba£
::
	$upd©e_thd
(

2263 
THD
* 
thd
)

2265 
åx_t
* 
åx
;

2267 
	`DBUG_ENTER
("ha_innobase::update_thd");

2268 
	`DBUG_PRINT
("ha_innobase::update_thd", ("user_thd: %p -> %p",

2269 
u£r_thd
, 
thd
));

2272 
	`DBUG_ASSERT
(
¥ebuût
->
èbÀ
->
n_ªf_cou¡
 > 0);

2274 
åx
 = 
	`check_åx_exi°s
(
thd
);

2276 i‡(
¥ebuût
->
åx
 !=Årx) {

2278 
	`row_upd©e_¥ebuût_åx
(
¥ebuût
, 
åx
);

2281 
u£r_thd
 = 
thd
;

2282 
DBUG_VOID_RETURN
;

2283 
	}
}

2289 
UNIV_INTERN


2291 
	gha_önoba£
::
	$upd©e_thd
()

2294 
THD
* 
thd
 = 
	`ha_thd
();

2296 
	`ut_ad
(
	`EQ_CURRENT_THD
(
thd
));

2297 
	`upd©e_thd
(
thd
);

2298 
	}
}

2307 
ölöe


2309 
	$önoba£_ªgi°î_åx
(

2311 
h™dÀπ⁄
* 
ht⁄
,

2312 
THD
* 
thd
,

2313 
åx_t
* 
åx
)

2315 
	`å™s_ªgi°î_ha
(
thd
, 
FALSE
, 
ht⁄
);

2317 i‡(!
	`åx_is_ªgi°îed_f‹_2pc
(
åx
)

2318 && 
	`thd_ã°_›ti⁄s
(
thd
, 
OPTION_NOT_AUTOCOMMIT
 | 
OPTION_BEGIN
)) {

2320 
	`å™s_ªgi°î_ha
(
thd
, 
TRUE
, 
ht⁄
);

2323 
	`åx_ªgi°î_f‹_2pc
(
åx
);

2324 
	}
}

2393 
my_boﬁ


2394 
	$önoba£_quîy_ˇchög_of_èbÀ_≥rmôãd
(

2396 
THD
* 
thd
,

2399 * 
fuŒ_«me
,

2400 
uöt
 
fuŒ_«me_Àn
,

2402 
ul⁄gl⁄g
 *
unu£d
)

2404 
iboﬁ
 
is_autocommô
;

2405 
åx_t
* 
åx
;

2406 
n‹m_«me
[1000];

2408 
	`ut_a
(
fuŒ_«me_Àn
 < 999);

2410 
åx
 = 
	`check_åx_exi°s
(
thd
);

2412 i‡(
åx
->
isﬁ©i⁄_Àvñ
 =
TRX_ISO_SERIALIZABLE
) {

2416 ((
my_boﬁ
)
FALSE
);

2419 i‡(
	`UNIV_UNLIKELY
(
åx
->
has_£¨ch_œtch
)) {

2420 
	`sql_¥öt_îr‹
("The callingÅhread is holdingÅheádaptive "

2423 
	`åx_¥öt
(
°dîr
, 
åx
, 1024);

2426 
	`åx_£¨ch_œtch_ªÀa£_if_ª£rved
(
åx
);

2428 
	`önoba£_§v_c⁄c_f‹˚_exô_önodb
(
åx
);

2430 i‡(!
	`thd_ã°_›ti⁄s
(
thd
, 
OPTION_NOT_AUTOCOMMIT
 | 
OPTION_BEGIN
)) {

2432 
is_autocommô
 = 
TRUE
;

2434 
is_autocommô
 = 
FALSE
;

2438 i‡(
is_autocommô
 && 
åx
->
n_mysql_èbÀs_ö_u£
 == 0) {

2457 ((
my_boﬁ
)
TRUE
);

2461 
	`n‹mÆize_èbÀ_«me
(
n‹m_«me
, 
fuŒ_«me
);

2463 
	`önoba£_ªgi°î_åx
(
önodb_ht⁄_±r
, 
thd
, 
åx
);

2465 i‡(
	`row_£¨ch_check_if_quîy_ˇche_≥rmôãd
(
åx
, 
n‹m_«me
)) {

2469 ((
my_boﬁ
)
TRUE
);

2474 ((
my_boﬁ
)
FALSE
);

2475 
	}
}

2479 
UNIV_INTERN


2481 
	$önoba£_övÆid©e_quîy_ˇche
(

2483 
åx_t
* 
åx
,

2485 c⁄° * 
fuŒ_«me
,

2490 
ulöt
 
fuŒ_«me_Àn
)

2497 #ifde‡
HAVE_QUERY_CACHE


2498 
qˇche_key_«me
[2 * (
NAME_LEN
 + 1)];

2499 
size_t
 
èb«me_Àn
;

2500 
size_t
 
db«me_Àn
;

2505 
db«me_Àn
 = 
	`fûíame_to_èbÀ«me
(
fuŒ_«me
, 
qˇche_key_«me
,

2506 (
qˇche_key_«me
));

2507 
èb«me_Àn
 = 
	`fûíame_to_èbÀ«me
(
fuŒ_«me
 + 
	`°æí
(full_name) + 1,

2508 
qˇche_key_«me
 + 
db«me_Àn
 + 1,

2509 (
qˇche_key_«me
)

2510 - 
db«me_Àn
 - 1);

2513 
	`mysql_quîy_ˇche_övÆid©e4
(
åx
->
mysql_thd
,

2514 
qˇche_key_«me
,

2515 (
db«me_Àn
 + 
èb«me_Àn
 + 2),

2516 
TRUE
);

2518 
	}
}

2526 
	$önoba£_c⁄vît_idítifõr
(

2528 * 
buf
,

2529 
ulöt
 
buÊí
,

2530 c⁄° * 
id
,

2531 
ulöt
 
idÀn
,

2532 
THD
* 
thd
,

2533 
iboﬁ
 
fûe_id
)

2536 c⁄° * 
s
 = 
id
;

2537 
q
;

2539 i‡(
fûe_id
) {

2541 
nz
[
MAX_TABLE_NAME_LEN
 + 1];

2542 
nz2
[
MAX_TABLE_NAME_LEN
 + 1];

2547 
	`ut_a
(
idÀn
 <
MAX_TABLE_NAME_LEN
);

2548 
	`mem˝y
(
nz
, 
id
, 
idÀn
);

2549 
nz
[
idÀn
] = 0;

2551 
s
 = 
nz2
;

2552 
idÀn
 = 
	`ex∂aö_fûíame
(
thd
, 
nz
, 
nz2
, Çz2,

2553 
EXPLAIN_PARTITIONS_AS_COMMENT
);

2554 
no_quŸe
;

2558 i‡(
	`UNIV_UNLIKELY
(!
thd
)) {

2559 
q
 = '"';

2561 
q
 = 
	`gë_quŸe_ch¨_f‹_idítifõr
(
thd
, 
s
, (Ë
idÀn
);

2564 i‡(
q
 =
EOF
) {

2565 
no_quŸe
:

2566 i‡(
	`UNIV_UNLIKELY
(
idÀn
 > 
buÊí
)) {

2567 
idÀn
 = 
buÊí
;

2569 
	`mem˝y
(
buf
, 
s
, 
idÀn
);

2570 (
buf
 + 
idÀn
);

2574 i‡(
buÊí
 < 2) {

2575 (
buf
);

2578 *
buf
++ = 
q
;

2579 
buÊí
--;

2581 ; 
idÀn
; idlen--) {

2582 
c
 = *
s
++;

2583 i‡(
	`UNIV_UNLIKELY
(
c
 =
q
)) {

2584 i‡(
	`UNIV_UNLIKELY
(
buÊí
 < 3)) {

2588 *
buf
++ = 
c
;

2589 *
buf
++ = 
c
;

2590 
buÊí
 -= 2;

2592 i‡(
	`UNIV_UNLIKELY
(
buÊí
 < 2)) {

2596 *
buf
++ = 
c
;

2597 
buÊí
--;

2601 *
buf
++ = 
q
;

2602 (
buf
);

2603 
	}
}

2609 
UNIV_INTERN


2611 
	$önoba£_c⁄vît_«me
(

2613 * 
buf
,

2614 
ulöt
 
buÊí
,

2615 c⁄° * 
id
,

2616 
ulöt
 
idÀn
,

2617 
THD
* 
thd
,

2618 
iboﬁ
 
èbÀ_id
)

2621 * 
s
 = 
buf
;

2622 c⁄° * 
bu„nd
 = 
buf
 + 
buÊí
;

2624 i‡(
èbÀ_id
) {

2625 c⁄° * 
¶ash
 = (c⁄° *Ë
	`memchr
(
id
, '/', 
idÀn
);

2626 i‡(!
¶ash
) {

2628 
no_db_«me
;

2632 
s
 = 
	`önoba£_c⁄vît_idítifõr
(s, 
bu„nd
 - s, 
id
, 
¶ash
 - id,

2633 
thd
, 
TRUE
);

2634 i‡(
	`UNIV_LIKELY
(
s
 < 
bu„nd
)) {

2635 *
s
++ = '.';

2636 
s
 = 
	`önoba£_c⁄vît_idítifõr
(s, 
bu„nd
 - s,

2637 
¶ash
 + 1, 
idÀn


2638 - (
¶ash
 - 
id
) - 1,

2639 
thd
, 
TRUE
);

2641 } i‡(
	`UNIV_UNLIKELY
(*
id
 =
TEMP_INDEX_PREFIX
)) {

2643 c⁄° 
ãmp_ödex_suffix
[]= "--temporary--";

2645 
s
 = 
	`önoba£_c⁄vît_idítifõr
(
buf
, 
buÊí
, 
id
 + 1, 
idÀn
 - 1,

2646 
thd
, 
FALSE
);

2647 i‡(
s
 - 
buf
 + ( 
ãmp_ödex_suffix
 - 1Ë< 
buÊí
) {

2648 
	`mem˝y
(
s
, 
ãmp_ödex_suffix
,

2649  
ãmp_ödex_suffix
 - 1);

2650 
s
 + 
ãmp_ödex_suffix
 - 1;

2653 
no_db_«me
:

2654 
s
 = 
	`önoba£_c⁄vît_idítifõr
(
buf
, 
buÊí
, 
id
, 
idÀn
,

2655 
thd
, 
èbÀ_id
);

2658 (
s
);

2659 
	}
}

2665 
UNIV_INTERN


2667 
	$önoba£_f‹m©_«me
(

2669 * 
buf
,

2670 
ulöt
 
buÊí
,

2671 c⁄° * 
«me
,

2672 
iboﬁ
 
is_ödex_«me
)

2674 c⁄° * 
bu„nd
;

2676 
bu„nd
 = 
	`önoba£_c⁄vît_«me
(
buf
, 
buÊí
, 
«me
, 
	`°æí
(name),

2677 
NULL
, !
is_ödex_«me
);

2679 
	`ut_ad
((
ulöt
Ë(
bu„nd
 - 
buf
Ë< 
buÊí
);

2681 
buf
[
bu„nd
 - buf] = '\0';

2682 
	}
}

2687 
UNIV_INTERN


2688 
iboﬁ


2689 
	$åx_is_öãºu±ed
(

2691 c⁄° 
åx_t
* 
åx
)

2693 (
åx
 &&Årx->
mysql_thd
 && 
	`thd_kûÀd
(trx->mysql_thd));

2694 
	}
}

2699 
UNIV_INTERN


2700 
iboﬁ


2701 
	$åx_is_°ri˘
(

2703 
åx_t
* 
åx
)

2705 (
åx
 &&Årx->
mysql_thd
 && 
	`THDVAR
—rx->mysql_thd, 
°ri˘_mode
));

2706 
	}
}

2711 
ölöe


2713 
	gha_önoba£
::
	$ª£t_ãm∂©e
()

2716 
	`ut_ad
(
¥ebuût
->
magic_n
 =
ROW_PREBUILT_ALLOCATED
);

2717 
	`ut_ad
(
¥ebuût
->
magic_n2
 =¥ebuût->
magic_n
);

2719 
¥ebuût
->
kìp_Ÿhî_fõlds_⁄_keyªad
 = 0;

2720 
¥ebuût
->
ªad_ju°_key
 = 0;

2721 
¥ebuût
->
ö_·s_quîy
 = 0;

2723 i‡(
¥ebuût
->
idx_c⁄d
) {

2724 
¥ebuût
->
idx_c⁄d
 = 
NULL
;

2725 
¥ebuût
->
idx_c⁄d_n_cﬁs
 = 0;

2728 
¥ebuût
->
ãm∂©e_ty≥
 = 
ROW_MYSQL_NO_TEMPLATE
;

2730 
	}
}

2738 
UNIV_INTERN


2740 
	gha_önoba£
::
	$öô_èbÀ_h™dÀ_f‹_HANDLER
()

2748 
	`upd©e_thd
(
	`ha_thd
());

2753 
	`åx_£¨ch_œtch_ªÀa£_if_ª£rved
(
¥ebuût
->
åx
);

2755 
	`önoba£_§v_c⁄c_f‹˚_exô_önodb
(
¥ebuût
->
åx
);

2759 
	`åx_°¨t_if_nŸ_°¨ãd_xa
(
¥ebuût
->
åx
);

2763 
	`åx_assign_ªad_võw
(
¥ebuût
->
åx
);

2765 
	`önoba£_ªgi°î_åx
(
ht
, 
u£r_thd
, 
¥ebuût
->
åx
);

2770 
¥ebuût
->
sql_°©_°¨t
 = 
FALSE
;

2775 
¥ebuût
->
£À˘_lock_ty≥
 = 
LOCK_NONE
;

2776 
¥ebuût
->
°‹ed_£À˘_lock_ty≥
 = 
LOCK_NONE
;

2780 
¥ebuût
->
höt_√ed_to_„tch_exåa_cﬁs
 = 
ROW_RETRIEVE_ALL_COLS
;

2785 
¥ebuût
->
u£d_ö_HANDLER
 = 
TRUE
;

2786 
	`ª£t_ãm∂©e
();

2787 
	}
}

2794 
	$önoba£_öô
(

2796 *
p
)

2798 
cuºít_dú
[3];

2799 
îr
;

2800 
boﬁ
 
ªt
;

2801 *
deÁu…_∑th
;

2802 
uöt
 
f‹m©_id
;

2803 
ul⁄g
 
num_∂l_degªe
;

2805 
	`DBUG_ENTER
("innobase_init");

2806 
h™dÀπ⁄
 *
önoba£_ht⁄
(h™dÀπ⁄*Ë
p
;

2807 
önodb_ht⁄_±r
 = 
önoba£_ht⁄
;

2809 
önoba£_ht⁄
->
°©e
 = 
SHOW_OPTION_YES
;

2810 
önoba£_ht⁄
->
db_ty≥

DB_TYPE_INNODB
;

2811 
önoba£_ht⁄
->
ßvïoöt_off£t
 = (
åx_«med_ßvït_t
);

2812 
önoba£_ht⁄
->
˛o£_c⁄√˘i⁄
 = 
önoba£_˛o£_c⁄√˘i⁄
;

2813 
önoba£_ht⁄
->
ßvïoöt_£t
 = 
önoba£_ßvïoöt
;

2814 
önoba£_ht⁄
->
ßvïoöt_rﬁlback
 = 
önoba£_rﬁlback_to_ßvïoöt
;

2815 
önoba£_ht⁄
->
ßvïoöt_rﬁlback_ˇn_ªÀa£_mdl
 =

2816 
önoba£_rﬁlback_to_ßvïoöt_ˇn_ªÀa£_mdl
;

2817 
önoba£_ht⁄
->
ßvïoöt_ªÀa£
 = 
önoba£_ªÀa£_ßvïoöt
;

2818 
önoba£_ht⁄
->
commô
 = 
önoba£_commô
;

2819 
önoba£_ht⁄
->
rﬁlback
 = 
önoba£_rﬁlback
;

2820 
önoba£_ht⁄
->
¥ï¨e
 = 
önoba£_xa_¥ï¨e
;

2821 
önoba£_ht⁄
->
ªcovî
 = 
önoba£_xa_ªcovî
;

2822 
önoba£_ht⁄
->
commô_by_xid
 = 
önoba£_commô_by_xid
;

2823 
önoba£_ht⁄
->
rﬁlback_by_xid
 = 
önoba£_rﬁlback_by_xid
;

2824 
önoba£_ht⁄
->
¸óã_curs‹_ªad_võw
 = 
önoba£_¸óã_curs‹_võw
;

2825 
önoba£_ht⁄
->
£t_curs‹_ªad_võw
 = 
önoba£_£t_curs‹_võw
;

2826 
önoba£_ht⁄
->
˛o£_curs‹_ªad_võw
 = 
önoba£_˛o£_curs‹_võw
;

2827 
önoba£_ht⁄
->
¸óã
 = 
önoba£_¸óã_h™dÀr
;

2828 
önoba£_ht⁄
->
dr›_d©aba£
 = 
önoba£_dr›_d©aba£
;

2829 
önoba£_ht⁄
->
∑nic
 = 
önoba£_íd
;

2831 
önoba£_ht⁄
->
°¨t_c⁄si°ít_¢≠shŸ
 =

2832 
önoba£_°¨t_åx_™d_assign_ªad_võw
;

2834 
önoba£_ht⁄
->
Êush_logs
 = 
önoba£_Êush_logs
;

2835 
önoba£_ht⁄
->
show_°©us
 = 
önoba£_show_°©us
;

2836 
önoba£_ht⁄
->
Êags
 =

2837 
HTON_SUPPORTS_EXTENDED_KEYS
 | 
HTON_SUPPORTS_FOREIGN_KEYS
;

2839 
önoba£_ht⁄
->
ªÀa£_ãmp‹¨y_œtches
 =

2840 
önoba£_ªÀa£_ãmp‹¨y_œtches
;

2842 
önoba£_ht⁄
->
d©a
 = &
önodb_≠i_cb
;

2844 
	`ut_a
(
DATA_MYSQL_TRUE_VARCHAR
 =(
ulöt
)
MYSQL_TYPE_VARCHAR
);

2846 #i‚de‡
DBUG_OFF


2847 c⁄° 
ã°_fûíame
[] = "-@";

2848 
ã°_èbÀ«me
[ 
ã°_fûíame


2849 + (
§v_mysql50_èbÀ_«me_¥efix
) - 1];

2850 i‡(((
ã°_èbÀ«me
)) - 1

2851 !
	`fûíame_to_èbÀ«me
(
ã°_fûíame
,

2852 
ã°_èbÀ«me
,

2853 (
ã°_èbÀ«me
), 
åue
)

2854 || 
	`°∫cmp
(
ã°_èbÀ«me
,

2855 
§v_mysql50_èbÀ_«me_¥efix
,

2856 (
§v_mysql50_èbÀ_«me_¥efix
) - 1)

2857 || 
	`°rcmp
(
ã°_èbÀ«me


2858 + (
§v_mysql50_èbÀ_«me_¥efix
) - 1,

2859 
ã°_fûíame
)) {

2861 
	`sql_¥öt_îr‹
("tablenameÉncoding has been changed");

2863 
îr‹
;

2868 i‡((
ulöt
) == 4) {

2869 i‡(
önoba£_buf„r_poﬁ_size
 > 
UINT_MAX32
) {

2870 
	`sql_¥öt_îr‹
(

2874 
îr‹
;

2878 
os_önodb_umask
 = (
ulöt
Ë
my_umask
;

2886 i‡(
mysqld_embedded
) {

2887 
deÁu…_∑th
 = 
mysql_ªÆ_d©a_home
;

2888 
fû_∑th_to_mysql_d©adú
 = 
mysql_ªÆ_d©a_home
;

2891 
cuºít_dú
[0] = 
FN_CURLIB
;

2892 
cuºít_dú
[1] = 
FN_LIBCHAR
;

2893 
cuºít_dú
[2] = 0;

2894 
deÁu…_∑th
 = 
cuºít_dú
;

2897 
	`ut_a
(
deÁu…_∑th
);

2906 
§v_d©a_home
 = (
önoba£_d©a_home_dú
 ? innobase_data_home_dir :

2907 
deÁu…_∑th
);

2913 i‡(!
önoba£_d©a_fûe_∑th
) {

2914 
önoba£_d©a_fûe_∑th
 = (*) "ibdata1:12M:autoextend";

2920 
öã∫Æ_önoba£_d©a_fûe_∑th
 = 
	`my_°rdup
(
önoba£_d©a_fûe_∑th
,

2921 
	`MYF
(
MY_FAE
));

2923 
ªt
 = (
boﬁ
Ë
	`§v_∑r£_d©a_fûe_∑ths_™d_sizes
(

2924 
öã∫Æ_önoba£_d©a_fûe_∑th
);

2925 i‡(
ªt
 =
FALSE
) {

2926 
	`sql_¥öt_îr‹
(

2929 
mem_‰ì_™d_îr‹
:

2930 
	`§v_‰ì_∑ths_™d_sizes
();

2931 
	`my_‰ì
(
öã∫Æ_önoba£_d©a_fûe_∑th
);

2932 
îr‹
;

2935 #i‡
SSD_CACHE_FACE


2936 
§v_u£_ssd_ˇche
 = (
iboﬁ
Ë
önoba£_u£_ssd_ˇche
;

2937 
§v_ssd_ˇche_fûe
 = 
önoba£_ssd_ˇche_fûe
;

2938 
§v_ssd_ˇche_size
 = (
ulöt
Ë
önoba£_ssd_ˇche_size
;

2939 
§v_ssd_ˇche_sˇn_dïth
 = (
ulöt
Ë
önoba£_ssd_ˇche_sˇn_dïth
;

2946 i‡(!
§v_log_group_home_dú
) {

2947 
§v_log_group_home_dú
 = 
deÁu…_∑th
;

2950 #ifde‡
UNIV_LOG_ARCHIVE


2955 
önoba£_log_¨ch_dú
 = 
önoba£_log_group_home_dú
;

2957 
§v_¨ch_dú
 = 
önoba£_log_¨ch_dú
;

2960 
	`§v_n‹mÆize_∑th_f‹_wö
(
§v_log_group_home_dú
);

2962 i‡(
	`°rchr
(
§v_log_group_home_dú
, ';')) {

2963 
	`sql_¥öt_îr‹
("syntaxÉrror in innodb_log_group_home_dir");

2964 
mem_‰ì_™d_îr‹
;

2967 i‡(
önoba£_múr‹ed_log_groups
 == 1) {

2968 
	`sql_¥öt_w¨nög
(

2974 i‡(
önoba£_múr‹ed_log_groups
 > 1) {

2975 
	`sql_¥öt_îr‹
(

2979 
mem_‰ì_™d_îr‹
;

2982 i‡(
önoba£_múr‹ed_log_groups
 == 0) {

2986 
önoba£_múr‹ed_log_groups
 = 1;

2990 i‡(
önoba£_fûe_f‹m©_«me
 !
NULL
) {

2992 
f‹m©_id
 = 
	`önoba£_fûe_f‹m©_«me_lookup
(

2993 
önoba£_fûe_f‹m©_«me
);

2995 i‡(
f‹m©_id
 > 
UNIV_FORMAT_MAX
) {

2997 
	`sql_¥öt_îr‹
("InnoDB: wrong innodb_file_format.");

2999 
mem_‰ì_™d_îr‹
;

3004 
f‹m©_id
 = 0;

3007 
§v_fûe_f‹m©
 = 
f‹m©_id
;

3014 
önoba£_fûe_f‹m©_«me
 =

3015 (*Ë
	`åx_sys_fûe_f‹m©_id_to_«me
(
f‹m©_id
);

3018 i‡(!
önoba£_fûe_f‹m©_check
) {

3021 
§v_max_fûe_f‹m©_©_°¨tup
 = 
UNIV_FORMAT_MAX
 + 1;

3026 
§v_max_fûe_f‹m©_©_°¨tup
 = 
UNIV_FORMAT_MIN
;

3032 i‡(
	`önoba£_fûe_f‹m©_vÆid©e_™d_£t
(

3033 
önoba£_fûe_f‹m©_max
) < 0) {

3035 
	`sql_¥öt_îr‹
("InnoDB: invalid "

3039 
	`åx_sys_fûe_f‹m©_id_to_«me
(

3040 
UNIV_FORMAT_MAX
));

3042 
mem_‰ì_™d_îr‹
;

3045 i‡(
önoba£_ch™ge_buf„rög
) {

3046 
ulöt
 
u£
;

3048 
u£
 = 0;

3049 
u£
 < 
	`UT_ARR_SIZE
(
önoba£_ch™ge_buf„rög_vÆues
);

3050 
u£
++) {

3051 i‡(!
	`önoba£_°rˇ£cmp
(

3052 
önoba£_ch™ge_buf„rög
,

3053 
önoba£_ch™ge_buf„rög_vÆues
[
u£
])) {

3054 
ibuf_u£
 = (
ibuf_u£_t
Ë
u£
;

3055 
önoba£_ch™ge_buf„rög_öôed_ok
;

3059 
	`sql_¥öt_îr‹
("InnoDB: invalid value "

3061 
önoba£_ch™ge_buf„rög
);

3062 
mem_‰ì_™d_îr‹
;

3065 
önoba£_ch™ge_buf„rög_öôed_ok
:

3066 
	`ut_a
((
ulöt
Ë
ibuf_u£
 < 
	`UT_ARR_SIZE
(
önoba£_ch™ge_buf„rög_vÆues
));

3067 
önoba£_ch™ge_buf„rög
 = (*)

3068 
önoba£_ch™ge_buf„rög_vÆues
[
ibuf_u£
];

3071 i‡(
§v_max_buf_poﬁ_modifõd_p˘
 < 
§v_max_dúty_∑ges_p˘_lwm
) {

3072 
	`sql_¥öt_w¨nög
("InnoDB: innodb_max_dirty_pages_pct_lwm"

3077 
§v_max_buf_poﬁ_modifõd_p˘
);

3079 
§v_max_dúty_∑ges_p˘_lwm
 = 
§v_max_buf_poﬁ_modifõd_p˘
;

3082 i‡(
§v_max_io_ˇ∑côy
 =
SRV_MAX_IO_CAPACITY_DUMMY_DEFAULT
) {

3084 i‡(
§v_io_ˇ∑côy
 >
SRV_MAX_IO_CAPACITY_LIMIT
 / 2) {

3086 
§v_max_io_ˇ∑côy
 = 
SRV_MAX_IO_CAPACITY_LIMIT
;

3090 
§v_max_io_ˇ∑côy
 = 
°©ic_ˇ°
<
ul⁄g
>(

3091 
	`ut_max
(2 * 
§v_io_ˇ∑côy
, 2000));

3094 } i‡(
§v_max_io_ˇ∑côy
 < 
§v_io_ˇ∑côy
) {

3095 
	`sql_¥öt_w¨nög
("InnoDB: innodb_io_capacity"

3100 
§v_max_io_ˇ∑côy
);

3102 
§v_io_ˇ∑côy
 = 
§v_max_io_ˇ∑côy
;

3105 i‡(!
	`is_fûíame_Ælowed
(
§v_buf_dump_fûíame
,

3106 
	`°æí
(
§v_buf_dump_fûíame
), 
FALSE
)) {

3107 
	`sql_¥öt_îr‹
("InnoDB: innodb_buffer_pool_filename"

3109 
mem_‰ì_™d_îr‹
;

3114 
§v_fûe_Êush_mëhod_°r
 = 
önoba£_fûe_Êush_mëhod
;

3116 
§v_log_fûe_size
 = (
ib_uöt64_t
Ë
önoba£_log_fûe_size
;

3118 #ifde‡
UNIV_LOG_ARCHIVE


3119 
§v_log_¨chive_⁄
 = (
ulöt
Ë
önoba£_log_¨chive
;

3125 
§v_∑ge_size_shi·
 = 
	`önodb_∑ge_size_vÆid©e
(
§v_∑ge_size
);

3126 i‡(!
§v_∑ge_size_shi·
) {

3127 
	`sql_¥öt_îr‹
("InnoDB: InvalidÖage size=%lu.\n",

3128 
§v_∑ge_size
);

3129 
mem_‰ì_™d_îr‹
;

3131 i‡(
UNIV_PAGE_SIZE_DEF
 !
§v_∑ge_size
) {

3132 
	`ut_¥öt_time°amp
(
°dîr
);

3133 
	`Ârötf
(
°dîr
,

3136 
UNIV_PAGE_SIZE_DEF
, 
§v_∑ge_size
);

3139 
§v_log_buf„r_size
 = (
ulöt
Ë
önoba£_log_buf„r_size
;

3141 i‡(
önoba£_buf„r_poﬁ_ö°™˚s
 == 0) {

3142 
önoba£_buf„r_poﬁ_ö°™˚s
 = 8;

3144 #i‡
	`deföed
(
__WIN__
Ë&& !deföed(
_WIN64
)

3145 i‡(
önoba£_buf„r_poﬁ_size
 > 1331 * 1024 * 1024) {

3146 
önoba£_buf„r_poﬁ_ö°™˚s


3147 
	`ut_mö
(
MAX_BUFFER_POOLS
,

3148 (Ë(
önoba£_buf„r_poﬁ_size


3153 
§v_buf_poﬁ_size
 = (
ulöt
Ë
önoba£_buf„r_poﬁ_size
;

3154 
§v_buf_poﬁ_ö°™˚s
 = (
ulöt
Ë
önoba£_buf„r_poﬁ_ö°™˚s
;

3156 
§v_mem_poﬁ_size
 = (
ulöt
Ë
önoba£_addôi⁄Æ_mem_poﬁ_size
;

3158 i‡(
önoba£_addôi⁄Æ_mem_poﬁ_size


3161 
	`ut_¥öt_time°amp
(
°dîr
);

3162 
	`Ârötf
(
°dîr
,

3171 i‡(!
§v_u£_sys_mÆloc
 ) {

3172 
	`ut_¥öt_time°amp
(
°dîr
);

3173 
	`Ârötf
(
°dîr
,

3181 
§v_n_fûe_io_thªads
 = (
ulöt
Ë
önoba£_fûe_io_thªads
;

3182 
§v_n_ªad_io_thªads
 = (
ulöt
Ë
önoba£_ªad_io_thªads
;

3183 
§v_n_wrôe_io_thªads
 = (
ulöt
Ë
önoba£_wrôe_io_thªads
;

3185 
§v_u£_doubÀwrôe_buf
 = (
iboﬁ
Ë
önoba£_u£_doubÀwrôe
;

3187 i‡(!
önoba£_u£_checksums
) {

3188 
	`ut_¥öt_time°amp
(
°dîr
);

3189 
	`Ârötf
(
°dîr
,

3195 
§v_checksum_Æg‹ôhm
 = 
SRV_CHECKSUM_ALGORITHM_NONE
;

3198 #ifde‡
HAVE_LARGE_PAGES


3199 i‡((
os_u£_œrge_∑ges
 = (
iboﬁ
Ë
my_u£_œrge_∑ges
)) {

3200 
os_œrge_∑ge_size
 = (
ulöt
Ë
›t_œrge_∑ge_size
;

3204 
row_rﬁlback_⁄_timeout
 = (
iboﬁ
Ë
önoba£_rﬁlback_⁄_timeout
;

3206 
§v_locks_unß„_f‹_bölog
 = (
iboﬁ
Ë
önoba£_locks_unß„_f‹_bölog
;

3207 i‡(
önoba£_locks_unß„_f‹_bölog
) {

3208 
	`ut_¥öt_time°amp
(
°dîr
);

3209 
	`Ârötf
(
°dîr
,

3214 "Àvñ in°ód, sì " 
REFMAN
 "set-transaction.html.\n");

3217 i‡(
önoba£_›í_fûes
 < 10) {

3218 
önoba£_›í_fûes
 = 300;

3219 i‡(
§v_fûe_≥r_èbÀ
 && 
èbÀ_ˇche_size
 > 300) {

3220 
önoba£_›í_fûes
 = 
èbÀ_ˇche_size
;

3223 
§v_max_n_›í_fûes
 = (
ulöt
Ë
önoba£_›í_fûes
;

3224 
§v_önodb_°©us
 = (
iboﬁ
Ë
önoba£_¸óã_°©us_fûe
;

3226 
§v_¥öt_vîbo£_log
 = 
mysqld_embedded
 ? 0 : 1;

3229 
num_∂l_degªe
 = 1;

3230 
num_∂l_degªe
 < 
·s_s‹t_∂l_degªe
;

3231 
num_∂l_degªe
 <<= 1) {

3236 
·s_s‹t_∂l_degªe
 = 
num_∂l_degªe
;

3241 
d©a_mysql_deÁu…_ch¨£t_cﬁl
 = (
ulöt
Ë
deÁu…_ch¨£t_öfo
->
numbî
;

3243 
	`ut_a
(
DATA_MYSQL_LATIN1_SWEDISH_CHARSET_COLL
 ==

3244 
my_ch¨£t_œtö1
.
numbî
);

3245 
	`ut_a
(
DATA_MYSQL_BINARY_CHARSET_COLL
 =
my_ch¨£t_bö
.
numbî
);

3252 
	`ut_a
(0 =
	`°rcmp
(
my_ch¨£t_œtö1
.
«me
, "latin1_swedish_ci"));

3253 
§v_œtö1_‹dîög
 = 
my_ch¨£t_œtö1
.
s‹t_‹dî
;

3255 
	`önoba£_commô_c⁄cuºícy_öô_deÁu…
();

3257 #ifde‡
HAVE_PSI_INTERFACE


3259 
cou¡
;

3261 
cou¡
 = 
	`¨øy_ñemíts
(
Æl_±hªad_muãxes
);

3262 
	`mysql_muãx_ªgi°î
("önodb", 
Æl_±hªad_muãxes
, 
cou¡
);

3264 #ifde‡
UNIV_PFS_MUTEX


3265 
cou¡
 = 
	`¨øy_ñemíts
(
Æl_önodb_muãxes
);

3266 
	`mysql_muãx_ªgi°î
("önodb", 
Æl_önodb_muãxes
, 
cou¡
);

3269 #ifde‡
UNIV_PFS_RWLOCK


3270 
cou¡
 = 
	`¨øy_ñemíts
(
Æl_önodb_rwlocks
);

3271 
	`mysql_rwlock_ªgi°î
("önodb", 
Æl_önodb_rwlocks
, 
cou¡
);

3274 #ifde‡
UNIV_PFS_THREAD


3275 
cou¡
 = 
	`¨øy_ñemíts
(
Æl_önodb_thªads
);

3276 
	`mysql_thªad_ªgi°î
("önodb", 
Æl_önodb_thªads
, 
cou¡
);

3279 #ifde‡
UNIV_PFS_IO


3280 
cou¡
 = 
	`¨øy_ñemíts
(
Æl_önodb_fûes
);

3281 
	`mysql_fûe_ªgi°î
("önodb", 
Æl_önodb_fûes
, 
cou¡
);

3284 
cou¡
 = 
	`¨øy_ñemíts
(
Æl_önodb_c⁄ds
);

3285 
	`mysql_c⁄d_ªgi°î
("önodb", 
Æl_önodb_c⁄ds
, 
cou¡
);

3294 
îr
 = 
	`önoba£_°¨t_‹_¸óã_f‹_mysql
();

3296 i‡(
îr
 !
DB_SUCCESS
) {

3297 
mem_‰ì_™d_îr‹
;

3301 
	`önoba£_undo_logs_öô_deÁu…_max
();

3303 
önoba£_ﬁd_blocks_p˘
 = 
°©ic_ˇ°
<
uöt
>(

3304 
	`buf_LRU_ﬁd_øtio_upd©e
(
önoba£_ﬁd_blocks_p˘
, 
TRUE
));

3306 
	`ibuf_max_size_upd©e
(
önoba£_ch™ge_buf„r_max_size
);

3308 
önoba£_›í_èbÀs
 = 
	`hash_¸óã
(200);

3309 
	`mysql_muãx_öô
(
önoba£_sh¨e_muãx_key
,

3310 &
önoba£_sh¨e_muãx
,

3311 
MY_MUTEX_INIT_FAST
);

3312 
	`mysql_muãx_öô
(
commô_c⁄d_muãx_key
,

3313 &
commô_c⁄d_m
, 
MY_MUTEX_INIT_FAST
);

3314 
	`mysql_c⁄d_öô
(
commô_c⁄d_key
, &
commô_c⁄d
, 
NULL
);

3315 
önodb_öôed
= 1;

3316 #ifde‡
MYSQL_DYNAMIC_PLUGIN


3317 i‡(
önoba£_ht⁄
 !
p
) {

3318 
önoba£_ht⁄
 = 
ªöãΩªt_ˇ°
<
h™dÀπ⁄
*>(
p
);

3319 *
önoba£_ht⁄
 = *
önodb_ht⁄_±r
;

3324 
önoba£_fûe_f‹m©_max
 = (*Ë
	`åx_sys_fûe_f‹m©_max_gë
();

3327 
	`mem£t
(
m⁄ô‹_£t_tbl
, 0,  monitor_set_tbl);

3329 
	`mem£t
(
önodb_cou¡î_vÆue
, 0,  innodb_counter_value);

3334 i‡(
önoba£_íabÀ_m⁄ô‹_cou¡î
) {

3335 
	`önodb_íabÀ_m⁄ô‹_©_°¨tup
(

3336 
önoba£_íabÀ_m⁄ô‹_cou¡î
);

3340 
	`§v_m⁄_deÁu…_⁄
();

3342 
	`DBUG_RETURN
(
FALSE
);

3343 
îr‹
:

3344 
	`DBUG_RETURN
(
TRUE
);

3345 
	}
}

3352 
önoba£_íd
(

3354 
h™dÀπ⁄
* 
ht⁄
,

3355 
ha_∑nic_fun˘i⁄
 
ty≥
 
__©åibuã__
((
unu£d
)))

3358 
	gîr
= 0;

3360 
DBUG_ENTER
("innobase_end");

3361 
DBUG_ASSERT
(
ht⁄
 =
önodb_ht⁄_±r
);

3363 i‡(
	gönodb_öôed
) {

3365 
	g§v_Á°_shutdown
 = (
ulöt
Ë
önoba£_Á°_shutdown
;

3367 
	gönodb_öôed
 = 0;

3368 
hash_èbÀ_‰ì
(
önoba£_›í_èbÀs
);

3369 
	gönoba£_›í_èbÀs
 = 
NULL
;

3370 i‡(
önoba£_shutdown_f‹_mysql
(Ë!
DB_SUCCESS
) {

3371 
îr
 = 1;

3373 
§v_‰ì_∑ths_™d_sizes
();

3374 
my_‰ì
(
öã∫Æ_önoba£_d©a_fûe_∑th
);

3375 
mysql_muãx_de°roy
(&
önoba£_sh¨e_muãx
);

3376 
mysql_muãx_de°roy
(&
commô_c⁄d_m
);

3377 
mysql_c⁄d_de°roy
(&
commô_c⁄d
);

3380 
DBUG_RETURN
(
îr
);

3388 
boﬁ


3389 
	$önoba£_Êush_logs
(

3391 
h™dÀπ⁄
* 
ht⁄
)

3393 
boﬁ
 
ªsu…
 = 0;

3395 
	`DBUG_ENTER
("innobase_flush_logs");

3396 
	`DBUG_ASSERT
(
ht⁄
 =
önodb_ht⁄_±r
);

3398 i‡(!
§v_ªad_⁄ly_mode
) {

3399 
	`log_buf„r_Êush_to_disk
();

3402 
	`DBUG_RETURN
(
ªsu…
);

3403 
	}
}

3409 
	$önoba£_commô_low
(

3411 
åx_t
* 
åx
)

3413 i‡(
	`åx_is_°¨ãd
(
åx
)) {

3415 
	`åx_commô_f‹_mysql
(
åx
);

3417 
	}
}

3427 
	$önoba£_°¨t_åx_™d_assign_ªad_võw
(

3429 
h™dÀπ⁄
* 
ht⁄
,

3430 
THD
* 
thd
)

3433 
åx_t
* 
åx
;

3435 
	`DBUG_ENTER
("innobase_start_trx_and_assign_read_view");

3436 
	`DBUG_ASSERT
(
ht⁄
 =
önodb_ht⁄_±r
);

3440 
åx
 = 
	`check_åx_exi°s
(
thd
);

3447 
	`åx_£¨ch_œtch_ªÀa£_if_ª£rved
(
åx
);

3449 
	`önoba£_§v_c⁄c_f‹˚_exô_önodb
(
åx
);

3453 
	`åx_°¨t_if_nŸ_°¨ãd_xa
(
åx
);

3458 
åx
->
isﬁ©i⁄_Àvñ
 = 
	`önoba£_m≠_isﬁ©i⁄_Àvñ
(

3459 
	`thd_gë_åx_isﬁ©i⁄
(
thd
));

3461 i‡(
åx
->
isﬁ©i⁄_Àvñ
 =
TRX_ISO_REPEATABLE_READ
) {

3462 
	`åx_assign_ªad_võw
(
åx
);

3464 
	`push_w¨nög_¥ötf
(
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

3465 
HA_ERR_UNSUPPORTED
,

3474 
	`önoba£_ªgi°î_åx
(
ht⁄
, 
cuºít_thd
, 
åx
);

3476 
	`DBUG_RETURN
(0);

3477 
	}
}

3485 
	$önoba£_commô
(

3487 
h™dÀπ⁄
* 
ht⁄
,

3488 
THD
* 
thd
,

3491 
boﬁ
 
commô_åx
)

3495 
åx_t
* 
åx
;

3497 
	`DBUG_ENTER
("innobase_commit");

3498 
	`DBUG_ASSERT
(
ht⁄
 =
önodb_ht⁄_±r
);

3499 
	`DBUG_PRINT
("trans", ("endingÅransaction"));

3501 
åx
 = 
	`check_åx_exi°s
(
thd
);

3506 i‡(
åx
->
has_£¨ch_œtch
) {

3507 
	`åx_£¨ch_œtch_ªÀa£_if_ª£rved
(
åx
);

3515 i‡(!
	`åx_is_ªgi°îed_f‹_2pc
(
åx
Ë&& 
	`åx_is_°¨ãd
(trx)) {

3517 
	`sql_¥öt_îr‹
("TransactionÇotÑegistered for MySQL 2PC, "

3521 i‡(
commô_åx


3522 || (!
	`thd_ã°_›ti⁄s
(
thd
, 
OPTION_NOT_AUTOCOMMIT
 | 
OPTION_BEGIN
))) {

3528 
ªåy
:

3529 i‡(
önoba£_commô_c⁄cuºícy
 > 0) {

3530 
	`mysql_muãx_lock
(&
commô_c⁄d_m
);

3531 
commô_thªads
++;

3533 i‡(
commô_thªads
 > 
önoba£_commô_c⁄cuºícy
) {

3534 
commô_thªads
--;

3535 
	`mysql_c⁄d_waô
(&
commô_c⁄d
,

3536 &
commô_c⁄d_m
);

3537 
	`mysql_muãx_u∆ock
(&
commô_c⁄d_m
);

3538 
ªåy
;

3541 
	`mysql_muãx_u∆ock
(&
commô_c⁄d_m
);

3557 
pos
;

3558 
	`thd_bölog_pos
(
thd
, &
åx
->
mysql_log_fûe_«me
, &
pos
);

3559 
åx
->
mysql_log_off£t

°©ic_ˇ°
<
ib_öt64_t
>(
pos
);

3562 
åx
->
Êush_log_œãr
 = 
TRUE
;

3563 
	`önoba£_commô_low
(
åx
);

3564 
åx
->
Êush_log_œãr
 = 
FALSE
;

3566 i‡(
önoba£_commô_c⁄cuºícy
 > 0) {

3567 
	`mysql_muãx_lock
(&
commô_c⁄d_m
);

3568 
commô_thªads
--;

3569 
	`mysql_c⁄d_sig«l
(&
commô_c⁄d
);

3570 
	`mysql_muãx_u∆ock
(&
commô_c⁄d_m
);

3573 
	`åx_dîegi°î_‰om_2pc
(
åx
);

3576 
	`åx_commô_com∂ëe_f‹_mysql
(
åx
);

3584 
	`lock_u∆ock_èbÀ_autoöc
(
åx
);

3590 
	`åx_m¨k_sql_°©_íd
(
åx
);

3593 
åx
->
n_autoöc_rows
 = 0;

3596 
åx
->
·s_√xt_doc_id
 = 0;

3598 
	`önoba£_§v_c⁄c_f‹˚_exô_önodb
(
åx
);

3600 
	`DBUG_RETURN
(0);

3601 
	}
}

3608 
	$önoba£_rﬁlback
(

3610 
h™dÀπ⁄
* 
ht⁄
,

3611 
THD
* 
thd
,

3614 
boﬁ
 
rﬁlback_åx
)

3618 
dbîr_t
 
îr‹
;

3619 
åx_t
* 
åx
;

3621 
	`DBUG_ENTER
("innobase_rollback");

3622 
	`DBUG_ASSERT
(
ht⁄
 =
önodb_ht⁄_±r
);

3623 
	`DBUG_PRINT
("trans", ("abortingÅransaction"));

3625 
åx
 = 
	`check_åx_exi°s
(
thd
);

3631 
	`åx_£¨ch_œtch_ªÀa£_if_ª£rved
(
åx
);

3633 
	`önoba£_§v_c⁄c_f‹˚_exô_önodb
(
åx
);

3635 
åx
->
n_autoöc_rows
 = 0;

3641 
	`lock_u∆ock_èbÀ_autoöc
(
åx
);

3644 
åx
->
·s_√xt_doc_id
 = 0;

3646 i‡(
rﬁlback_åx


3647 || !
	`thd_ã°_›ti⁄s
(
thd
, 
OPTION_NOT_AUTOCOMMIT
 | 
OPTION_BEGIN
)) {

3649 
îr‹
 = 
	`åx_rﬁlback_f‹_mysql
(
åx
);

3650 
	`åx_dîegi°î_‰om_2pc
(
åx
);

3652 
îr‹
 = 
	`åx_rﬁlback_œ°_sql_°©_f‹_mysql
(
åx
);

3655 
	`DBUG_RETURN
(
	`c⁄vît_îr‹_code_to_mysql
(
îr‹
, 0, 
NULL
));

3656 
	}
}

3663 
	$önoba£_rﬁlback_åx
(

3665 
åx_t
* 
åx
)

3667 
dbîr_t
 
îr‹
 = 
DB_SUCCESS
;

3669 
	`DBUG_ENTER
("innobase_rollback_trx");

3670 
	`DBUG_PRINT
("trans", ("abortingÅransaction"));

3676 
	`åx_£¨ch_œtch_ªÀa£_if_ª£rved
(
åx
);

3678 
	`önoba£_§v_c⁄c_f‹˚_exô_önodb
(
åx
);

3684 
	`lock_u∆ock_èbÀ_autoöc
(
åx
);

3686 i‡(!
åx
->
ªad_⁄ly
) {

3687 
îr‹
 = 
	`åx_rﬁlback_f‹_mysql
(
åx
);

3690 
	`DBUG_RETURN
(
	`c⁄vît_îr‹_code_to_mysql
(
îr‹
, 0, 
NULL
));

3691 
	}
}

3699 
	$önoba£_rﬁlback_to_ßvïoöt
(

3701 
h™dÀπ⁄
* 
ht⁄
,

3702 
THD
* 
thd
,

3705 * 
ßvïoöt
)

3707 
ib_öt64_t
 
mysql_bölog_ˇche_pos
;

3708 
dbîr_t
 
îr‹
;

3709 
åx_t
* 
åx
;

3710 
«me
[64];

3712 
	`DBUG_ENTER
("innobase_rollback_to_savepoint");

3713 
	`DBUG_ASSERT
(
ht⁄
 =
önodb_ht⁄_±r
);

3715 
åx
 = 
	`check_åx_exi°s
(
thd
);

3721 
	`åx_£¨ch_œtch_ªÀa£_if_ª£rved
(
åx
);

3723 
	`önoba£_§v_c⁄c_f‹˚_exô_önodb
(
åx
);

3727 
	`l⁄gl⁄g2°r
((
ulöt
Ë
ßvïoöt
, 
«me
, 36);

3729 
îr‹
 = 
	`åx_rﬁlback_to_ßvïoöt_f‹_mysql
(

3730 
åx
, 
«me
, &
mysql_bölog_ˇche_pos
);

3732 i‡(
îr‹
 =
DB_SUCCESS
 && 
åx
->
·s_åx
 !
NULL
) {

3733 
	`·s_ßvïoöt_rﬁlback
(
åx
, 
«me
);

3736 
	`DBUG_RETURN
(
	`c⁄vît_îr‹_code_to_mysql
(
îr‹
, 0, 
NULL
));

3737 
	}
}

3746 
boﬁ


3747 
	$önoba£_rﬁlback_to_ßvïoöt_ˇn_ªÀa£_mdl
(

3749 
h™dÀπ⁄
* 
ht⁄
,

3750 
THD
* 
thd
)

3754 
åx_t
* 
åx
;

3756 
	`DBUG_ENTER
("innobase_rollback_to_savepoint_can_release_mdl");

3757 
	`DBUG_ASSERT
(
ht⁄
 =
önodb_ht⁄_±r
);

3759 
åx
 = 
	`check_åx_exi°s
(
thd
);

3760 
	`ut_ad
(
åx
);

3764 i‡(!(
	`UT_LIST_GET_LEN
(
åx
->
lock
.
åx_locks
))) {

3765 
	`DBUG_RETURN
(
åue
);

3768 
	`DBUG_RETURN
(
Ál£
);

3769 
	}
}

3777 
	$önoba£_ªÀa£_ßvïoöt
(

3779 
h™dÀπ⁄
* 
ht⁄
,

3780 
THD
* 
thd
,

3783 * 
ßvïoöt
)

3785 
dbîr_t
 
îr‹
;

3786 
åx_t
* 
åx
;

3787 
«me
[64];

3789 
	`DBUG_ENTER
("innobase_release_savepoint");

3790 
	`DBUG_ASSERT
(
ht⁄
 =
önodb_ht⁄_±r
);

3792 
åx
 = 
	`check_åx_exi°s
(
thd
);

3796 
	`l⁄gl⁄g2°r
((
ulöt
Ë
ßvïoöt
, 
«me
, 36);

3798 
îr‹
 = 
	`åx_ªÀa£_ßvïoöt_f‹_mysql
(
åx
, 
«me
);

3800 i‡(
îr‹
 =
DB_SUCCESS
 && 
åx
->
·s_åx
 !
NULL
) {

3801 
	`·s_ßvïoöt_ªÀa£
(
åx
, 
«me
);

3804 
	`DBUG_RETURN
(
	`c⁄vît_îr‹_code_to_mysql
(
îr‹
, 0, 
NULL
));

3805 
	}
}

3812 
	$önoba£_ßvïoöt
(

3814 
h™dÀπ⁄
* 
ht⁄
,

3815 
THD
* 
thd
,

3816 * 
ßvïoöt
)

3818 
dbîr_t
 
îr‹
;

3819 
åx_t
* 
åx
;

3821 
	`DBUG_ENTER
("innobase_savepoint");

3822 
	`DBUG_ASSERT
(
ht⁄
 =
önodb_ht⁄_±r
);

3828 
åx
 = 
	`check_åx_exi°s
(
thd
);

3834 
	`åx_£¨ch_œtch_ªÀa£_if_ª£rved
(
åx
);

3836 
	`önoba£_§v_c⁄c_f‹˚_exô_önodb
(
åx
);

3839 
	`DBUG_ASSERT
(
	`åx_is_ªgi°îed_f‹_2pc
(
åx
));

3842 
«me
[64];

3843 
	`l⁄gl⁄g2°r
((
ulöt
Ë
ßvïoöt
,
«me
,36);

3845 
îr‹
 = 
	`åx_ßvïoöt_f‹_mysql
(
åx
, 
«me
, (
ib_öt64_t
)0);

3847 i‡(
îr‹
 =
DB_SUCCESS
 && 
åx
->
·s_åx
 !
NULL
) {

3848 
	`·s_ßvïoöt_èke
(
åx
,Årx->
·s_åx
, 
«me
);

3851 
	`DBUG_RETURN
(
	`c⁄vît_îr‹_code_to_mysql
(
îr‹
, 0, 
NULL
));

3852 
	}
}

3859 
	$önoba£_˛o£_c⁄√˘i⁄
(

3861 
h™dÀπ⁄
* 
ht⁄
,

3862 
THD
* 
thd
)

3865 
åx_t
* 
åx
;

3867 
	`DBUG_ENTER
("innobase_close_connection");

3868 
	`DBUG_ASSERT
(
ht⁄
 =
önodb_ht⁄_±r
);

3869 
åx
 = 
	`thd_to_åx
(
thd
);

3871 
	`ut_a
(
åx
);

3873 i‡(!
	`åx_is_ªgi°îed_f‹_2pc
(
åx
Ë&& 
	`åx_is_°¨ãd
(trx)) {

3875 
	`sql_¥öt_îr‹
("TransactionÇotÑegistered for MySQL 2PC, "

3879 i‡(
	`åx_is_°¨ãd
(
åx
Ë&& 
log_w¨nögs
) {

3881 
	`sql_¥öt_w¨nög
(

3883 "I¬oDBÅønß˘i⁄. " 
TRX_ID_FMT
 "Ñow modifications "

3885 
åx
->
undo_no
);

3888 
	`önoba£_rﬁlback_åx
(
åx
);

3890 
	`åx_‰ì_f‹_mysql
(
åx
);

3892 
	`DBUG_RETURN
(0);

3893 
	}
}

3898 
UNIV_INTERN


3900 
	$önoba£_˛o£_thd
(

3902 
THD
* 
thd
)

3905 
åx_t
* 
åx
 = 
	`thd_to_åx
(
thd
);

3907 i‡(!
åx
) {

3911 (
	`önoba£_˛o£_c⁄√˘i⁄
(
önodb_ht⁄_±r
, 
thd
));

3912 
	}
}

3922 
UNIV_INTERN


3923 
row_ty≥


3924 
	gha_önoba£
::
	$gë_row_ty≥
() const

3927 i‡(
¥ebuût
 &&Öªbuût->
èbÀ
) {

3928 c⁄° 
ulöt
 
Êags
 = 
¥ebuût
->
èbÀ
->flags;

3930 
	`di˘_tf_gë_ªc_f‹m©
(
Êags
)) {

3931 
REC_FORMAT_REDUNDANT
:

3932 (
ROW_TYPE_REDUNDANT
);

3933 
REC_FORMAT_COMPACT
:

3934 (
ROW_TYPE_COMPACT
);

3935 
REC_FORMAT_COMPRESSED
:

3936 (
ROW_TYPE_COMPRESSED
);

3937 
REC_FORMAT_DYNAMIC
:

3938 (
ROW_TYPE_DYNAMIC
);

3941 
	`ut_ad
(0);

3942 (
ROW_TYPE_NOT_USED
);

3943 
	}
}

3950 
UNIV_INTERN


3951 
	gh™dÀr
::
TabÀ_Êags


3952 
ha_önoba£
::
	$èbÀ_Êags
() const

3957 
ul⁄g
 c⁄° 
tx_isﬁ©i⁄
 = 
	`thd_tx_isﬁ©i⁄
(
	`ha_thd
());

3959 i‡(
tx_isﬁ©i⁄
 <
ISO_READ_COMMITTED
) {

3960 (
öt_èbÀ_Êags
);

3963 (
öt_èbÀ_Êags
 | 
HA_BINLOG_STMT_CAPABLE
);

3964 
	}
}

3968 c⁄° * 
	gha_önoba£_exts
[] = {

3971 
NuŒS


3977 
UNIV_INTERN


3979 
	gha_önoba£
::
	$èbÀ_ty≥
() const

3982 (
önoba£_ht⁄_«me
);

3983 
	}
}

3988 
UNIV_INTERN


3990 
	gha_önoba£
::
	$ödex_ty≥
(

3992 
uöt
 
keyƒ
)

3994 
di˘_ödex_t
* 
ödex
 = 
	`önoba£_gë_ödex
(
keyƒ
);

3996 i‡(
ödex
 && index->
ty≥
 & 
DICT_FTS
) {

4001 
	}
}

4006 
UNIV_INTERN


4008 
	gha_önoba£
::
	$bas_ext
() const

4011 (
ha_önoba£_exts
);

4012 
	}
}

4017 
UNIV_INTERN


4018 
ul⁄g


4019 
	gha_önoba£
::
	$ödex_Êags
(

4021 
uöt
 
key
,

4022 
uöt
,

4023 
boﬁ
) const

4025 ((
èbÀ_sh¨e
->
key_öfo
[
key
].
Æg‹ôhm
 =
HA_KEY_ALG_FULLTEXT
)

4027 : (
HA_READ_NEXT
 | 
HA_READ_PREV
 | 
HA_READ_ORDER


4028 | 
HA_READ_RANGE
 | 
HA_KEYREAD_ONLY


4029 | 
HA_DO_INDEX_COND_PUSHDOWN
));

4030 
	}
}

4035 
UNIV_INTERN


4036 
uöt


4037 
	gha_önoba£
::
	$max_suµ‹ãd_keys
() const

4040 (
MAX_KEY
);

4041 
	}
}

4046 
UNIV_INTERN


4047 
uöt


4048 
	gha_önoba£
::
	$max_suµ‹ãd_key_Àngth
() const

4063 
UNIV_PAGE_SIZE
) {

4071 
	}
}

4076 
UNIV_INTERN


4077 c⁄° 
key_m≠
*

4078 
	gha_önoba£
::
	$keys_to_u£_f‹_sˇ¬ög
()

4081 (&
key_m≠_fuŒ
);

4082 
	}
}

4087 
UNIV_INTERN


4088 
uöt8


4089 
	gha_önoba£
::
	$èbÀ_ˇche_ty≥
()

4092 (
HA_CACHE_TBL_ASKTRANSACT
);

4093 
	}
}

4098 
UNIV_INTERN


4099 
boﬁ


4100 
	gha_önoba£
::
	$¥im¨y_key_is_˛u°îed
()

4103 (
åue
);

4104 
	}
}

4113 
	$n‹mÆize_èbÀ_«me_low
(

4115 * 
n‹m_«me
,

4117 c⁄° * 
«me
,

4118 
iboﬁ
 
£t_lowî_ˇ£
)

4121 * 
«me_±r
;

4122 
ulöt
 
«me_Àn
;

4123 * 
db_±r
;

4124 
ulöt
 
db_Àn
;

4125 * 
±r
;

4126 
ulöt
 
n‹m_Àn
;

4130 
±r
 = 
	`°ªnd
(
«me
) - 1;

4133 
±r
 >
«me
 && *ptr != '\\' && *ptr != '/') {

4134 
±r
--;

4137 
«me_±r
 = 
±r
 + 1;

4138 
«me_Àn
 = 
	`°æí
(
«me_±r
);

4141 
±r
 >
«me
 && (*ptr == '\\' || *ptr == '/')) {

4142 
±r
--;

4145 
	`DBUG_ASSERT
(
±r
 >
«me
);

4149 
db_Àn
 = 0;

4150 
±r
 >
«me
 && *ptr != '\\' && *ptr != '/') {

4151 
±r
--;

4152 
db_Àn
++;

4155 
db_±r
 = 
±r
 + 1;

4157 
n‹m_Àn
 = 
db_Àn
 + 
«me_Àn
 +  "/";

4158 
	`ut_a
(
n‹m_Àn
 < 
FN_REFLEN
 - 1);

4160 
	`mem˝y
(
n‹m_«me
, 
db_±r
, 
db_Àn
);

4162 
n‹m_«me
[
db_Àn
] = '/';

4165 
	`mem˝y
(
n‹m_«me
 + 
db_Àn
 + 1, 
«me_±r
, 
«me_Àn
 + 1);

4167 i‡(
£t_lowî_ˇ£
) {

4168 
	`önoba£_ˇ£dn_°r
(
n‹m_«me
);

4170 
	}
}

4172 #i‡!
deföed
(
DBUG_OFF
)

4177 
	$ã°_n‹mÆize_èbÀ_«me_low
()

4180 
n‹m_«me
[
FN_REFLEN
];

4181 c⁄° * 
ã°_d©a
[][2] = {

4221 
size_t
 
i
 = 0; i < 
	`UT_ARR_SIZE
(
ã°_d©a
); i++) {

4222 
	`¥ötf
("test_normalize_table_name_low(): "

4224 
ã°_d©a
[
i
][0],Åest_data[i][1]);

4226 
	`n‹mÆize_èbÀ_«me_low
(
n‹m_«me
, 
ã°_d©a
[
i
][0], 
FALSE
);

4228 i‡(
	`°rcmp
(
n‹m_«me
, 
ã°_d©a
[
i
][1]) == 0) {

4229 
	`¥ötf
("ok\n");

4231 
	`¥ötf
("gŸ \"%s\"\n", 
n‹m_«me
);

4232 
ut_îr‹
;

4235 
	}
}

4241 
	$ã°_ut_f‹m©_«me
()

4244 
buf
[
NAME_LEN
 * 3];

4247 c⁄° * 
«me
;

4248 
iboﬁ
 
is_èbÀ
;

4249 
ulöt
 
buf_size
;

4250 c⁄° * 
ex≥˘ed
;

4251 } 
ã°_d©a
[] = {

4252 {"ã°/t1", 
TRUE
, (
buf
), "\"test\".\"t1\""},

4253 {"ã°/t1", 
TRUE
, 12, "\"test\".\"t1\""},

4254 {"ã°/t1", 
TRUE
, 11, "\"test\".\"t1"},

4255 {"ã°/t1", 
TRUE
, 10, "\"test\".\"t"},

4256 {"ã°/t1", 
TRUE
, 9, "\"test\".\""},

4257 {"ã°/t1", 
TRUE
, 8, "\"test\"."},

4258 {"ã°/t1", 
TRUE
, 7, "\"test\""},

4259 {"ã°/t1", 
TRUE
, 6, "\"test"},

4260 {"ã°/t1", 
TRUE
, 5, "\"tes"},

4261 {"ã°/t1", 
TRUE
, 4, "\"te"},

4262 {"ã°/t1", 
TRUE
, 3, "\"t"},

4263 {"ã°/t1", 
TRUE
, 2, "\""},

4264 {"ã°/t1", 
TRUE
, 1, ""},

4265 {"ã°/t1", 
TRUE
, 0, "BUF_NOT_CHANGED"},

4266 {"èbÀ", 
TRUE
, (
buf
), "\"table\""},

4267 {"è'À", 
TRUE
, (
buf
), "\"ta'le\""},

4268 {"è\"À", 
TRUE
, (
buf
), "\"ta\"\"le\""},

4269 {"è`À", 
TRUE
, (
buf
), "\"ta`le\""},

4270 {"ödex", 
FALSE
, (
buf
), "\"index\""},

4271 {"öd/ex", 
FALSE
, (
buf
), "\"ind/ex\""},

4274 
size_t
 
i
 = 0; i < 
	`UT_ARR_SIZE
(
ã°_d©a
); i++) {

4276 
	`mem˝y
(
buf
, "BUF_NOT_CHANGED", 
	`°æí
("BUF_NOT_CHANGED") + 1);

4278 * 
ªt
;

4280 
ªt
 = 
	`ut_f‹m©_«me
(
ã°_d©a
[
i
].
«me
,

4281 
ã°_d©a
[
i
].
is_èbÀ
,

4282 
buf
,

4283 
ã°_d©a
[
i
].
buf_size
);

4285 
	`ut_a
(
ªt
 =
buf
);

4287 i‡(
	`°rcmp
(
buf
, 
ã°_d©a
[
i
].
ex≥˘ed
) == 0) {

4288 
	`Ârötf
(
°dîr
,

4291 
ã°_d©a
[
i
].
«me
,

4292 
ã°_d©a
[
i
].
is_èbÀ
 ? "TRUE" : "FALSE",

4293 
ã°_d©a
[
i
].
buf_size
,

4294 
ã°_d©a
[
i
].
ex≥˘ed
);

4296 
	`Ârötf
(
°dîr
,

4299 
ã°_d©a
[
i
].
«me
,

4300 
ã°_d©a
[
i
].
is_èbÀ
 ? "TRUE" : "FALSE",

4301 
ã°_d©a
[
i
].
buf_size
,

4302 
ã°_d©a
[
i
].
ex≥˘ed
,

4303 
buf
);

4304 
ut_îr‹
;

4307 
	}
}

4313 
UNIV_INTERN


4314 
ul⁄gl⁄g


4315 
	$önoba£_gë_öt_cﬁ_max_vÆue
(

4317 c⁄° 
Fõld
* 
fõld
)

4319 
ul⁄gl⁄g
 
max_vÆue
 = 0;

4321 
fõld
->
	`key_ty≥
()) {

4323 
HA_KEYTYPE_BINARY
:

4324 
max_vÆue
 = 0xFFULL;

4326 
HA_KEYTYPE_INT8
:

4327 
max_vÆue
 = 0x7FULL;

4330 
HA_KEYTYPE_USHORT_INT
:

4331 
max_vÆue
 = 0xFFFFULL;

4333 
HA_KEYTYPE_SHORT_INT
:

4334 
max_vÆue
 = 0x7FFFULL;

4337 
HA_KEYTYPE_UINT24
:

4338 
max_vÆue
 = 0xFFFFFFULL;

4340 
HA_KEYTYPE_INT24
:

4341 
max_vÆue
 = 0x7FFFFFULL;

4344 
HA_KEYTYPE_ULONG_INT
:

4345 
max_vÆue
 = 0xFFFFFFFFULL;

4347 
HA_KEYTYPE_LONG_INT
:

4348 
max_vÆue
 = 0x7FFFFFFFULL;

4351 
HA_KEYTYPE_ULONGLONG
:

4352 
max_vÆue
 = 0xFFFFFFFFFFFFFFFFULL;

4354 
HA_KEYTYPE_LONGLONG
:

4355 
max_vÆue
 = 0x7FFFFFFFFFFFFFFFULL;

4357 
HA_KEYTYPE_FLOAT
:

4359 
max_vÆue
 = 0x1000000ULL;

4361 
HA_KEYTYPE_DOUBLE
:

4363 
max_vÆue
 = 0x20000000000000ULL;

4366 
ut_îr‹
;

4369 (
max_vÆue
);

4370 
	}
}

4377 
iboﬁ


4378 
	$önoba£_m©ch_ödex_cﬁumns
(

4380 c⁄° 
KEY
* 
key_öfo
,

4382 c⁄° 
di˘_ödex_t
* 
ödex_öfo
)

4385 c⁄° 
KEY_PART_INFO
* 
key_∑π
;

4386 c⁄° 
KEY_PART_INFO
* 
key_íd
;

4387 c⁄° 
di˘_fõld_t
* 
önodb_idx_Êd
;

4388 c⁄° 
di˘_fõld_t
* 
önodb_idx_Êd_íd
;

4390 
	`DBUG_ENTER
("innobase_match_index_columns");

4393 i‡(
key_öfo
->
u£r_deföed_key_∑πs
 !=

4394 
ödex_öfo
->
n_u£r_deföed_cﬁs
) {

4395 
	`DBUG_RETURN
(
FALSE
);

4398 
key_∑π
 = 
key_öfo
->key_part;

4399 
key_íd
 = 
key_∑π
 + 
key_öfo
->
u£r_deföed_key_∑πs
;

4400 
önodb_idx_Êd
 = 
ödex_öfo
->
fõlds
;

4401 
önodb_idx_Êd_íd
 = 
ödex_öfo
->
fõlds
 + index_öfo->
n_fõlds
;

4409 ; 
key_∑π
 !
key_íd
; ++key_part) {

4410 
ulöt
 
cﬁ_ty≥
;

4411 
iboﬁ
 
is_unsig√d
;

4412 
ulöt
 
mty≥
 = 
önodb_idx_Êd
->
cﬁ
->mtype;

4416 
cﬁ_ty≥
 = 
	`gë_önoba£_ty≥_‰om_mysql_ty≥
(&
is_unsig√d
,

4417 
key_∑π
->
fõld
);

4420 
mty≥
 =
DATA_SYS
) {

4421 
önodb_idx_Êd
++;

4423 i‡(
önodb_idx_Êd
 >
önodb_idx_Êd_íd
) {

4424 
	`DBUG_RETURN
(
FALSE
);

4428 i‡(
cﬁ_ty≥
 !
mty≥
) {

4430 
	`DBUG_RETURN
(
FALSE
);

4433 
önodb_idx_Êd
++;

4436 
	`DBUG_RETURN
(
TRUE
);

4437 
	}
}

4451 
iboﬁ


4452 
	$önoba£_buûd_ödex_å™¶©i⁄
(

4454 c⁄° 
TABLE
* 
èbÀ
,

4456 
di˘_èbÀ_t
* 
ib_èbÀ
,

4458 
INNOBASE_SHARE
* 
sh¨e
)

4462 
ulöt
 
mysql_num_ödex
;

4463 
ulöt
 
ib_num_ödex
;

4464 
di˘_ödex_t
** 
ödex_m≠pög
;

4465 
iboﬁ
 
ªt
 = 
TRUE
;

4467 
	`DBUG_ENTER
("innobase_build_index_translation");

4469 
	`muãx_íãr
(&
di˘_sys
->
muãx
);

4471 
mysql_num_ödex
 = 
èbÀ
->
s
->
keys
;

4472 
ib_num_ödex
 = 
	`UT_LIST_GET_LEN
(
ib_èbÀ
->
ödexes
);

4474 
ödex_m≠pög
 = 
sh¨e
->
idx_å™s_tbl
.index_mapping;

4480 i‡(
	`UNIV_UNLIKELY
(
ib_num_ödex
 < 
mysql_num_ödex
)) {

4481 
ªt
 = 
FALSE
;

4482 
func_exô
;

4487 i‡(
sh¨e
->
idx_å™s_tbl
.
ödex_cou¡
) {

4489 
	`ut_a
(
sh¨e
->
idx_å™s_tbl
.
ödex_cou¡
 =
mysql_num_ödex
);

4490 
func_exô
;

4494 i‡(
mysql_num_ödex
 > 
sh¨e
->
idx_å™s_tbl
.
¨øy_size
) {

4495 
ödex_m≠pög
 = (
di˘_ödex_t
**Ë
	`my_ªÆloc
(index_mapping,

4496 
mysql_num_ödex
 *

4497 (*
ödex_m≠pög
),

4498 
	`MYF
(
MY_ALLOW_ZERO_PTR
));

4500 i‡(!
ödex_m≠pög
) {

4503 
	`sql_¥öt_îr‹
("InnoDB: failÅoállocate memory for "

4506 
mysql_num_ödex
,

4507 
sh¨e
->
idx_å™s_tbl
.
¨øy_size
);

4508 
ªt
 = 
FALSE
;

4509 
func_exô
;

4512 
sh¨e
->
idx_å™s_tbl
.
¨øy_size
 = 
mysql_num_ödex
;

4518 
ulöt
 
cou¡
 = 0; cou¡ < 
mysql_num_ödex
; count++) {

4522 
ödex_m≠pög
[
cou¡
] = 
	`di˘_èbÀ_gë_ödex_⁄_«me
(

4523 
ib_èbÀ
, 
èbÀ
->
key_öfo
[
cou¡
].
«me
);

4525 i‡(!
ödex_m≠pög
[
cou¡
]) {

4526 
	`sql_¥öt_îr‹
("Cannot find index %s in InnoDB "

4528 
èbÀ
->
key_öfo
[
cou¡
].
«me
);

4529 
ªt
 = 
FALSE
;

4530 
func_exô
;

4535 i‡(!
	`önoba£_m©ch_ödex_cﬁumns
(&
èbÀ
->
key_öfo
[
cou¡
],

4536 
ödex_m≠pög
[
cou¡
])) {

4537 
	`sql_¥öt_îr‹
("Found index %s whose column info "

4539 
èbÀ
->
key_öfo
[
cou¡
].
«me
);

4540 
ªt
 = 
FALSE
;

4541 
func_exô
;

4546 
sh¨e
->
idx_å™s_tbl
.
ödex_cou¡
 = 
mysql_num_ödex
;

4548 
func_exô
:

4549 i‡(!
ªt
) {

4551 
	`my_‰ì
(
ödex_m≠pög
);

4553 
sh¨e
->
idx_å™s_tbl
.
¨øy_size
 = 0;

4554 
sh¨e
->
idx_å™s_tbl
.
ödex_cou¡
 = 0;

4555 
ödex_m≠pög
 = 
NULL
;

4558 
sh¨e
->
idx_å™s_tbl
.
ödex_m≠pög
 = index_mapping;

4560 
	`muãx_exô
(&
di˘_sys
->
muãx
);

4562 
	`DBUG_RETURN
(
ªt
);

4563 
	}
}

4575 
di˘_ödex_t
*

4576 
	$önoba£_ödex_lookup
(

4578 
INNOBASE_SHARE
* 
sh¨e
,

4580 
uöt
 
keyƒ
)

4583 i‡(!
sh¨e
->
idx_å™s_tbl
.
ödex_m≠pög


4584 || 
keyƒ
 >
sh¨e
->
idx_å™s_tbl
.
ödex_cou¡
) {

4585 (
NULL
);

4588 (
sh¨e
->
idx_å™s_tbl
.
ödex_m≠pög
[
keyƒ
]);

4589 
	}
}

4594 
UNIV_INTERN


4596 
	gha_önoba£
::
	$önoba£_öôülize_autoöc
()

4599 
ul⁄gl⁄g
 
auto_öc
;

4600 c⁄° 
Fõld
* 
fõld
 = 
èbÀ
->
found_√xt_numbî_fõld
;

4602 i‡(
fõld
 !
NULL
) {

4603 
auto_öc
 = 
	`önoba£_gë_öt_cﬁ_max_vÆue
(
fõld
);

4608 
auto_öc
 = 0;

4610 
	`ut_¥öt_time°amp
(
°dîr
);

4611 
	`Ârötf
(
°dîr
, " InnoDB: UnableÅo determineÅhe AUTOINC "

4615 i‡(
§v_f‹˚_ªcovîy
 >
SRV_FORCE_NO_IBUF_MERGE
) {

4626 
auto_öc
 = 0;

4627 } i‡(
fõld
 =
NULL
) {

4630 
	`my_îr‹
(
ER_AUTOINC_READ_FAILED
, 
	`MYF
(0));

4632 
di˘_ödex_t
* 
ödex
;

4633 c⁄° * 
cﬁ_«me
;

4634 
ib_uöt64_t
 
ªad_auto_öc
;

4635 
ulöt
 
îr
;

4637 
	`upd©e_thd
(
	`ha_thd
());

4639 
	`ut_a
(
¥ebuût
->
åx
 =
	`thd_to_åx
(
u£r_thd
));

4641 
cﬁ_«me
 = 
fõld
->
fõld_«me
;

4642 
ödex
 = 
	`önoba£_gë_ödex
(
èbÀ
->
s
->
√xt_numbî_ödex
);

4645 
îr
 = 
	`row_£¨ch_max_autoöc
(
ödex
, 
cﬁ_«me
, &
ªad_auto_öc
);

4647 
îr
) {

4648 
DB_SUCCESS
: {

4649 
ul⁄gl⁄g
 
cﬁ_max_vÆue
;

4651 
cﬁ_max_vÆue
 = 
	`önoba£_gë_öt_cﬁ_max_vÆue
(
fõld
);

4656 
auto_öc
 = 
	`önoba£_√xt_autoöc
(

4657 
ªad_auto_öc
, 1, 1, 0, 
cﬁ_max_vÆue
);

4661 
DB_RECORD_NOT_FOUND
:

4662 
	`ut_¥öt_time°amp
(
°dîr
);

4663 
	`Ârötf
(
°dîr
, " InnoDB: MySQLánd InnoDB data "

4675 
cﬁ_«me
, 
ödex
->
èbÀ
->
«me
);

4678 
auto_öc
 = 0;

4683 
îr
 = 
DB_SUCCESS
;

4688 
ut_îr‹
;

4692 
	`di˘_èbÀ_autoöc_öôülize
(
¥ebuût
->
èbÀ
, 
auto_öc
);

4693 
	}
}

4699 
UNIV_INTERN


4701 
	gha_önoba£
::
	$›í
(

4703 c⁄° * 
«me
,

4704 
mode
,

4705 
uöt
 
ã°_if_locked
)

4707 
di˘_èbÀ_t
* 
ib_èbÀ
;

4708 
n‹m_«me
[
FN_REFLEN
];

4709 
THD
* 
thd
;

4710 * 
is_∑π
 = 
NULL
;

4711 
iboﬁ
 
∑r_ˇ£_«me_£t
 = 
FALSE
;

4712 
∑r_ˇ£_«me
[
FN_REFLEN
];

4713 
di˘_îr_ign‹e_t
 
ign‹e_îr
 = 
DICT_ERR_IGNORE_NONE
;

4715 
	`DBUG_ENTER
("ha_innobase::open");

4717 
	`UT_NOT_USED
(
mode
);

4718 
	`UT_NOT_USED
(
ã°_if_locked
);

4720 
thd
 = 
	`ha_thd
();

4725 i‡(
thd
 !
NULL
) {

4726 
	`önoba£_ªÀa£_ãmp‹¨y_œtches
(
ht
, 
thd
);

4729 
	`n‹mÆize_èbÀ_«me
(
n‹m_«me
, 
«me
);

4731 
u£r_thd
 = 
NULL
;

4733 i‡(!(
sh¨e
=
	`gë_sh¨e
(
«me
))) {

4735 
	`DBUG_RETURN
(1);

4739 
upd_buf
 = 
NULL
;

4740 
upd_buf_size
 = 0;

4744 #ifde‡
__WIN__


4745 
is_∑π
 = 
	`°r°r
(
n‹m_«me
, "#p#");

4747 
is_∑π
 = 
	`°r°r
(
n‹m_«me
, "#P#");

4753 i‡(
	`thd_ã°_›ti⁄s
(
thd
, 
OPTION_NO_FOREIGN_KEY_CHECKS
)) {

4754 
ign‹e_îr
 = 
DICT_ERR_IGNORE_FK_NOKEY
;

4758 
ib_èbÀ
 = 
	`di˘_èbÀ_›í_⁄_«me
(
n‹m_«me
, 
FALSE
, 
TRUE
, 
ign‹e_îr
);

4760 i‡(
ib_èbÀ


4761 && ((!
	`DICT_TF2_FLAG_IS_SET
(
ib_èbÀ
, 
DICT_TF2_FTS_HAS_DOC_ID
)

4762 && 
èbÀ
->
s
->
fõlds
 !
	`di˘_èbÀ_gë_n_u£r_cﬁs
(
ib_èbÀ
))

4763 || (
	`DICT_TF2_FLAG_IS_SET
(
ib_èbÀ
, 
DICT_TF2_FTS_HAS_DOC_ID
)

4764 && (
èbÀ
->
s
->
fõlds


4765 !
	`di˘_èbÀ_gë_n_u£r_cﬁs
(
ib_èbÀ
) - 1)))) {

4766 
	`ib_logf
(
IB_LOG_LEVEL_WARN
,

4770 
REFMAN
 "innodb-troubleshooting.html "

4772 
n‹m_«me
, (
ul⁄g
Ë
	`di˘_èbÀ_gë_n_u£r_cﬁs
(
ib_èbÀ
),

4773 (
ul⁄g
Ë
èbÀ
->
s
->
fõlds
);

4777 
ib_èbÀ
->
c‹ru±ed
 = 
åue
;

4778 
	`di˘_èbÀ_˛o£
(
ib_èbÀ
, 
FALSE
, FALSE);

4779 
ib_èbÀ
 = 
NULL
;

4780 
is_∑π
 = 
NULL
;

4783 i‡(
NULL
 =
ib_èbÀ
) {

4784 i‡(
is_∑π
) {

4802 i‡(
	`önoba£_gë_lowî_ˇ£_èbÀ_«mes
() == 1) {

4804 i‡(!
∑r_ˇ£_«me_£t
) {

4805 #i‚de‡
__WIN__


4809 
	`°r˝y
(
∑r_ˇ£_«me
, 
n‹m_«me
);

4810 
	`önoba£_ˇ£dn_°r
(
∑r_ˇ£_«me
);

4816 
	`n‹mÆize_èbÀ_«me_low
(

4817 
∑r_ˇ£_«me
, 
«me
, 
FALSE
);

4819 
∑r_ˇ£_«me_£t
 = 
TRUE
;

4822 
ib_èbÀ
 = 
	`di˘_èbÀ_›í_⁄_«me
(

4823 
∑r_ˇ£_«me
, 
FALSE
, 
TRUE
,

4824 
ign‹e_îr
);

4827 i‡(
ib_èbÀ
) {

4828 #i‚de‡
__WIN__


4829 
	`sql_¥öt_w¨nög
("PartitionÅable %s opened "

4836 
n‹m_«me
);

4838 
	`sql_¥öt_w¨nög
("PartitionÅable %s opened "

4846 
n‹m_«me
);

4848 
èbÀ_›íed
;

4852 i‡(
is_∑π
) {

4853 
	`sql_¥öt_îr‹
("FailedÅo openÅable %s.\n",

4854 
n‹m_«me
);

4857 
	`ib_logf
(
IB_LOG_LEVEL_WARN
,

4861 
REFMAN
 "innodb-troubleshooting.html for how "

4862 "you c™Ñesﬁvêthê¥obÀm.", 
n‹m_«me
);

4864 
	`‰ì_sh¨e
(
sh¨e
);

4865 
my_î∫o
 = 
ENOENT
;

4867 
	`DBUG_RETURN
(
HA_ERR_NO_SUCH_TABLE
);

4870 
èbÀ_›íed
:

4872 
	`önoba£_c›y_‰m_Êags_‰om_èbÀ_sh¨e
(
ib_èbÀ
, 
èbÀ
->
s
);

4874 
	`di˘_°©s_öô
(
ib_èbÀ
);

4876 
	`MONITOR_INC
(
MONITOR_TABLE_OPEN
);

4878 
boﬁ
 
no_èbÀ•a˚
;

4880 i‡(
	`di˘_èbÀ_is_disˇrded
(
ib_èbÀ
)) {

4882 
	`ib_£ndîrf
(
thd
,

4883 
IB_LOG_LEVEL_WARN
, 
ER_TABLESPACE_DISCARDED
,

4884 
èbÀ
->
s
->
èbÀ_«me
.
°r
);

4891 
no_èbÀ•a˚
 = 
Ál£
;

4893 } i‡(
ib_èbÀ
->
ibd_fûe_missög
) {

4895 
	`ib_£ndîrf
(

4896 
thd
, 
IB_LOG_LEVEL_WARN
,

4897 
ER_TABLESPACE_MISSING
, 
n‹m_«me
);

4902 
no_èbÀ•a˚
 = 
åue
;

4904 
no_èbÀ•a˚
 = 
Ál£
;

4907 i‡(!
	`thd_èbÀ•a˚_›
(
thd
Ë&& 
no_èbÀ•a˚
) {

4908 
	`‰ì_sh¨e
(
sh¨e
);

4909 
my_î∫o
 = 
ENOENT
;

4911 
	`di˘_èbÀ_˛o£
(
ib_èbÀ
, 
FALSE
, FALSE);

4913 
	`DBUG_RETURN
(
HA_ERR_NO_SUCH_TABLE
);

4916 
¥ebuût
 = 
	`row_¸óã_¥ebuût
(
ib_èbÀ
, 
èbÀ
->
s
->
ª˛ígth
);

4918 
¥ebuût
->
deÁu…_ªc
 = 
èbÀ
->
s
->
deÁu…_vÆues
;

4919 
	`ut_ad
(
¥ebuût
->
deÁu…_ªc
);

4922 
¥im¨y_key
 = 
èbÀ
->
s
->primary_key;

4923 
key_u£d_⁄_sˇn
 = 
¥im¨y_key
;

4925 i‡(!
	`önoba£_buûd_ödex_å™¶©i⁄
(
èbÀ
, 
ib_èbÀ
, 
sh¨e
)) {

4926 
	`sql_¥öt_îr‹
("Build InnoDB indexÅranslationÅable for"

4927 " TabÀ %†Áûed", 
«me
);

4936 i‡(!
	`row_èbÀ_gŸ_deÁu…_˛u°_ödex
(
ib_èbÀ
)) {

4938 
¥ebuût
->
˛u°_ödex_was_gíî©ed
 = 
FALSE
;

4940 i‡(
	`UNIV_UNLIKELY
(
¥im¨y_key
 >
MAX_KEY
)) {

4941 
	`sql_¥öt_îr‹
("Table %s hasáÖrimary key in "

4943 "ö MySQL!", 
«me
);

4949 
	`push_w¨nög_¥ötf
(
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

4950 
ER_NO_SUCH_INDEX
,

4954 "MySQL!", 
«me
);

4972 i‡(!
èbÀ
->
key_öfo
) {

4973 
	`ut_ad
(!
èbÀ
->
s
->
keys
);

4974 
ªf_Àngth
 = 0;

4976 
ªf_Àngth
 = 
èbÀ
->
key_öfo
[0].
key_Àngth
;

4981 
uöt
 
i
 = 0; i < 
èbÀ
->
s
->
keys
; i++) {

4982 
di˘_ödex_t
* 
ödex
;

4983 
ödex
 = 
	`önoba£_gë_ödex
(
i
);

4984 i‡(
	`di˘_ödex_is_˛u°
(
ödex
)) {

4985 
ªf_Àngth
 =

4986 
èbÀ
->
key_öfo
[
i
].
key_Àngth
;

4997 
ªf_Àngth
 = 
èbÀ
->
key_öfo
[
¥im¨y_key
].
key_Àngth
;

5000 i‡(
¥im¨y_key
 !
MAX_KEY
) {

5001 
	`sql_¥öt_îr‹
(

5010 "o‡thêèbÀ.", 
«me
);

5016 
	`push_w¨nög_¥ötf
(
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

5017 
ER_NO_SUCH_INDEX
,

5021 "MySQL!", 
«me
);

5024 
¥ebuût
->
˛u°_ödex_was_gíî©ed
 = 
TRUE
;

5026 
ªf_Àngth
 = 
DATA_ROW_ID_LEN
;

5036 i‡(
key_u£d_⁄_sˇn
 !
MAX_KEY
) {

5037 
	`sql_¥öt_w¨nög
(

5040 "I¬oDB.", 
«me
, (
ul⁄g
Ë
key_u£d_⁄_sˇn
);

5045 
°©s
.
block_size
 = 
UNIV_PAGE_SIZE
;

5048 
	`thr_lock_d©a_öô
(&
sh¨e
->
lock
,&lock,(*) 0);

5050 i‡(
¥ebuût
->
èbÀ
) {

5054 
	`åx_sys_fûe_f‹m©_max_upgøde
(

5055 (c⁄° **Ë&
önoba£_fûe_f‹m©_max
,

5056 
	`di˘_èbÀ_gë_f‹m©
(
¥ebuût
->
èbÀ
));

5060 i‡(
¥ebuût
->
èbÀ
 !
NULL


5061 && !
¥ebuût
->
èbÀ
->
ibd_fûe_missög


5062 && 
èbÀ
->
found_√xt_numbî_fõld
 !
NULL
) {

5063 
	`di˘_èbÀ_autoöc_lock
(
¥ebuût
->
èbÀ
);

5069 i‡(
	`di˘_èbÀ_autoöc_ªad
(
¥ebuût
->
èbÀ
) == 0) {

5071 
	`önoba£_öôülize_autoöc
();

5074 
	`di˘_èbÀ_autoöc_u∆ock
(
¥ebuût
->
èbÀ
);

5077 
	`öfo
(
HA_STATUS_NO_LOCK
 | 
HA_STATUS_VARIABLE
 | 
HA_STATUS_CONST
);

5079 
	`DBUG_RETURN
(0);

5080 
	}
}

5082 
UNIV_INTERN


5083 
h™dÀr
*

5084 
	gha_önoba£
::
	$˛⁄e
(

5086 c⁄° * 
«me
,

5087 
MEM_ROOT
* 
mem_roŸ
)

5089 
ha_önoba£
* 
√w_h™dÀr
;

5091 
	`DBUG_ENTER
("ha_innobase::clone");

5093 
√w_h™dÀr
 = 
°©ic_ˇ°
<
ha_önoba£
*>(
h™dÀr
::
	`˛⁄e
(
«me
,

5094 
mem_roŸ
));

5095 i‡(
√w_h™dÀr
) {

5096 
	`DBUG_ASSERT
(
√w_h™dÀr
->
¥ebuût
 !
NULL
);

5098 
√w_h™dÀr
->
¥ebuût
->
£À˘_lock_ty≥


5099 
¥ebuût
->
£À˘_lock_ty≥
;

5102 
	`DBUG_RETURN
(
√w_h™dÀr
);

5103 
	}
}

5105 
UNIV_INTERN


5106 
uöt


5107 
	gha_önoba£
::
	$max_suµ‹ãd_key_∑π_Àngth
() const

5112 (
önoba£_œrge_¥efix


5113 ? 
REC_VERSION_56_MAX_INDEX_COL_LEN


5114 : 
REC_ANTELOPE_MAX_INDEX_COL_LEN
 - 1);

5115 
	}
}

5120 
UNIV_INTERN


5122 
	gha_önoba£
::
	$˛o£
()

5125 
THD
* 
thd
;

5127 
	`DBUG_ENTER
("ha_innobase::close");

5129 
thd
 = 
	`ha_thd
();

5130 i‡(
thd
 !
NULL
) {

5131 
	`önoba£_ªÀa£_ãmp‹¨y_œtches
(
ht
, 
thd
);

5134 
	`row_¥ebuût_‰ì
(
¥ebuût
, 
FALSE
);

5136 i‡(
upd_buf
 !
NULL
) {

5137 
	`ut_ad
(
upd_buf_size
 != 0);

5138 
	`my_‰ì
(
upd_buf
);

5139 
upd_buf
 = 
NULL
;

5140 
upd_buf_size
 = 0;

5143 
	`‰ì_sh¨e
(
sh¨e
);

5145 
	`MONITOR_INC
(
MONITOR_TABLE_CLOSE
);

5150 
	`§v_a˘ive_wake_ma°î_thªad
();

5152 
	`DBUG_RETURN
(0);

5153 
	}
}

5160 
ölöe


5161 
uöt


5162 
	$gë_fõld_off£t
(

5164 c⁄° 
TABLE
* 
èbÀ
,

5165 c⁄° 
Fõld
* 
fõld
)

5167 ((
uöt
Ë(
fõld
->
±r
 - 
èbÀ
->
ªc‹d
[0]));

5168 
	}
}

5176 
UNIV_INTERN


5178 
	$önoba£_mysql_cmp
(

5180 
mysql_ty≥
,

5181 
uöt
 
ch¨£t_numbî
,

5182 c⁄° * 
a
,

5183 
a_Àngth
,

5185 c⁄° * 
b
,

5186 
b_Àngth
)

5189 
CHARSET_INFO
* 
ch¨£t
;

5190 
íum_fõld_ty≥s
 
mysql_ç
;

5191 
ªt
;

5193 
	`DBUG_ASSERT
(
a_Àngth
 !
UNIV_SQL_NULL
);

5194 
	`DBUG_ASSERT
(
b_Àngth
 !
UNIV_SQL_NULL
);

5196 
mysql_ç
 = (
íum_fõld_ty≥s
Ë
mysql_ty≥
;

5198 
mysql_ç
) {

5200 
MYSQL_TYPE_BIT
:

5201 
MYSQL_TYPE_STRING
:

5202 
MYSQL_TYPE_VAR_STRING
:

5203 
MYSQL_TYPE_TINY_BLOB
:

5204 
MYSQL_TYPE_MEDIUM_BLOB
:

5205 
MYSQL_TYPE_BLOB
:

5206 
MYSQL_TYPE_LONG_BLOB
:

5207 
MYSQL_TYPE_VARCHAR
:

5213 i‡(
ch¨£t_numbî
 =
deÁu…_ch¨£t_öfo
->
numbî
) {

5214 
ch¨£t
 = 
deÁu…_ch¨£t_öfo
;

5215 } i‡(
ch¨£t_numbî
 =
my_ch¨£t_œtö1
.
numbî
) {

5216 
ch¨£t
 = &
my_ch¨£t_œtö1
;

5218 
ch¨£t
 = 
	`gë_ch¨£t
(
ch¨£t_numbî
, 
	`MYF
(
MY_WME
));

5220 i‡(
ch¨£t
 =
NULL
) {

5221 
	`sql_¥öt_îr‹
("InnoDBÇeeds charset %lu for doing "

5224 (
ul⁄g
Ë
ch¨£t_numbî
);

5225 
	`ut_a
(0);

5234 
ªt
 = 
ch¨£t
->
cﬁl
->
	`°∫ncﬁl•
(

5235 
ch¨£t
, 
a
, 
a_Àngth
, 
b
, 
b_Àngth
, 0);

5237 i‡(
ªt
 < 0) {

5239 } i‡(
ªt
 > 0) {

5245 
ut_îr‹
;

5249 
	}
}

5254 
UNIV_INTERN


5255 
CHARSET_INFO
*

5256 
	$önoba£_gë_·s_ch¨£t
(

5258 
mysql_ty≥
,

5259 
uöt
 
ch¨£t_numbî
)

5261 
íum_fõld_ty≥s
 
mysql_ç
;

5262 
CHARSET_INFO
* 
ch¨£t
;

5264 
mysql_ç
 = (
íum_fõld_ty≥s
Ë
mysql_ty≥
;

5266 
mysql_ç
) {

5268 
MYSQL_TYPE_BIT
:

5269 
MYSQL_TYPE_STRING
:

5270 
MYSQL_TYPE_VAR_STRING
:

5271 
MYSQL_TYPE_TINY_BLOB
:

5272 
MYSQL_TYPE_MEDIUM_BLOB
:

5273 
MYSQL_TYPE_BLOB
:

5274 
MYSQL_TYPE_LONG_BLOB
:

5275 
MYSQL_TYPE_VARCHAR
:

5281 i‡(
ch¨£t_numbî
 =
deÁu…_ch¨£t_öfo
->
numbî
) {

5282 
ch¨£t
 = 
deÁu…_ch¨£t_öfo
;

5283 } i‡(
ch¨£t_numbî
 =
my_ch¨£t_œtö1
.
numbî
) {

5284 
ch¨£t
 = &
my_ch¨£t_œtö1
;

5286 
ch¨£t
 = 
	`gë_ch¨£t
(
ch¨£t_numbî
, 
	`MYF
(
MY_WME
));

5288 i‡(
ch¨£t
 =
NULL
) {

5289 
	`sql_¥öt_îr‹
("InnoDBÇeeds charset %lu for doing "

5292 (
ul⁄g
Ë
ch¨£t_numbî
);

5293 
	`ut_a
(0);

5298 
ut_îr‹
;

5301 (
ch¨£t
);

5302 
	}
}

5310 
UNIV_INTERN


5312 
	$önoba£_mysql_cmp_¥efix
(

5314 
mysql_ty≥
,

5315 
uöt
 
ch¨£t_numbî
,

5316 c⁄° * 
a
,

5317 
a_Àngth
,

5319 c⁄° * 
b
,

5320 
b_Àngth
)

5323 
CHARSET_INFO
* 
ch¨£t
;

5324 
ªsu…
;

5326 
ch¨£t
 = 
	`önoba£_gë_·s_ch¨£t
(
mysql_ty≥
, 
ch¨£t_numbî
);

5328 
ªsu…
 = 
	`ha_com∑ª_ãxt
(
ch¨£t
, (
uch¨
*Ë
a
, 
a_Àngth
,

5329 (
uch¨
*Ë
b
, 
b_Àngth
, 1, 0);

5331 (
ªsu…
);

5332 
	}
}

5335 
UNIV_INTERN


5337 
	$önoba£_·s_ãxt_cmp
(

5339 c⁄° * 
cs
,

5340 c⁄° * 
p1
,

5341 c⁄° * 
p2
)

5343 c⁄° 
CHARSET_INFO
* 
ch¨£t
 = (c⁄° CHARSET_INFO*Ë
cs
;

5344 c⁄° 
·s_°rög_t
* 
s1
 = (c⁄° fts_°rög_t*Ë
p1
;

5345 c⁄° 
·s_°rög_t
* 
s2
 = (c⁄° fts_°rög_t*Ë
p2
;

5347 (
	`ha_com∑ª_ãxt
(

5348 
ch¨£t
, 
s1
->
f_°r
, 
°©ic_ˇ°
<
uöt
>(s1->
f_Àn
),

5349 
s2
->
f_°r
, 
°©ic_ˇ°
<
uöt
>(s2->
f_Àn
), 0, 0));

5350 
	}
}

5353 
UNIV_INTERN


5355 
	$önoba£_·s_ãxt_ˇ£_cmp
(

5357 c⁄° * 
cs
,

5358 c⁄° * 
p1
,

5359 c⁄° * 
p2
)

5361 c⁄° 
CHARSET_INFO
* 
ch¨£t
 = (c⁄° CHARSET_INFO*Ë
cs
;

5362 c⁄° 
·s_°rög_t
* 
s1
 = (c⁄° fts_°rög_t*Ë
p1
;

5363 c⁄° 
·s_°rög_t
* 
s2
 = (c⁄° fts_°rög_t*Ë
p2
;

5364 
ulöt
 
√wÀn
;

5366 
	`my_ˇ£dn_°r
(
ch¨£t
, (*Ë
s2
->
f_°r
);

5368 
√wÀn
 = 
	`°æí
((c⁄° *Ë
s2
->
f_°r
);

5370 (
	`ha_com∑ª_ãxt
(

5371 
ch¨£t
, 
s1
->
f_°r
, 
°©ic_ˇ°
<
uöt
>(s1->
f_Àn
),

5372 
s2
->
f_°r
, 
°©ic_ˇ°
<
uöt
>(
√wÀn
), 0, 0));

5373 
	}
}

5376 
UNIV_INTERN


5377 
ulöt


5378 
	$önoba£_°∫x‰m
(

5380 c⁄° 
CHARSET_INFO
*

5381 
cs
,

5382 c⁄° 
uch¨
* 
°r
,

5383 c⁄° 
ulöt
 
Àn
)

5385 
uch¨
 
my°r
[2];

5386 
ulöt
 
vÆue
;

5388 i‡(!
°r
 || 
Àn
 == 0) {

5392 
	`my_°∫x‰m
(
cs
, (
uch¨
*Ë
my°r
, 2, 
°r
, 
Àn
);

5394 
vÆue
 = 
	`mach_ªad_‰om_2
(
my°r
);

5396 i‡(
vÆue
 > 255) {

5397 
vÆue
 = value / 256;

5400 (
vÆue
);

5401 
	}
}

5405 
UNIV_INTERN


5407 
	$önoba£_·s_ãxt_cmp_¥efix
(

5409 c⁄° * 
cs
,

5410 c⁄° * 
p1
,

5411 c⁄° * 
p2
)

5413 c⁄° 
CHARSET_INFO
* 
ch¨£t
 = (c⁄° CHARSET_INFO*Ë
cs
;

5414 c⁄° 
·s_°rög_t
* 
s1
 = (c⁄° fts_°rög_t*Ë
p1
;

5415 c⁄° 
·s_°rög_t
* 
s2
 = (c⁄° fts_°rög_t*Ë
p2
;

5416 
ªsu…
;

5418 
ªsu…
 = 
	`ha_com∑ª_ãxt
(

5419 
ch¨£t
, 
s2
->
f_°r
, 
°©ic_ˇ°
<
uöt
>(s2->
f_Àn
),

5420 
s1
->
f_°r
, 
°©ic_ˇ°
<
uöt
>(s1->
f_Àn
), 1, 0);

5424 (-
ªsu…
);

5425 
	}
}

5429 
UNIV_INTERN


5430 
size_t


5431 
	$önoba£_·s_ˇ£dn_°r
(

5433 
CHARSET_INFO
* 
cs
,

5434 * 
§c
,

5435 
size_t
 
§c_Àn
,

5436 * 
d°
,

5437 
size_t
 
d°_Àn
)

5439 i‡(
cs
->
ˇ£dn_mu…ùly
 == 1) {

5440 
	`mem˝y
(
d°
, 
§c
, 
§c_Àn
);

5441 
d°
[
§c_Àn
] = 0;

5442 
	`my_ˇ£dn_°r
(
cs
, 
d°
);

5444 (
	`°æí
(
d°
));

5446 (
cs
->
c£t
->
	`ˇ£dn
(cs, 
§c
, 
§c_Àn
, 
d°
, 
d°_Àn
));

5448 
	}
}

5450 
	#åue_w‹d_ch¨
(
c
, 
ch
Ë((cË& (
_MY_U
 | 
_MY_L
 | 
_MY_NMR
Ë|| (chË='_')

	)

5452 
	#misc_w‹d_ch¨
(
X
Ë0

	)

5458 
UNIV_INTERN


5459 
ulöt


5460 
	$önoba£_mysql_·s_gë_tokí
(

5462 
CHARSET_INFO
* 
cs
,

5463 c⁄° 
byã
* 
°¨t
,

5464 c⁄° 
byã
* 
íd
,

5466 
·s_°rög_t
* 
tokí
,

5467 
ulöt
* 
off£t
)

5471 
mbl
;

5472 c⁄° 
uch¨
* 
doc
 = 
°¨t
;

5474 
	`ut_a
(
cs
);

5476 
tokí
->
f_n_ch¨
 =Åokí->
f_Àn
 = 0;

5477 
tokí
->
f_°r
 = 
NULL
;

5481 i‡(
doc
 >
íd
) {

5482 (
doc
 - 
°¨t
);

5485 
˘y≥
;

5487 
mbl
 = 
cs
->
c£t
->
	`˘y≥
(

5488 
cs
, &
˘y≥
, 
doc
, (c⁄° 
uch¨
*Ë
íd
);

5490 i‡(
	`åue_w‹d_ch¨
(
˘y≥
, *
doc
)) {

5494 
doc
 +
mbl
 > 0 ? mbl : (mbl < 0 ? -mbl : 1);

5497 
ulöt
 
mwc
 = 0;

5498 
ulöt
 
Àngth
 = 0;

5500 
tokí
->
f_°r
 = 
c⁄°_ˇ°
<
byã
*>(
doc
);

5502 
doc
 < 
íd
) {

5504 
˘y≥
;

5506 
mbl
 = 
cs
->
c£t
->
	`˘y≥
(

5507 
cs
, &
˘y≥
, (
uch¨
*Ë
doc
, (uch¨*Ë
íd
);

5508 i‡(
	`åue_w‹d_ch¨
(
˘y≥
, *
doc
)) {

5509 
mwc
 = 0;

5510 } i‡(!
	`misc_w‹d_ch¨
(*
doc
Ë|| 
mwc
) {

5513 ++
mwc
;

5516 ++
Àngth
;

5518 
doc
 +
mbl
 > 0 ? mbl : (mbl < 0 ? -mbl : 1);

5521 
tokí
->
f_Àn
 = (
uöt
Ë(
doc
 -Åokí->
f_°r
Ë- 
mwc
;

5522 
tokí
->
f_n_ch¨
 = 
Àngth
;

5524 (
doc
 - 
°¨t
);

5525 
	}
}

5532 
UNIV_INTERN


5533 
ulöt


5534 
	$gë_önoba£_ty≥_‰om_mysql_ty≥
(

5536 
ulöt
* 
unsig√d_Êag
,

5541 c⁄° * 
f
)

5543 c⁄° 
˛ass
 
Fõld
* 
fõld
 = 
ªöãΩªt_ˇ°
<c⁄° cœs†Fõld*>(
f
);

5549 
	`DBUG_ASSERT
((
ulöt
)
MYSQL_TYPE_STRING
 < 256);

5550 
	`DBUG_ASSERT
((
ulöt
)
MYSQL_TYPE_VAR_STRING
 < 256);

5551 
	`DBUG_ASSERT
((
ulöt
)
MYSQL_TYPE_DOUBLE
 < 256);

5552 
	`DBUG_ASSERT
((
ulöt
)
MYSQL_TYPE_FLOAT
 < 256);

5553 
	`DBUG_ASSERT
((
ulöt
)
MYSQL_TYPE_DECIMAL
 < 256);

5555 i‡(
fõld
->
Êags
 & 
UNSIGNED_FLAG
) {

5557 *
unsig√d_Êag
 = 
DATA_UNSIGNED
;

5559 *
unsig√d_Êag
 = 0;

5562 i‡(
fõld
->
	`ªÆ_ty≥
(Ë=
MYSQL_TYPE_ENUM


5563 || 
fõld
->
	`ªÆ_ty≥
(Ë=
MYSQL_TYPE_SET
) {

5569 *
unsig√d_Êag
 = 
DATA_UNSIGNED
;

5573 (
DATA_INT
);

5576 
fõld
->
	`ty≥
()) {

5579 
MYSQL_TYPE_VAR_STRING
:

5580 
MYSQL_TYPE_VARCHAR
:

5581 i‡(
fõld
->
	`bö¨y
()) {

5582 (
DATA_BINARY
);

5583 } i‡(
	`°rcmp
(
fõld
->
	`ch¨£t
()->
«me
,

5585 (
DATA_VARCHAR
);

5587 (
DATA_VARMYSQL
);

5589 
MYSQL_TYPE_BIT
:

5590 
MYSQL_TYPE_STRING
: i‡(
fõld
->
	`bö¨y
()) {

5592 (
DATA_FIXBINARY
);

5593 } i‡(
	`°rcmp
(
fõld
->
	`ch¨£t
()->
«me
,

5595 (
DATA_CHAR
);

5597 (
DATA_MYSQL
);

5599 
MYSQL_TYPE_NEWDECIMAL
:

5600 (
DATA_FIXBINARY
);

5601 
MYSQL_TYPE_LONG
:

5602 
MYSQL_TYPE_LONGLONG
:

5603 
MYSQL_TYPE_TINY
:

5604 
MYSQL_TYPE_SHORT
:

5605 
MYSQL_TYPE_INT24
:

5606 
MYSQL_TYPE_DATE
:

5607 
MYSQL_TYPE_YEAR
:

5608 
MYSQL_TYPE_NEWDATE
:

5609 (
DATA_INT
);

5610 
MYSQL_TYPE_TIME
:

5611 
MYSQL_TYPE_DATETIME
:

5612 
MYSQL_TYPE_TIMESTAMP
:

5613 
fõld
->
	`ªÆ_ty≥
()) {

5614 
MYSQL_TYPE_TIME
:

5615 
MYSQL_TYPE_DATETIME
:

5616 
MYSQL_TYPE_TIMESTAMP
:

5617 (
DATA_INT
);

5619 
	`DBUG_ASSERT
((
ulöt
)
MYSQL_TYPE_DECIMAL
 < 256);

5620 
MYSQL_TYPE_TIME2
:

5621 
MYSQL_TYPE_DATETIME2
:

5622 
MYSQL_TYPE_TIMESTAMP2
:

5623 (
DATA_FIXBINARY
);

5625 
MYSQL_TYPE_FLOAT
:

5626 (
DATA_FLOAT
);

5627 
MYSQL_TYPE_DOUBLE
:

5628 (
DATA_DOUBLE
);

5629 
MYSQL_TYPE_DECIMAL
:

5630 (
DATA_DECIMAL
);

5631 
MYSQL_TYPE_GEOMETRY
:

5632 
MYSQL_TYPE_TINY_BLOB
:

5633 
MYSQL_TYPE_MEDIUM_BLOB
:

5634 
MYSQL_TYPE_BLOB
:

5635 
MYSQL_TYPE_LONG_BLOB
:

5636 (
DATA_BLOB
);

5637 
MYSQL_TYPE_NULL
:

5643 
ut_îr‹
;

5647 
	}
}

5652 
ölöe


5654 
	$önoba£_wrôe_to_2_lôée_ídün
(

5656 
byã
* 
buf
,

5657 
ulöt
 
vÆ
)

5659 
	`ut_a
(
vÆ
 < 256 * 256);

5661 
buf
[0] = (
byã
)(
vÆ
 & 0xFF);

5662 
buf
[1] = (
byã
)(
vÆ
 / 256);

5663 
	}
}

5669 
ölöe


5670 
uöt


5671 
	$önoba£_ªad_‰om_2_lôée_ídün
(

5673 c⁄° 
uch¨
* 
buf
)

5675 ((
uöt
Ë((
ulöt
)(
buf
[0]) + 256 * ((ulint)(buf[1]))));

5676 
	}
}

5681 
UNIV_INTERN


5682 
uöt


5683 
	gha_önoba£
::
	$°‹e_key_vÆ_f‹_row
(

5685 
uöt
 
keyƒ
,

5686 * 
buff
,

5688 
uöt
 
buff_Àn
,

5689 c⁄° 
uch¨
* 
ªc‹d
)

5691 
KEY
* 
key_öfo
 = 
èbÀ
->key_öfÿ+ 
keyƒ
;

5692 
KEY_PART_INFO
* 
key_∑π
 = 
key_öfo
->key_part;

5693 
KEY_PART_INFO
* 
íd
 =

5694 
key_∑π
 + 
key_öfo
->
u£r_deföed_key_∑πs
;

5695 * 
buff_°¨t
 = 
buff
;

5696 
íum_fõld_ty≥s
 
mysql_ty≥
;

5697 
Fõld
* 
fõld
;

5698 
iboﬁ
 
is_nuŒ
;

5700 
	`DBUG_ENTER
("store_key_val_for_row");

5727 
	`mem£t
(
buff
, 0, 
buff_Àn
);

5729 ; 
key_∑π
 !
íd
; key_part++) {

5730 
is_nuŒ
 = 
FALSE
;

5732 i‡(
key_∑π
->
nuŒ_bô
) {

5733 i‡(
ªc‹d
[
key_∑π
->
nuŒ_off£t
]

5734 & 
key_∑π
->
nuŒ_bô
) {

5735 *
buff
 = 1;

5736 
is_nuŒ
 = 
TRUE
;

5738 *
buff
 = 0;

5740 
buff
++;

5743 
fõld
 = 
key_∑π
->field;

5744 
mysql_ty≥
 = 
fõld
->
	`ty≥
();

5746 i‡(
mysql_ty≥
 =
MYSQL_TYPE_VARCHAR
) {

5748 
ulöt
 
À∆í
;

5749 
ulöt
 
Àn
;

5750 c⁄° 
byã
* 
d©a
;

5751 
ulöt
 
key_Àn
;

5752 
ulöt
 
åue_Àn
;

5753 c⁄° 
CHARSET_INFO
* 
cs
;

5754 
îr‹
=0;

5756 
key_Àn
 = 
key_∑π
->
Àngth
;

5758 i‡(
is_nuŒ
) {

5759 
buff
 +
key_Àn
 + 2;

5763 
cs
 = 
fõld
->
	`ch¨£t
();

5765 
À∆í
 = (
ulöt
)

5766 (((
Fõld_v¨°rög
*Ë
fõld
)->
Àngth_byãs
);

5768 
d©a
 = 
	`row_mysql_ªad_åue_v¨ch¨
(&
Àn
,

5769 (
byã
*Ë(
ªc‹d


5770 + (
ulöt
Ë
	`gë_fõld_off£t
(
èbÀ
, 
fõld
)),

5771 
À∆í
);

5773 
åue_Àn
 = 
Àn
;

5778 i‡(
Àn
 > 0 && 
cs
->
mbmaxÀn
 > 1) {

5779 
åue_Àn
 = (
ulöt
Ë
cs
->
c£t
->
	`wñl_f‹med_Àn
(cs,

5780 (c⁄° *Ë
d©a
,

5781 (c⁄° *Ë
d©a
 + 
Àn
,

5782 (
uöt
Ë(
key_Àn
 / 
cs
->
mbmaxÀn
),

5783 &
îr‹
);

5789 i‡(
åue_Àn
 > 
key_Àn
) {

5790 
åue_Àn
 = 
key_Àn
;

5796 
	`row_mysql_°‹e_åue_v¨_Àn
((
byã
*Ë
buff
, 
åue_Àn
, 2);

5797 
buff
 += 2;

5799 
	`mem˝y
(
buff
, 
d©a
, 
åue_Àn
);

5807 
buff
 +
key_Àn
;

5809 } i‡(
mysql_ty≥
 =
MYSQL_TYPE_TINY_BLOB


5810 || 
mysql_ty≥
 =
MYSQL_TYPE_MEDIUM_BLOB


5811 || 
mysql_ty≥
 =
MYSQL_TYPE_BLOB


5812 || 
mysql_ty≥
 =
MYSQL_TYPE_LONG_BLOB


5815 || 
mysql_ty≥
 =
MYSQL_TYPE_GEOMETRY
) {

5817 c⁄° 
CHARSET_INFO
* 
cs
;

5818 
ulöt
 
key_Àn
;

5819 
ulöt
 
åue_Àn
;

5820 
îr‹
=0;

5821 
ulöt
 
blob_Àn
;

5822 c⁄° 
byã
* 
blob_d©a
;

5824 
	`ut_a
(
key_∑π
->
key_∑π_Êag
 & 
HA_PART_KEY_SEG
);

5826 
key_Àn
 = 
key_∑π
->
Àngth
;

5828 i‡(
is_nuŒ
) {

5829 
buff
 +
key_Àn
 + 2;

5834 
cs
 = 
fõld
->
	`ch¨£t
();

5836 
blob_d©a
 = 
	`row_mysql_ªad_blob_ªf
(&
blob_Àn
,

5837 (
byã
*Ë(
ªc‹d


5838 + (
ulöt
Ë
	`gë_fõld_off£t
(
èbÀ
, 
fõld
)),

5839 (
ulöt
Ë
fõld
->
	`∑ck_Àngth
());

5841 
åue_Àn
 = 
blob_Àn
;

5843 
	`ut_a
(
	`gë_fõld_off£t
(
èbÀ
, 
fõld
)

5844 =
key_∑π
->
off£t
);

5849 i‡(
blob_Àn
 > 0 && 
cs
->
mbmaxÀn
 > 1) {

5850 
åue_Àn
 = (
ulöt
Ë
cs
->
c£t
->
	`wñl_f‹med_Àn
(cs,

5851 (c⁄° *Ë
blob_d©a
,

5852 (c⁄° *Ë
blob_d©a


5853 + 
blob_Àn
,

5854 (
uöt
Ë(
key_Àn
 / 
cs
->
mbmaxÀn
),

5855 &
îr‹
);

5862 i‡(
åue_Àn
 > 
key_Àn
) {

5863 
åue_Àn
 = 
key_Àn
;

5869 
	`önoba£_wrôe_to_2_lôée_ídün
(

5870 (
byã
*Ë
buff
, 
åue_Àn
);

5871 
buff
 += 2;

5873 
	`mem˝y
(
buff
, 
blob_d©a
, 
åue_Àn
);

5878 
buff
 +
key_Àn
;

5885 c⁄° 
CHARSET_INFO
* 
cs
 = 
NULL
;

5886 
ulöt
 
åue_Àn
;

5887 
ulöt
 
key_Àn
;

5888 c⁄° 
uch¨
* 
§c_°¨t
;

5889 
îr‹
=0;

5890 
íum_fõld_ty≥s
 
ªÆ_ty≥
;

5892 
key_Àn
 = 
key_∑π
->
Àngth
;

5894 i‡(
is_nuŒ
) {

5895 
buff
 +
key_Àn
;

5900 
§c_°¨t
 = 
ªc‹d
 + 
key_∑π
->
off£t
;

5901 
ªÆ_ty≥
 = 
fõld
->
	`ªÆ_ty≥
();

5902 
åue_Àn
 = 
key_Àn
;

5909 i‡(
ªÆ_ty≥
 !
MYSQL_TYPE_ENUM


5910 && 
ªÆ_ty≥
 !
MYSQL_TYPE_SET


5911 && ( 
mysql_ty≥
 =
MYSQL_TYPE_VAR_STRING


5912 || 
mysql_ty≥
 =
MYSQL_TYPE_STRING
)) {

5914 
cs
 = 
fõld
->
	`ch¨£t
();

5919 i‡(
key_Àn
 > 0 && 
cs
->
mbmaxÀn
 > 1) {

5921 
åue_Àn
 = (
ulöt
)

5922 
cs
->
c£t
->
	`wñl_f‹med_Àn
(cs,

5923 (c⁄° *Ë
§c_°¨t
,

5924 (c⁄° *Ë
§c_°¨t


5925 + 
key_Àn
,

5926 (
uöt
Ë(
key_Àn


5927 / 
cs
->
mbmaxÀn
),

5928 &
îr‹
);

5932 
	`mem˝y
(
buff
, 
§c_°¨t
, 
åue_Àn
);

5933 
buff
 +
åue_Àn
;

5937 i‡(
åue_Àn
 < 
key_Àn
) {

5938 
ulöt
 
∑d_Àn
 = 
key_Àn
 - 
åue_Àn
;

5939 
	`ut_a
(
cs
 !
NULL
);

5940 
	`ut_a
(!(
∑d_Àn
 % 
cs
->
mbmöÀn
));

5942 
cs
->
c£t
->
	`fûl
(cs, 
buff
, 
∑d_Àn
,

5944 
buff
 +
∑d_Àn
;

5949 
	`ut_a
(
buff
 <
buff_°¨t
 + 
buff_Àn
);

5951 
	`DBUG_RETURN
((
uöt
)(
buff
 - 
buff_°¨t
));

5952 
	}
}

5958 c⁄° 
Fõld
*

5959 
	$buûd_ãm∂©e_√eds_fõld
(

5961 
iboﬁ
 
ödex_c⁄èös
,

5964 
iboﬁ
 
ªad_ju°_key
,

5970 
iboﬁ
 
„tch_Æl_ö_key
,

5973 
iboﬁ
 
„tch_¥im¨y_key_cﬁs
,

5976 
di˘_ödex_t
* 
ödex
,

5977 c⁄° 
TABLE
* 
èbÀ
,

5978 
ulöt
 
i
)

5980 c⁄° 
Fõld
* 
fõld
 = 
èbÀ
->fõld[
i
];

5982 
	`ut_ad
(
ödex_c⁄èös
 =
	`di˘_ödex_c⁄èös_cﬁ_‹_¥efix
(
ödex
, 
i
));

5984 i‡(!
ödex_c⁄èös
) {

5985 i‡(
ªad_ju°_key
) {

5989 (
NULL
);

5991 } i‡(
„tch_Æl_ö_key
) {

5994 (
fõld
);

5997 i‡(
	`bôm≠_is_£t
(
èbÀ
->
ªad_£t
, 
°©ic_ˇ°
<
uöt
>(
i
))

5998 || 
	`bôm≠_is_£t
(
èbÀ
->
wrôe_£t
, 
°©ic_ˇ°
<
uöt
>(
i
))) {

6001 (
fõld
);

6004 i‡(
„tch_¥im¨y_key_cﬁs


6005 && 
	`di˘_èbÀ_cﬁ_ö_˛u°îed_key
(
ödex
->
èbÀ
, 
i
)) {

6008 (
fõld
);

6013 (
NULL
);

6014 
	}
}

6019 
ölöe


6020 
boﬁ


6021 
	$buûd_ãm∂©e_√eds_fõld_ö_i˝
(

6023 c⁄° 
di˘_ödex_t
* 
ödex
,

6024 c⁄° 
row_¥ebuût_t
* 
¥ebuût
,

6025 
boﬁ
 
c⁄èös
,

6027 
ulöt
 
i
)

6029 
	`ut_ad
(
c⁄èös
 =
	`di˘_ödex_c⁄èös_cﬁ_‹_¥efix
(
ödex
, 
i
));

6031 (
ödex
 =
¥ebuût
->index

6032 ? 
c⁄èös


6033 : 
	`di˘_ödex_c⁄èös_cﬁ_‹_¥efix
(
¥ebuût
->
ödex
, 
i
));

6034 
	}
}

6040 
mysql_row_ãm∂_t
*

6041 
	$buûd_ãm∂©e_fõld
(

6043 
row_¥ebuût_t
* 
¥ebuût
,

6044 
di˘_ödex_t
* 
˛u°_ödex
,

6045 
di˘_ödex_t
* 
ödex
,

6046 
TABLE
* 
èbÀ
,

6047 c⁄° 
Fõld
* 
fõld
,

6048 
ulöt
 
i
)

6050 
mysql_row_ãm∂_t
* 
ãm∂
;

6051 c⁄° 
di˘_cﬁ_t
* 
cﬁ
;

6053 
	`ut_ad
(
fõld
 =
èbÀ
->fõld[
i
]);

6054 
	`ut_ad
(
˛u°_ödex
->
èbÀ
 =
ödex
->table);

6056 
cﬁ
 = 
	`di˘_èbÀ_gë_¡h_cﬁ
(
ödex
->
èbÀ
, 
i
);

6058 
ãm∂
 = 
¥ebuût
->
mysql_ãm∂©e
 +Öªbuût->
n_ãm∂©e
++;

6059 
	`UNIV_MEM_INVALID
(
ãm∂
,  *templ);

6060 
ãm∂
->
cﬁ_no
 = 
i
;

6061 
ãm∂
->
˛u°_ªc_fõld_no
 = 
	`di˘_cﬁ_gë_˛u°_pos
(
cﬁ
, 
˛u°_ödex
);

6062 
	`ut_a
(
ãm∂
->
˛u°_ªc_fõld_no
 !
ULINT_UNDEFINED
);

6064 i‡(
	`di˘_ödex_is_˛u°
(
ödex
)) {

6065 
ãm∂
->
ªc_fõld_no
 =Åem∂->
˛u°_ªc_fõld_no
;

6067 
ãm∂
->
ªc_fõld_no
 = 
	`di˘_ödex_gë_¡h_cﬁ_pos
(
ödex
, 
i
);

6070 i‡(
fõld
->
	`ªÆ_maybe_nuŒ
()) {

6071 
ãm∂
->
mysql_nuŒ_byã_off£t
 =

6072 
fõld
->
	`nuŒ_off£t
();

6074 
ãm∂
->
mysql_nuŒ_bô_mask
 = (
ulöt
Ë
fõld
->
nuŒ_bô
;

6076 
ãm∂
->
mysql_nuŒ_bô_mask
 = 0;

6079 
ãm∂
->
mysql_cﬁ_off£t
 = (
ulöt
Ë
	`gë_fõld_off£t
(
èbÀ
, 
fõld
);

6081 
ãm∂
->
mysql_cﬁ_Àn
 = (
ulöt
Ë
fõld
->
	`∑ck_Àngth
();

6082 
ãm∂
->
ty≥
 = 
cﬁ
->
mty≥
;

6083 
ãm∂
->
mysql_ty≥
 = (
ulöt
Ë
fõld
->
	`ty≥
();

6085 i‡(
ãm∂
->
mysql_ty≥
 =
DATA_MYSQL_TRUE_VARCHAR
) {

6086 
ãm∂
->
mysql_Àngth_byãs
 = (
ulöt
)

6087 (((
Fõld_v¨°rög
*Ë
fõld
)->
Àngth_byãs
);

6090 
ãm∂
->
ch¨£t
 = 
	`dty≥_gë_ch¨£t_cﬁl
(
cﬁ
->
¥ty≥
);

6091 
ãm∂
->
mbmöÀn
 = 
	`di˘_cﬁ_gë_mbmöÀn
(
cﬁ
);

6092 
ãm∂
->
mbmaxÀn
 = 
	`di˘_cﬁ_gë_mbmaxÀn
(
cﬁ
);

6093 
ãm∂
->
is_unsig√d
 = 
cﬁ
->
¥ty≥
 & 
DATA_UNSIGNED
;

6095 i‡(!
	`di˘_ödex_is_˛u°
(
ödex
)

6096 && 
ãm∂
->
ªc_fõld_no
 =
ULINT_UNDEFINED
) {

6097 
¥ebuût
->
√ed_to_ac˚ss_˛u°îed
 = 
TRUE
;

6100 i‡(
¥ebuût
->
mysql_¥efix_Àn
 < 
ãm∂
->
mysql_cﬁ_off£t


6101 + 
ãm∂
->
mysql_cﬁ_Àn
) {

6102 
¥ebuût
->
mysql_¥efix_Àn
 = 
ãm∂
->
mysql_cﬁ_off£t


6103 + 
ãm∂
->
mysql_cﬁ_Àn
;

6106 i‡(
ãm∂
->
ty≥
 =
DATA_BLOB
) {

6107 
¥ebuût
->
ãm∂_c⁄èös_blob
 = 
TRUE
;

6110 (
ãm∂
);

6111 
	}
}

6116 
UNIV_INTERN


6118 
	gha_önoba£
::
	$buûd_ãm∂©e
(

6120 
boﬁ
 
whﬁe_row
)

6123 
di˘_ödex_t
* 
ödex
;

6124 
di˘_ödex_t
* 
˛u°_ödex
;

6125 
ulöt
 
n_fõlds
;

6126 
iboﬁ
 
„tch_Æl_ö_key
 = 
FALSE
;

6127 
iboﬁ
 
„tch_¥im¨y_key_cﬁs
 = 
FALSE
;

6128 
ulöt
 
i
;

6130 i‡(
¥ebuût
->
£À˘_lock_ty≥
 =
LOCK_X
) {

6135 
whﬁe_row
 = 
åue
;

6136 } i‡(!
whﬁe_row
) {

6137 i‡(
¥ebuût
->
höt_√ed_to_„tch_exåa_cﬁs


6138 =
ROW_RETRIEVE_ALL_COLS
) {

6143 i‡(
¥ebuût
->
ªad_ju°_key
) {

6151 
„tch_Æl_ö_key
 = 
TRUE
;

6153 
whﬁe_row
 = 
åue
;

6155 } i‡(
¥ebuût
->
höt_√ed_to_„tch_exåa_cﬁs


6156 =
ROW_RETRIEVE_PRIMARY_KEY
) {

6164 
„tch_¥im¨y_key_cﬁs
 = 
TRUE
;

6168 
˛u°_ödex
 = 
	`di˘_èbÀ_gë_fú°_ödex
(
¥ebuût
->
èbÀ
);

6170 
ödex
 = 
whﬁe_row
 ? 
˛u°_ödex
 : 
¥ebuût
->index;

6172 
¥ebuût
->
√ed_to_ac˚ss_˛u°îed
 = (
ödex
 =
˛u°_ödex
);

6176 
	`ut_ad
(
	`di˘_ödex_is_˛u°
(
ödex
Ë=(ödex =
˛u°_ödex
));

6181 
n_fõlds
 = (
ulöt
Ë
èbÀ
->
s
->
fõlds
;

6183 i‡(!
¥ebuût
->
mysql_ãm∂©e
) {

6184 
¥ebuût
->
mysql_ãm∂©e
 = (
mysql_row_ãm∂_t
*)

6185 
	`mem_Æloc
(
n_fõlds
 * (
mysql_row_ãm∂_t
));

6188 
¥ebuût
->
ãm∂©e_ty≥
 = 
whﬁe_row


6189 ? 
ROW_MYSQL_WHOLE_ROW
 : 
ROW_MYSQL_REC_FIELDS
;

6190 
¥ebuût
->
nuŒ_bôm≠_Àn
 = 
èbÀ
->
s
->
nuŒ_byãs
;

6193 
¥ebuût
->
ãm∂_c⁄èös_blob
 = 
FALSE
;

6194 
¥ebuût
->
mysql_¥efix_Àn
 = 0;

6195 
¥ebuût
->
n_ãm∂©e
 = 0;

6196 
¥ebuût
->
idx_c⁄d_n_cﬁs
 = 0;

6201 i‡(
a˘ive_ödex
 !
MAX_KEY
 &&á˘ive_ödex =
pushed_idx_c⁄d_keyno
) {

6203 
i
 = 0; i < 
n_fõlds
; i++) {

6204 c⁄° 
iboﬁ
 
ödex_c⁄èös


6205 
	`di˘_ödex_c⁄èös_cﬁ_‹_¥efix
(
ödex
, 
i
);

6221 i‡(
	`buûd_ãm∂©e_√eds_fõld_ö_i˝
(

6222 
ödex
, 
¥ebuût
, 
ödex_c⁄èös
, 
i
)) {

6224 c⁄° 
Fõld
* 
fõld
;

6225 
mysql_row_ãm∂_t
* 
ãm∂
;

6227 i‡(
whﬁe_row
) {

6228 
fõld
 = 
èbÀ
->fõld[
i
];

6230 
fõld
 = 
	`buûd_ãm∂©e_√eds_fõld
(

6231 
ödex_c⁄èös
,

6232 
¥ebuût
->
ªad_ju°_key
,

6233 
„tch_Æl_ö_key
,

6234 
„tch_¥im¨y_key_cﬁs
,

6235 
ödex
, 
èbÀ
, 
i
);

6236 i‡(!
fõld
) {

6241 
ãm∂
 = 
	`buûd_ãm∂©e_fõld
(

6242 
¥ebuût
, 
˛u°_ödex
, 
ödex
,

6243 
èbÀ
, 
fõld
, 
i
);

6244 
¥ebuût
->
idx_c⁄d_n_cﬁs
++;

6245 
	`ut_ad
(
¥ebuût
->
idx_c⁄d_n_cﬁs


6246 =
¥ebuût
->
n_ãm∂©e
);

6248 i‡(
ödex
 =
¥ebuût
->index) {

6249 
ãm∂
->
i˝_ªc_fõld_no


6250 
ãm∂
->
ªc_fõld_no
;

6252 
ãm∂
->
i˝_ªc_fõld_no


6253 
	`di˘_ödex_gë_¡h_cﬁ_pos
(

6254 
¥ebuût
->
ödex
, 
i
);

6257 i‡(
	`di˘_ödex_is_˛u°
(
¥ebuût
->
ödex
)) {

6258 
	`ut_ad
(
ãm∂
->
i˝_ªc_fõld_no


6259 !
ULINT_UNDEFINED
);

6267 i‡(
ãm∂
->
i˝_ªc_fõld_no


6268 < 
¥ebuût
->
ödex
->
n_uniq
) {

6273 } i‡(
ãm∂
->
i˝_ªc_fõld_no


6274 !
ULINT_UNDEFINED
) {

6282 
ãm∂
->
i˝_ªc_fõld_no


6283 
	`di˘_ödex_gë_¡h_cﬁ_‹_¥efix_pos
(

6284 
¥ebuût
->
ödex
, 
i
, 
TRUE
);

6285 
	`ut_ad
(
ãm∂
->
i˝_ªc_fõld_no


6286 !
ULINT_UNDEFINED
);

6311 
	`ut_ad
(
¥ebuût
->
idx_c⁄d_n_cﬁs
 > 0);

6312 
	`ut_ad
(
¥ebuût
->
idx_c⁄d_n_cﬁs
 =¥ebuût->
n_ãm∂©e
);

6316 
i
 = 0; i < 
n_fõlds
; i++) {

6317 c⁄° 
iboﬁ
 
ödex_c⁄èös


6318 
	`di˘_ödex_c⁄èös_cﬁ_‹_¥efix
(
ödex
, 
i
);

6320 i‡(!
	`buûd_ãm∂©e_√eds_fõld_ö_i˝
(

6321 
ödex
, 
¥ebuût
, 
ödex_c⁄èös
, 
i
)) {

6323 c⁄° 
Fõld
* 
fõld
;

6325 i‡(
whﬁe_row
) {

6326 
fõld
 = 
èbÀ
->fõld[
i
];

6328 
fõld
 = 
	`buûd_ãm∂©e_√eds_fõld
(

6329 
ödex_c⁄èös
,

6330 
¥ebuût
->
ªad_ju°_key
,

6331 
„tch_Æl_ö_key
,

6332 
„tch_¥im¨y_key_cﬁs
,

6333 
ödex
, 
èbÀ
, 
i
);

6334 i‡(!
fõld
) {

6339 
	`buûd_ãm∂©e_fõld
(
¥ebuût
,

6340 
˛u°_ödex
, 
ödex
,

6341 
èbÀ
, 
fõld
, 
i
);

6345 
¥ebuût
->
idx_c⁄d
 = 
this
;

6348 
¥ebuût
->
idx_c⁄d
 = 
NULL
;

6350 
i
 = 0; i < 
n_fõlds
; i++) {

6351 c⁄° 
Fõld
* 
fõld
;

6353 i‡(
whﬁe_row
) {

6354 
fõld
 = 
èbÀ
->fõld[
i
];

6356 
fõld
 = 
	`buûd_ãm∂©e_√eds_fõld
(

6357 
	`di˘_ödex_c⁄èös_cﬁ_‹_¥efix
(

6358 
ödex
, 
i
),

6359 
¥ebuût
->
ªad_ju°_key
,

6360 
„tch_Æl_ö_key
,

6361 
„tch_¥im¨y_key_cﬁs
,

6362 
ödex
, 
èbÀ
, 
i
);

6363 i‡(!
fõld
) {

6368 
	`buûd_ãm∂©e_fõld
(
¥ebuût
, 
˛u°_ödex
, 
ödex
,

6369 
èbÀ
, 
fõld
, 
i
);

6373 i‡(
ödex
 !
˛u°_ödex
 && 
¥ebuût
->
√ed_to_ac˚ss_˛u°îed
) {

6376 
i
 = 0; i < 
¥ebuût
->
n_ãm∂©e
; i++) {

6378 
mysql_row_ãm∂_t
* 
ãm∂


6379 &
¥ebuût
->
mysql_ãm∂©e
[
i
];

6381 
ãm∂
->
ªc_fõld_no
 =Åem∂->
˛u°_ªc_fõld_no
;

6384 
	}
}

6393 
UNIV_INTERN


6394 
dbîr_t


6395 
	gha_önoba£
::
	$önoba£_lock_autoöc
()

6398 
dbîr_t
 
îr‹
 = 
DB_SUCCESS
;

6400 
	`ut_ad
(!
§v_ªad_⁄ly_mode
);

6402 
önoba£_autoöc_lock_mode
) {

6403 
AUTOINC_NO_LOCKING
:

6405 
	`di˘_èbÀ_autoöc_lock
(
¥ebuût
->
èbÀ
);

6408 
AUTOINC_NEW_STYLE_LOCKING
:

6413 i‡(
	`thd_sql_comm™d
(
u£r_thd
Ë=
SQLCOM_INSERT


6414 || 
	`thd_sql_comm™d
(
u£r_thd
Ë=
SQLCOM_REPLACE
) {

6415 
di˘_èbÀ_t
* 
ib_èbÀ
 = 
¥ebuût
->
èbÀ
;

6418 
	`di˘_èbÀ_autoöc_lock
(
ib_èbÀ
);

6422 i‡(
ib_èbÀ
->
n_waôög_‹_gø¡ed_auto_öc_locks
) {

6424 
	`di˘_èbÀ_autoöc_u∆ock
(
ib_èbÀ
);

6431 
AUTOINC_OLD_STYLE_LOCKING
:

6432 
îr‹
 = 
	`row_lock_èbÀ_autoöc_f‹_mysql
(
¥ebuût
);

6434 i‡(
îr‹
 =
DB_SUCCESS
) {

6437 
	`di˘_èbÀ_autoöc_lock
(
¥ebuût
->
èbÀ
);

6442 
ut_îr‹
;

6445 (
îr‹
);

6446 
	}
}

6451 
UNIV_INTERN


6452 
dbîr_t


6453 
	gha_önoba£
::
	$önoba£_ª£t_autoöc
(

6455 
ul⁄gl⁄g
 
autoöc
)

6457 
dbîr_t
 
îr‹
;

6459 
îr‹
 = 
	`önoba£_lock_autoöc
();

6461 i‡(
îr‹
 =
DB_SUCCESS
) {

6463 
	`di˘_èbÀ_autoöc_öôülize
(
¥ebuût
->
èbÀ
, 
autoöc
);

6465 
	`di˘_èbÀ_autoöc_u∆ock
(
¥ebuût
->
èbÀ
);

6468 (
îr‹
);

6469 
	}
}

6475 
UNIV_INTERN


6476 
dbîr_t


6477 
	gha_önoba£
::
	$önoba£_£t_max_autoöc
(

6479 
ul⁄gl⁄g
 
auto_öc
)

6481 
dbîr_t
 
îr‹
;

6483 
îr‹
 = 
	`önoba£_lock_autoöc
();

6485 i‡(
îr‹
 =
DB_SUCCESS
) {

6487 
	`di˘_èbÀ_autoöc_upd©e_if_gª©î
(
¥ebuût
->
èbÀ
, 
auto_öc
);

6489 
	`di˘_èbÀ_autoöc_u∆ock
(
¥ebuût
->
èbÀ
);

6492 (
îr‹
);

6493 
	}
}

6499 
UNIV_INTERN


6501 
	gha_önoba£
::
	$wrôe_row
(

6503 
uch¨
* 
ªc‹d
)

6505 
dbîr_t
 
îr‹
;

6506 
îr‹_ªsu…
= 0;

6507 
iboﬁ
 
auto_öc_u£d

FALSE
;

6508 
ulöt
 
sql_comm™d
;

6509 
åx_t
* 
åx
 = 
	`thd_to_åx
(
u£r_thd
);

6511 
	`DBUG_ENTER
("ha_innobase::write_row");

6513 i‡(
§v_ªad_⁄ly_mode
) {

6514 
	`ib_£ndîrf
(
	`ha_thd
(), 
IB_LOG_LEVEL_WARN
, 
ER_READ_ONLY_MODE
);

6515 
	`DBUG_RETURN
(
HA_ERR_TABLE_READONLY
);

6516 } i‡(
¥ebuût
->
åx
 !=Årx) {

6517 
	`sql_¥öt_îr‹
("TheÅransaction object forÅheÅable handle "

6520 (c⁄° *Ë
¥ebuût
->
åx
, (const *)Årx);

6522 
	`Âuts
("I¬oDB: Dum∞o‡200 byã†¨oundÖªbuût: ", 
°dîr
);

6523 
	`ut_¥öt_buf
(
°dîr
, ((c⁄° 
byã
*Ë
¥ebuût
) - 100, 200);

6524 
	`Âuts
("\n"

6526 
°dîr
);

6527 
	`ut_¥öt_buf
(
°dîr
, ((c⁄° 
byã
*Ë
åx
) - 100, 200);

6528 
	`putc
('\n', 
°dîr
);

6529 
ut_îr‹
;

6530 } i‡(!
	`åx_is_°¨ãd
(
åx
)) {

6531 ++
åx
->
wûl_lock
;

6534 
	`ha_°©i°ic_ö¸emít
(&
SSV
::
ha_wrôe_cou¡
);

6536 
sql_comm™d
 = 
	`thd_sql_comm™d
(
u£r_thd
);

6538 i‡((
sql_comm™d
 =
SQLCOM_ALTER_TABLE


6539 || 
sql_comm™d
 =
SQLCOM_OPTIMIZE


6540 || 
sql_comm™d
 =
SQLCOM_CREATE_INDEX


6541 || 
sql_comm™d
 =
SQLCOM_DROP_INDEX
)

6542 && 
num_wrôe_row
 >= 10000) {

6552 
di˘_èbÀ_t
* 
§c_èbÀ
;

6553 
lock_mode
 
mode
;

6555 
num_wrôe_row
 = 0;

6562 
§c_èbÀ
 = 
	`lock_gë_§c_èbÀ
(

6563 
¥ebuût
->
åx
,Öªbuût->
èbÀ
, &
mode
);

6564 i‡(!
§c_èbÀ
) {

6565 
no_commô
:

6575 } i‡(
§c_èbÀ
 =
¥ebuût
->
èbÀ
) {

6580 
	`önoba£_commô
(
ht
, 
u£r_thd
, 1);

6582 
	`åx_ªgi°î_f‹_2pc
(
¥ebuût
->
åx
);

6584 
¥ebuût
->
sql_°©_°¨t
 = 
TRUE
;

6589 i‡(!
	`lock_is_èbÀ_ex˛usive
(
¥ebuût
->
èbÀ
,

6590 
¥ebuût
->
åx
)) {

6591 
no_commô
;

6596 
	`önoba£_commô
(
ht
, 
u£r_thd
, 1);

6598 
	`åx_ªgi°î_f‹_2pc
(
¥ebuût
->
åx
);

6600 
	`row_lock_èbÀ_f‹_mysql
(
¥ebuût
, 
§c_èbÀ
, 
mode
);

6602 
¥ebuût
->
sql_°©_°¨t
 = 
TRUE
;

6606 
num_wrôe_row
++;

6609 i‡(
èbÀ
->
√xt_numbî_fõld
 && 
ªc‹d
 ==Åable->record[0]) {

6613 
¥ebuût
->
autoöc_îr‹
 = 
DB_SUCCESS
;

6615 i‡((
îr‹_ªsu…
 = 
	`upd©e_auto_ö¸emít
())) {

6620 i‡(
¥ebuût
->
autoöc_îr‹
 =
DB_UNSUPPORTED
) {

6621 
îr‹_ªsu…
 = 
ER_AUTOINC_READ_FAILED
;

6623 
	`my_îr‹
(
ER_AUTOINC_READ_FAILED
, 
	`MYF
(0));

6624 
func_exô
;

6625 } i‡(
¥ebuût
->
autoöc_îr‹
 !
DB_SUCCESS
) {

6626 
îr‹
 = 
¥ebuût
->
autoöc_îr‹
;

6627 
ªp‹t_îr‹
;

6631 
func_exô
;

6634 
auto_öc_u£d
 = 
TRUE
;

6637 i‡(
¥ebuût
->
mysql_ãm∂©e
 =
NULL


6638 || 
¥ebuût
->
ãm∂©e_ty≥
 !
ROW_MYSQL_WHOLE_ROW
) {

6643 
	`buûd_ãm∂©e
(
åue
);

6646 
	`önoba£_§v_c⁄c_íãr_önodb
(
¥ebuût
->
åx
);

6648 
îr‹
 = 
	`row_ö£π_f‹_mysql
((
byã
*Ë
ªc‹d
, 
¥ebuût
);

6649 
	`DEBUG_SYNC
(
u£r_thd
, "ib_after_row_insert");

6652 i‡(
auto_öc_u£d
) {

6653 
ul⁄gl⁄g
 
auto_öc
;

6654 
ul⁄gl⁄g
 
cﬁ_max_vÆue
;

6660 i‡(
åx
->
n_autoöc_rows
 > 0) {

6661 --
åx
->
n_autoöc_rows
;

6666 
cﬁ_max_vÆue
 = 
	`önoba£_gë_öt_cﬁ_max_vÆue
(

6667 
èbÀ
->
√xt_numbî_fõld
);

6670 
auto_öc
 = 
èbÀ
->
√xt_numbî_fõld
->
	`vÆ_öt
();

6672 
îr‹
) {

6673 
DB_DUPLICATE_KEY
:

6680 
sql_comm™d
) {

6681 
SQLCOM_LOAD
:

6682 i‡(
åx
->
du∂iˇãs
) {

6684 
£t_max_autoöc
;

6688 
SQLCOM_REPLACE
:

6689 
SQLCOM_INSERT_SELECT
:

6690 
SQLCOM_REPLACE_SELECT
:

6691 
£t_max_autoöc
;

6699 
DB_SUCCESS
:

6705 i‡(
auto_öc
 >
¥ebuût
->
autoöc_œ°_vÆue
) {

6706 
£t_max_autoöc
:

6709 i‡(
auto_öc
 <
cﬁ_max_vÆue
) {

6710 
	`ut_a
(
¥ebuût
->
autoöc_ö¸emít
 > 0);

6712 
ul⁄gl⁄g
 
off£t
;

6713 
ul⁄gl⁄g
 
ö¸emít
;

6714 
dbîr_t
 
îr
;

6716 
off£t
 = 
¥ebuût
->
autoöc_off£t
;

6717 
ö¸emít
 = 
¥ebuût
->
autoöc_ö¸emít
;

6719 
auto_öc
 = 
	`önoba£_√xt_autoöc
(

6720 
auto_öc
,

6721 1, 
ö¸emít
, 
off£t
,

6722 
cﬁ_max_vÆue
);

6724 
îr
 = 
	`önoba£_£t_max_autoöc
(

6725 
auto_öc
);

6727 i‡(
îr
 !
DB_SUCCESS
) {

6728 
îr‹
 = 
îr
;

6738 
	`önoba£_§v_c⁄c_exô_önodb
(
¥ebuût
->
åx
);

6740 
ªp‹t_îr‹
:

6741 i‡(
îr‹
 =
DB_TABLESPACE_DELETED
) {

6742 
	`ib_£ndîrf
(

6743 
åx
->
mysql_thd
, 
IB_LOG_LEVEL_ERROR
,

6744 
ER_TABLESPACE_DISCARDED
,

6745 
èbÀ
->
s
->
èbÀ_«me
.
°r
);

6748 
îr‹_ªsu…
 = 
	`c⁄vît_îr‹_code_to_mysql
(
îr‹
,

6749 
¥ebuût
->
èbÀ
->
Êags
,

6750 
u£r_thd
);

6752 i‡(
îr‹_ªsu…
 =
HA_FTS_INVALID_DOCID
) {

6753 
	`my_îr‹
(
HA_FTS_INVALID_DOCID
, 
	`MYF
(0));

6756 
func_exô
:

6757 
	`önoba£_a˘ive_smÆl
();

6759 
	`DBUG_RETURN
(
îr‹_ªsu…
);

6760 
	}
}

6767 
dbîr_t


6768 
	$ˇlc_row_dif„ªn˚
(

6770 
upd_t
* 
uve˘
,

6771 
uch¨
* 
ﬁd_row
,

6772 
uch¨
* 
√w_row
,

6773 
TABLE
* 
èbÀ
,

6775 
uch¨
* 
upd_buff
,

6776 
ulöt
 
buff_Àn
,

6777 
row_¥ebuût_t
* 
¥ebuût
,

6778 
THD
* 
thd
)

6780 
uch¨
* 
‹igöÆ_upd_buff
 = 
upd_buff
;

6781 
Fõld
* 
fõld
;

6782 
íum_fõld_ty≥s
 
fõld_mysql_ty≥
;

6783 
uöt
 
n_fõlds
;

6784 
ulöt
 
o_Àn
;

6785 
ulöt
 
n_Àn
;

6786 
ulöt
 
cﬁ_∑ck_Àn
;

6787 c⁄° 
byã
* 
√w_mysql_row_cﬁ
;

6788 c⁄° 
byã
* 
o_±r
;

6789 c⁄° 
byã
* 
n_±r
;

6790 
byã
* 
buf
;

6791 
upd_fõld_t
* 
ufõld
;

6792 
ulöt
 
cﬁ_ty≥
;

6793 
ulöt
 
n_ch™ged
 = 0;

6794 
dfõld_t
 
dfõld
;

6795 
di˘_ödex_t
* 
˛u°_ödex
;

6796 
uöt
 
i
;

6797 
iboﬁ
 
ch™ges_·s_cﬁumn
 = 
FALSE
;

6798 
iboﬁ
 
ch™ges_·s_doc_cﬁ
 = 
FALSE
;

6799 
åx_t
* 
åx
 = 
	`thd_to_åx
(
thd
);

6800 
doc_id_t
 
doc_id
 = 
FTS_NULL_DOC_ID
;

6802 
	`ut_ad
(!
§v_ªad_⁄ly_mode
);

6804 
n_fõlds
 = 
èbÀ
->
s
->
fõlds
;

6805 
˛u°_ödex
 = 
	`di˘_èbÀ_gë_fú°_ödex
(
¥ebuût
->
èbÀ
);

6808 
buf
 = (
byã
*Ë
upd_buff
;

6810 
i
 = 0; i < 
n_fõlds
; i++) {

6811 
fõld
 = 
èbÀ
->fõld[
i
];

6813 
o_±r
 = (c⁄° 
byã
*Ë
ﬁd_row
 + 
	`gë_fõld_off£t
(
èbÀ
, 
fõld
);

6814 
n_±r
 = (c⁄° 
byã
*Ë
√w_row
 + 
	`gë_fõld_off£t
(
èbÀ
, 
fõld
);

6818 
√w_mysql_row_cﬁ
 = 
n_±r
;

6819 
cﬁ_∑ck_Àn
 = 
fõld
->
	`∑ck_Àngth
();

6821 
o_Àn
 = 
cﬁ_∑ck_Àn
;

6822 
n_Àn
 = 
cﬁ_∑ck_Àn
;

6827 
fõld_mysql_ty≥
 = 
fõld
->
	`ty≥
();

6829 
cﬁ_ty≥
 = 
¥ebuût
->
èbÀ
->
cﬁs
[
i
].
mty≥
;

6831 
cﬁ_ty≥
) {

6833 
DATA_BLOB
:

6834 
o_±r
 = 
	`row_mysql_ªad_blob_ªf
(&
o_Àn
, o_ptr, o_len);

6835 
n_±r
 = 
	`row_mysql_ªad_blob_ªf
(&
n_Àn
,Ç_ptr,Ç_len);

6839 
DATA_VARCHAR
:

6840 
DATA_BINARY
:

6841 
DATA_VARMYSQL
:

6842 i‡(
fõld_mysql_ty≥
 =
MYSQL_TYPE_VARCHAR
) {

6847 
o_±r
 = 
	`row_mysql_ªad_åue_v¨ch¨
(

6848 &
o_Àn
, 
o_±r
,

6849 (
ulöt
)

6850 (((
Fõld_v¨°rög
*Ë
fõld
)->
Àngth_byãs
));

6852 
n_±r
 = 
	`row_mysql_ªad_åue_v¨ch¨
(

6853 &
n_Àn
, 
n_±r
,

6854 (
ulöt
)

6855 (((
Fõld_v¨°rög
*Ë
fõld
)->
Àngth_byãs
));

6863 i‡(
fõld_mysql_ty≥
 =
MYSQL_TYPE_LONGLONG


6864 && 
¥ebuût
->
èbÀ
->
·s


6865 && 
	`önoba£_°rˇ£cmp
(

6866 
fõld
->
fõld_«me
, 
FTS_DOC_ID_COL_NAME
) == 0) {

6867 
doc_id
 = (
doc_id_t
Ë
	`mach_ªad_‰om_n_lôée_ídün
(

6868 
n_±r
, 8);

6869 i‡(
doc_id
 == 0) {

6870 (
DB_FTS_INVALID_DOCID
);

6875 i‡(
fõld
->
	`ªÆ_maybe_nuŒ
()) {

6876 i‡(
fõld
->
	`is_nuŒ_ö_ªc‹d
(
ﬁd_row
)) {

6877 
o_Àn
 = 
UNIV_SQL_NULL
;

6880 i‡(
fõld
->
	`is_nuŒ_ö_ªc‹d
(
√w_row
)) {

6881 
n_Àn
 = 
UNIV_SQL_NULL
;

6885 i‡(
o_Àn
 !
n_Àn
 || (o_À¿!
UNIV_SQL_NULL
 &&

6886 0 !
	`memcmp
(
o_±r
, 
n_±r
, 
o_Àn
))) {

6889 
ufõld
 = 
uve˘
->
fõlds
 + 
n_ch™ged
;

6890 
	`UNIV_MEM_INVALID
(
ufõld
,  *ufield);

6895 i‡(
n_Àn
 !
UNIV_SQL_NULL
) {

6896 
	`di˘_cﬁ_c›y_ty≥
(
¥ebuût
->
èbÀ
->
cﬁs
 + 
i
,

6897 
	`dfõld_gë_ty≥
(&
dfõld
));

6899 
buf
 = 
	`row_mysql_°‹e_cﬁ_ö_önoba£_f‹m©
(

6900 &
dfõld
,

6901 (
byã
*Ë
buf
,

6902 
TRUE
,

6903 
√w_mysql_row_cﬁ
,

6904 
cﬁ_∑ck_Àn
,

6905 
	`di˘_èbÀ_is_comp
(
¥ebuût
->
èbÀ
));

6906 
	`dfõld_c›y
(&
ufõld
->
√w_vÆ
, &
dfõld
);

6908 
	`dfõld_£t_nuŒ
(&
ufõld
->
√w_vÆ
);

6911 
ufõld
->
exp
 = 
NULL
;

6912 
ufõld
->
‹ig_Àn
 = 0;

6913 
ufõld
->
fõld_no
 = 
	`di˘_cﬁ_gë_˛u°_pos
(

6914 &
¥ebuût
->
èbÀ
->
cﬁs
[
i
], 
˛u°_ödex
);

6915 
n_ch™ged
++;

6926 i‡(
¥ebuût
->
èbÀ
->
·s
 !
NULL
) {

6927 
ulöt
 
off£t
;

6928 
di˘_èbÀ_t
* 
önodb_èbÀ
;

6930 
önodb_èbÀ
 = 
¥ebuût
->
èbÀ
;

6932 i‡(!
ch™ges_·s_cﬁumn
) {

6933 
off£t
 = 
	`row_upd_ch™ges_·s_cﬁumn
(

6934 
önodb_èbÀ
, 
ufõld
);

6936 i‡(
off£t
 !
ULINT_UNDEFINED
) {

6937 
ch™ges_·s_cﬁumn
 = 
TRUE
;

6941 i‡(!
ch™ges_·s_doc_cﬁ
) {

6942 
ch™ges_·s_doc_cﬁ
 =

6943 
	`row_upd_ch™ges_doc_id
(

6944 
önodb_èbÀ
, 
ufõld
);

6954 i‡(!
¥ebuût
->
èbÀ
->
·s
) {

6955 
åx
->
·s_√xt_doc_id
 = 0;

6956 } i‡(
ch™ges_·s_cﬁumn
 || 
ch™ges_·s_doc_cﬁ
) {

6957 
di˘_èbÀ_t
* 
önodb_èbÀ
 = 
¥ebuût
->
èbÀ
;

6959 
ufõld
 = 
uve˘
->
fõlds
 + 
n_ch™ged
;

6961 i‡(!
	`DICT_TF2_FLAG_IS_SET
(

6962 
önodb_èbÀ
, 
DICT_TF2_FTS_HAS_DOC_ID
)) {

6968 i‡(
ch™ges_·s_cﬁumn
 && !
ch™ges_·s_doc_cﬁ
) {

6969 
	`ut_¥öt_time°amp
(
°dîr
);

6970 
	`Ârötf
(
°dîr
, " InnoDB: AÇew Doc ID"

6973 (
DB_FTS_INVALID_DOCID
);

6977 
	`ut_ad
(
önodb_èbÀ
->
·s
->
ˇche
);

6978 i‡(
doc_id
 < 
¥ebuût
->
èbÀ
->
·s
->
ˇche
->
√xt_doc_id
) {

6979 
	`Ârötf
(
°dîr
,

6981 " " 
IB_ID_FMT
 " forÅable",

6982 
önodb_èbÀ
->
·s
->
ˇche
->
√xt_doc_id


6984 
	`ut_¥öt_«me
(
°dîr
, 
åx
,

6985 
TRUE
, 
önodb_èbÀ
->
«me
);

6986 
	`putc
('\n', 
°dîr
);

6988 (
DB_FTS_INVALID_DOCID
);

6989 } i‡((
doc_id


6990 - 
¥ebuût
->
èbÀ
->
·s
->
ˇche
->
√xt_doc_id
)

6991 >
FTS_DOC_ID_MAX_STEP
) {

6992 
	`Ârötf
(
°dîr
,

6993 "I¬oDB: Do¯ID " 
UINT64PF
 " isÅoo"

6995 " Do¯ID u£d " 
UINT64PF
 " cannot"

6997 
doc_id
,

6998 
¥ebuût
->
èbÀ
->
·s
->
ˇche
->
√xt_doc_id
 - 1,

6999 
FTS_DOC_ID_MAX_STEP
);

7003 
åx
->
·s_√xt_doc_id
 = 
doc_id
;

7007 
	`ut_ad
(!
ch™ges_·s_doc_cﬁ
);

7011 
åx
->
·s_√xt_doc_id
 = 0;

7014 
	`·s_upd©e_doc_id
(

7015 
önodb_èbÀ
, 
ufõld
, &
åx
->
·s_√xt_doc_id
);

7017 ++
n_ch™ged
;

7023 
åx
->
·s_√xt_doc_id
 = 
UINT64_UNDEFINED
;

7026 
uve˘
->
n_fõlds
 = 
n_ch™ged
;

7027 
uve˘
->
öfo_bôs
 = 0;

7029 
	`ut_a
(
buf
 <(
byã
*Ë
‹igöÆ_upd_buff
 + 
buff_Àn
);

7031 (
DB_SUCCESS
);

7032 
	}
}

7042 
UNIV_INTERN


7044 
	gha_önoba£
::
	$upd©e_row
(

7046 c⁄° 
uch¨
* 
ﬁd_row
,

7047 
uch¨
* 
√w_row
)

7049 
upd_t
* 
uve˘
;

7050 
dbîr_t
 
îr‹
;

7051 
åx_t
* 
åx
 = 
	`thd_to_åx
(
u£r_thd
);

7053 
	`DBUG_ENTER
("ha_innobase::update_row");

7055 
	`ut_a
(
¥ebuût
->
åx
 ==Årx);

7057 i‡(
§v_ªad_⁄ly_mode
) {

7058 
	`ib_£ndîrf
(
	`ha_thd
(), 
IB_LOG_LEVEL_WARN
, 
ER_READ_ONLY_MODE
);

7059 
	`DBUG_RETURN
(
HA_ERR_TABLE_READONLY
);

7060 } i‡(!
	`åx_is_°¨ãd
(
åx
)) {

7061 ++
åx
->
wûl_lock
;

7064 i‡(
upd_buf
 =
NULL
) {

7065 
	`ut_ad
(
upd_buf_size
 == 0);

7072 
upd_buf_size
 = 
èbÀ
->
s
->
ª˛ígth
 +ÅabÀ->s->
max_key_Àngth


7073 + 
MAX_REF_PARTS
 * 3;

7074 
upd_buf
 = (
uch¨
*Ë
	`my_mÆloc
(
upd_buf_size
, 
	`MYF
(
MY_WME
));

7075 i‡(
upd_buf
 =
NULL
) {

7076 
upd_buf_size
 = 0;

7077 
	`DBUG_RETURN
(
HA_ERR_OUT_OF_MEM
);

7081 
	`ha_°©i°ic_ö¸emít
(&
SSV
::
ha_upd©e_cou¡
);

7083 i‡(
¥ebuût
->
upd_node
) {

7084 
uve˘
 = 
¥ebuût
->
upd_node
->
upd©e
;

7086 
uve˘
 = 
	`row_gë_¥ebuût_upd©e_ve˘‹
(
¥ebuût
);

7092 
îr‹
 = 
	`ˇlc_row_dif„ªn˚
(
uve˘
, (
uch¨
*Ë
ﬁd_row
, 
√w_row
, 
èbÀ
,

7093 
upd_buf
, 
upd_buf_size
, 
¥ebuût
, 
u£r_thd
);

7095 i‡(
îr‹
 !
DB_SUCCESS
) {

7096 
func_exô
;

7100 
¥ebuût
->
upd_node
->
is_dñëe
 = 
FALSE
;

7102 
	`ut_a
(
¥ebuût
->
ãm∂©e_ty≥
 =
ROW_MYSQL_WHOLE_ROW
);

7104 
	`önoba£_§v_c⁄c_íãr_önodb
(
åx
);

7106 
îr‹
 = 
	`row_upd©e_f‹_mysql
((
byã
*Ë
ﬁd_row
, 
¥ebuût
);

7116 i‡(
îr‹
 =
DB_SUCCESS


7117 && 
èbÀ
->
√xt_numbî_fõld


7118 && 
√w_row
 =
èbÀ
->
ªc‹d
[0]

7119 && 
	`thd_sql_comm™d
(
u£r_thd
Ë=
SQLCOM_INSERT


7120 && 
åx
->
du∂iˇãs
) {

7122 
ul⁄gl⁄g
 
auto_öc
;

7123 
ul⁄gl⁄g
 
cﬁ_max_vÆue
;

7125 
auto_öc
 = 
èbÀ
->
√xt_numbî_fõld
->
	`vÆ_öt
();

7129 
cﬁ_max_vÆue
 = 
	`önoba£_gë_öt_cﬁ_max_vÆue
(

7130 
èbÀ
->
√xt_numbî_fõld
);

7132 i‡(
auto_öc
 <
cﬁ_max_vÆue
 &&áuto_inc != 0) {

7134 
ul⁄gl⁄g
 
off£t
;

7135 
ul⁄gl⁄g
 
ö¸emít
;

7137 
off£t
 = 
¥ebuût
->
autoöc_off£t
;

7138 
ö¸emít
 = 
¥ebuût
->
autoöc_ö¸emít
;

7140 
auto_öc
 = 
	`önoba£_√xt_autoöc
(

7141 
auto_öc
, 1, 
ö¸emít
, 
off£t
, 
cﬁ_max_vÆue
);

7143 
îr‹
 = 
	`önoba£_£t_max_autoöc
(
auto_öc
);

7147 
	`önoba£_§v_c⁄c_exô_önodb
(
åx
);

7149 
func_exô
:

7150 
îr
 = 
	`c⁄vît_îr‹_code_to_mysql
(
îr‹
,

7151 
¥ebuût
->
èbÀ
->
Êags
, 
u£r_thd
);

7154 i‡(
îr
 =0 && 
uve˘
->
n_fõlds
 == 0) {

7160 
îr
 = 
HA_ERR_RECORD_IS_THE_SAME
;

7161 } i‡(
îr
 =
HA_FTS_INVALID_DOCID
) {

7162 
	`my_îr‹
(
HA_FTS_INVALID_DOCID
, 
	`MYF
(0));

7168 
	`önoba£_a˘ive_smÆl
();

7170 
	`DBUG_RETURN
(
îr
);

7171 
	}
}

7176 
UNIV_INTERN


7178 
	gha_önoba£
::
	$dñëe_row
(

7180 c⁄° 
uch¨
* 
ªc‹d
)

7182 
dbîr_t
 
îr‹
;

7183 
åx_t
* 
åx
 = 
	`thd_to_åx
(
u£r_thd
);

7185 
	`DBUG_ENTER
("ha_innobase::delete_row");

7187 
	`ut_a
(
¥ebuût
->
åx
 ==Årx);

7189 i‡(
§v_ªad_⁄ly_mode
) {

7190 
	`ib_£ndîrf
(
	`ha_thd
(), 
IB_LOG_LEVEL_WARN
, 
ER_READ_ONLY_MODE
);

7191 
	`DBUG_RETURN
(
HA_ERR_TABLE_READONLY
);

7192 } i‡(!
	`åx_is_°¨ãd
(
åx
)) {

7193 ++
åx
->
wûl_lock
;

7196 
	`ha_°©i°ic_ö¸emít
(&
SSV
::
ha_dñëe_cou¡
);

7198 i‡(!
¥ebuût
->
upd_node
) {

7199 
	`row_gë_¥ebuût_upd©e_ve˘‹
(
¥ebuût
);

7204 
¥ebuût
->
upd_node
->
is_dñëe
 = 
TRUE
;

7206 
	`önoba£_§v_c⁄c_íãr_önodb
(
åx
);

7208 
îr‹
 = 
	`row_upd©e_f‹_mysql
((
byã
*Ë
ªc‹d
, 
¥ebuût
);

7210 
	`önoba£_§v_c⁄c_exô_önodb
(
åx
);

7215 
	`önoba£_a˘ive_smÆl
();

7217 
	`DBUG_RETURN
(
	`c⁄vît_îr‹_code_to_mysql
(

7218 
îr‹
, 
¥ebuût
->
èbÀ
->
Êags
, 
u£r_thd
));

7219 
	}
}

7225 
UNIV_INTERN


7227 
	gha_önoba£
::
	$u∆ock_row
()

7230 
	`DBUG_ENTER
("ha_innobase::unlock_row");

7235 i‡(
¥ebuût
->
£À˘_lock_ty≥
 =
LOCK_NONE
) {

7236 
DBUG_VOID_RETURN
;

7243 
	`ut_ad
(
	`åx_°©e_eq
(
¥ebuût
->
åx
, 
TRX_STATE_ACTIVE
));

7245 
¥ebuût
->
row_ªad_ty≥
) {

7246 
ROW_READ_WITH_LOCKS
:

7247 i‡(!
§v_locks_unß„_f‹_bölog


7248 && 
¥ebuût
->
åx
->
isﬁ©i⁄_Àvñ


7249 > 
TRX_ISO_READ_COMMITTED
) {

7253 
ROW_READ_TRY_SEMI_CONSISTENT
:

7254 
	`row_u∆ock_f‹_mysql
(
¥ebuût
, 
FALSE
);

7256 
ROW_READ_DID_SEMI_CONSISTENT
:

7257 
¥ebuût
->
row_ªad_ty≥
 = 
ROW_READ_TRY_SEMI_CONSISTENT
;

7261 
DBUG_VOID_RETURN
;

7262 
	}
}

7265 
UNIV_INTERN


7266 
boﬁ


7267 
	gha_önoba£
::
	$was_£mi_c⁄si°ít_ªad
()

7270 (
¥ebuût
->
row_ªad_ty≥
 =
ROW_READ_DID_SEMI_CONSISTENT
);

7271 
	}
}

7274 
UNIV_INTERN


7276 
	gha_önoba£
::
	$åy_£mi_c⁄si°ít_ªad
(
boﬁ
 
yes
)

7279 
	`ut_a
(
¥ebuût
->
åx
 =
	`thd_to_åx
(
	`ha_thd
()));

7286 i‡(
yes


7287 && (
§v_locks_unß„_f‹_bölog


7288 || 
¥ebuût
->
åx
->
isﬁ©i⁄_Àvñ
 <
TRX_ISO_READ_COMMITTED
)) {

7289 
¥ebuût
->
row_ªad_ty≥
 = 
ROW_READ_TRY_SEMI_CONSISTENT
;

7291 
¥ebuût
->
row_ªad_ty≥
 = 
ROW_READ_WITH_LOCKS
;

7293 
	}
}

7298 
UNIV_INTERN


7300 
	gha_önoba£
::
	$ödex_öô
(

7302 
uöt
 
keyƒ
,

7303 
boﬁ
 
s‹ãd
)

7305 
	`DBUG_ENTER
("index_init");

7307 
	`DBUG_RETURN
(
	`ch™ge_a˘ive_ödex
(
keyƒ
));

7308 
	}
}

7313 
UNIV_INTERN


7315 
	gha_önoba£
::
	$ödex_íd
()

7318 
îr‹
 = 0;

7319 
	`DBUG_ENTER
("index_end");

7320 
a˘ive_ödex
 = 
MAX_KEY
;

7321 
ö_ønge_check_pushed_down
 = 
FALSE
;

7322 
ds_mº
.
	`dsmº_˛o£
();

7323 
	`DBUG_RETURN
(
îr‹
);

7324 
	}
}

7329 
ölöe


7330 
ulöt


7331 
	$c⁄vît_£¨ch_mode_to_önoba£
(

7333 
ha_rkey_fun˘i⁄
 
föd_Êag
)

7335 
föd_Êag
) {

7336 
HA_READ_KEY_EXACT
:

7338 (
PAGE_CUR_GE
);

7339 
HA_READ_KEY_OR_NEXT
:

7340 (
PAGE_CUR_GE
);

7341 
HA_READ_KEY_OR_PREV
:

7342 (
PAGE_CUR_LE
);

7343 
HA_READ_AFTER_KEY
:

7344 (
PAGE_CUR_G
);

7345 
HA_READ_BEFORE_KEY
:

7346 (
PAGE_CUR_L
);

7347 
HA_READ_PREFIX
:

7348 (
PAGE_CUR_GE
);

7349 
HA_READ_PREFIX_LAST
:

7350 (
PAGE_CUR_LE
);

7351 
HA_READ_PREFIX_LAST_OR_PREV
:

7352 (
PAGE_CUR_LE
);

7366 
HA_READ_MBR_CONTAIN
:

7367 
HA_READ_MBR_INTERSECT
:

7368 
HA_READ_MBR_WITHIN
:

7369 
HA_READ_MBR_DISJOINT
:

7370 
HA_READ_MBR_EQUAL
:

7371 (
PAGE_CUR_UNSUPP
);

7377 
	`my_îr‹
(
ER_CHECK_NOT_IMPLEMENTED
, 
	`MYF
(0), "this functionality");

7379 (
PAGE_CUR_UNSUPP
);

7380 
	}
}

7435 
UNIV_INTERN


7437 
	gha_önoba£
::
	$ödex_ªad
(

7439 
uch¨
* 
buf
,

7441 c⁄° 
uch¨
* 
key_±r
,

7450 
uöt
 
key_Àn
,

7451 
ha_rkey_fun˘i⁄
 
föd_Êag
)

7453 
ulöt
 
mode
;

7454 
di˘_ödex_t
* 
ödex
;

7455 
ulöt
 
m©ch_mode
 = 0;

7456 
îr‹
;

7457 
dbîr_t
 
ªt
;

7459 
	`DBUG_ENTER
("index_read");

7460 
	`DEBUG_SYNC_C
("ha_innobase_index_read_begin");

7462 
	`ut_a
(
¥ebuût
->
åx
 =
	`thd_to_åx
(
u£r_thd
));

7463 
	`ut_ad
(
key_Àn
 !0 || 
föd_Êag
 !
HA_READ_KEY_EXACT
);

7465 
	`ha_°©i°ic_ö¸emít
(&
SSV
::
ha_ªad_key_cou¡
);

7467 
ödex
 = 
¥ebuût
->index;

7469 i‡(
	`UNIV_UNLIKELY
(
ödex
 =
NULL
Ë|| 
	`di˘_ödex_is_c‹ru±ed
(index)) {

7470 
¥ebuût
->
ödex_ußbÀ
 = 
FALSE
;

7471 
	`DBUG_RETURN
(
HA_ERR_CRASHED
);

7473 i‡(
	`UNIV_UNLIKELY
(!
¥ebuût
->
ödex_ußbÀ
)) {

7474 
	`DBUG_RETURN
(
	`di˘_ödex_is_c‹ru±ed
(
ödex
)

7475 ? 
HA_ERR_INDEX_CORRUPT


7476 : 
HA_ERR_TABLE_DEF_CHANGED
);

7479 i‡(
ödex
->
ty≥
 & 
DICT_FTS
) {

7480 
	`DBUG_RETURN
(
HA_ERR_KEY_NOT_FOUND
);

7486 i‡(
¥ebuût
->
sql_°©_°¨t
) {

7487 
	`buûd_ãm∂©e
(
Ál£
);

7490 i‡(
key_±r
) {

7494 
	`row_£l_c⁄vît_mysql_key_to_önoba£
(

7495 
¥ebuût
->
£¨ch_tu∂e
,

7496 
¥ebuût
->
§ch_key_vÆ1
,

7497 
¥ebuût
->
§ch_key_vÆ_Àn
,

7498 
ödex
,

7499 (
byã
*Ë
key_±r
,

7500 (
ulöt
Ë
key_Àn
,

7501 
¥ebuût
->
åx
);

7502 
	`DBUG_ASSERT
(
¥ebuût
->
£¨ch_tu∂e
->
n_fõlds
 > 0);

7507 
	`dtu∂e_£t_n_fõlds
(
¥ebuût
->
£¨ch_tu∂e
, 0);

7510 
mode
 = 
	`c⁄vît_£¨ch_mode_to_önoba£
(
föd_Êag
);

7512 
m©ch_mode
 = 0;

7514 i‡(
föd_Êag
 =
HA_READ_KEY_EXACT
) {

7516 
m©ch_mode
 = 
ROW_SEL_EXACT
;

7518 } i‡(
föd_Êag
 =
HA_READ_PREFIX


7519 || 
föd_Êag
 =
HA_READ_PREFIX_LAST
) {

7521 
m©ch_mode
 = 
ROW_SEL_EXACT_PREFIX
;

7524 
œ°_m©ch_mode
 = (
uöt
Ë
m©ch_mode
;

7526 i‡(
mode
 !
PAGE_CUR_UNSUPP
) {

7528 
	`önoba£_§v_c⁄c_íãr_önodb
(
¥ebuût
->
åx
);

7530 
ªt
 = 
	`row_£¨ch_f‹_mysql
((
byã
*Ë
buf
, 
mode
, 
¥ebuût
,

7531 
m©ch_mode
, 0);

7533 
	`önoba£_§v_c⁄c_exô_önodb
(
¥ebuût
->
åx
);

7536 
ªt
 = 
DB_UNSUPPORTED
;

7539 
ªt
) {

7540 
DB_SUCCESS
:

7541 
îr‹
 = 0;

7542 
èbÀ
->
°©us
 = 0;

7543 
§v_°©s
.
n_rows_ªad
.
	`add
((
size_t
Ë
¥ebuût
->
åx
->
id
, 1);

7545 
DB_RECORD_NOT_FOUND
:

7546 
îr‹
 = 
HA_ERR_KEY_NOT_FOUND
;

7547 
èbÀ
->
°©us
 = 
STATUS_NOT_FOUND
;

7549 
DB_END_OF_INDEX
:

7550 
îr‹
 = 
HA_ERR_KEY_NOT_FOUND
;

7551 
èbÀ
->
°©us
 = 
STATUS_NOT_FOUND
;

7553 
DB_TABLESPACE_DELETED
:

7555 
	`ib_£ndîrf
(

7556 
¥ebuût
->
åx
->
mysql_thd
, 
IB_LOG_LEVEL_ERROR
,

7557 
ER_TABLESPACE_DISCARDED
,

7558 
èbÀ
->
s
->
èbÀ_«me
.
°r
);

7560 
èbÀ
->
°©us
 = 
STATUS_NOT_FOUND
;

7561 
îr‹
 = 
HA_ERR_NO_SUCH_TABLE
;

7563 
DB_TABLESPACE_NOT_FOUND
:

7565 
	`ib_£ndîrf
(

7566 
¥ebuût
->
åx
->
mysql_thd
, 
IB_LOG_LEVEL_ERROR
,

7567 
ER_TABLESPACE_MISSING
, 
	`MYF
(0),

7568 
èbÀ
->
s
->
èbÀ_«me
.
°r
);

7570 
èbÀ
->
°©us
 = 
STATUS_NOT_FOUND
;

7571 
îr‹
 = 
HA_ERR_NO_SUCH_TABLE
;

7574 
îr‹
 = 
	`c⁄vît_îr‹_code_to_mysql
(

7575 
ªt
, 
¥ebuût
->
èbÀ
->
Êags
, 
u£r_thd
);

7577 
èbÀ
->
°©us
 = 
STATUS_NOT_FOUND
;

7581 
	`DBUG_RETURN
(
îr‹
);

7582 
	}
}

7588 
UNIV_INTERN


7590 
	gha_önoba£
::
	$ödex_ªad_œ°
(

7592 
uch¨
* 
buf
,

7593 c⁄° 
uch¨
* 
key_±r
,

7595 
uöt
 
key_Àn
)

7598 (
	`ödex_ªad
(
buf
, 
key_±r
, 
key_Àn
, 
HA_READ_PREFIX_LAST
));

7599 
	}
}

7604 
UNIV_INTERN


7605 
di˘_ödex_t
*

7606 
	gha_önoba£
::
	$önoba£_gë_ödex
(

7608 
uöt
 
keyƒ
)

7612 
KEY
* 
key
 = 0;

7613 
di˘_ödex_t
* 
ödex
 = 0;

7615 
	`DBUG_ENTER
("innobase_get_index");

7617 i‡(
keyƒ
 !
MAX_KEY
 && 
èbÀ
->
s
->
keys
 > 0) {

7618 
key
 = 
èbÀ
->
key_öfo
 + 
keyƒ
;

7620 
ödex
 = 
	`önoba£_ödex_lookup
(
sh¨e
, 
keyƒ
);

7622 i‡(
ödex
) {

7623 
	`ut_a
(
	`ut_°rcmp
(
ödex
->
«me
, 
key
->name) == 0);

7628 i‡(
sh¨e
->
idx_å™s_tbl
.
ödex_m≠pög
) {

7629 
	`sql_¥öt_w¨nög
("InnoDB couldÇot find "

7633 
key
 ? key->
«me
 : "NULL",

7634 
keyƒ
,

7635 
¥ebuût
->
èbÀ
->
«me
);

7638 
ödex
 = 
	`di˘_èbÀ_gë_ödex_⁄_«me
(
¥ebuût
->
èbÀ
,

7639 
key
->
«me
);

7642 
ödex
 = 
	`di˘_èbÀ_gë_fú°_ödex
(
¥ebuût
->
èbÀ
);

7645 i‡(!
ödex
) {

7646 
	`sql_¥öt_îr‹
(

7649 
keyƒ
, 
key
 ? key->
«me
 : "NULL",

7650 
¥ebuût
->
èbÀ
->
«me
);

7653 
	`DBUG_RETURN
(
ödex
);

7654 
	}
}

7659 
UNIV_INTERN


7661 
	gha_önoba£
::
	$ch™ge_a˘ive_ödex
(

7663 
uöt
 
keyƒ
)

7667 
	`DBUG_ENTER
("change_active_index");

7669 
	`ut_ad
(
u£r_thd
 =
	`ha_thd
());

7670 
	`ut_a
(
¥ebuût
->
åx
 =
	`thd_to_åx
(
u£r_thd
));

7672 
a˘ive_ödex
 = 
keyƒ
;

7674 
¥ebuût
->
ödex
 = 
	`önoba£_gë_ödex
(
keyƒ
);

7676 i‡(
	`UNIV_UNLIKELY
(!
¥ebuût
->
ödex
)) {

7677 
	`sql_¥öt_w¨nög
("InnoDB: change_active_index(%u) failed",

7678 
keyƒ
);

7679 
¥ebuût
->
ödex_ußbÀ
 = 
FALSE
;

7680 
	`DBUG_RETURN
(1);

7683 
¥ebuût
->
ödex_ußbÀ
 = 
	`row_mîge_is_ödex_ußbÀ
’ªbuût->
åx
,

7684 
¥ebuût
->
ödex
);

7686 i‡(
	`UNIV_UNLIKELY
(!
¥ebuût
->
ödex_ußbÀ
)) {

7687 i‡(
	`di˘_ödex_is_c‹ru±ed
(
¥ebuût
->
ödex
)) {

7688 
ödex_«me
[
MAX_FULL_NAME_LEN
 + 1];

7689 
èbÀ_«me
[
MAX_FULL_NAME_LEN
 + 1];

7691 
	`önoba£_f‹m©_«me
(

7692 
ödex_«me
,  index_name,

7693 
¥ebuût
->
ödex
->
«me
, 
TRUE
);

7695 
	`önoba£_f‹m©_«me
(

7696 
èbÀ_«me
, Åable_name,

7697 
¥ebuût
->
ödex
->
èbÀ
->
«me
, 
FALSE
);

7699 
	`push_w¨nög_¥ötf
(

7700 
u£r_thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

7701 
HA_ERR_INDEX_CORRUPT
,

7704 
ödex_«me
, 
èbÀ_«me
);

7705 
	`DBUG_RETURN
(
HA_ERR_INDEX_CORRUPT
);

7707 
	`push_w¨nög_¥ötf
(

7708 
u£r_thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

7709 
HA_ERR_TABLE_DEF_CHANGED
,

7711 
keyƒ
);

7716 
	`DBUG_RETURN
(
HA_ERR_TABLE_DEF_CHANGED
);

7719 
	`ut_a
(
¥ebuût
->
£¨ch_tu∂e
 != 0);

7721 
	`dtu∂e_£t_n_fõlds
(
¥ebuût
->
£¨ch_tu∂e
,Öªbuût->
ödex
->
n_fõlds
);

7723 
	`di˘_ödex_c›y_ty≥s
(
¥ebuût
->
£¨ch_tu∂e
,Öªbuût->
ödex
,

7724 
¥ebuût
->
ödex
->
n_fõlds
);

7732 
	`buûd_ãm∂©e
(
Ál£
);

7734 
	`DBUG_RETURN
(0);

7735 
	}
}

7742 
UNIV_INTERN


7744 
	gha_önoba£
::
	$ödex_ªad_idx
(

7746 
uch¨
* 
buf
,

7748 
uöt
 
keyƒ
,

7749 c⁄° 
uch¨
* 
key
,

7752 
uöt
 
key_Àn
,

7753 
ha_rkey_fun˘i⁄
 
föd_Êag
)

7755 i‡(
	`ch™ge_a˘ive_ödex
(
keyƒ
)) {

7760 (
	`ödex_ªad
(
buf
, 
key
, 
key_Àn
, 
föd_Êag
));

7761 
	}
}

7767 
UNIV_INTERN


7769 
	gha_önoba£
::
	$gíîÆ_„tch
(

7771 
uch¨
* 
buf
,

7773 
uöt
 
dúe˘i⁄
,

7774 
uöt
 
m©ch_mode
)

7777 
dbîr_t
 
ªt
;

7778 
îr‹
;

7780 
	`DBUG_ENTER
("general_fetch");

7782 
	`ut_a
(
¥ebuût
->
åx
 =
	`thd_to_åx
(
u£r_thd
));

7784 
	`önoba£_§v_c⁄c_íãr_önodb
(
¥ebuût
->
åx
);

7786 
ªt
 = 
	`row_£¨ch_f‹_mysql
(

7787 (
byã
*Ë
buf
, 0, 
¥ebuût
, 
m©ch_mode
, 
dúe˘i⁄
);

7789 
	`önoba£_§v_c⁄c_exô_önodb
(
¥ebuût
->
åx
);

7791 
ªt
) {

7792 
DB_SUCCESS
:

7793 
îr‹
 = 0;

7794 
èbÀ
->
°©us
 = 0;

7795 
§v_°©s
.
n_rows_ªad
.
	`add
((
size_t
Ë
¥ebuût
->
åx
->
id
, 1);

7797 
DB_RECORD_NOT_FOUND
:

7798 
îr‹
 = 
HA_ERR_END_OF_FILE
;

7799 
èbÀ
->
°©us
 = 
STATUS_NOT_FOUND
;

7801 
DB_END_OF_INDEX
:

7802 
îr‹
 = 
HA_ERR_END_OF_FILE
;

7803 
èbÀ
->
°©us
 = 
STATUS_NOT_FOUND
;

7805 
DB_TABLESPACE_DELETED
:

7807 
	`ib_£ndîrf
(

7808 
¥ebuût
->
åx
->
mysql_thd
, 
IB_LOG_LEVEL_ERROR
,

7809 
ER_TABLESPACE_DISCARDED
,

7810 
èbÀ
->
s
->
èbÀ_«me
.
°r
);

7812 
èbÀ
->
°©us
 = 
STATUS_NOT_FOUND
;

7813 
îr‹
 = 
HA_ERR_NO_SUCH_TABLE
;

7815 
DB_TABLESPACE_NOT_FOUND
:

7817 
	`ib_£ndîrf
(

7818 
¥ebuût
->
åx
->
mysql_thd
, 
IB_LOG_LEVEL_ERROR
,

7819 
ER_TABLESPACE_MISSING
,

7820 
èbÀ
->
s
->
èbÀ_«me
.
°r
);

7822 
èbÀ
->
°©us
 = 
STATUS_NOT_FOUND
;

7823 
îr‹
 = 
HA_ERR_NO_SUCH_TABLE
;

7826 
îr‹
 = 
	`c⁄vît_îr‹_code_to_mysql
(

7827 
ªt
, 
¥ebuût
->
èbÀ
->
Êags
, 
u£r_thd
);

7829 
èbÀ
->
°©us
 = 
STATUS_NOT_FOUND
;

7833 
	`DBUG_RETURN
(
îr‹
);

7834 
	}
}

7840 
UNIV_INTERN


7842 
	gha_önoba£
::
	$ödex_√xt
(

7844 
uch¨
* 
buf
)

7847 
	`ha_°©i°ic_ö¸emít
(&
SSV
::
ha_ªad_√xt_cou¡
);

7849 (
	`gíîÆ_„tch
(
buf
, 
ROW_SEL_NEXT
, 0));

7850 
	}
}

7855 
UNIV_INTERN


7857 
	gha_önoba£
::
	$ödex_√xt_ßme
(

7859 
uch¨
* 
buf
,

7860 c⁄° 
uch¨
* 
key
,

7861 
uöt
 
keyÀn
)

7863 
	`ha_°©i°ic_ö¸emít
(&
SSV
::
ha_ªad_√xt_cou¡
);

7865 (
	`gíîÆ_„tch
(
buf
, 
ROW_SEL_NEXT
, 
œ°_m©ch_mode
));

7866 
	}
}

7872 
UNIV_INTERN


7874 
	gha_önoba£
::
	$ödex_¥ev
(

7876 
uch¨
* 
buf
)

7878 
	`ha_°©i°ic_ö¸emít
(&
SSV
::
ha_ªad_¥ev_cou¡
);

7880 (
	`gíîÆ_„tch
(
buf
, 
ROW_SEL_PREV
, 0));

7881 
	}
}

7887 
UNIV_INTERN


7889 
	gha_önoba£
::
	$ödex_fú°
(

7891 
uch¨
* 
buf
)

7893 
îr‹
;

7895 
	`DBUG_ENTER
("index_first");

7896 
	`ha_°©i°ic_ö¸emít
(&
SSV
::
ha_ªad_fú°_cou¡
);

7898 
îr‹
 = 
	`ödex_ªad
(
buf
, 
NULL
, 0, 
HA_READ_AFTER_KEY
);

7902 i‡(
îr‹
 =
HA_ERR_KEY_NOT_FOUND
) {

7903 
îr‹
 = 
HA_ERR_END_OF_FILE
;

7906 
	`DBUG_RETURN
(
îr‹
);

7907 
	}
}

7913 
UNIV_INTERN


7915 
	gha_önoba£
::
	$ödex_œ°
(

7917 
uch¨
* 
buf
)

7919 
îr‹
;

7921 
	`DBUG_ENTER
("index_last");

7922 
	`ha_°©i°ic_ö¸emít
(&
SSV
::
ha_ªad_œ°_cou¡
);

7924 
îr‹
 = 
	`ödex_ªad
(
buf
, 
NULL
, 0, 
HA_READ_BEFORE_KEY
);

7928 i‡(
îr‹
 =
HA_ERR_KEY_NOT_FOUND
) {

7929 
îr‹
 = 
HA_ERR_END_OF_FILE
;

7932 
	`DBUG_RETURN
(
îr‹
);

7933 
	}
}

7938 
UNIV_INTERN


7940 
	gha_önoba£
::
	$∫d_öô
(

7942 
boﬁ
 
sˇn
)

7944 
îr
;

7949 i‡(
¥ebuût
->
˛u°_ödex_was_gíî©ed
) {

7950 
îr
 = 
	`ch™ge_a˘ive_ödex
(
MAX_KEY
);

7952 
îr
 = 
	`ch™ge_a˘ive_ödex
(
¥im¨y_key
);

7958 i‡(!
sˇn
) {

7959 
	`åy_£mi_c⁄si°ít_ªad
(0);

7962 
°¨t_of_sˇn
 = 1;

7964 (
îr
);

7965 
	}
}

7970 
UNIV_INTERN


7972 
	gha_önoba£
::
	$∫d_íd
()

7975 (
	`ödex_íd
());

7976 
	}
}

7982 
UNIV_INTERN


7984 
	gha_önoba£
::
	$∫d_√xt
(

7986 
uch¨
* 
buf
)

7989 
îr‹
;

7991 
	`DBUG_ENTER
("rnd_next");

7992 
	`ha_°©i°ic_ö¸emít
(&
SSV
::
ha_ªad_∫d_√xt_cou¡
);

7994 i‡(
°¨t_of_sˇn
) {

7995 
îr‹
 = 
	`ödex_fú°
(
buf
);

7997 i‡(
îr‹
 =
HA_ERR_KEY_NOT_FOUND
) {

7998 
îr‹
 = 
HA_ERR_END_OF_FILE
;

8001 
°¨t_of_sˇn
 = 0;

8003 
îr‹
 = 
	`gíîÆ_„tch
(
buf
, 
ROW_SEL_NEXT
, 0);

8006 
	`DBUG_RETURN
(
îr‹
);

8007 
	}
}

8012 
UNIV_INTERN


8014 
	gha_önoba£
::
	$∫d_pos
(

8016 
uch¨
* 
buf
,

8017 
uch¨
* 
pos
)

8022 
îr‹
;

8023 
	`DBUG_ENTER
("rnd_pos");

8024 
	`DBUG_DUMP
("key", 
pos
, 
ªf_Àngth
);

8026 
	`ha_°©i°ic_ö¸emít
(&
SSV
::
ha_ªad_∫d_cou¡
);

8028 
	`ut_a
(
¥ebuût
->
åx
 =
	`thd_to_åx
(
	`ha_thd
()));

8033 
îr‹
 = 
	`ödex_ªad
(
buf
, 
pos
, 
ªf_Àngth
, 
HA_READ_KEY_EXACT
);

8035 i‡(
îr‹
) {

8036 
	`DBUG_PRINT
("îr‹", ("GŸÉº‹: %d", 
îr‹
));

8039 
	`DBUG_RETURN
(
îr‹
);

8040 
	}
}

8045 
UNIV_INTERN


8047 
	gha_önoba£
::
	$·_öô
()

8050 
	`DBUG_ENTER
("ft_init");

8052 
åx_t
* 
åx
 = 
	`check_åx_exi°s
(
	`ha_thd
());

8059 i‡(!
	`åx_is_°¨ãd
(
åx
)) {

8060 ++
åx
->
wûl_lock
;

8063 
	`DBUG_RETURN
(
	`∫d_öô
(
Ál£
));

8064 
	}
}

8069 
UNIV_INTERN


8070 
FT_INFO
*

8071 
	gha_önoba£
::
	$·_öô_ext
(

8073 
uöt
 
Êags
,

8074 
uöt
 
keyƒ
,

8075 
Såög
* 
key
)

8077 
åx_t
* 
åx
;

8078 
di˘_èbÀ_t
* 
·_èbÀ
;

8079 
dbîr_t
 
îr‹
;

8080 
byã
* 
quîy
 = (byã*Ë
key
->
	`±r
();

8081 
ulöt
 
quîy_Àn
 = 
key
->
	`Àngth
();

8082 c⁄° 
CHARSET_INFO
* 
ch¨_£t
 = 
key
->
	`ch¨£t
();

8083 
NEW_FT_INFO
* 
·s_hdl
 = 
NULL
;

8084 
di˘_ödex_t
* 
ödex
;

8085 
·s_ªsu…_t
* 
ªsu…
;

8086 
buf_tmp
[8192];

8087 
ulöt
 
buf_tmp_u£d
;

8088 
uöt
 
num_îr‹s
;

8090 i‡(
·s_íabÀ_düg_¥öt
) {

8091 
	`Ârötf
(
°dîr
, "keynr=%u, '%.*s'\n",

8092 
keyƒ
, (Ë
key
->
	`Àngth
(), (
byã
*Ëkey->
	`±r
());

8094 i‡(
Êags
 & 
FT_BOOL
) {

8095 
	`Ârötf
(
°dîr
, "BOOL search\n");

8097 
	`Ârötf
(
°dîr
, "NL search\n");

8104 i‡(
	`°rcmp
(
ch¨_£t
->
c¢ame
, "utf32") == 0

8105 || 
	`°rcmp
(
ch¨_£t
->
c¢ame
, "utf16") == 0) {

8106 
buf_tmp_u£d
 = 
	`önoba£_c⁄vît_°rög
(

8107 
buf_tmp
, (buf_tmp) - 1,

8108 &
my_ch¨£t_utf8_gíîÆ_ci
,

8109 
quîy
, 
quîy_Àn
, (
CHARSET_INFO
*Ë
ch¨_£t
,

8110 &
num_îr‹s
);

8112 
quîy
 = (
byã
*Ë
buf_tmp
;

8113 
quîy_Àn
 = 
buf_tmp_u£d
;

8114 
quîy
[
quîy_Àn
] = 0;

8117 
åx
 = 
¥ebuût
->trx;

8124 i‡(!
	`åx_is_°¨ãd
(
åx
)) {

8125 ++
åx
->
wûl_lock
;

8128 
·_èbÀ
 = 
¥ebuût
->
èbÀ
;

8131 i‡(!
·_èbÀ
->
·s
 || 
	`ib_ve˘‹_is_em±y
(·_èbÀ->·s->
ödexes
)) {

8132 
	`my_îr‹
(
ER_TABLE_HAS_NO_FT
, 
	`MYF
(0));

8133 (
NULL
);

8137 i‡(
	`di˘_èbÀ_is_disˇrded
(
·_èbÀ
)) {

8138 
	`my_îr‹
(
ER_NO_SUCH_TABLE
, 
	`MYF
(0), 
èbÀ
->
s
->
db
.
°r
,

8139 
èbÀ
->
s
->
èbÀ_«me
.
°r
);

8140 (
NULL
);

8143 i‡(
keyƒ
 =
NO_SUCH_KEY
) {

8145 
ödex
 = (
di˘_ödex_t
*Ë
	`ib_ve˘‹_gëp
(
·_èbÀ
->
·s
->
ödexes
, 0);

8147 
ödex
 = 
	`önoba£_gë_ödex
(
keyƒ
);

8150 i‡(!
ödex
 || index->
ty≥
 !
DICT_FTS
) {

8151 
	`my_îr‹
(
ER_TABLE_HAS_NO_FT
, 
	`MYF
(0));

8152 (
NULL
);

8155 i‡(!(
·_èbÀ
->
·s
->
·s_°©us
 & 
ADDED_TABLE_SYNCED
)) {

8156 
	`·s_öô_ödex
(
·_èbÀ
, 
FALSE
);

8158 
·_èbÀ
->
·s
->
·s_°©us
 |
ADDED_TABLE_SYNCED
;

8161 
îr‹
 = 
	`·s_quîy
(
åx
, 
ödex
, 
Êags
, 
quîy
, 
quîy_Àn
, &
ªsu…
);

8163 i‡(
îr‹
 !
DB_SUCCESS
) {

8164 
	`my_îr‹
(
	`c⁄vît_îr‹_code_to_mysql
(
îr‹
, 0, 
NULL
),

8165 
	`MYF
(0));

8166 (
NULL
);

8170 
·s_hdl
 = 
°©ic_ˇ°
<
NEW_FT_INFO
*>(
	`my_mÆloc
((NEW_FT_INFO),

8171 
	`MYF
(0)));

8173 
·s_hdl
->
∂ó£
 = 
c⁄°_ˇ°
<
_·_v·
*>(&
·_v·_ªsu…
);

8174 
·s_hdl
->
could_you
 = 
c⁄°_ˇ°
<
_·_v·_ext
*>(&
·_v·_ext_ªsu…
);

8175 
·s_hdl
->
·_¥ebuût
 = 
¥ebuût
;

8176 
·s_hdl
->
·_ªsu…
 = 
ªsu…
;

8180 
¥ebuût
->
ö_·s_quîy
 = 
åue
;

8182 ((
FT_INFO
*Ë
·s_hdl
);

8183 
	}
}

8191 
	$önoba£_·s_¸óã_doc_id_key
(

8193 
dtu∂e_t
* 
tu∂e
,

8194 c⁄° 
di˘_ödex_t
*

8195 
ödex
,

8196 
doc_id_t
* 
doc_id
)

8200 
doc_id_t
 
ãmp_doc_id
;

8201 
dfõld_t
* 
dfõld
 = 
	`dtu∂e_gë_¡h_fõld
(
tu∂e
, 0);

8203 
	`ut_a
(
	`di˘_ödex_gë_n_unique
(
ödex
) == 1);

8205 
	`dtu∂e_£t_n_fõlds
(
tu∂e
, 
ödex
->
n_fõlds
);

8206 
	`di˘_ödex_c›y_ty≥s
(
tu∂e
, 
ödex
, index->
n_fõlds
);

8208 #ifde‡
UNIV_DEBUG


8210 
di˘_fõld_t
* 
fõld
 = 
	`di˘_ödex_gë_¡h_fõld
(
ödex
, 0);

8211 
	`ut_a
(
fõld
->
cﬁ
->
mty≥
 =
DATA_INT
);

8212 
	`ut_ad
((*
doc_id
Ë=
fõld
->
fixed_Àn
);

8213 
	`ut_ad
(
	`önoba£_°rˇ£cmp
(
ödex
->
«me
, 
FTS_DOC_ID_INDEX_NAME
) == 0);

8217 
	`mach_wrôe_to_8
(
ªöãΩªt_ˇ°
<
byã
*>(&
ãmp_doc_id
), *
doc_id
);

8218 *
doc_id
 = 
ãmp_doc_id
;

8219 
	`dfõld_£t_d©a
(
dfõld
, 
doc_id
, (*doc_id));

8221 
	`dtu∂e_£t_n_fõlds_cmp
(
tu∂e
, 1);

8223 
ulöt
 
i
 = 1; i < 
ödex
->
n_fõlds
; i++) {

8224 
dfõld
 = 
	`dtu∂e_gë_¡h_fõld
(
tu∂e
, 
i
);

8225 
	`dfõld_£t_nuŒ
(
dfõld
);

8227 
	}
}

8232 
UNIV_INTERN


8234 
	gha_önoba£
::
	$·_ªad
(

8236 
uch¨
* 
buf
)

8238 
·s_ªsu…_t
* 
ªsu…
;

8239 
îr‹
;

8240 
row_¥ebuût_t
* 
·_¥ebuût
;

8242 
·_¥ebuût
 = ((
NEW_FT_INFO
*Ë
·_h™dÀr
)->ft_prebuilt;

8244 
	`ut_a
(
·_¥ebuût
 =
¥ebuût
);

8246 
ªsu…
 = ((
NEW_FT_INFO
*Ë
·_h™dÀr
)->
·_ªsu…
;

8248 i‡(
ªsu…
->
cuºít
 =
NULL
) {

8251 i‡(
ªsu…
->
ønkögs_by_id
 !
NULL
) {

8256 
	`·s_quîy_s‹t_ªsu…_⁄_ønk
(
ªsu…
);

8258 
ªsu…
->
cuºít
 = 
c⁄°_ˇ°
<
ib_rbt_node_t
*>(

8259 
	`rbt_fú°
(
ªsu…
->
ønkögs_by_ønk
));

8261 
	`ut_a
(
ªsu…
->
cuºít
 =
NULL
);

8264 
ªsu…
->
cuºít
 = 
c⁄°_ˇ°
<
ib_rbt_node_t
*>(

8265 
	`rbt_√xt
(
ªsu…
->
ønkögs_by_ønk
,Ñesu…->
cuºít
));

8268 
√xt_ªc‹d
:

8270 i‡(
ªsu…
->
cuºít
 !
NULL
) {

8271 
di˘_ödex_t
* 
ödex
;

8272 
dtu∂e_t
* 
tu∂e
 = 
¥ebuût
->
£¨ch_tu∂e
;

8273 
doc_id_t
 
£¨ch_doc_id
;

8277 i‡(
·_¥ebuût
->
ªad_ju°_key
) {

8278 
èbÀ
->
°©us
= 0;

8282 
ödex
 = 
	`di˘_èbÀ_gë_ödex_⁄_«me
(

8283 
¥ebuût
->
èbÀ
, 
FTS_DOC_ID_INDEX_NAME
);

8286 
	`ut_a
(
ödex
);

8289 
¥ebuût
->
ödex
 = index;

8291 
·s_ønkög_t
* 
ønkög
 = 
	`rbt_vÆue
(

8292 
·s_ønkög_t
, 
ªsu…
->
cuºít
);

8294 
£¨ch_doc_id
 = 
ønkög
->
doc_id
;

8299 
	`önoba£_·s_¸óã_doc_id_key
(
tu∂e
, 
ödex
, &
£¨ch_doc_id
);

8301 
	`önoba£_§v_c⁄c_íãr_önodb
(
¥ebuût
->
åx
);

8303 
dbîr_t
 
ªt
 = 
	`row_£¨ch_f‹_mysql
(

8304 (
byã
*Ë
buf
, 
PAGE_CUR_GE
, 
¥ebuût
, 
ROW_SEL_EXACT
, 0);

8306 
	`önoba£_§v_c⁄c_exô_önodb
(
¥ebuût
->
åx
);

8308 
ªt
) {

8309 
DB_SUCCESS
:

8310 
îr‹
 = 0;

8311 
èbÀ
->
°©us
 = 0;

8313 
DB_RECORD_NOT_FOUND
:

8314 
ªsu…
->
cuºít
 = 
c⁄°_ˇ°
<
ib_rbt_node_t
*>(

8315 
	`rbt_√xt
(
ªsu…
->
ønkögs_by_ønk
,

8316 
ªsu…
->
cuºít
));

8318 i‡(!
ªsu…
->
cuºít
) {

8323 
îr‹
 = 
HA_ERR_END_OF_FILE
;

8324 
èbÀ
->
°©us
 = 
STATUS_NOT_FOUND
;

8326 
√xt_ªc‹d
;

8329 
DB_END_OF_INDEX
:

8330 
îr‹
 = 
HA_ERR_END_OF_FILE
;

8331 
èbÀ
->
°©us
 = 
STATUS_NOT_FOUND
;

8333 
DB_TABLESPACE_DELETED
:

8335 
	`ib_£ndîrf
(

8336 
¥ebuût
->
åx
->
mysql_thd
, 
IB_LOG_LEVEL_ERROR
,

8337 
ER_TABLESPACE_DISCARDED
,

8338 
èbÀ
->
s
->
èbÀ_«me
.
°r
);

8340 
èbÀ
->
°©us
 = 
STATUS_NOT_FOUND
;

8341 
îr‹
 = 
HA_ERR_NO_SUCH_TABLE
;

8343 
DB_TABLESPACE_NOT_FOUND
:

8345 
	`ib_£ndîrf
(

8346 
¥ebuût
->
åx
->
mysql_thd
, 
IB_LOG_LEVEL_ERROR
,

8347 
ER_TABLESPACE_MISSING
,

8348 
èbÀ
->
s
->
èbÀ_«me
.
°r
);

8350 
èbÀ
->
°©us
 = 
STATUS_NOT_FOUND
;

8351 
îr‹
 = 
HA_ERR_NO_SUCH_TABLE
;

8354 
îr‹
 = 
	`c⁄vît_îr‹_code_to_mysql
(

8355 
ªt
, 0, 
u£r_thd
);

8357 
èbÀ
->
°©us
 = 
STATUS_NOT_FOUND
;

8361 (
îr‹
);

8364 (
HA_ERR_END_OF_FILE
);

8365 
	}
}

8371 
	gha_önoba£
::
	$·_íd
()

8373 
	`Ârötf
(
°dîr
, "ft_end()\n");

8375 
	`∫d_íd
();

8376 
	}
}

8386 
UNIV_INTERN


8388 
	gha_önoba£
::
	$posôi⁄
(

8390 c⁄° 
uch¨
* 
ªc‹d
)

8392 
uöt
 
Àn
;

8394 
	`ut_a
(
¥ebuût
->
åx
 =
	`thd_to_åx
(
	`ha_thd
()));

8396 i‡(
¥ebuût
->
˛u°_ödex_was_gíî©ed
) {

8402 
Àn
 = 
DATA_ROW_ID_LEN
;

8404 
	`mem˝y
(
ªf
, 
¥ebuût
->
row_id
, 
Àn
);

8406 
Àn
 = 
	`°‹e_key_vÆ_f‹_row
(
¥im¨y_key
, (*Ë
ªf
,

8407 
ªf_Àngth
, 
ªc‹d
);

8413 i‡(
Àn
 !
ªf_Àngth
) {

8414 
	`sql_¥öt_îr‹
("StoredÑefÜen is %lu, butÅableÑefÜen is "

8415 "%lu", (
ul⁄g
Ë
Àn
, (ul⁄gË
ªf_Àngth
);

8417 
	}
}

8424 
boﬁ


8425 
	$¸óã_èbÀ_check_doc_id_cﬁ
(

8427 
åx_t
* 
åx
,

8428 c⁄° 
TABLE
* 
f‹m
,

8430 
ulöt
* 
doc_id_cﬁ
)

8435 
ulöt
 
i
 = 0; i < 
f‹m
->
s
->
fõlds
; i++) {

8436 c⁄° 
Fõld
* 
fõld
;

8437 
ulöt
 
cﬁ_ty≥
;

8438 
ulöt
 
cﬁ_Àn
;

8439 
ulöt
 
unsig√d_ty≥
;

8441 
fõld
 = 
f‹m
->fõld[
i
];

8443 
cﬁ_ty≥
 = 
	`gë_önoba£_ty≥_‰om_mysql_ty≥
(&
unsig√d_ty≥
,

8444 
fõld
);

8446 
cﬁ_Àn
 = 
fõld
->
	`∑ck_Àngth
();

8448 i‡(
	`önoba£_°rˇ£cmp
(
fõld
->
fõld_«me
,

8449 
FTS_DOC_ID_COL_NAME
) == 0) {

8453 i‡(
cﬁ_ty≥
 =
DATA_INT


8454 && !
fõld
->
	`ªÆ_maybe_nuŒ
()

8455 && 
cﬁ_Àn
 =(
doc_id_t
)

8456 && (
	`°rcmp
(
fõld
->
fõld_«me
,

8457 
FTS_DOC_ID_COL_NAME
) == 0)) {

8458 *
doc_id_cﬁ
 = 
i
;

8460 
	`push_w¨nög_¥ötf
(

8461 
åx
->
mysql_thd
,

8462 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

8463 
ER_ILLEGAL_HA_CREATE_OPTION
,

8467 
	`my_îr‹
(
ER_WRONG_COLUMN_NAME
, 
	`MYF
(0),

8468 
fõld
->
fõld_«me
);

8469 *
doc_id_cﬁ
 = 
ULINT_UNDEFINED
;

8472 (
åue
);

8476 (
Ál£
);

8477 
	}
}

8481 
__©åibuã__
((
n⁄nuŒ
, 
w¨n_unu£d_ªsu…
))

8483 
	$¸óã_èbÀ_def
(

8485 
åx_t
* 
åx
,

8486 c⁄° 
TABLE
* 
f‹m
,

8488 c⁄° * 
èbÀ_«me
,

8489 c⁄° * 
ãmp_∑th
,

8497 c⁄° * 
ªmŸe_∑th
,

8498 
ulöt
 
Êags
,

8499 
ulöt
 
Êags2
)

8501 
THD
* 
thd
 = 
åx
->
mysql_thd
;

8502 
di˘_èbÀ_t
* 
èbÀ
;

8503 
ulöt
 
n_cﬁs
;

8504 
dbîr_t
 
îr
;

8505 
ulöt
 
cﬁ_ty≥
;

8506 
ulöt
 
cﬁ_Àn
;

8507 
ulöt
 
nuŒs_Ælowed
;

8508 
ulöt
 
unsig√d_ty≥
;

8509 
ulöt
 
bö¨y_ty≥
;

8510 
ulöt
 
l⁄g_åue_v¨ch¨
;

8511 
ulöt
 
ch¨£t_no
;

8512 
ulöt
 
i
;

8513 
ulöt
 
doc_id_cﬁ
 = 0;

8514 
iboﬁ
 
has_doc_id_cﬁ
 = 
FALSE
;

8515 
mem_hóp_t
* 
hóp
;

8517 
	`DBUG_ENTER
("create_table_def");

8518 
	`DBUG_PRINT
("íãr", ("èbÀ_«me: %s", 
èbÀ_«me
));

8520 
	`DBUG_ASSERT
(
thd
 !
NULL
);

8524 c⁄° 
size_t
 
èbÀ_«me_Àn
 = 
	`°æí
(
èbÀ_«me
);

8525 i‡(
èbÀ_«me_Àn
 > 
MAX_FULL_NAME_LEN
) {

8526 
	`push_w¨nög_¥ötf
(

8527 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

8528 
ER_TABLE_NAME
,

8531 
	`DBUG_RETURN
(
ER_TABLE_NAME
);

8534 i‡(
èbÀ_«me
[
èbÀ_«me_Àn
 - 1] == '/') {

8535 
	`push_w¨nög_¥ötf
(

8536 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

8537 
ER_TABLE_NAME
,

8540 
	`DBUG_RETURN
(
ER_WRONG_TABLE_NAME
);

8543 
n_cﬁs
 = 
f‹m
->
s
->
fõlds
;

8546 i‡(
	`¸óã_èbÀ_check_doc_id_cﬁ
(
åx
, 
f‹m
, &
doc_id_cﬁ
)){

8549 i‡(
doc_id_cﬁ
 =
ULINT_UNDEFINED
) {

8550 
	`åx_commô_f‹_mysql
(
åx
);

8552 
îr
 = 
DB_ERROR
;

8553 
îr‹_ªt
;

8555 
has_doc_id_cﬁ
 = 
TRUE
;

8562 i‡(
Êags2
 & 
DICT_TF2_FTS
) {

8564 i‡(!
has_doc_id_cﬁ
) {

8565 
èbÀ
 = 
	`di˘_mem_èbÀ_¸óã
(
èbÀ_«me
, 0, 
n_cﬁs
 + 1,

8566 
Êags
, 
Êags2
);

8569 
èbÀ
->
·s
->
doc_cﬁ
 = 
n_cﬁs
;

8571 
èbÀ
 = 
	`di˘_mem_èbÀ_¸óã
(
èbÀ_«me
, 0, 
n_cﬁs
,

8572 
Êags
, 
Êags2
);

8573 
èbÀ
->
·s
->
doc_cﬁ
 = 
doc_id_cﬁ
;

8576 
èbÀ
 = 
	`di˘_mem_èbÀ_¸óã
(
èbÀ_«me
, 0, 
n_cﬁs
,

8577 
Êags
, 
Êags2
);

8580 i‡(
Êags2
 & 
DICT_TF2_TEMPORARY
) {

8581 
	`ut_a
(
	`°æí
(
ãmp_∑th
));

8582 
èbÀ
->
dú_∑th_of_ãmp_èbÀ
 =

8583 
	`mem_hóp_°rdup
(
èbÀ
->
hóp
, 
ãmp_∑th
);

8586 i‡(
	`DICT_TF_HAS_DATA_DIR
(
Êags
)) {

8587 
	`ut_a
(
	`°æí
(
ªmŸe_∑th
));

8588 
èbÀ
->
d©a_dú_∑th
 = 
	`mem_hóp_°rdup
—abÀ->
hóp
, 
ªmŸe_∑th
);

8590 
èbÀ
->
d©a_dú_∑th
 = 
NULL
;

8592 
hóp
 = 
	`mem_hóp_¸óã
(1000);

8594 
i
 = 0; i < 
n_cﬁs
; i++) {

8595 
Fõld
* 
fõld
 = 
f‹m
->fõld[
i
];

8597 
cﬁ_ty≥
 = 
	`gë_önoba£_ty≥_‰om_mysql_ty≥
(&
unsig√d_ty≥
,

8598 
fõld
);

8600 i‡(!
cﬁ_ty≥
) {

8601 
	`push_w¨nög_¥ötf
(

8602 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

8603 
ER_CANT_CREATE_TABLE
,

8609 
èbÀ
->
«me
, 
fõld
->
fõld_«me
);

8610 
îr_cﬁ
;

8613 
nuŒs_Ælowed
 = 
fõld
->
	`ªÆ_maybe_nuŒ
(Ë? 0 : 
DATA_NOT_NULL
;

8614 
bö¨y_ty≥
 = 
fõld
->
	`bö¨y
(Ë? 
DATA_BINARY_TYPE
 : 0;

8616 
ch¨£t_no
 = 0;

8618 i‡(
	`dty≥_is_°rög_ty≥
(
cﬁ_ty≥
)) {

8620 
ch¨£t_no
 = (
ulöt
Ë
fõld
->
	`ch¨£t
()->
numbî
;

8622 i‡(
	`UNIV_UNLIKELY
(
ch¨£t_no
 > 
MAX_CHAR_COLL_NUM
)) {

8625 
	`push_w¨nög_¥ötf
(

8626 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

8627 
ER_CANT_CREATE_TABLE
,

8631 (
ul⁄g
Ë
ch¨£t_no
);

8632 
	`mem_hóp_‰ì
(
hóp
);

8633 
	`DBUG_RETURN
(
ER_CANT_CREATE_TABLE
);

8639 
	`ut_a
(
°©ic_ˇ°
<
uöt
>(
fõld
->
	`ty≥
()Ë<
MAX_CHAR_COLL_NUM
);

8640 
cﬁ_Àn
 = 
fõld
->
	`∑ck_Àngth
();

8647 
l⁄g_åue_v¨ch¨
 = 0;

8649 i‡(
fõld
->
	`ty≥
(Ë=
MYSQL_TYPE_VARCHAR
) {

8650 
cﬁ_Àn
 -((
Fõld_v¨°rög
*Ë
fõld
)->
Àngth_byãs
;

8652 i‡(((
Fõld_v¨°rög
*Ë
fõld
)->
Àngth_byãs
 == 2) {

8653 
l⁄g_åue_v¨ch¨
 = 
DATA_LONG_TRUE_VARCHAR
;

8659 i‡(
	`di˘_cﬁ_«me_is_ª£rved
(
fõld
->
fõld_«me
)){

8660 
	`my_îr‹
(
ER_WRONG_COLUMN_NAME
, 
	`MYF
(0),

8661 
fõld
->
fõld_«me
);

8662 
îr_cﬁ
:

8663 
	`di˘_mem_èbÀ_‰ì
(
èbÀ
);

8664 
	`mem_hóp_‰ì
(
hóp
);

8665 
	`åx_commô_f‹_mysql
(
åx
);

8667 
îr
 = 
DB_ERROR
;

8668 
îr‹_ªt
;

8671 
	`di˘_mem_èbÀ_add_cﬁ
(
èbÀ
, 
hóp
,

8672 
fõld
->
fõld_«me
,

8673 
cﬁ_ty≥
,

8674 
	`dty≥_f‹m_¥ty≥
(

8675 (
ulöt
Ë
fõld
->
	`ty≥
()

8676 | 
nuŒs_Ælowed
 | 
unsig√d_ty≥


8677 | 
bö¨y_ty≥
 | 
l⁄g_åue_v¨ch¨
,

8678 
ch¨£t_no
),

8679 
cﬁ_Àn
);

8683 i‡(
Êags2
 & 
DICT_TF2_FTS
 && !
has_doc_id_cﬁ
) {

8684 
	`·s_add_doc_id_cﬁumn
(
èbÀ
, 
hóp
);

8687 
îr
 = 
	`row_¸óã_èbÀ_f‹_mysql
(
èbÀ
, 
åx
, 
Ál£
);

8689 
	`mem_hóp_‰ì
(
hóp
);

8691 
	`DBUG_EXECUTE_IF
("ib_create_err_tablespace_exist",

8692 
îr
 = 
DB_TABLESPACE_EXISTS
;);

8694 i‡(
îr
 =
DB_DUPLICATE_KEY
 ||Éº =
DB_TABLESPACE_EXISTS
) {

8695 
di•œy_«me
[
FN_REFLEN
];

8696 * 
buf_íd
 = 
	`önoba£_c⁄vît_idítifõr
(

8697 
di•œy_«me
, (display_name) - 1,

8698 
èbÀ_«me
, 
	`°æí
(table_name),

8699 
thd
, 
TRUE
);

8701 *
buf_íd
 = '\0';

8703 
	`my_îr‹
(
îr
 =
DB_DUPLICATE_KEY


8704 ? 
ER_TABLE_EXISTS_ERROR


8705 : 
ER_TABLESPACE_EXISTS
, 
	`MYF
(0), 
di•œy_«me
);

8708 i‡(
îr
 =
DB_SUCCESS
 && (
Êags2
 & 
DICT_TF2_FTS
)) {

8709 
	`·s_›timize_add_èbÀ
(
èbÀ
);

8712 
îr‹_ªt
:

8713 
	`DBUG_RETURN
(
	`c⁄vît_îr‹_code_to_mysql
(
îr
, 
Êags
, 
thd
));

8714 
	}
}

8720 
	$¸óã_ödex
(

8722 
åx_t
* 
åx
,

8723 c⁄° 
TABLE
* 
f‹m
,

8725 
ulöt
 
Êags
,

8726 c⁄° * 
èbÀ_«me
,

8727 
uöt
 
key_num
)

8729 
di˘_ödex_t
* 
ödex
;

8730 
îr‹
;

8731 c⁄° 
KEY
* 
key
;

8732 
ulöt
 
öd_ty≥
;

8733 
ulöt
* 
fõld_Àngths
;

8735 
	`DBUG_ENTER
("create_index");

8737 
key
 = 
f‹m
->
key_öfo
 + 
key_num
;

8740 
	`ut_a
(
	`önoba£_°rˇ£cmp
(
key
->
«me
, 
önoba£_ödex_ª£rve_«me
) != 0);

8742 i‡(
key
->
Êags
 & 
HA_FULLTEXT
) {

8743 
ödex
 = 
	`di˘_mem_ödex_¸óã
(
èbÀ_«me
, 
key
->
«me
, 0,

8744 
DICT_FTS
,

8745 
key
->
u£r_deföed_key_∑πs
);

8747 
ulöt
 
i
 = 0; i < 
key
->
u£r_deföed_key_∑πs
; i++) {

8748 
KEY_PART_INFO
* 
key_∑π
 = 
key
->key_∑π + 
i
;

8749 
	`di˘_mem_ödex_add_fõld
(

8750 
ödex
, 
key_∑π
->
fõld
->
fõld_«me
, 0);

8753 
	`DBUG_RETURN
(
	`c⁄vît_îr‹_code_to_mysql
(

8754 
	`row_¸óã_ödex_f‹_mysql
(

8755 
ödex
, 
åx
, 
NULL
),

8756 
Êags
, 
NULL
));

8760 
öd_ty≥
 = 0;

8762 i‡(
key_num
 =
f‹m
->
s
->
¥im¨y_key
) {

8763 
öd_ty≥
 |
DICT_CLUSTERED
;

8766 i‡(
key
->
Êags
 & 
HA_NOSAME
) {

8767 
öd_ty≥
 |
DICT_UNIQUE
;

8770 
fõld_Àngths
 = (
ulöt
*Ë
	`my_mÆloc
(

8771 
key
->
u£r_deföed_key_∑πs
 *  *

8772 
fõld_Àngths
, 
	`MYF
(
MY_FAE
));

8777 
ödex
 = 
	`di˘_mem_ödex_¸óã
(
èbÀ_«me
, 
key
->
«me
, 0,

8778 
öd_ty≥
, 
key
->
u£r_deföed_key_∑πs
);

8780 
ulöt
 
i
 = 0; i < 
key
->
u£r_deföed_key_∑πs
; i++) {

8781 
KEY_PART_INFO
* 
key_∑π
 = 
key
->key_∑π + 
i
;

8782 
ulöt
 
¥efix_Àn
;

8783 
ulöt
 
cﬁ_ty≥
;

8784 
ulöt
 
is_unsig√d
;

8794 
Fõld
* 
fõld
 = 
NULL
;

8796 
ulöt
 
j
 = 0; j < 
f‹m
->
s
->
fõlds
; j++) {

8798 
fõld
 = 
f‹m
->fõld[
j
];

8800 i‡(0 =
	`önoba£_°rˇ£cmp
(

8801 
fõld
->
fõld_«me
,

8802 
key_∑π
->
fõld
->
fõld_«me
)) {

8805 
found
;

8809 
ut_îr‹
;

8810 
found
:

8811 
cﬁ_ty≥
 = 
	`gë_önoba£_ty≥_‰om_mysql_ty≥
(

8812 &
is_unsig√d
, 
key_∑π
->
fõld
);

8814 i‡(
DATA_BLOB
 =
cﬁ_ty≥


8815 || (
key_∑π
->
Àngth
 < 
fõld
->
	`∑ck_Àngth
()

8816 && 
fõld
->
	`ty≥
(Ë!
MYSQL_TYPE_VARCHAR
)

8817 || (
fõld
->
	`ty≥
(Ë=
MYSQL_TYPE_VARCHAR


8818 && 
key_∑π
->
Àngth
 < 
fõld
->
	`∑ck_Àngth
()

8819 - ((
Fõld_v¨°rög
*Ë
fõld
)->
Àngth_byãs
)) {

8821 
cﬁ_ty≥
) {

8823 
¥efix_Àn
 = 
key_∑π
->
Àngth
;

8825 
DATA_INT
:

8826 
DATA_FLOAT
:

8827 
DATA_DOUBLE
:

8828 
DATA_DECIMAL
:

8829 
	`sql_¥öt_îr‹
(

8834 
èbÀ_«me
,

8835 
key_∑π
->
fõld
->
fõld_«me
);

8837 
¥efix_Àn
 = 0;

8840 
¥efix_Àn
 = 0;

8843 
fõld_Àngths
[
i
] = 
key_∑π
->
Àngth
;

8845 
	`di˘_mem_ödex_add_fõld
(

8846 
ödex
, 
key_∑π
->
fõld
->
fõld_«me
, 
¥efix_Àn
);

8849 
	`ut_ad
(
key
->
Êags
 & 
HA_FULLTEXT
 || !(
ödex
->
ty≥
 & 
DICT_FTS
));

8855 
îr‹
 = 
	`c⁄vît_îr‹_code_to_mysql
(

8856 
	`row_¸óã_ödex_f‹_mysql
(
ödex
, 
åx
, 
fõld_Àngths
),

8857 
Êags
, 
NULL
);

8859 
	`my_‰ì
(
fõld_Àngths
);

8861 
	`DBUG_RETURN
(
îr‹
);

8862 
	}
}

8869 
	$¸óã_˛u°îed_ödex_whí_no_¥im¨y
(

8871 
åx_t
* 
åx
,

8872 
ulöt
 
Êags
,

8873 c⁄° * 
èbÀ_«me
)

8875 
di˘_ödex_t
* 
ödex
;

8876 
dbîr_t
 
îr‹
;

8880 
ödex
 = 
	`di˘_mem_ödex_¸óã
(
èbÀ_«me
,

8881 
önoba£_ödex_ª£rve_«me
,

8882 0, 
DICT_CLUSTERED
, 0);

8884 
îr‹
 = 
	`row_¸óã_ödex_f‹_mysql
(
ödex
, 
åx
, 
NULL
);

8886 (
	`c⁄vît_îr‹_code_to_mysql
(
îr‹
, 
Êags
, 
NULL
));

8887 
	}
}

8892 
UNIV_INTERN


8894 
	$gë_row_f‹m©_«me
(

8896 
row_ty≥
 
row_f‹m©
)

8898 
row_f‹m©
) {

8899 
ROW_TYPE_COMPACT
:

8901 
ROW_TYPE_COMPRESSED
:

8903 
ROW_TYPE_DYNAMIC
:

8905 
ROW_TYPE_REDUNDANT
:

8907 
ROW_TYPE_DEFAULT
:

8909 
ROW_TYPE_FIXED
:

8911 
ROW_TYPE_PAGE
:

8912 
ROW_TYPE_NOT_USED
:

8916 
	}
}

8919 
	#CHECK_ERROR_ROW_TYPE_NEEDS_FILE_PER_TABLE
(
u£_èbÀ•a˚
)\

8920 i‡(!
u£_èbÀ•a˚
) { \

8921 
	`push_w¨nög_¥ötf
( \

8922 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
, \

8923 
ER_ILLEGAL_HA_CREATE_OPTION
, \

8926 
	`gë_row_f‹m©_«me
(
row_f‹m©
)); \

8927 
ªt
 = "ROW_FORMAT"; \

8928 }

	)

8931 
	#CHECK_ERROR_ROW_TYPE_NEEDS_GT_ANTELOPE
 \

8932 i‡(
§v_fûe_f‹m©
 < 
UNIV_FORMAT_B
) { \

8933 
	`push_w¨nög_¥ötf
( \

8934 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
, \

8935 
ER_ILLEGAL_HA_CREATE_OPTION
, \

8938 
	`gë_row_f‹m©_«me
(
row_f‹m©
)); \

8939 
ªt
 = "ROW_FORMAT"; \

8940 }

	)

8949 
UNIV_INTERN


8951 
	$¸óã_›ti⁄s_¨e_övÆid
(

8953 
THD
* 
thd
,

8954 
TABLE
* 
f‹m
,

8956 
HA_CREATE_INFO
* 
¸óã_öfo
,

8957 
boﬁ
 
u£_èbÀ•a˚
)

8959 
iboﬁ
 
kbs_•ecifõd
 = 
FALSE
;

8960 c⁄° * 
ªt
 = 
NULL
;

8961 
row_ty≥
 
row_f‹m©
 = 
f‹m
->
s
->row_type;

8963 
	`ut_ad
(
thd
 !
NULL
);

8966 i‡(!(
	`THDVAR
(
thd
, 
°ri˘_mode
))) {

8967 (
NULL
);

8970 
	`ut_ad
(
f‹m
 !
NULL
);

8971 
	`ut_ad
(
¸óã_öfo
 !
NULL
);

8974 i‡(
¸óã_öfo
->
key_block_size
) {

8975 
kbs_•ecifõd
 = 
TRUE
;

8976 
¸óã_öfo
->
key_block_size
) {

8977 
ulöt
 
kbs_max
;

8984 i‡(!
u£_èbÀ•a˚
) {

8985 
	`push_w¨nög
(

8986 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

8987 
ER_ILLEGAL_HA_CREATE_OPTION
,

8990 
ªt
 = "KEY_BLOCK_SIZE";

8992 i‡(
§v_fûe_f‹m©
 < 
UNIV_FORMAT_B
) {

8993 
	`push_w¨nög
(

8994 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

8995 
ER_ILLEGAL_HA_CREATE_OPTION
,

8998 
ªt
 = "KEY_BLOCK_SIZE";

9004 
kbs_max
 = 
	`ut_mö
(

9005 1 << (
UNIV_PAGE_SSIZE_MAX
 - 1),

9006 1 << (
PAGE_ZIP_SSIZE_MAX
 - 1));

9007 i‡(
¸óã_öfo
->
key_block_size
 > 
kbs_max
) {

9008 
	`push_w¨nög_¥ötf
(

9009 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

9010 
ER_ILLEGAL_HA_CREATE_OPTION
,

9013 
¸óã_öfo
->
key_block_size
,

9014 
kbs_max
);

9015 
ªt
 = "KEY_BLOCK_SIZE";

9019 
	`push_w¨nög_¥ötf
(

9020 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

9021 
ER_ILLEGAL_HA_CREATE_OPTION
,

9024 
¸óã_öfo
->
key_block_size
);

9025 
ªt
 = "KEY_BLOCK_SIZE";

9032 
row_f‹m©
) {

9033 
ROW_TYPE_COMPRESSED
:

9034 
	`CHECK_ERROR_ROW_TYPE_NEEDS_FILE_PER_TABLE
(
u£_èbÀ•a˚
);

9035 
CHECK_ERROR_ROW_TYPE_NEEDS_GT_ANTELOPE
;

9037 
ROW_TYPE_DYNAMIC
:

9038 
	`CHECK_ERROR_ROW_TYPE_NEEDS_FILE_PER_TABLE
(
u£_èbÀ•a˚
);

9039 
CHECK_ERROR_ROW_TYPE_NEEDS_GT_ANTELOPE
;

9041 
ROW_TYPE_COMPACT
:

9042 
ROW_TYPE_REDUNDANT
:

9043 i‡(
kbs_•ecifõd
) {

9044 
	`push_w¨nög_¥ötf
(

9045 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

9046 
ER_ILLEGAL_HA_CREATE_OPTION
,

9049 
	`gë_row_f‹m©_«me
(
row_f‹m©
));

9050 
ªt
 = "KEY_BLOCK_SIZE";

9053 
ROW_TYPE_DEFAULT
:

9055 
ROW_TYPE_FIXED
:

9056 
ROW_TYPE_PAGE
:

9057 
ROW_TYPE_NOT_USED
:

9058 
	`push_w¨nög
(

9059 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

9060 
ER_ILLEGAL_HA_CREATE_OPTION
, \

9062 
ªt
 = "ROW_TYPE";

9067 i‡(
¸óã_öfo
->
d©a_fûe_«me
 && !
u£_èbÀ•a˚
) {

9068 
	`push_w¨nög
(

9069 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

9070 
ER_ILLEGAL_HA_CREATE_OPTION
,

9073 
ªt
 = "DATA DIRECTORY";

9077 i‡(
¸óã_öfo
->
d©a_fûe_«me


9078 && 
¸óã_öfo
->
›ti⁄s
 & 
HA_LEX_CREATE_TMP_TABLE
) {

9079 
	`push_w¨nög
(

9080 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

9081 
ER_ILLEGAL_HA_CREATE_OPTION
,

9084 
ªt
 = "DATA DIRECTORY";

9088 i‡(
¸óã_öfo
->
ödex_fûe_«me
) {

9089 
	`push_w¨nög_¥ötf
(

9090 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

9091 
ER_ILLEGAL_HA_CREATE_OPTION
,

9093 
ªt
 = "INDEX DIRECTORY";

9096 (
ªt
);

9097 
	}
}

9101 
UNIV_INTERN


9103 
	gha_önoba£
::
	$upd©e_¸óã_öfo
(

9105 
HA_CREATE_INFO
* 
¸óã_öfo
)

9107 i‡(!(
¸óã_öfo
->
u£d_fõlds
 & 
HA_CREATE_USED_AUTO
)) {

9108 
ha_önoba£
::
	`öfo
(
HA_STATUS_AUTO
);

9109 
¸óã_öfo
->
auto_ö¸emít_vÆue
 = 
°©s
.auto_increment_value;

9113 
	`di˘_gë_™d_ßve_d©a_dú_∑th
(
¥ebuût
->
èbÀ
, 
Ál£
);

9115 i‡(
¥ebuût
->
èbÀ
->
d©a_dú_∑th
) {

9116 
¸óã_öfo
->
d©a_fûe_«me
 = 
¥ebuût
->
èbÀ
->
d©a_dú_∑th
;

9118 
	}
}

9123 
UNIV_INTERN


9124 
iboﬁ


9125 
	$önoba£_·s_lﬂd_°›w‹d
(

9127 
di˘_èbÀ_t
* 
èbÀ
,

9128 
åx_t
* 
åx
,

9129 
THD
* 
thd
)

9131 (
	`·s_lﬂd_°›w‹d
(
èbÀ
, 
åx
,

9132 
önoba£_£rvî_°›w‹d_èbÀ
,

9133 
	`THDVAR
(
thd
, 
·_u£r_°›w‹d_èbÀ
),

9134 
	`THDVAR
(
thd
, 
·_íabÀ_°›w‹d
), 
FALSE
));

9135 
	}
}

9141 
UNIV_INTERN


9143 
	gha_önoba£
::
	$∑r£_èbÀ_«me
(

9145 c⁄° * 
«me
,

9146 
HA_CREATE_INFO
* 
¸óã_öfo
,

9149 
ulöt
 
Êags
,

9150 
ulöt
 
Êags2
,

9151 * 
n‹m_«me
,

9152 * 
ãmp_∑th
,

9153 * 
ªmŸe_∑th
)

9155 
THD
* 
thd
 = 
	`ha_thd
();

9156 
boﬁ
 
u£_èbÀ•a˚
 = 
Êags2
 & 
DICT_TF2_USE_TABLESPACE
;

9157 
	`DBUG_ENTER
("ha_innobase::parse_table_name");

9159 #ifde‡
__WIN__


9171 i‡(
u£_èbÀ•a˚


9172 && !
mysqld_embedded


9173 && !(
¸óã_öfo
->
›ti⁄s
 & 
HA_LEX_CREATE_TMP_TABLE
)) {

9175 i‡((
«me
[1] == ':')

9176 || (
«me
[0] == '\\' &&Çame[1] == '\\')) {

9177 
	`sql_¥öt_îr‹
("C™nŸ cª©êèbÀ %s\n", 
«me
);

9178 
	`DBUG_RETURN
(
HA_ERR_GENERIC
);

9183 
	`n‹mÆize_èbÀ_«me
(
n‹m_«me
, 
«me
);

9184 
ãmp_∑th
[0] = '\0';

9185 
ªmŸe_∑th
[0] = '\0';

9191 i‡(
¸óã_öfo
->
›ti⁄s
 & 
HA_LEX_CREATE_TMP_TABLE
) {

9192 
	`°∫˝y
(
ãmp_∑th
, 
«me
, 
FN_REFLEN
 - 1);

9195 i‡(
¸óã_öfo
->
d©a_fûe_«me
) {

9196 
boﬁ
 
ign‹e
 = 
Ál£
;

9199 i‡(!
u£_èbÀ•a˚
) {

9200 
	`push_w¨nög
(

9201 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

9202 
ER_ILLEGAL_HA_CREATE_OPTION
,

9205 
ign‹e
 = 
åue
;

9209 i‡(
¸óã_öfo
->
›ti⁄s
 & 
HA_LEX_CREATE_TMP_TABLE
) {

9210 
	`push_w¨nög
(

9211 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

9212 
ER_ILLEGAL_HA_CREATE_OPTION
,

9215 
ign‹e
 = 
åue
;

9218 i‡(
ign‹e
) {

9219 
	`push_w¨nög_¥ötf
(

9220 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

9221 
WARN_OPTION_IGNORED
,

9222 
	`ER_DEFAULT
(
WARN_OPTION_IGNORED
),

9225 
	`°∫˝y
(
ªmŸe_∑th
, 
¸óã_öfo
->
d©a_fûe_«me
,

9226 
FN_REFLEN
 - 1);

9230 i‡(
¸óã_öfo
->
ödex_fûe_«me
) {

9231 
	`push_w¨nög_¥ötf
(

9232 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

9233 
WARN_OPTION_IGNORED
,

9234 
	`ER_DEFAULT
(
WARN_OPTION_IGNORED
),

9238 
	`DBUG_RETURN
(0);

9239 
	}
}

9244 
UNIV_INTERN


9245 
boﬁ


9246 
	$önoba£_èbÀ_Êags
(

9248 c⁄° 
TABLE
* 
f‹m
,

9249 c⁄° 
HA_CREATE_INFO
* 
¸óã_öfo
,

9251 
THD
* 
thd
,

9252 
boﬁ
 
u£_èbÀ•a˚
,

9254 
ulöt
* 
Êags
,

9255 
ulöt
* 
Êags2
)

9257 
	`DBUG_ENTER
("innobase_table_flags");

9259 c⁄° * 
·s_doc_id_ödex_bad
 = 
NULL
;

9260 
boﬁ
 
zù_Ælowed
 = 
åue
;

9261 
ulöt
 
zù_ssize
 = 0;

9262 
row_ty≥
 
row_f‹m©
;

9263 
ªc_f‹m©_t
 
önodb_row_f‹m©
 = 
REC_FORMAT_COMPACT
;

9264 
boﬁ
 
u£_d©a_dú
;

9268 c⁄° 
ulöt
 
fûe_f‹m©_Ælowed
 = 
§v_fûe_f‹m©
;

9270 *
Êags
 = 0;

9271 *
Êags2
 = 0;

9274 
uöt
 
i
 = 0; i < 
f‹m
->
s
->
keys
; i++) {

9275 c⁄° 
KEY
* 
key
 = &
f‹m
->
key_öfo
[
i
];

9277 i‡(
key
->
Êags
 & 
HA_FULLTEXT
) {

9278 *
Êags2
 |
DICT_TF2_FTS
;

9282 i‡(
¸óã_öfo
->
›ti⁄s
 & 
HA_LEX_CREATE_TMP_TABLE
) {

9284 
	`my_îr‹
(
ER_INNODB_NO_FT_TEMP_TABLE
, 
	`MYF
(0));

9285 
	`DBUG_RETURN
(
Ál£
);

9288 i‡(
key
->
Êags
 & 
HA_USES_PARSER
) {

9289 
	`my_îr‹
(
ER_INNODB_NO_FT_USES_PARSER
, 
	`MYF
(0));

9290 
	`DBUG_RETURN
(
Ál£
);

9293 i‡(
·s_doc_id_ödex_bad
) {

9294 
ödex_bad
;

9298 i‡(
	`önoba£_°rˇ£cmp
(
key
->
«me
, 
FTS_DOC_ID_INDEX_NAME
)) {

9303 i‡(!(
key
->
Êags
 & 
HA_NOSAME
)

9304 || 
	`°rcmp
(
key
->
«me
, 
FTS_DOC_ID_INDEX_NAME
)

9305 || 
	`°rcmp
(
key
->
key_∑π
[0].
fõld
->
fõld_«me
,

9306 
FTS_DOC_ID_COL_NAME
)) {

9307 
·s_doc_id_ödex_bad
 = 
key
->
«me
;

9310 i‡(
·s_doc_id_ödex_bad
 && (*
Êags2
 & 
DICT_TF2_FTS
)) {

9311 
ödex_bad
:

9312 
	`my_îr‹
(
ER_INNODB_FT_WRONG_DOCID_INDEX
, 
	`MYF
(0),

9313 
·s_doc_id_ödex_bad
);

9314 
	`DBUG_RETURN
(
Ál£
);

9318 i‡(
¸óã_öfo
->
key_block_size
) {

9323 
ulöt
 
zssize
;

9324 
ulöt
 
kbsize
;

9325 
zssize
 = 
kbsize
 = 1;

9326 
zssize
 <
	`ut_mö
(
UNIV_PAGE_SSIZE_MAX
,

9327 
PAGE_ZIP_SSIZE_MAX
);

9328 
zssize
++, 
kbsize
 <<= 1) {

9329 i‡(
kbsize
 =
¸óã_öfo
->
key_block_size
) {

9330 
zù_ssize
 = 
zssize
;

9336 i‡(!
u£_èbÀ•a˚
) {

9337 
	`push_w¨nög
(

9338 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

9339 
ER_ILLEGAL_HA_CREATE_OPTION
,

9342 
zù_Ælowed
 = 
FALSE
;

9345 i‡(
fûe_f‹m©_Ælowed
 < 
UNIV_FORMAT_B
) {

9346 
	`push_w¨nög
(

9347 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

9348 
ER_ILLEGAL_HA_CREATE_OPTION
,

9351 
zù_Ælowed
 = 
FALSE
;

9354 i‡(!
zù_Ælowed


9355 || 
zssize
 > 
	`ut_mö
(
UNIV_PAGE_SSIZE_MAX
,

9356 
PAGE_ZIP_SSIZE_MAX
)) {

9357 
	`push_w¨nög_¥ötf
(

9358 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

9359 
ER_ILLEGAL_HA_CREATE_OPTION
,

9361 
¸óã_öfo
->
key_block_size
);

9365 
row_f‹m©
 = 
f‹m
->
s
->
row_ty≥
;

9367 i‡(
zù_ssize
 && 
zù_Ælowed
) {

9370 i‡(
row_f‹m©
 =
ROW_TYPE_DEFAULT
) {

9371 
row_f‹m©
 = 
ROW_TYPE_COMPRESSED
;

9372 } i‡(
row_f‹m©
 !
ROW_TYPE_COMPRESSED
) {

9379 
	`push_w¨nög_¥ötf
(

9380 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

9381 
ER_ILLEGAL_HA_CREATE_OPTION
,

9384 
¸óã_öfo
->
key_block_size
);

9385 
zù_Ælowed
 = 
FALSE
;

9389 i‡(
row_f‹m©
 =
ROW_TYPE_COMPRESSED
 && 
zù_Ælowed
) {

9393 
zù_ssize
 = 
	`ut_mö
(
UNIV_PAGE_SSIZE_MAX
,

9394 
PAGE_ZIP_SSIZE_MAX
) - 1;

9399 
row_f‹m©
) {

9400 
ROW_TYPE_REDUNDANT
:

9401 
önodb_row_f‹m©
 = 
REC_FORMAT_REDUNDANT
;

9404 
ROW_TYPE_COMPRESSED
:

9405 
ROW_TYPE_DYNAMIC
:

9406 i‡(!
u£_èbÀ•a˚
) {

9407 
	`push_w¨nög_¥ötf
(

9408 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

9409 
ER_ILLEGAL_HA_CREATE_OPTION
,

9412 
	`gë_row_f‹m©_«me
(
row_f‹m©
));

9413 } i‡(
fûe_f‹m©_Ælowed
 =
UNIV_FORMAT_A
) {

9414 
	`push_w¨nög_¥ötf
(

9415 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

9416 
ER_ILLEGAL_HA_CREATE_OPTION
,

9419 
	`gë_row_f‹m©_«me
(
row_f‹m©
));

9421 
önodb_row_f‹m©
 = (
row_f‹m©
 =
ROW_TYPE_DYNAMIC


9422 ? 
REC_FORMAT_DYNAMIC


9423 : 
REC_FORMAT_COMPRESSED
);

9426 
zù_Ælowed
 = 
FALSE
;

9428 
ROW_TYPE_NOT_USED
:

9429 
ROW_TYPE_FIXED
:

9430 
ROW_TYPE_PAGE
:

9431 
	`push_w¨nög
(

9432 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

9433 
ER_ILLEGAL_HA_CREATE_OPTION
,

9435 
ROW_TYPE_DEFAULT
:

9437 
row_f‹m©
 = 
ROW_TYPE_COMPACT
;

9438 
ROW_TYPE_COMPACT
:

9443 i‡(!
zù_Ælowed
) {

9444 
zù_ssize
 = 0;

9447 
u£_d©a_dú
 = 
u£_èbÀ•a˚


9448 && ((
¸óã_öfo
->
d©a_fûe_«me
 !
NULL
)

9449 && !(
¸óã_öfo
->
›ti⁄s
 & 
HA_LEX_CREATE_TMP_TABLE
));

9451 
	`di˘_tf_£t
(
Êags
, 
önodb_row_f‹m©
, 
zù_ssize
, 
u£_d©a_dú
);

9453 i‡(
¸óã_öfo
->
›ti⁄s
 & 
HA_LEX_CREATE_TMP_TABLE
) {

9454 *
Êags2
 |
DICT_TF2_TEMPORARY
;

9457 i‡(
u£_èbÀ•a˚
) {

9458 *
Êags2
 |
DICT_TF2_USE_TABLESPACE
;

9462 *
Êags2
 |
DICT_TF2_FTS_AUX_HEX_NAME
;

9463 
	`DBUG_EXECUTE_IF
("innodb_test_wrong_fts_aux_table_name",

9464 *
Êags2
 &~
DICT_TF2_FTS_AUX_HEX_NAME
;);

9466 
	`DBUG_RETURN
(
åue
);

9467 
	}
}

9472 
UNIV_INTERN


9474 
	gha_önoba£
::
	$¸óã
(

9476 c⁄° * 
«me
,

9477 
TABLE
* 
f‹m
,

9479 
HA_CREATE_INFO
* 
¸óã_öfo
)

9483 
îr‹
;

9484 
åx_t
* 
∑ª¡_åx
;

9485 
åx_t
* 
åx
;

9486 
¥im¨y_key_no
;

9487 
uöt
 
i
;

9488 
n‹m_«me
[
FN_REFLEN
];

9489 
ãmp_∑th
[
FN_REFLEN
];

9490 
ªmŸe_∑th
[
FN_REFLEN
];

9491 
THD
* 
thd
 = 
	`ha_thd
();

9492 
ib_öt64_t
 
auto_öc_vÆue
;

9499 
boﬁ
 
u£_èbÀ•a˚
 = 
§v_fûe_≥r_èbÀ
;

9503 
ulöt
 
Êags
;

9504 
ulöt
 
Êags2
;

9505 
di˘_èbÀ_t
* 
önoba£_èbÀ
 = 
NULL
;

9507 c⁄° * 
°mt
;

9508 
size_t
 
°mt_Àn
;

9510 
	`DBUG_ENTER
("ha_innobase::create");

9512 
	`DBUG_ASSERT
(
thd
 !
NULL
);

9513 
	`DBUG_ASSERT
(
¸óã_öfo
 !
NULL
);

9515 i‡(
f‹m
->
s
->
fõlds
 > 
REC_MAX_N_USER_FIELDS
) {

9516 
	`DBUG_RETURN
(
HA_ERR_TOO_MANY_FIELDS
);

9517 } i‡(
§v_ªad_⁄ly_mode
) {

9518 
	`DBUG_RETURN
(
HA_ERR_INNODB_READ_ONLY
);

9524 i‡(
	`¸óã_›ti⁄s_¨e_övÆid
(

9525 
thd
, 
f‹m
, 
¸óã_öfo
, 
u£_èbÀ•a˚
)) {

9526 
	`DBUG_RETURN
(
HA_WRONG_CREATE_OPTION
);

9529 i‡(!
	`önoba£_èbÀ_Êags
(
f‹m
, 
¸óã_öfo
,

9530 
thd
, 
u£_èbÀ•a˚
,

9531 &
Êags
, &
Êags2
)) {

9532 
	`DBUG_RETURN
(-1);

9535 
îr‹
 = 
	`∑r£_èbÀ_«me
(
«me
, 
¸óã_öfo
, 
Êags
, 
Êags2
,

9536 
n‹m_«me
, 
ãmp_∑th
, 
ªmŸe_∑th
);

9537 i‡(
îr‹
) {

9538 
	`DBUG_RETURN
(
îr‹
);

9542 
¥im¨y_key_no
 = (
f‹m
->
s
->
¥im¨y_key
 !
MAX_KEY
 ?

9543 (Ë
f‹m
->
s
->
¥im¨y_key
 :

9548 
	`ut_a
(
¥im¨y_key_no
 == -1 ||Örimary_key_no == 0);

9552 i‡(
	`önoba£_ödex_«me_is_ª£rved
(
thd
, 
f‹m
->
key_öfo
,

9553 
f‹m
->
s
->
keys
)) {

9554 
	`DBUG_RETURN
(-1);

9557 i‡(
	`row_is_magic_m⁄ô‹_èbÀ
(
n‹m_«me
)) {

9558 
	`push_w¨nög_¥ötf
(
thd
,

9559 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

9560 
HA_ERR_WRONG_COMMAND
,

9567 
	`di˘_ªmove_db_«me
(
n‹m_«me
));

9571 i‡(
	`check_globÆ_ac˚ss
(
thd
, 
PROCESS_ACL
)) {

9572 
	`DBUG_RETURN
(
HA_ERR_GENERIC
);

9579 
∑ª¡_åx
 = 
	`check_åx_exi°s
(
thd
);

9584 
	`åx_£¨ch_œtch_ªÀa£_if_ª£rved
(
∑ª¡_åx
);

9586 
åx
 = 
	`önoba£_åx_Æloˇã
(
thd
);

9592 
	`row_mysql_lock_d©a_di˘i⁄¨y
(
åx
);

9594 
îr‹
 = 
	`¸óã_èbÀ_def
(
åx
, 
f‹m
, 
n‹m_«me
, 
ãmp_∑th
,

9595 
ªmŸe_∑th
, 
Êags
, 
Êags2
);

9596 i‡(
îr‹
) {

9597 
˛ónup
;

9602 i‡(
f‹m
->
s
->
keys
 =0 || 
¥im¨y_key_no
 == -1) {

9607 
îr‹
 = 
	`¸óã_˛u°îed_ödex_whí_no_¥im¨y
(

9608 
åx
, 
Êags
, 
n‹m_«me
);

9609 i‡(
îr‹
) {

9610 
˛ónup
;

9614 i‡(
¥im¨y_key_no
 != -1) {

9617 i‡((
îr‹
 = 
	`¸óã_ödex
(
åx
, 
f‹m
, 
Êags
, 
n‹m_«me
,

9618 (
uöt
Ë
¥im¨y_key_no
))) {

9619 
˛ónup
;

9625 i‡(
Êags2
 & 
DICT_TF2_FTS
) {

9626 
·s_doc_id_ödex_íum
 
ªt
;

9628 
önoba£_èbÀ
 = 
	`di˘_èbÀ_›í_⁄_«me
(

9629 
n‹m_«me
, 
TRUE
, 
FALSE
, 
DICT_ERR_IGNORE_NONE
);

9631 
	`ut_a
(
önoba£_èbÀ
);

9634 
ªt
 = 
	`önoba£_·s_check_doc_id_ödex_ö_def
(

9635 
f‹m
->
s
->
keys
, f‹m->
key_öfo
);

9637 
ªt
) {

9638 
FTS_INCORRECT_DOC_ID_INDEX
:

9639 
	`push_w¨nög_¥ötf
(
thd
,

9640 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

9641 
ER_WRONG_NAME_FOR_INDEX
,

9650 
FTS_DOC_ID_INDEX_NAME
,

9651 
önoba£_èbÀ
->
«me
);

9653 i‡(
önoba£_èbÀ
->
·s
) {

9654 
	`·s_‰ì
(
önoba£_èbÀ
);

9657 
	`di˘_èbÀ_˛o£
(
önoba£_èbÀ
, 
TRUE
, 
FALSE
);

9658 
	`my_îr‹
(
ER_WRONG_NAME_FOR_INDEX
, 
	`MYF
(0),

9659 
FTS_DOC_ID_INDEX_NAME
);

9660 
îr‹
 = -1;

9661 
˛ónup
;

9662 
FTS_EXIST_DOC_ID_INDEX
:

9663 
FTS_NOT_EXIST_DOC_ID_INDEX
:

9667 
dbîr_t
 
îr
 = 
	`·s_¸óã_comm⁄_èbÀs
(

9668 
åx
, 
önoba£_èbÀ
, 
n‹m_«me
,

9669 (
ªt
 =
FTS_EXIST_DOC_ID_INDEX
));

9671 
îr‹
 = 
	`c⁄vît_îr‹_code_to_mysql
(
îr
, 0, 
NULL
);

9673 
	`di˘_èbÀ_˛o£
(
önoba£_èbÀ
, 
TRUE
, 
FALSE
);

9675 i‡(
îr‹
) {

9676 
˛ónup
;

9680 
i
 = 0; i < 
f‹m
->
s
->
keys
; i++) {

9682 i‡(
i
 !
°©ic_ˇ°
<
uöt
>(
¥im¨y_key_no
)) {

9684 i‡((
îr‹
 = 
	`¸óã_ödex
(
åx
, 
f‹m
, 
Êags
,

9685 
n‹m_«me
, 
i
))) {

9686 
˛ónup
;

9693 i‡(
Êags2
 & 
DICT_TF2_FTS
) {

9694 
·s_t
* 
·s
 = 
önoba£_èbÀ
->fts;

9696 
	`ut_a
(
·s
 !
NULL
);

9698 
	`di˘_èbÀ_gë_Æl_·s_ödexes
(
önoba£_èbÀ
, 
·s
->
ödexes
);

9701 
°mt
 = 
	`önoba£_gë_°mt
(
thd
, &
°mt_Àn
);

9703 i‡(
°mt
) {

9704 
dbîr_t
 
îr
 = 
	`row_èbÀ_add_f‹eign_c⁄°øöts
(

9705 
åx
, 
°mt
, 
°mt_Àn
, 
n‹m_«me
,

9706 
¸óã_öfo
->
›ti⁄s
 & 
HA_LEX_CREATE_TMP_TABLE
);

9708 
îr
) {

9710 
DB_PARENT_NO_INDEX
:

9711 
	`push_w¨nög_¥ötf
(

9712 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

9713 
HA_ERR_CANNOT_ADD_FOREIGN
,

9717 "á†thêfú° cﬁumns.\n", 
n‹m_«me
);

9720 
DB_CHILD_NO_INDEX
:

9721 
	`push_w¨nög_¥ötf
(

9722 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

9723 
HA_ERR_CANNOT_ADD_FOREIGN
,

9727 "á†thêfú° cﬁumns.\n", 
n‹m_«me
);

9733 
îr‹
 = 
	`c⁄vît_îr‹_code_to_mysql
(
îr
, 
Êags
, 
NULL
);

9735 i‡(
îr‹
) {

9736 
˛ónup
;

9740 
	`önoba£_commô_low
(
åx
);

9742 
	`row_mysql_u∆ock_d©a_di˘i⁄¨y
(
åx
);

9748 
	`log_buf„r_Êush_to_disk
();

9750 
önoba£_èbÀ
 = 
	`di˘_èbÀ_›í_⁄_«me
(

9751 
n‹m_«me
, 
FALSE
, FALSE, 
DICT_ERR_IGNORE_NONE
);

9753 
	`DBUG_ASSERT
(
önoba£_èbÀ
 != 0);

9755 
	`önoba£_c›y_‰m_Êags_‰om_¸óã_öfo
(
önoba£_èbÀ
, 
¸óã_öfo
);

9757 
	`di˘_°©s_upd©e
(
önoba£_èbÀ
, 
DICT_STATS_EMPTY_TABLE
);

9759 i‡(
önoba£_èbÀ
) {

9763 
	`åx_sys_fûe_f‹m©_max_upgøde
(

9764 (c⁄° **Ë&
önoba£_fûe_f‹m©_max
,

9765 
	`di˘_èbÀ_gë_f‹m©
(
önoba£_èbÀ
));

9769 i‡(
Êags2
 & 
DICT_TF2_FTS
) {

9770 i‡(!
	`önoba£_·s_lﬂd_°›w‹d
(
önoba£_èbÀ
, 
NULL
, 
thd
)) {

9771 
	`di˘_èbÀ_˛o£
(
önoba£_èbÀ
, 
FALSE
, FALSE);

9772 
	`§v_a˘ive_wake_ma°î_thªad
();

9773 
	`åx_‰ì_f‹_mysql
(
åx
);

9774 
	`DBUG_RETURN
(-1);

9795 i‡(((
¸óã_öfo
->
u£d_fõlds
 & 
HA_CREATE_USED_AUTO
)

9796 || 
	`thd_sql_comm™d
(
thd
Ë=
SQLCOM_ALTER_TABLE


9797 || 
	`thd_sql_comm™d
(
thd
Ë=
SQLCOM_OPTIMIZE


9798 || 
	`thd_sql_comm™d
(
thd
Ë=
SQLCOM_CREATE_INDEX
)

9799 && 
¸óã_öfo
->
auto_ö¸emít_vÆue
 > 0) {

9801 
auto_öc_vÆue
 = 
¸óã_öfo
->
auto_ö¸emít_vÆue
;

9803 
	`di˘_èbÀ_autoöc_lock
(
önoba£_èbÀ
);

9804 
	`di˘_èbÀ_autoöc_öôülize
(
önoba£_èbÀ
, 
auto_öc_vÆue
);

9805 
	`di˘_èbÀ_autoöc_u∆ock
(
önoba£_èbÀ
);

9808 
	`di˘_èbÀ_˛o£
(
önoba£_èbÀ
, 
FALSE
, FALSE);

9813 
	`§v_a˘ive_wake_ma°î_thªad
();

9815 
	`åx_‰ì_f‹_mysql
(
åx
);

9817 
	`DBUG_RETURN
(0);

9819 
˛ónup
:

9820 
	`åx_rﬁlback_f‹_mysql
(
åx
);

9822 
	`row_mysql_u∆ock_d©a_di˘i⁄¨y
(
åx
);

9824 
	`åx_‰ì_f‹_mysql
(
åx
);

9826 
	`DBUG_RETURN
(
îr‹
);

9827 
	}
}

9832 
UNIV_INTERN


9834 
	gha_önoba£
::
	$disˇrd_‹_imp‹t_èbÀ•a˚
(

9836 
my_boﬁ
 
disˇrd
)

9838 
dbîr_t
 
îr
;

9839 
di˘_èbÀ_t
* 
di˘_èbÀ
;

9841 
	`DBUG_ENTER
("ha_innobase::discard_or_import_tablespace");

9843 
	`ut_a
(
¥ebuût
->
åx
);

9844 
	`ut_a
(
¥ebuût
->
åx
->
magic_n
 =
TRX_MAGIC_N
);

9845 
	`ut_a
(
¥ebuût
->
åx
 =
	`thd_to_åx
(
	`ha_thd
()));

9847 i‡(
§v_ªad_⁄ly_mode
) {

9848 
	`DBUG_RETURN
(
HA_ERR_TABLE_READONLY
);

9851 
di˘_èbÀ
 = 
¥ebuût
->
èbÀ
;

9853 i‡(
di˘_èbÀ
->
•a˚
 =
TRX_SYS_SPACE
) {

9855 
	`ib_£ndîrf
(

9856 
¥ebuût
->
åx
->
mysql_thd
, 
IB_LOG_LEVEL_ERROR
,

9857 
ER_TABLE_IN_SYSTEM_TABLESPACE
,

9858 
èbÀ
->
s
->
èbÀ_«me
.
°r
);

9860 
	`DBUG_RETURN
(
HA_ERR_TABLE_NEEDS_UPGRADE
);

9863 
	`åx_°¨t_if_nŸ_°¨ãd
(
¥ebuût
->
åx
);

9867 
	`åx_£¨ch_œtch_ªÀa£_if_ª£rved
(
¥ebuût
->
åx
);

9870 
îr
 = 
	`row_mysql_lock_èbÀ
(

9871 
¥ebuût
->
åx
, 
di˘_èbÀ
, 
LOCK_X
,

9872 
disˇrd
 ? "settingÅableÜock for DISCARD TABLESPACE"

9875 i‡(
îr
 !
DB_SUCCESS
) {

9877 } i‡(
disˇrd
) {

9884 i‡(
di˘_èbÀ
->
ibd_fûe_missög
) {

9885 
	`ib_£ndîrf
(

9886 
¥ebuût
->
åx
->
mysql_thd
,

9887 
IB_LOG_LEVEL_WARN
, 
ER_TABLESPACE_MISSING
,

9888 
èbÀ
->
s
->
èbÀ_«me
.
°r
);

9891 
îr
 = 
	`row_disˇrd_èbÀ•a˚_f‹_mysql
(

9892 
di˘_èbÀ
->
«me
, 
¥ebuût
->
åx
);

9894 } i‡(!
di˘_èbÀ
->
ibd_fûe_missög
) {

9897 
	`åx_commô_f‹_mysql
(
¥ebuût
->
åx
);

9899 
	`ib_£ndîrf
(

9900 
¥ebuût
->
åx
->
mysql_thd
, 
IB_LOG_LEVEL_ERROR
,

9901 
ER_TABLESPACE_EXISTS
, 
èbÀ
->
s
->
èbÀ_«me
.
°r
);

9903 
	`DBUG_RETURN
(
HA_ERR_TABLE_EXIST
);

9905 
îr
 = 
	`row_imp‹t_f‹_mysql
(
di˘_èbÀ
, 
¥ebuût
);

9907 i‡(
îr
 =
DB_SUCCESS
) {

9909 i‡(
èbÀ
->
found_√xt_numbî_fõld
) {

9910 
	`di˘_èbÀ_autoöc_lock
(
di˘_èbÀ
);

9911 
	`önoba£_öôülize_autoöc
();

9912 
	`di˘_èbÀ_autoöc_u∆ock
(
di˘_èbÀ
);

9915 
	`öfo
(
HA_STATUS_TIME


9916 | 
HA_STATUS_CONST


9917 | 
HA_STATUS_VARIABLE


9918 | 
HA_STATUS_AUTO
);

9923 
	`åx_commô_f‹_mysql
(
¥ebuût
->
åx
);

9925 
	`DBUG_RETURN
(
	`c⁄vît_îr‹_code_to_mysql
(
îr
, 
di˘_èbÀ
->
Êags
, 
NULL
));

9926 
	}
}

9931 
UNIV_INTERN


9933 
	gha_önoba£
::
	$åunˇã
()

9936 
dbîr_t
 
îr
;

9937 
îr‹
;

9939 
	`DBUG_ENTER
("ha_innobase::truncate");

9941 i‡(
§v_ªad_⁄ly_mode
) {

9942 
	`DBUG_RETURN
(
HA_ERR_TABLE_READONLY
);

9948 
	`upd©e_thd
(
	`ha_thd
());

9950 i‡(!
	`åx_is_°¨ãd
(
¥ebuût
->
åx
)) {

9951 ++
¥ebuût
->
åx
->
wûl_lock
;

9955 
îr
 = 
	`row_åunˇã_èbÀ_f‹_mysql
(
¥ebuût
->
èbÀ
,Öªbuût->
åx
);

9957 
îr
) {

9959 
DB_TABLESPACE_DELETED
:

9960 
DB_TABLESPACE_NOT_FOUND
:

9961 
	`ib_£ndîrf
(

9962 
¥ebuût
->
åx
->
mysql_thd
, 
IB_LOG_LEVEL_ERROR
,

9963 (
îr
 =
DB_TABLESPACE_DELETED
 ?

9964 
ER_TABLESPACE_DISCARDED
 : 
ER_TABLESPACE_MISSING
),

9965 
èbÀ
->
s
->
èbÀ_«me
.
°r
);

9966 
èbÀ
->
°©us
 = 
STATUS_NOT_FOUND
;

9967 
îr‹
 = 
HA_ERR_NO_SUCH_TABLE
;

9971 
îr‹
 = 
	`c⁄vît_îr‹_code_to_mysql
(

9972 
îr
, 
¥ebuût
->
èbÀ
->
Êags
,

9973 
¥ebuût
->
åx
->
mysql_thd
);

9974 
èbÀ
->
°©us
 = 
STATUS_NOT_FOUND
;

9977 
	`DBUG_RETURN
(
îr‹
);

9978 
	}
}

9987 
UNIV_INTERN


9989 
	gha_önoba£
::
	$dñëe_èbÀ
(

9991 c⁄° * 
«me
)

9993 
ulöt
 
«me_Àn
;

9994 
dbîr_t
 
îr
;

9995 
åx_t
* 
∑ª¡_åx
;

9996 
åx_t
* 
åx
;

9997 
THD
* 
thd
 = 
	`ha_thd
();

9998 
n‹m_«me
[
FN_REFLEN
];

10000 
	`DBUG_ENTER
("ha_innobase::delete_table");

10002 
	`DBUG_EXECUTE_IF
(

10004 
	`ã°_n‹mÆize_èbÀ_«me_low
();

10006 
	`DBUG_EXECUTE_IF
(

10008 
	`ã°_ut_f‹m©_«me
();

10013 
	`n‹mÆize_èbÀ_«me
(
n‹m_«me
, 
«me
);

10015 i‡(
§v_ªad_⁄ly_mode
) {

10016 
	`DBUG_RETURN
(
HA_ERR_TABLE_READONLY
);

10017 } i‡(
	`row_is_magic_m⁄ô‹_èbÀ
(
n‹m_«me
)

10018 && 
	`check_globÆ_ac˚ss
(
thd
, 
PROCESS_ACL
)) {

10019 
	`DBUG_RETURN
(
HA_ERR_GENERIC
);

10022 
∑ª¡_åx
 = 
	`check_åx_exi°s
(
thd
);

10027 
	`åx_£¨ch_œtch_ªÀa£_if_ª£rved
(
∑ª¡_åx
);

10029 
åx
 = 
	`önoba£_åx_Æloˇã
(
thd
);

10031 
«me_Àn
 = 
	`°æí
(
«me
);

10033 
	`ut_a
(
«me_Àn
 < 1000);

10038 
	`ut_a
(!
	`åx_is_°¨ãd
(
åx
Ë||Årx->
wûl_lock
 > 0);

10041 ++
åx
->
wûl_lock
;

10042 
åx
->
ddl
 = 
åue
;

10045 
îr
 = 
	`row_dr›_èbÀ_f‹_mysql
(

10046 
n‹m_«me
, 
åx
, 
	`thd_sql_comm™d
(
thd
Ë=
SQLCOM_DROP_DB
);

10049 i‡(
îr
 =
DB_TABLE_NOT_FOUND


10050 && 
	`önoba£_gë_lowî_ˇ£_èbÀ_«mes
() == 1) {

10051 * 
is_∑π
 = 
NULL
;

10052 #ifde‡
__WIN__


10053 
is_∑π
 = 
	`°r°r
(
n‹m_«me
, "#p#");

10055 
is_∑π
 = 
	`°r°r
(
n‹m_«me
, "#P#");

10058 i‡(
is_∑π
) {

10059 
∑r_ˇ£_«me
[
FN_REFLEN
];

10061 #i‚de‡
__WIN__


10065 
	`°r˝y
(
∑r_ˇ£_«me
, 
n‹m_«me
);

10066 
	`önoba£_ˇ£dn_°r
(
∑r_ˇ£_«me
);

10072 
	`n‹mÆize_èbÀ_«me_low
(

10073 
∑r_ˇ£_«me
, 
«me
, 
FALSE
);

10075 
îr
 = 
	`row_dr›_èbÀ_f‹_mysql
(

10076 
∑r_ˇ£_«me
, 
åx
,

10077 
	`thd_sql_comm™d
(
thd
Ë=
SQLCOM_DROP_DB
);

10085 
	`log_buf„r_Êush_to_disk
();

10087 
	`önoba£_commô_low
(
åx
);

10089 
	`åx_‰ì_f‹_mysql
(
åx
);

10091 
	`DBUG_RETURN
(
	`c⁄vît_îr‹_code_to_mysql
(
îr
, 0, 
NULL
));

10092 
	}
}

10098 
	$önoba£_dr›_d©aba£
(

10100 
h™dÀπ⁄
* 
ht⁄
,

10101 * 
∑th
)

10106 
ulöt
 
Àn
 = 0;

10107 
åx_t
* 
åx
;

10108 * 
±r
;

10109 * 
«mebuf
;

10110 
THD
* 
thd
 = 
cuºít_thd
;

10115 
	`DBUG_ASSERT
(
ht⁄
 =
önodb_ht⁄_±r
);

10117 i‡(
§v_ªad_⁄ly_mode
) {

10122 i‡(
thd
) {

10123 
åx_t
* 
∑ª¡_åx
 = 
	`check_åx_exi°s
(
thd
);

10129 
	`åx_£¨ch_œtch_ªÀa£_if_ª£rved
(
∑ª¡_åx
);

10132 
±r
 = 
	`°ªnd
(
∑th
) - 2;

10134 
±r
 >
∑th
 && *ptr != '\\' && *ptr != '/') {

10135 
±r
--;

10136 
Àn
++;

10139 
±r
++;

10140 
«mebuf
 = (*Ë
	`my_mÆloc
((
uöt
Ë
Àn
 + 2, 
	`MYF
(0));

10142 
	`mem˝y
(
«mebuf
, 
±r
, 
Àn
);

10143 
«mebuf
[
Àn
] = '/';

10144 
«mebuf
[
Àn
 + 1] = '\0';

10145 #ifdef 
__WIN__


10146 
	`önoba£_ˇ£dn_°r
(
«mebuf
);

10148 
åx
 = 
	`önoba£_åx_Æloˇã
(
thd
);

10153 
	`ut_a
(!
	`åx_is_°¨ãd
(
åx
Ë||Årx->
wûl_lock
 > 0);

10156 ++
åx
->
wûl_lock
;

10158 
	`row_dr›_d©aba£_f‹_mysql
(
«mebuf
, 
åx
);

10160 
	`my_‰ì
(
«mebuf
);

10166 
	`log_buf„r_Êush_to_disk
();

10168 
	`önoba£_commô_low
(
åx
);

10169 
	`åx_‰ì_f‹_mysql
(
åx
);

10170 
	}
}

10175 
__©åibuã__
((
n⁄nuŒ
, 
w¨n_unu£d_ªsu…
))

10176 
dbîr_t


10177 
	$önoba£_ª«me_èbÀ
(

10179 
åx_t
* 
åx
,

10180 c⁄° * 
‰om
,

10181 c⁄° * 
to
)

10183 
dbîr_t
 
îr‹
;

10184 
n‹m_to
[
FN_REFLEN
];

10185 
n‹m_‰om
[
FN_REFLEN
];

10187 
	`DBUG_ENTER
("innobase_rename_table");

10188 
	`DBUG_ASSERT
(
	`åx_gë_di˘_›î©i⁄
(
åx
Ë=
TRX_DICT_OP_INDEX
);

10190 
	`ut_ad
(!
§v_ªad_⁄ly_mode
);

10192 
	`n‹mÆize_èbÀ_«me
(
n‹m_to
, 
to
);

10193 
	`n‹mÆize_èbÀ_«me
(
n‹m_‰om
, 
‰om
);

10195 
	`DEBUG_SYNC_C
("innodb_rename_table_ready");

10197 
	`åx_°¨t_if_nŸ_°¨ãd
(
åx
);

10202 
	`row_mysql_lock_d©a_di˘i⁄¨y
(
åx
);

10207 
	`ut_a
(
åx
->
wûl_lock
 > 0);

10209 
îr‹
 = 
	`row_ª«me_èbÀ_f‹_mysql
(

10210 
n‹m_‰om
, 
n‹m_to
, 
åx
, 
TRUE
);

10212 i‡(
îr‹
 !
DB_SUCCESS
) {

10213 i‡(
îr‹
 =
DB_TABLE_NOT_FOUND


10214 && 
	`önoba£_gë_lowî_ˇ£_èbÀ_«mes
() == 1) {

10215 * 
is_∑π
 = 
NULL
;

10216 #ifde‡
__WIN__


10217 
is_∑π
 = 
	`°r°r
(
n‹m_‰om
, "#p#");

10219 
is_∑π
 = 
	`°r°r
(
n‹m_‰om
, "#P#");

10222 i‡(
is_∑π
) {

10223 
∑r_ˇ£_«me
[
FN_REFLEN
];

10224 #i‚de‡
__WIN__


10228 
	`°r˝y
(
∑r_ˇ£_«me
, 
n‹m_‰om
);

10229 
	`önoba£_ˇ£dn_°r
(
∑r_ˇ£_«me
);

10235 
	`n‹mÆize_èbÀ_«me_low
(

10236 
∑r_ˇ£_«me
, 
‰om
, 
FALSE
);

10238 
	`åx_°¨t_if_nŸ_°¨ãd
(
åx
);

10239 
îr‹
 = 
	`row_ª«me_èbÀ_f‹_mysql
(

10240 
∑r_ˇ£_«me
, 
n‹m_to
, 
åx
, 
TRUE
);

10244 i‡(
îr‹
 =
DB_SUCCESS
) {

10245 #i‚de‡
__WIN__


10246 
	`sql_¥öt_w¨nög
("RenameÖartitionÅable %s "

10251 
n‹m_‰om
);

10253 
	`sql_¥öt_w¨nög
("RenameÖartitionÅable %s "

10259 
n‹m_‰om
);

10264 
	`row_mysql_u∆ock_d©a_di˘i⁄¨y
(
åx
);

10270 
	`log_buf„r_Êush_to_disk
();

10272 
	`DBUG_RETURN
(
îr‹
);

10273 
	}
}

10278 
UNIV_INTERN


10280 
	gha_önoba£
::
	$ª«me_èbÀ
(

10282 c⁄° * 
‰om
,

10283 c⁄° * 
to
)

10285 
åx_t
* 
åx
;

10286 
dbîr_t
 
îr‹
;

10287 
åx_t
* 
∑ª¡_åx
;

10288 
THD
* 
thd
 = 
	`ha_thd
();

10290 
	`DBUG_ENTER
("ha_innobase::rename_table");

10292 i‡(
§v_ªad_⁄ly_mode
) {

10293 
	`ib_£ndîrf
(
thd
, 
IB_LOG_LEVEL_WARN
, 
ER_READ_ONLY_MODE
);

10294 
	`DBUG_RETURN
(
HA_ERR_TABLE_READONLY
);

10300 
∑ª¡_åx
 = 
	`check_åx_exi°s
(
thd
);

10305 
	`åx_£¨ch_œtch_ªÀa£_if_ª£rved
(
∑ª¡_åx
);

10307 
åx
 = 
	`önoba£_åx_Æloˇã
(
thd
);

10310 ++
åx
->
wûl_lock
;

10311 
	`åx_£t_di˘_›î©i⁄
(
åx
, 
TRX_DICT_OP_INDEX
);

10313 
îr‹
 = 
	`önoba£_ª«me_èbÀ
(
åx
, 
‰om
, 
to
);

10315 
	`DEBUG_SYNC
(
thd
, "after_innobase_rename_table");

10317 
	`önoba£_commô_low
(
åx
);

10318 
	`åx_‰ì_f‹_mysql
(
åx
);

10320 i‡(
îr‹
 =
DB_SUCCESS
) {

10321 
n‹m_‰om
[
MAX_FULL_NAME_LEN
];

10322 
n‹m_to
[
MAX_FULL_NAME_LEN
];

10323 
îr°r
[512];

10324 
dbîr_t
 
ªt
;

10326 
	`n‹mÆize_èbÀ_«me
(
n‹m_‰om
, 
‰om
);

10327 
	`n‹mÆize_èbÀ_«me
(
n‹m_to
, 
to
);

10329 
ªt
 = 
	`di˘_°©s_ª«me_èbÀ
(
n‹m_‰om
, 
n‹m_to
,

10330 
îr°r
, (errstr));

10332 i‡(
ªt
 !
DB_SUCCESS
) {

10333 
	`ut_¥öt_time°amp
(
°dîr
);

10334 
	`Ârötf
(
°dîr
, " I¬oDB: %s\n", 
îr°r
);

10336 
	`push_w¨nög
(
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

10337 
ER_LOCK_WAIT_TIMEOUT
, 
îr°r
);

10353 i‡(
îr‹
 =
DB_DUPLICATE_KEY
) {

10354 
	`my_îr‹
(
ER_TABLE_EXISTS_ERROR
, 
	`MYF
(0), 
to
);

10356 
îr‹
 = 
DB_ERROR
;

10359 
	`DBUG_RETURN
(
	`c⁄vît_îr‹_code_to_mysql
(
îr‹
, 0, 
NULL
));

10360 
	}
}

10365 
UNIV_INTERN


10366 
ha_rows


10367 
	gha_önoba£
::
	$ªc‹ds_ö_ønge
(

10369 
uöt
 
keyƒ
,

10370 
key_ønge
 *
mö_key
,

10372 
key_ønge
 *
max_key
)

10375 
KEY
* 
key
;

10376 
di˘_ödex_t
* 
ödex
;

10377 
dtu∂e_t
* 
ønge_°¨t
;

10378 
dtu∂e_t
* 
ønge_íd
;

10379 
ib_öt64_t
 
n_rows
;

10380 
ulöt
 
mode1
;

10381 
ulöt
 
mode2
;

10382 
mem_hóp_t
* 
hóp
;

10384 
	`DBUG_ENTER
("records_in_range");

10386 
	`ut_a
(
¥ebuût
->
åx
 =
	`thd_to_åx
(
	`ha_thd
()));

10388 
¥ebuût
->
åx
->
›_öfo
 = (*)"estimatingÑecords in indexÑange";

10393 
	`åx_£¨ch_œtch_ªÀa£_if_ª£rved
(
¥ebuût
->
åx
);

10395 
a˘ive_ödex
 = 
keyƒ
;

10397 
key
 = 
èbÀ
->
key_öfo
 + 
a˘ive_ödex
;

10399 
ödex
 = 
	`önoba£_gë_ödex
(
keyƒ
);

10404 i‡(
	`di˘_èbÀ_is_disˇrded
(
¥ebuût
->
èbÀ
)) {

10405 
n_rows
 = 
HA_POS_ERROR
;

10406 
func_exô
;

10408 i‡(
	`UNIV_UNLIKELY
(!
ödex
)) {

10409 
n_rows
 = 
HA_POS_ERROR
;

10410 
func_exô
;

10412 i‡(
	`di˘_ödex_is_c‹ru±ed
(
ödex
)) {

10413 
n_rows
 = 
HA_ERR_INDEX_CORRUPT
;

10414 
func_exô
;

10416 i‡(
	`UNIV_UNLIKELY
(!
	`row_mîge_is_ödex_ußbÀ
(
¥ebuût
->
åx
, 
ödex
))) {

10417 
n_rows
 = 
HA_ERR_TABLE_DEF_CHANGED
;

10418 
func_exô
;

10421 
hóp
 = 
	`mem_hóp_¸óã
(2 * (
key
->
a˘uÆ_key_∑πs
 * (
dfõld_t
)

10422 + (
dtu∂e_t
)));

10424 
ønge_°¨t
 = 
	`dtu∂e_¸óã
(
hóp
, 
key
->
a˘uÆ_key_∑πs
);

10425 
	`di˘_ödex_c›y_ty≥s
(
ønge_°¨t
, 
ödex
, 
key
->
a˘uÆ_key_∑πs
);

10427 
ønge_íd
 = 
	`dtu∂e_¸óã
(
hóp
, 
key
->
a˘uÆ_key_∑πs
);

10428 
	`di˘_ödex_c›y_ty≥s
(
ønge_íd
, 
ödex
, 
key
->
a˘uÆ_key_∑πs
);

10430 
	`row_£l_c⁄vît_mysql_key_to_önoba£
(

10431 
ønge_°¨t
,

10432 
¥ebuût
->
§ch_key_vÆ1
,

10433 
¥ebuût
->
§ch_key_vÆ_Àn
,

10434 
ödex
,

10435 (
byã
*Ë(
mö_key
 ? mö_key->
key
 :

10436 (c⁄° 
uch¨
*) 0),

10437 (
ulöt
Ë(
mö_key
 ? mö_key->
Àngth
 : 0),

10438 
¥ebuût
->
åx
);

10439 
	`DBUG_ASSERT
(
mö_key


10440 ? 
ønge_°¨t
->
n_fõlds
 > 0

10441 : 
ønge_°¨t
->
n_fõlds
 == 0);

10443 
	`row_£l_c⁄vît_mysql_key_to_önoba£
(

10444 
ønge_íd
,

10445 
¥ebuût
->
§ch_key_vÆ2
,

10446 
¥ebuût
->
§ch_key_vÆ_Àn
,

10447 
ödex
,

10448 (
byã
*Ë(
max_key
 ? max_key->
key
 :

10449 (c⁄° 
uch¨
*) 0),

10450 (
ulöt
Ë(
max_key
 ? max_key->
Àngth
 : 0),

10451 
¥ebuût
->
åx
);

10452 
	`DBUG_ASSERT
(
max_key


10453 ? 
ønge_íd
->
n_fõlds
 > 0

10454 : 
ønge_íd
->
n_fõlds
 == 0);

10456 
mode1
 = 
	`c⁄vît_£¨ch_mode_to_önoba£
(
mö_key
 ? mö_key->
Êag
 :

10457 
HA_READ_KEY_EXACT
);

10458 
mode2
 = 
	`c⁄vît_£¨ch_mode_to_önoba£
(
max_key
 ? max_key->
Êag
 :

10459 
HA_READ_KEY_EXACT
);

10461 i‡(
mode1
 !
PAGE_CUR_UNSUPP
 && 
mode2
 != PAGE_CUR_UNSUPP) {

10463 
n_rows
 = 
	`bå_e°im©e_n_rows_ö_ønge
(
ödex
, 
ønge_°¨t
,

10464 
mode1
, 
ønge_íd
,

10465 
mode2
);

10468 
n_rows
 = 
HA_POS_ERROR
;

10471 
	`mem_hóp_‰ì
(
hóp
);

10473 
func_exô
:

10475 
¥ebuût
->
åx
->
›_öfo
 = (*)"";

10483 i‡(
n_rows
 == 0) {

10484 
n_rows
 = 1;

10487 
	`DBUG_RETURN
((
ha_rows
Ë
n_rows
);

10488 
	}
}

10494 
UNIV_INTERN


10495 
ha_rows


10496 
	gha_önoba£
::
	$e°im©e_rows_uµî_bound
()

10499 c⁄° 
di˘_ödex_t
* 
ödex
;

10500 
ul⁄gl⁄g
 
e°im©e
;

10501 
ul⁄gl⁄g
 
loˇl_d©a_fûe_Àngth
;

10502 
ulöt
 
°©_n_Àaf_∑ges
;

10504 
	`DBUG_ENTER
("estimate_rows_upper_bound");

10510 
	`upd©e_thd
(
	`ha_thd
());

10512 
¥ebuût
->
åx
->
›_öfo
 = "calculating upper bound forÅableÑows";

10517 
	`åx_£¨ch_œtch_ªÀa£_if_ª£rved
(
¥ebuût
->
åx
);

10519 
ödex
 = 
	`di˘_èbÀ_gë_fú°_ödex
(
¥ebuût
->
èbÀ
);

10521 
°©_n_Àaf_∑ges
 = 
ödex
->stat_n_leaf_pages;

10523 
	`ut_a
(
°©_n_Àaf_∑ges
 > 0);

10525 
loˇl_d©a_fûe_Àngth
 =

10526 ((
ul⁄gl⁄g
Ë
°©_n_Àaf_∑ges
Ë* 
UNIV_PAGE_SIZE
;

10533 
e°im©e
 = 2 * 
loˇl_d©a_fûe_Àngth


10534 / 
	`di˘_ödex_ˇlc_mö_ªc_Àn
(
ödex
);

10536 
¥ebuût
->
åx
->
›_öfo
 = "";

10540 
	`DBUG_EXECUTE_IF
("set_num_rows_lt_MERGEBUFF",

10541 
e°im©e
 = 2;

10542 
	`DBUG_SET
("-d,set_num_rows_lt_MERGEBUFF");

10545 
	`DBUG_RETURN
((
ha_rows
Ë
e°im©e
);

10546 
	}
}

10553 
UNIV_INTERN


10555 
	gha_önoba£
::
	$sˇn_time
()

10570 
	`upd©e_thd
(
	`ha_thd
());

10571 
	`åx_£¨ch_œtch_ªÀa£_if_ª£rved
(
¥ebuût
->
åx
);

10574 
ulöt
 
°©_˛u°îed_ödex_size
;

10577 
	`di˘_èbÀ_°©s_lock
(
¥ebuût
->
èbÀ
, 
RW_S_LATCH
);

10580 
	`ut_a
(
¥ebuût
->
èbÀ
->
°©_öôülized
);

10582 
°©_˛u°îed_ödex_size
 = 
¥ebuût
->
èbÀ
->stat_clustered_index_size;

10585 
	`di˘_èbÀ_°©s_u∆ock
(
¥ebuût
->
èbÀ
, 
RW_S_LATCH
);

10588 ((Ë
°©_˛u°îed_ödex_size
);

10589 
	}
}

10595 
UNIV_INTERN


10597 
	gha_önoba£
::
	$ªad_time
(

10599 
uöt
 
ödex
,

10600 
uöt
 
ønges
,

10601 
ha_rows
 
rows
)

10603 
ha_rows
 
tŸÆ_rows
;

10604 
time_f‹_sˇn
;

10606 i‡(
ödex
 !
èbÀ
->
s
->
¥im¨y_key
) {

10608 (
h™dÀr
::
	`ªad_time
(
ödex
, 
ønges
, 
rows
));

10611 i‡(
rows
 <= 2) {

10613 ((Ë
rows
);

10619 
time_f‹_sˇn
 = 
	`sˇn_time
();

10621 i‡((
tŸÆ_rows
 = 
	`e°im©e_rows_uµî_bound
()Ë< 
rows
) {

10623 (
time_f‹_sˇn
);

10626 (
ønges
 + (Ë
rows
 / (Ë
tŸÆ_rows
 * 
time_f‹_sˇn
);

10627 
	}
}

10631 
UNIV_INTERN


10632 
l⁄gl⁄g


10633 
	gha_önoba£
::
	$gë_mem‹y_buf„r_size
() const

10636 (
önoba£_buf„r_poﬁ_size
);

10637 
	}
}

10650 
	$önoba£_gë_mysql_key_numbî_f‹_ödex
(

10652 
INNOBASE_SHARE
* 
sh¨e
,

10654 c⁄° 
TABLE
* 
èbÀ
,

10656 
di˘_èbÀ_t
* 
ib_èbÀ
,

10658 c⁄° 
di˘_ödex_t
* 
ödex
)

10660 c⁄° 
di˘_ödex_t
* 
öd
;

10661 
i
;

10663 
	`ut_a
(
ödex
);

10668 i‡(
ödex
->
èbÀ
 !
ib_èbÀ
) {

10669 
i
 = 0;

10670 
öd
 = 
	`di˘_èbÀ_gë_fú°_ödex
(
ödex
->
èbÀ
);

10672 
ödex
 !
öd
) {

10673 
öd
 = 
	`di˘_èbÀ_gë_√xt_ödex
(ind);

10674 
i
++;

10677 i‡(
	`row_èbÀ_gŸ_deÁu…_˛u°_ödex
(
ödex
->
èbÀ
)) {

10678 
	`ut_a
(
i
 > 0);

10679 
i
--;

10682 (
i
);

10687 i‡(
sh¨e
->
idx_å™s_tbl
.
ödex_m≠pög
) {

10688 
i
 = 0; i < 
sh¨e
->
idx_å™s_tbl
.
ödex_cou¡
; i++) {

10689 i‡(
sh¨e
->
idx_å™s_tbl
.
ödex_m≠pög
[
i
] =
ödex
) {

10690 (
i
);

10696 i‡(*
ödex
->
«me
 !
TEMP_INDEX_PREFIX
) {

10697 
	`sql_¥öt_îr‹
("Cannot find index %s in InnoDB index "

10698 "å™¶©i⁄ÅabÀ.", 
ödex
->
«me
);

10706 
i
 = 0; i < 
èbÀ
->
s
->
keys
; i++) {

10707 
öd
 = 
	`di˘_èbÀ_gë_ödex_⁄_«me
(

10708 
ib_èbÀ
, 
èbÀ
->
key_öfo
[
i
].
«me
);

10710 i‡(
ödex
 =
öd
) {

10711 (
i
);

10716 
öd
 = 
	`di˘_èbÀ_gë_fú°_ödex
(
ib_èbÀ
);

10717 
öd
 !
NULL
;

10718 
öd
 = 
	`di˘_èbÀ_gë_√xt_ödex
(ind)) {

10719 i‡(
ödex
 =
öd
) {

10723 i‡(*(
ödex
->
«me
Ë!
TEMP_INDEX_PREFIX
) {

10724 
	`sql_¥öt_w¨nög
(

10728 
ödex
->
«me
);

10734 
ut_îr‹
;

10737 
	}
}

10744 
ha_rows


10745 
	$önodb_ªc_≥r_key
(

10747 
di˘_ödex_t
* 
ödex
,

10748 
ulöt
 
i
,

10750 
ha_rows
 
ªc‹ds
)

10752 
ha_rows
 
ªc_≥r_key
;

10753 
ib_uöt64_t
 
n_diff
;

10755 
	`ut_a
(
ödex
->
èbÀ
->
°©_öôülized
);

10757 
	`ut_ad
(
i
 < 
	`di˘_ödex_gë_n_unique
(
ödex
));

10759 
n_diff
 = 
ödex
->
°©_n_diff_key_vÆs
[
i
];

10761 i‡(
n_diff
 == 0) {

10763 
ªc_≥r_key
 = 
ªc‹ds
;

10764 } i‡(
§v_önodb_°©s_mëhod
 =
SRV_STATS_NULLS_IGNORED
) {

10765 
ib_uöt64_t
 
n_nuŒ
;

10766 
ib_uöt64_t
 
n_n⁄_nuŒ
;

10768 
n_n⁄_nuŒ
 = 
ödex
->
°©_n_n⁄_nuŒ_key_vÆs
[
i
];

10775 i‡(
ªc‹ds
 < 
n_n⁄_nuŒ
) {

10776 
n_nuŒ
 = 0;

10778 
n_nuŒ
 = 
ªc‹ds
 - 
n_n⁄_nuŒ
;

10785 i‡(
n_diff
 <
n_nuŒ
) {

10786 
ªc_≥r_key
 = 1;

10790 
ªc_≥r_key
 = (
ha_rows
)

10791 ((
ªc‹ds
 - 
n_nuŒ
Ë/ (
n_diff
 -Ç_null));

10794 
	`DEBUG_SYNC_C
("after_checking_for_0");

10795 
ªc_≥r_key
 = (
ha_rows
Ë(
ªc‹ds
 / 
n_diff
);

10798 (
ªc_≥r_key
);

10799 
	}
}

10805 
UNIV_INTERN


10807 
	gha_önoba£
::
	$öfo_low
(

10809 
uöt
 
Êag
,

10810 
boﬁ
 
is_™Æyze
)

10812 
di˘_èbÀ_t
* 
ib_èbÀ
;

10813 
ha_rows
 
ªc_≥r_key
;

10814 
ib_uöt64_t
 
n_rows
;

10815 
os_fûe_°©_t
 
°©_öfo
;

10817 
	`DBUG_ENTER
("info");

10827 
	`upd©e_thd
(
	`ha_thd
());

10832 
¥ebuût
->
åx
->
›_öfo
 = (*)"returning various infoÅo MySQL";

10834 
	`åx_£¨ch_œtch_ªÀa£_if_ª£rved
(
¥ebuût
->
åx
);

10836 
ib_èbÀ
 = 
¥ebuût
->
èbÀ
;

10837 
	`DBUG_ASSERT
(
ib_èbÀ
->
n_ªf_cou¡
 > 0);

10839 i‡(
Êag
 & 
HA_STATUS_TIME
) {

10840 i‡(
is_™Æyze
 || 
önoba£_°©s_⁄_mëad©a
) {

10842 
di˘_°©s_upd_›ti⁄_t
 
›t
;

10843 
dbîr_t
 
ªt
;

10845 
¥ebuût
->
åx
->
›_öfo
 = "updatingÅable statistics";

10847 i‡(
	`di˘_°©s_is_≥rsi°ít_íabÀd
(
ib_èbÀ
)) {

10849 i‡(
is_™Æyze
) {

10850 
›t
 = 
DICT_STATS_RECALC_PERSISTENT
;

10854 
›t
 = 
DICT_STATS_FETCH_ONLY_IF_NOT_IN_MEMORY
;

10857 
›t
 = 
DICT_STATS_RECALC_TRANSIENT
;

10860 
	`ut_ad
(!
	`muãx_own
(&
di˘_sys
->
muãx
));

10861 
ªt
 = 
	`di˘_°©s_upd©e
(
ib_èbÀ
, 
›t
);

10863 i‡(
ªt
 !
DB_SUCCESS
) {

10864 
¥ebuût
->
åx
->
›_öfo
 = "";

10865 
	`DBUG_RETURN
(
HA_ERR_GENERIC
);

10868 
¥ebuût
->
åx
->
›_öfo
 =

10874 i‡(
Êag
 & 
HA_STATUS_VARIABLE
) {

10876 
ulöt
 
∑ge_size
;

10877 
ulöt
 
°©_˛u°îed_ödex_size
;

10878 
ulöt
 
°©_sum_of_Ÿhî_ödex_sizes
;

10880 i‡(!(
Êag
 & 
HA_STATUS_NO_LOCK
)) {

10881 
	`di˘_èbÀ_°©s_lock
(
ib_èbÀ
, 
RW_S_LATCH
);

10884 
	`ut_a
(
ib_èbÀ
->
°©_öôülized
);

10886 
n_rows
 = 
ib_èbÀ
->
°©_n_rows
;

10888 
°©_˛u°îed_ödex_size


10889 
ib_èbÀ
->
°©_˛u°îed_ödex_size
;

10891 
°©_sum_of_Ÿhî_ödex_sizes


10892 
ib_èbÀ
->
°©_sum_of_Ÿhî_ödex_sizes
;

10894 i‡(!(
Êag
 & 
HA_STATUS_NO_LOCK
)) {

10895 
	`di˘_èbÀ_°©s_u∆ock
(
ib_èbÀ
, 
RW_S_LATCH
);

10908 i‡(
n_rows
 =0 && !(
Êag
 & 
HA_STATUS_TIME
)) {

10909 
n_rows
++;

10916 i‡(
	`thd_sql_comm™d
(
u£r_thd
Ë=
SQLCOM_TRUNCATE
) {

10918 
n_rows
 = 1;

10926 
¥ebuût
->
autoöc_œ°_vÆue
 = 0;

10929 
∑ge_size
 = 
	`di˘_èbÀ_zù_size
(
ib_èbÀ
);

10930 i‡(
∑ge_size
 == 0) {

10931 
∑ge_size
 = 
UNIV_PAGE_SIZE
;

10934 
°©s
.
ªc‹ds
 = (
ha_rows
Ë
n_rows
;

10935 
°©s
.
dñëed
 = 0;

10936 
°©s
.
d©a_fûe_Àngth


10937 ((
ul⁄gl⁄g
Ë
°©_˛u°îed_ödex_size
)

10938 * 
∑ge_size
;

10939 
°©s
.
ödex_fûe_Àngth


10940 ((
ul⁄gl⁄g
Ë
°©_sum_of_Ÿhî_ödex_sizes
)

10941 * 
∑ge_size
;

10948 i‡(
Êag
 & 
HA_STATUS_NO_LOCK


10949 || !(
Êag
 & 
HA_STATUS_VARIABLE_EXTRA
)) {

10956 } i‡(
UNIV_UNLIKELY


10957 (
§v_f‹˚_ªcovîy
 >
SRV_FORCE_NO_IBUF_MERGE
)) {

10960 
°©s
.
dñëe_Àngth
 = 0;

10962 
uŒöt
 
avaû_•a˚
;

10964 
avaû_•a˚
 = 
	`f•_gë_avaûabÀ_•a˚_ö_‰ì_exã¡s
(

10965 
ib_èbÀ
->
•a˚
);

10967 i‡(
avaû_•a˚
 =
ULLINT_UNDEFINED
) {

10968 
THD
* 
thd
;

10969 
îrbuf
[
MYSYS_STRERROR_SIZE
];

10971 
thd
 = 
	`ha_thd
();

10973 
	`push_w¨nög_¥ötf
(

10974 
thd
,

10975 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

10976 
ER_CANT_GET_STAT
,

10983 
ib_èbÀ
->
«me
, 
î∫o
,

10984 
	`my_°ªº‹
(
îrbuf
, (errbuf),

10985 
î∫o
));

10987 
°©s
.
dñëe_Àngth
 = 0;

10989 
°©s
.
dñëe_Àngth
 = 
avaû_•a˚
 * 1024;

10993 
°©s
.
check_time
 = 0;

10994 
°©s
.
mº_Àngth_≥r_ªc
 = 
ªf_Àngth
 + (*);

10996 i‡(
°©s
.
ªc‹ds
 == 0) {

10997 
°©s
.
món_ªc_Àngth
 = 0;

10999 
°©s
.
món_ªc_Àngth
 = (
ul⁄g
)

11000 (
°©s
.
d©a_fûe_Àngth
 / sèts.
ªc‹ds
);

11004 i‡(
Êag
 & 
HA_STATUS_CONST
) {

11005 
ul⁄g
 
i
;

11006 
∑th
[
FN_REFLEN
];

11010 
ulöt
 
num_önodb_ödex
 = 
	`UT_LIST_GET_LEN
(
ib_èbÀ
->
ödexes
)

11011 - 
¥ebuût
->
˛u°_ödex_was_gíî©ed
;

11012 i‡(
èbÀ
->
s
->
keys
 < 
num_önodb_ödex
) {

11018 c⁄° 
di˘_ödex_t
* 
ödex


11019 
	`UT_LIST_GET_FIRST
(
ib_èbÀ
->
ödexes
);

11020 
ödex
 !
NULL
;

11021 
ödex
 = 
	`UT_LIST_GET_NEXT
(
ödexes
, index)) {

11031 i‡(*
ödex
->
«me
 =
TEMP_INDEX_PREFIX
) {

11032 
num_önodb_ödex
--;

11036 i‡(
èbÀ
->
s
->
keys
 < 
num_önodb_ödex


11037 && 
	`önoba£_·s_check_doc_id_ödex
(

11038 
ib_èbÀ
, 
NULL
, NULL)

11039 =
FTS_EXIST_DOC_ID_INDEX
) {

11040 
num_önodb_ödex
--;

11044 i‡(
èbÀ
->
s
->
keys
 !
num_önodb_ödex
) {

11045 
	`sql_¥öt_îr‹
("InnoDB: Table %s contains %lu "

11049 
ib_èbÀ
->
«me
, 
num_önodb_ödex
,

11050 
èbÀ
->
s
->
keys
);

11053 i‡(!(
Êag
 & 
HA_STATUS_NO_LOCK
)) {

11054 
	`di˘_èbÀ_°©s_lock
(
ib_èbÀ
, 
RW_S_LATCH
);

11057 
	`ut_a
(
ib_èbÀ
->
°©_öôülized
);

11059 
i
 = 0; i < 
èbÀ
->
s
->
keys
; i++) {

11060 
ul⁄g
 
j
;

11066 
di˘_ödex_t
* 
ödex
 = 
	`önoba£_gë_ödex
(
i
);

11068 i‡(
ödex
 =
NULL
) {

11069 
	`sql_¥öt_îr‹
("Table %s contains fewer "

11075 
REFMAN


11077 
ib_èbÀ
->
«me
);

11081 
j
 = 0; j < 
èbÀ
->
key_öfo
[
i
].
a˘uÆ_key_∑πs
; j++) {

11083 i‡(
èbÀ
->
key_öfo
[
i
].
Êags
 & 
HA_FULLTEXT
) {

11086 
èbÀ
->
key_öfo
[
i
].
ªc_≥r_key
[
j
] = 1;

11090 i‡(
j
 + 1 > 
ödex
->
n_uniq
) {

11091 
	`sql_¥öt_îr‹
(

11098 "Sì " 
REFMAN


11100 
ödex
->
«me
,

11101 
ib_èbÀ
->
«me
,

11103 
ödex
->
n_uniq
, 
j
 + 1);

11107 
ªc_≥r_key
 = 
	`önodb_ªc_≥r_key
(

11108 
ödex
, 
j
, 
°©s
.
ªc‹ds
);

11115 
ªc_≥r_key
 =Ñec_per_key / 2;

11117 i‡(
ªc_≥r_key
 == 0) {

11118 
ªc_≥r_key
 = 1;

11121 
èbÀ
->
key_öfo
[
i
].
ªc_≥r_key
[
j
] =

11122 
ªc_≥r_key
 >~(
ul⁄g
) 0 ? ~(ulong) 0 :

11123 (
ul⁄g
Ë
ªc_≥r_key
;

11127 i‡(!(
Êag
 & 
HA_STATUS_NO_LOCK
)) {

11128 
	`di˘_èbÀ_°©s_u∆ock
(
ib_èbÀ
, 
RW_S_LATCH
);

11131 
	`my_¢¥ötf
(
∑th
, (path), "%s/%s%s",

11132 
mysql_d©a_home
,

11133 
èbÀ
->
s
->
n‹mÆized_∑th
.
°r
,

11134 
ªg_ext
);

11136 
	`u≈ack_fûíame
(
∑th
,path);

11141 i‡(
	`os_fûe_gë_°©us
(
∑th
, &
°©_öfo
, 
Ál£
Ë=
DB_SUCCESS
) {

11142 
°©s
.
¸óã_time
 = (
ul⁄g
Ë
°©_öfo
.
˘ime
;

11146 i‡(
§v_f‹˚_ªcovîy
 >
SRV_FORCE_NO_IBUF_MERGE
) {

11148 
func_exô
;

11151 i‡(
Êag
 & 
HA_STATUS_ERRKEY
) {

11152 c⁄° 
di˘_ödex_t
* 
îr_ödex
;

11154 
	`ut_a
(
¥ebuût
->
åx
);

11155 
	`ut_a
(
¥ebuût
->
åx
->
magic_n
 =
TRX_MAGIC_N
);

11157 
îr_ödex
 = 
	`åx_gë_îr‹_öfo
(
¥ebuût
->
åx
);

11159 i‡(
îr_ödex
) {

11160 
îrkey
 = 
	`önoba£_gë_mysql_key_numbî_f‹_ödex
(

11161 
sh¨e
, 
èbÀ
, 
ib_èbÀ
, 
îr_ödex
);

11163 
îrkey
 = () (

11164 (
¥ebuût
->
åx
->
îr‹_key_num


11165 =
ULINT_UNDEFINED
)

11167 : 
¥ebuût
->
åx
->
îr‹_key_num
);

11171 i‡((
Êag
 & 
HA_STATUS_AUTO
Ë&& 
èbÀ
->
found_√xt_numbî_fõld
) {

11172 
°©s
.
auto_ö¸emít_vÆue
 = 
	`önoba£_≥ek_autoöc
();

11175 
func_exô
:

11176 
¥ebuût
->
åx
->
›_öfo
 = (*)"";

11178 
	`DBUG_RETURN
(0);

11179 
	}
}

11185 
UNIV_INTERN


11187 
	gha_önoba£
::
	$öfo
(

11189 
uöt
 
Êag
)

11191 (
this
->
	`öfo_low
(
Êag
, 
Ál£
 ));

11192 
	}
}

11198 
UNIV_INTERN


11200 
	gha_önoba£
::
	$™Æyze
(

11202 
THD
* 
thd
,

11203 
HA_CHECK_OPT
* 
check_›t
)

11205 
ªt
;

11209 
ªt
 = 
this
->
	`öfo_low
(

11210 
HA_STATUS_TIME
 | 
HA_STATUS_CONST
 | 
HA_STATUS_VARIABLE
,

11211 
åue
 );

11213 i‡(
ªt
 != 0) {

11214 (
HA_ADMIN_FAILED
);

11217 (
HA_ADMIN_OK
);

11218 
	}
}

11223 
UNIV_INTERN


11225 
	gha_önoba£
::
	$›timize
(

11227 
THD
* 
thd
,

11228 
HA_CHECK_OPT
* 
check_›t
)

11239 i‡(
önodb_›timize_fuŒãxt_⁄ly
) {

11240 i‡(
¥ebuût
->
èbÀ
->
·s
 &&Öªbuût->èbÀ->·s->
ˇche


11241 && !
	`di˘_èbÀ_is_disˇrded
(
¥ebuût
->
èbÀ
)) {

11242 
	`·s_sync_èbÀ
(
¥ebuût
->
èbÀ
);

11243 
	`·s_›timize_èbÀ
(
¥ebuût
->
èbÀ
);

11245 (
HA_ADMIN_OK
);

11248 (
HA_ADMIN_TRY_ALTER
);

11250 
	}
}

11257 
UNIV_INTERN


11259 
	gha_önoba£
::
	$check
(

11261 
THD
* 
thd
,

11262 
HA_CHECK_OPT
* 
check_›t
)

11264 
di˘_ödex_t
* 
ödex
;

11265 
ulöt
 
n_rows
;

11266 
ulöt
 
n_rows_ö_èbÀ
 = 
ULINT_UNDEFINED
;

11267 
boﬁ
 
is_ok
 = 
åue
;

11268 
ulöt
 
ﬁd_isﬁ©i⁄_Àvñ
;

11269 
iboﬁ
 
èbÀ_c‹ru±ed
;

11271 
	`DBUG_ENTER
("ha_innobase::check");

11272 
	`DBUG_ASSERT
(
thd
 =
	`ha_thd
());

11273 
	`ut_a
(
¥ebuût
->
åx
);

11274 
	`ut_a
(
¥ebuût
->
åx
->
magic_n
 =
TRX_MAGIC_N
);

11275 
	`ut_a
(
¥ebuût
->
åx
 =
	`thd_to_åx
(
thd
));

11277 i‡(
¥ebuût
->
mysql_ãm∂©e
 =
NULL
) {

11281 
	`buûd_ãm∂©e
(
åue
);

11284 i‡(
	`di˘_èbÀ_is_disˇrded
(
¥ebuût
->
èbÀ
)) {

11286 
	`ib_£ndîrf
(

11287 
thd
,

11288 
IB_LOG_LEVEL_ERROR
,

11289 
ER_TABLESPACE_DISCARDED
,

11290 
èbÀ
->
s
->
èbÀ_«me
.
°r
);

11292 
	`DBUG_RETURN
(
HA_ADMIN_CORRUPT
);

11294 } i‡(
¥ebuût
->
èbÀ
->
ibd_fûe_missög
) {

11296 
	`ib_£ndîrf
(

11297 
thd
, 
IB_LOG_LEVEL_ERROR
,

11298 
ER_TABLESPACE_MISSING
,

11299 
èbÀ
->
s
->
èbÀ_«me
.
°r
);

11301 
	`DBUG_RETURN
(
HA_ADMIN_CORRUPT
);

11304 
¥ebuût
->
åx
->
›_öfo
 = "checkingÅable";

11306 
ﬁd_isﬁ©i⁄_Àvñ
 = 
¥ebuût
->
åx
->
isﬁ©i⁄_Àvñ
;

11313 
¥ebuût
->
åx
->
isﬁ©i⁄_Àvñ
 = 
TRX_ISO_REPEATABLE_READ
;

11317 
èbÀ_c‹ru±ed
 = 
¥ebuût
->
èbÀ
->
c‹ru±ed
;

11321 
¥ebuût
->
èbÀ
->
c‹ru±ed
 = 
FALSE
;

11323 
ödex
 = 
	`di˘_èbÀ_gë_fú°_ödex
(
¥ebuût
->
èbÀ
);

11324 
ödex
 !
NULL
;

11325 
ödex
 = 
	`di˘_èbÀ_gë_√xt_ödex
(index)) {

11326 
ödex_«me
[
MAX_FULL_NAME_LEN
 + 1];

11329 i‡(*
ödex
->
«me
 =
TEMP_INDEX_PREFIX
) {

11333 i‡(!(
check_›t
->
Êags
 & 
T_QUICK
)) {

11336 
	`os_ö¸emít_cou¡î_by_amou¡
(

11337 
£rvî_muãx
,

11338 
§v_Áèl_£m≠h‹e_waô_thªshﬁd
,

11339 
SRV_SEMAPHORE_WAIT_EXTENSION
);

11340 
boﬁ
 
vÆid
 = 
	`bå_vÆid©e_ödex
(
ödex
, 
¥ebuût
->
åx
);

11344 
	`os_de¸emít_cou¡î_by_amou¡
(

11345 
£rvî_muãx
,

11346 
§v_Áèl_£m≠h‹e_waô_thªshﬁd
,

11347 
SRV_SEMAPHORE_WAIT_EXTENSION
);

11349 i‡(!
vÆid
) {

11350 
is_ok
 = 
Ál£
;

11352 
	`önoba£_f‹m©_«me
(

11353 
ödex_«me
,  index_name,

11354 
ödex
->
«me
, 
TRUE
);

11355 
	`push_w¨nög_¥ötf
(

11356 
thd
,

11357 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

11358 
ER_NOT_KEYFILE
,

11361 
ödex_«me
);

11369 
¥ebuût
->
ödex
 = index;

11371 
¥ebuût
->
ödex_ußbÀ
 = 
	`row_mîge_is_ödex_ußbÀ
(

11372 
¥ebuût
->
åx
,Öªbuût->
ödex
);

11374 i‡(
	`UNIV_UNLIKELY
(!
¥ebuût
->
ödex_ußbÀ
)) {

11375 
	`önoba£_f‹m©_«me
(

11376 
ödex_«me
,  index_name,

11377 
¥ebuût
->
ödex
->
«me
, 
TRUE
);

11379 i‡(
	`di˘_ödex_is_c‹ru±ed
(
¥ebuût
->
ödex
)) {

11380 
	`push_w¨nög_¥ötf
(

11381 
u£r_thd
,

11382 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

11383 
HA_ERR_INDEX_CORRUPT
,

11386 
ödex_«me
);

11387 
is_ok
 = 
Ál£
;

11389 
	`push_w¨nög_¥ötf
(

11390 
thd
,

11391 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

11392 
HA_ERR_TABLE_DEF_CHANGED
,

11395 
ödex_«me
);

11400 
¥ebuût
->
sql_°©_°¨t
 = 
TRUE
;

11401 
¥ebuût
->
ãm∂©e_ty≥
 = 
ROW_MYSQL_DUMMY_TEMPLATE
;

11402 
¥ebuût
->
n_ãm∂©e
 = 0;

11403 
¥ebuût
->
√ed_to_ac˚ss_˛u°îed
 = 
FALSE
;

11405 
	`dtu∂e_£t_n_fõlds
(
¥ebuût
->
£¨ch_tu∂e
, 0);

11407 
¥ebuût
->
£À˘_lock_ty≥
 = 
LOCK_NONE
;

11409 i‡(!
	`row_check_ödex_f‹_mysql
(
¥ebuût
, 
ödex
, &
n_rows
)) {

11410 
	`önoba£_f‹m©_«me
(

11411 
ödex_«me
,  index_name,

11412 
ödex
->
«me
, 
TRUE
);

11414 
	`push_w¨nög_¥ötf
(

11415 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

11416 
ER_NOT_KEYFILE
,

11419 
ödex_«me
);

11420 
is_ok
 = 
Ál£
;

11421 
	`di˘_£t_c‹ru±ed
(

11422 
ödex
, 
¥ebuût
->
åx
, "CHECK TABLE-check index");

11425 i‡(
	`thd_kûÀd
(
u£r_thd
)) {

11430 
	`Ârötf
(
°dîr
, "%luÉ¡rõ†ö index %s\n", 
n_rows
,

11431 
ödex
->
«me
);

11434 i‡(
ödex
 =
	`di˘_èbÀ_gë_fú°_ödex
(
¥ebuût
->
èbÀ
)) {

11435 
n_rows_ö_èbÀ
 = 
n_rows
;

11436 } i‡(!(
ödex
->
ty≥
 & 
DICT_FTS
)

11437 && (
n_rows
 !
n_rows_ö_èbÀ
)) {

11438 
	`push_w¨nög_¥ötf
(

11439 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

11440 
ER_NOT_KEYFILE
,

11443 
ödex
->
«me
,

11444 (
ul⁄g
Ë
n_rows
,

11445 (
ul⁄g
Ë
n_rows_ö_èbÀ
);

11446 
is_ok
 = 
Ál£
;

11447 
	`di˘_£t_c‹ru±ed
(

11448 
ödex
, 
¥ebuût
->
åx
,

11453 i‡(
èbÀ_c‹ru±ed
) {

11457 
ödex
 = 
	`di˘_èbÀ_gë_fú°_ödex
(
¥ebuût
->
èbÀ
);

11459 i‡(!
	`di˘_ödex_is_c‹ru±ed
(
ödex
)) {

11460 
	`di˘_£t_c‹ru±ed
(

11461 
ödex
, 
¥ebuût
->
åx
, "CHECK TABLE");

11463 
¥ebuût
->
èbÀ
->
c‹ru±ed
 = 
TRUE
;

11467 
¥ebuût
->
åx
->
isﬁ©i⁄_Àvñ
 = 
ﬁd_isﬁ©i⁄_Àvñ
;

11472 #i‡
deföed
 
UNIV_AHI_DEBUG
 || deföed 
UNIV_DEBUG


11473 i‡(!(
check_›t
->
Êags
 & 
T_QUICK
Ë&& !
	`bå_£¨ch_vÆid©e
()) {

11474 
	`push_w¨nög
(
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

11475 
ER_NOT_KEYFILE
,

11477 
is_ok
 = 
Ál£
;

11481 
¥ebuût
->
åx
->
›_öfo
 = "";

11482 i‡(
	`thd_kûÀd
(
u£r_thd
)) {

11483 
	`my_îr‹
(
ER_QUERY_INTERRUPTED
, 
	`MYF
(0));

11486 
	`DBUG_RETURN
(
is_ok
 ? 
HA_ADMIN_OK
 : 
HA_ADMIN_CORRUPT
);

11487 
	}
}

11494 
UNIV_INTERN


11496 
	gha_önoba£
::
	$upd©e_èbÀ_commít
(

11498 c⁄° * 
commít
)

11500 
uöt
 
Àngth
 = (uötË
	`°æí
(
commít
);

11501 * 
°r
;

11502 
Êí
;

11508 i‡(
Àngth
 > 64000 - 3) {

11509 ((*Ë
commít
);

11512 
	`upd©e_thd
(
	`ha_thd
());

11514 
¥ebuût
->
åx
->
›_öfo
 = (*)"returningÅable comment";

11519 
	`åx_£¨ch_œtch_ªÀa£_if_ª£rved
(
¥ebuût
->
åx
);

11520 
°r
 = 
NULL
;

11524 i‡(!
§v_ªad_⁄ly_mode
) {

11526 
	`muãx_íãr
(&
§v_di˘_tmpfûe_muãx
);

11528 
	`ªwöd
(
§v_di˘_tmpfûe
);

11530 
	`Ârötf
(
§v_di˘_tmpfûe
, "InnoDB free: %llu kB",

11531 
	`f•_gë_avaûabÀ_•a˚_ö_‰ì_exã¡s
(

11532 
¥ebuût
->
èbÀ
->
•a˚
));

11534 
	`di˘_¥öt_öfo_⁄_f‹eign_keys
(

11535 
FALSE
, 
§v_di˘_tmpfûe
, 
¥ebuût
->
åx
,

11536 
¥ebuût
->
èbÀ
);

11538 
Êí
 = 
	`·ñl
(
§v_di˘_tmpfûe
);

11540 i‡(
Êí
 < 0) {

11541 
Êí
 = 0;

11542 } i‡(
Àngth
 + 
Êí
 + 3 > 64000) {

11543 
Êí
 = 64000 - 3 - 
Àngth
;

11549 
°r
 = (*Ë
	`my_mÆloc
(
Àngth
 + 
Êí
 + 3, 
	`MYF
(0));

11551 i‡(
°r
) {

11552 * 
pos
 = 
°r
 + 
Àngth
;

11553 i‡(
Àngth
) {

11554 
	`mem˝y
(
°r
, 
commít
, 
Àngth
);

11555 *
pos
++ = ';';

11556 *
pos
++ = ' ';

11558 
	`ªwöd
(
§v_di˘_tmpfûe
);

11559 
Êí
 = (
uöt
Ë
	`‰ód
(
pos
, 1, fÀn, 
§v_di˘_tmpfûe
);

11560 
pos
[
Êí
] = 0;

11563 
	`muãx_exô
(&
§v_di˘_tmpfûe_muãx
);

11566 
¥ebuût
->
åx
->
›_öfo
 = (*)"";

11568 (
°r
 ? så : (*Ë
commít
);

11569 
	}
}

11576 
UNIV_INTERN


11578 
	gha_önoba£
::
	$gë_f‹eign_key_¸óã_öfo
()

11581 
Êí
;

11582 * 
°r
 = 0;

11584 
	`ut_a
(
¥ebuût
 !
NULL
);

11590 
	`upd©e_thd
(
	`ha_thd
());

11592 
¥ebuût
->
åx
->
›_öfo
 = (*)"getting info on foreign keys";

11598 
	`åx_£¨ch_œtch_ªÀa£_if_ª£rved
(
¥ebuût
->
åx
);

11600 i‡(!
§v_ªad_⁄ly_mode
) {

11601 
	`muãx_íãr
(&
§v_di˘_tmpfûe_muãx
);

11602 
	`ªwöd
(
§v_di˘_tmpfûe
);

11605 
	`di˘_¥öt_öfo_⁄_f‹eign_keys
(

11606 
TRUE
, 
§v_di˘_tmpfûe
, 
¥ebuût
->
åx
,

11607 
¥ebuût
->
èbÀ
);

11609 
¥ebuût
->
åx
->
›_öfo
 = (*)"";

11611 
Êí
 = 
	`·ñl
(
§v_di˘_tmpfûe
);

11613 i‡(
Êí
 < 0) {

11614 
Êí
 = 0;

11620 
°r
 = (*Ë
	`my_mÆloc
(
Êí
 + 1, 
	`MYF
(0));

11622 i‡(
°r
) {

11623 
	`ªwöd
(
§v_di˘_tmpfûe
);

11624 
Êí
 = (
uöt
Ë
	`‰ód
(
°r
, 1, fÀn, 
§v_di˘_tmpfûe
);

11625 
°r
[
Êí
] = 0;

11628 
	`muãx_exô
(&
§v_di˘_tmpfûe_muãx
);

11631 (
°r
);

11632 
	}
}

11639 
FOREIGN_KEY_INFO
*

11640 
	$gë_f‹eign_key_öfo
(

11642 
THD
* 
thd
,

11643 
di˘_f‹eign_t
* 
f‹eign
)

11645 
FOREIGN_KEY_INFO
 
f_key_öfo
;

11646 
FOREIGN_KEY_INFO
* 
pf_key_öfo
;

11647 
uöt
 
i
 = 0;

11648 
ulöt
 
Àn
;

11649 
tmp_buff
[
NAME_LEN
+1];

11650 
«me_buff
[
NAME_LEN
+1];

11651 c⁄° * 
±r
;

11652 
LEX_STRING
* 
ª„ªn˚d_key_«me
;

11653 
LEX_STRING
* 
«me
 = 
NULL
;

11655 
±r
 = 
	`di˘_ªmove_db_«me
(
f‹eign
->
id
);

11656 
f_key_öfo
.
f‹eign_id
 = 
	`thd_make_Àx_°rög
(
thd
, 0, 
±r
,

11657 (
uöt
Ë
	`°æí
(
±r
), 1);

11662 
Àn
 = 
	`di˘_gë_db_«me_Àn
(
f‹eign
->
ª„ªn˚d_èbÀ_«me
);

11663 
	`ut_a
(
Àn
 < (
tmp_buff
));

11664 
	`ut_mem˝y
(
tmp_buff
, 
f‹eign
->
ª„ªn˚d_èbÀ_«me
, 
Àn
);

11665 
tmp_buff
[
Àn
] = 0;

11667 
Àn
 = 
	`fûíame_to_èbÀ«me
(
tmp_buff
, 
«me_buff
, (name_buff));

11668 
f_key_öfo
.
ª„ªn˚d_db
 = 
	`thd_make_Àx_°rög
(

11669 
thd
, 0, 
«me_buff
, 
°©ic_ˇ°
<>(
Àn
), 1);

11672 
±r
 = 
	`di˘_ªmove_db_«me
(
f‹eign
->
ª„ªn˚d_èbÀ_«me
);

11673 
Àn
 = 
	`fûíame_to_èbÀ«me
(
±r
, 
«me_buff
, (name_buff));

11674 
f_key_öfo
.
ª„ªn˚d_èbÀ
 = 
	`thd_make_Àx_°rög
(

11675 
thd
, 0, 
«me_buff
, 
°©ic_ˇ°
<>(
Àn
), 1);

11678 
Àn
 = 
	`di˘_gë_db_«me_Àn
(
f‹eign
->
f‹eign_èbÀ_«me
);

11679 
	`ut_a
(
Àn
 < (
tmp_buff
));

11680 
	`ut_mem˝y
(
tmp_buff
, 
f‹eign
->
f‹eign_èbÀ_«me
, 
Àn
);

11681 
tmp_buff
[
Àn
] = 0;

11683 
Àn
 = 
	`fûíame_to_èbÀ«me
(
tmp_buff
, 
«me_buff
, (name_buff));

11684 
f_key_öfo
.
f‹eign_db
 = 
	`thd_make_Àx_°rög
(

11685 
thd
, 0, 
«me_buff
, 
°©ic_ˇ°
<>(
Àn
), 1);

11688 
±r
 = 
	`di˘_ªmove_db_«me
(
f‹eign
->
f‹eign_èbÀ_«me
);

11689 
Àn
 = 
	`fûíame_to_èbÀ«me
(
±r
, 
«me_buff
, (name_buff));

11690 
f_key_öfo
.
f‹eign_èbÀ
 = 
	`thd_make_Àx_°rög
(

11691 
thd
, 0, 
«me_buff
, 
°©ic_ˇ°
<>(
Àn
), 1);

11694 
±r
 = 
f‹eign
->
f‹eign_cﬁ_«mes
[
i
];

11695 
«me
 = 
	`thd_make_Àx_°rög
(
thd
,Çame, 
±r
,

11696 (
uöt
Ë
	`°æí
(
±r
), 1);

11697 
f_key_öfo
.
f‹eign_fõlds
.
	`push_back
(
«me
);

11698 
±r
 = 
f‹eign
->
ª„ªn˚d_cﬁ_«mes
[
i
];

11699 
«me
 = 
	`thd_make_Àx_°rög
(
thd
,Çame, 
±r
,

11700 (
uöt
Ë
	`°æí
(
±r
), 1);

11701 
f_key_öfo
.
ª„ªn˚d_fõlds
.
	`push_back
(
«me
);

11702 } ++
i
 < 
f‹eign
->
n_fõlds
);

11704 i‡(
f‹eign
->
ty≥
 & 
DICT_FOREIGN_ON_DELETE_CASCADE
) {

11705 
Àn
 = 7;

11706 
±r
 = "CASCADE";

11707 } i‡(
f‹eign
->
ty≥
 & 
DICT_FOREIGN_ON_DELETE_SET_NULL
) {

11708 
Àn
 = 8;

11709 
±r
 = "SET NULL";

11710 } i‡(
f‹eign
->
ty≥
 & 
DICT_FOREIGN_ON_DELETE_NO_ACTION
) {

11711 
Àn
 = 9;

11712 
±r
 = "NO ACTION";

11714 
Àn
 = 8;

11715 
±r
 = "RESTRICT";

11718 
f_key_öfo
.
dñëe_mëhod
 = 
	`thd_make_Àx_°rög
(

11719 
thd
, 
f_key_öfo
.
dñëe_mëhod
, 
±r
,

11720 
°©ic_ˇ°
<>(
Àn
), 1);

11722 i‡(
f‹eign
->
ty≥
 & 
DICT_FOREIGN_ON_UPDATE_CASCADE
) {

11723 
Àn
 = 7;

11724 
±r
 = "CASCADE";

11725 } i‡(
f‹eign
->
ty≥
 & 
DICT_FOREIGN_ON_UPDATE_SET_NULL
) {

11726 
Àn
 = 8;

11727 
±r
 = "SET NULL";

11728 } i‡(
f‹eign
->
ty≥
 & 
DICT_FOREIGN_ON_UPDATE_NO_ACTION
) {

11729 
Àn
 = 9;

11730 
±r
 = "NO ACTION";

11732 
Àn
 = 8;

11733 
±r
 = "RESTRICT";

11736 
f_key_öfo
.
upd©e_mëhod
 = 
	`thd_make_Àx_°rög
(

11737 
thd
, 
f_key_öfo
.
upd©e_mëhod
, 
±r
,

11738 
°©ic_ˇ°
<>(
Àn
), 1);

11740 i‡(
f‹eign
->
ª„ªn˚d_ödex
 && f‹eign->ª„ªn˚d_ödex->
«me
) {

11741 
ª„ªn˚d_key_«me
 = 
	`thd_make_Àx_°rög
(
thd
,

11742 
f_key_öfo
.
ª„ªn˚d_key_«me
,

11743 
f‹eign
->
ª„ªn˚d_ödex
->
«me
,

11744 (
uöt
Ë
	`°æí
(
f‹eign
->
ª„ªn˚d_ödex
->
«me
),

11747 
ª„ªn˚d_key_«me
 = 
NULL
;

11750 
f_key_öfo
.
ª„ªn˚d_key_«me
 =Ñeferenced_key_name;

11752 
pf_key_öfo
 = (
FOREIGN_KEY_INFO
*Ë
	`thd_memdup
(
thd
, &
f_key_öfo
,

11753 (
FOREIGN_KEY_INFO
));

11755 (
pf_key_öfo
);

11756 
	}
}

11761 
UNIV_INTERN


11763 
	gha_önoba£
::
gë_f‹eign_key_li°
(

11765 
THD
* 
thd
,

11766 
Li°
<
FOREIGN_KEY_INFO
>* 
f_key_li°
)

11768 
FOREIGN_KEY_INFO
* 
	gpf_key_öfo
;

11769 
di˘_f‹eign_t
* 
	gf‹eign
;

11771 
ut_a
(
¥ebuût
 !
NULL
);

11772 
upd©e_thd
(
ha_thd
());

11774 
	g¥ebuût
->
	gåx
->
	g›_öfo
 = "gettingÜist of foreign keys";

11776 
åx_£¨ch_œtch_ªÀa£_if_ª£rved
(
¥ebuût
->
åx
);

11778 
muãx_íãr
(&(
di˘_sys
->
muãx
));

11780 
	gdi˘_f‹eign_£t
::
ôî©‹
 
ô


11781 
¥ebuût
->
èbÀ
->
f‹eign_£t
.
begö
();

11782 
	gô
 !
¥ebuût
->
èbÀ
->
f‹eign_£t
.
íd
();

11783 ++
	gô
) {

11785 
	gf‹eign
 = *
ô
;

11787 
	gpf_key_öfo
 = 
gë_f‹eign_key_öfo
(
thd
, 
f‹eign
);

11788 i‡(
	gpf_key_öfo
) {

11789 
	gf_key_li°
->
push_back
(
pf_key_öfo
);

11793 
muãx_exô
(&(
di˘_sys
->
muãx
));

11795 
	g¥ebuût
->
	gåx
->
	g›_öfo
 = "";

11803 
UNIV_INTERN


11805 
	gha_önoba£
::
gë_∑ª¡_f‹eign_key_li°
(

11807 
THD
* 
thd
,

11808 
Li°
<
FOREIGN_KEY_INFO
>* 
f_key_li°
)

11810 
FOREIGN_KEY_INFO
* 
	gpf_key_öfo
;

11811 
di˘_f‹eign_t
* 
	gf‹eign
;

11813 
ut_a
(
¥ebuût
 !
NULL
);

11814 
upd©e_thd
(
ha_thd
());

11816 
	g¥ebuût
->
	gåx
->
	g›_öfo
 = "gettingÜist ofÑeferencing foreign keys";

11818 
åx_£¨ch_œtch_ªÀa£_if_ª£rved
(
¥ebuût
->
åx
);

11820 
muãx_íãr
(&(
di˘_sys
->
muãx
));

11822 
	gdi˘_f‹eign_£t
::
ôî©‹
 
ô


11823 
¥ebuût
->
èbÀ
->
ª„ªn˚d_£t
.
begö
();

11824 
	gô
 !
¥ebuût
->
èbÀ
->
ª„ªn˚d_£t
.
íd
();

11825 ++
	gô
) {

11827 
	gf‹eign
 = *
ô
;

11829 
	gpf_key_öfo
 = 
gë_f‹eign_key_öfo
(
thd
, 
f‹eign
);

11830 i‡(
	gpf_key_öfo
) {

11831 
	gf_key_li°
->
push_back
(
pf_key_öfo
);

11835 
muãx_exô
(&(
di˘_sys
->
muãx
));

11837 
	g¥ebuût
->
	gåx
->
	g›_öfo
 = "";

11847 
UNIV_INTERN


11848 
boﬁ


11849 
	gha_önoba£
::
	$ˇn_swôch_ígöes
()

11852 
boﬁ
 
ˇn_swôch
;

11854 
	`DBUG_ENTER
("ha_innobase::can_switch_engines");

11855 
	`upd©e_thd
();

11857 
¥ebuût
->
åx
->
›_öfo
 =

11859 
	`row_mysql_‰ìze_d©a_di˘i⁄¨y
(
¥ebuût
->
åx
);

11861 
ˇn_swôch
 = 
¥ebuût
->
èbÀ
->
ª„ªn˚d_£t
.
	`em±y
()

11862 && 
¥ebuût
->
èbÀ
->
f‹eign_£t
.
	`em±y
();

11864 
	`row_mysql_un‰ìze_d©a_di˘i⁄¨y
(
¥ebuût
->
åx
);

11865 
¥ebuût
->
åx
->
›_öfo
 = "";

11867 
	`DBUG_RETURN
(
ˇn_swôch
);

11868 
	}
}

11876 
UNIV_INTERN


11877 
uöt


11878 
	gha_önoba£
::
	$ª„ªn˚d_by_f‹eign_key
()

11881 i‡(
	`di˘_èbÀ_is_ª„ªn˚d_by_f‹eign_key
(
¥ebuût
->
èbÀ
)) {

11887 
	}
}

11892 
UNIV_INTERN


11894 
	gha_önoba£
::
	$‰ì_f‹eign_key_¸óã_öfo
(

11896 * 
°r
)

11898 i‡(
°r
) {

11899 
	`my_‰ì
(
°r
);

11901 
	}
}

11906 
UNIV_INTERN


11908 
	gha_önoba£
::
	$exåa
(

11910 
ha_exåa_fun˘i⁄
 
›î©i⁄
)

11913 
	`check_åx_exi°s
(
	`ha_thd
());

11919 
›î©i⁄
) {

11920 
HA_EXTRA_FLUSH
:

11921 i‡(
¥ebuût
->
blob_hóp
) {

11922 
	`row_mysql_¥ebuût_‰ì_blob_hóp
(
¥ebuût
);

11925 
HA_EXTRA_RESET_STATE
:

11926 
	`ª£t_ãm∂©e
();

11927 
	`thd_to_åx
(
	`ha_thd
())->
du∂iˇãs
 = 0;

11929 
HA_EXTRA_NO_KEYREAD
:

11930 
¥ebuût
->
ªad_ju°_key
 = 0;

11932 
HA_EXTRA_KEYREAD
:

11933 
¥ebuût
->
ªad_ju°_key
 = 1;

11935 
HA_EXTRA_KEYREAD_PRESERVE_FIELDS
:

11936 
¥ebuût
->
kìp_Ÿhî_fõlds_⁄_keyªad
 = 1;

11945 
HA_EXTRA_INSERT_WITH_UPDATE
:

11946 
	`thd_to_åx
(
	`ha_thd
())->
du∂iˇãs
 |
TRX_DUP_IGNORE
;

11948 
HA_EXTRA_NO_IGNORE_DUP_KEY
:

11949 
	`thd_to_åx
(
	`ha_thd
())->
du∂iˇãs
 &~
TRX_DUP_IGNORE
;

11951 
HA_EXTRA_WRITE_CAN_REPLACE
:

11952 
	`thd_to_åx
(
	`ha_thd
())->
du∂iˇãs
 |
TRX_DUP_REPLACE
;

11954 
HA_EXTRA_WRITE_CANNOT_REPLACE
:

11955 
	`thd_to_åx
(
	`ha_thd
())->
du∂iˇãs
 &~
TRX_DUP_REPLACE
;

11962 
	}
}

11966 
UNIV_INTERN


11968 
	gha_önoba£
::
	$ª£t
()

11971 i‡(
¥ebuût
->
blob_hóp
) {

11972 
	`row_mysql_¥ebuût_‰ì_blob_hóp
(
¥ebuût
);

11975 
	`ª£t_ãm∂©e
();

11976 
ds_mº
.
	`ª£t
();

11982 
¥ebuût
->
autoöc_œ°_vÆue
 = 0;

11985 
	}
}

11999 
UNIV_INTERN


12001 
	gha_önoba£
::
	$°¨t_°mt
(

12003 
THD
* 
thd
,

12004 
thr_lock_ty≥
 
lock_ty≥
)

12006 
åx_t
* 
åx
;

12007 
	`DBUG_ENTER
("ha_innobase::start_stmt");

12009 
	`upd©e_thd
(
thd
);

12011 
åx
 = 
¥ebuût
->trx;

12020 
	`åx_£¨ch_œtch_ªÀa£_if_ª£rved
(
åx
);

12022 
	`önoba£_§v_c⁄c_f‹˚_exô_önodb
(
åx
);

12025 
åx
->
n_autoöc_rows
 = 0;

12027 
¥ebuût
->
sql_°©_°¨t
 = 
TRUE
;

12028 
¥ebuût
->
höt_√ed_to_„tch_exåa_cﬁs
 = 0;

12029 
	`ª£t_ãm∂©e
();

12031 i‡(
	`di˘_èbÀ_is_ãmp‹¨y
(
¥ebuût
->
èbÀ
)

12032 && 
¥ebuût
->
mysql_has_locked


12033 && 
¥ebuût
->
£À˘_lock_ty≥
 =
LOCK_NONE
) {

12034 
dbîr_t
 
îr‹
;

12036 
	`thd_sql_comm™d
(
thd
)) {

12037 
SQLCOM_INSERT
:

12038 
SQLCOM_UPDATE
:

12039 
SQLCOM_DELETE
:

12040 
	`öô_èbÀ_h™dÀ_f‹_HANDLER
();

12041 
¥ebuût
->
£À˘_lock_ty≥
 = 
LOCK_X
;

12042 
¥ebuût
->
°‹ed_£À˘_lock_ty≥
 = 
LOCK_X
;

12043 
îr‹
 = 
	`row_lock_èbÀ_f‹_mysql
(
¥ebuût
, 
NULL
, 1);

12045 i‡(
îr‹
 !
DB_SUCCESS
) {

12046 
°
 = 
	`c⁄vît_îr‹_code_to_mysql
(

12047 
îr‹
, 0, 
thd
);

12048 
	`DBUG_RETURN
(
°
);

12054 i‡(!
¥ebuût
->
mysql_has_locked
) {

12060 
¥ebuût
->
£À˘_lock_ty≥
 = 
LOCK_X
;

12062 } i‡(
åx
->
isﬁ©i⁄_Àvñ
 !
TRX_ISO_SERIALIZABLE


12063 && 
	`thd_sql_comm™d
(
thd
Ë=
SQLCOM_SELECT


12064 && 
lock_ty≥
 =
TL_READ
) {

12069 
¥ebuût
->
£À˘_lock_ty≥
 = 
LOCK_NONE
;

12079 
	`ut_a
(
¥ebuût
->
°‹ed_£À˘_lock_ty≥
 !
LOCK_NONE_UNSET
);

12080 
¥ebuût
->
£À˘_lock_ty≥
 =Öªbuût->
°‹ed_£À˘_lock_ty≥
;

12083 *
åx
->
dëaûed_îr‹
 = 0;

12085 
	`önoba£_ªgi°î_åx
(
ht
, 
thd
, 
åx
);

12087 i‡(!
	`åx_is_°¨ãd
(
åx
)) {

12088 ++
åx
->
wûl_lock
;

12091 
	`DBUG_RETURN
(0);

12092 
	}
}

12097 
ölöe


12098 
ulöt


12099 
	$önoba£_m≠_isﬁ©i⁄_Àvñ
(

12101 
íum_tx_isﬁ©i⁄
 
iso
)

12103 
iso
) {

12104 
ISO_REPEATABLE_READ
: (
TRX_ISO_REPEATABLE_READ
);

12105 
ISO_READ_COMMITTED
: (
TRX_ISO_READ_COMMITTED
);

12106 
ISO_SERIALIZABLE
: (
TRX_ISO_SERIALIZABLE
);

12107 
ISO_READ_UNCOMMITTED
: (
TRX_ISO_READ_UNCOMMITTED
);

12110 
ut_îr‹
;

12113 
	}
}

12124 
UNIV_INTERN


12126 
	gha_önoba£
::
	$exã∫Æ_lock
(

12128 
THD
* 
thd
,

12129 
lock_ty≥
)

12131 
åx_t
* 
åx
;

12133 
	`DBUG_ENTER
("ha_innobase::external_lock");

12134 
	`DBUG_PRINT
("íãr",("lock_ty≥: %d", 
lock_ty≥
));

12136 
	`upd©e_thd
(
thd
);

12145 i‡(
lock_ty≥
 =
F_WRLCK


12146 && !(
	`èbÀ_Êags
(Ë& 
HA_BINLOG_STMT_CAPABLE
)

12147 && 
	`thd_bölog_f‹m©
(
thd
Ë=
BINLOG_FORMAT_STMT


12148 && 
	`thd_bölog_fûãr_ok
(
thd
)

12149 && 
	`thd_sqlcom_ˇn_gíî©e_row_evíts
(
thd
)) {

12150 
boﬁ
 
skù
 = 0;

12152 
	`DBUG_EXECUTE_IF
("no_önodb_bölog_îr‹s", 
skù
 = 
åue
;);

12153 i‡(!
skù
) {

12154 
	`my_îr‹
(
ER_BINLOG_STMT_MODE_AND_ROW_ENGINE
, 
	`MYF
(0),

12158 
	`DBUG_RETURN
(
HA_ERR_LOGGING_IMPOSSIBLE
);

12163 i‡(
§v_ªad_⁄ly_mode


12164 && (
	`thd_sql_comm™d
(
thd
Ë=
SQLCOM_UPDATE


12165 || 
	`thd_sql_comm™d
(
thd
Ë=
SQLCOM_INSERT


12166 || 
	`thd_sql_comm™d
(
thd
Ë=
SQLCOM_REPLACE


12167 || 
	`thd_sql_comm™d
(
thd
Ë=
SQLCOM_DROP_TABLE


12168 || 
	`thd_sql_comm™d
(
thd
Ë=
SQLCOM_ALTER_TABLE


12169 || 
	`thd_sql_comm™d
(
thd
Ë=
SQLCOM_OPTIMIZE


12170 || (
	`thd_sql_comm™d
(
thd
Ë=
SQLCOM_CREATE_TABLE


12171 && 
lock_ty≥
 =
F_WRLCK
)

12172 || 
	`thd_sql_comm™d
(
thd
Ë=
SQLCOM_CREATE_INDEX


12173 || 
	`thd_sql_comm™d
(
thd
Ë=
SQLCOM_DROP_INDEX


12174 || 
	`thd_sql_comm™d
(
thd
Ë=
SQLCOM_DELETE
)) {

12176 i‡(
	`thd_sql_comm™d
(
thd
Ë=
SQLCOM_CREATE_TABLE
)

12178 
	`ib_£ndîrf
(
thd
, 
IB_LOG_LEVEL_WARN
,

12179 
ER_INNODB_READ_ONLY
);

12180 
	`DBUG_RETURN
(
HA_ERR_INNODB_READ_ONLY
);

12182 
	`ib_£ndîrf
(
thd
, 
IB_LOG_LEVEL_WARN
,

12183 
ER_READ_ONLY_MODE
);

12184 
	`DBUG_RETURN
(
HA_ERR_TABLE_READONLY
);

12189 
åx
 = 
¥ebuût
->trx;

12191 
¥ebuût
->
sql_°©_°¨t
 = 
TRUE
;

12192 
¥ebuût
->
höt_√ed_to_„tch_exåa_cﬁs
 = 0;

12194 
	`ª£t_ãm∂©e
();

12196 
¥ebuût
->
èbÀ
->
quõs˚
) {

12197 
QUIESCE_START
:

12199 i‡(!
§v_ªad_⁄ly_mode


12200 && 
	`thd_sql_comm™d
(
thd
Ë=
SQLCOM_FLUSH


12201 && 
lock_ty≥
 =
F_RDLCK
) {

12203 
	`row_quõs˚_èbÀ_°¨t
(
¥ebuût
->
èbÀ
, 
åx
);

12209 ++
åx
->
Êush_èbÀs
;

12213 
QUIESCE_COMPLETE
:

12216 i‡(
åx
->
Êush_èbÀs
 > 0

12217 && (
lock_ty≥
 =
F_UNLCK
 || 
	`åx_is_öãºu±ed
(
åx
))) {

12219 
	`row_quõs˚_èbÀ_com∂ëe
(
¥ebuût
->
èbÀ
, 
åx
);

12221 
	`ut_a
(
åx
->
Êush_èbÀs
 > 0);

12222 --
åx
->
Êush_èbÀs
;

12227 
QUIESCE_NONE
:

12231 i‡(
lock_ty≥
 =
F_WRLCK
) {

12235 
¥ebuût
->
£À˘_lock_ty≥
 = 
LOCK_X
;

12236 
¥ebuût
->
°‹ed_£À˘_lock_ty≥
 = 
LOCK_X
;

12239 i‡(
lock_ty≥
 !
F_UNLCK
) {

12242 *
åx
->
dëaûed_îr‹
 = 0;

12244 
	`önoba£_ªgi°î_åx
(
ht
, 
thd
, 
åx
);

12246 i‡(
åx
->
isﬁ©i⁄_Àvñ
 =
TRX_ISO_SERIALIZABLE


12247 && 
¥ebuût
->
£À˘_lock_ty≥
 =
LOCK_NONE


12248 && 
	`thd_ã°_›ti⁄s
(

12249 
thd
, 
OPTION_NOT_AUTOCOMMIT
 | 
OPTION_BEGIN
)) {

12259 
¥ebuût
->
£À˘_lock_ty≥
 = 
LOCK_S
;

12260 
¥ebuût
->
°‹ed_£À˘_lock_ty≥
 = 
LOCK_S
;

12274 i‡(
¥ebuût
->
£À˘_lock_ty≥
 !
LOCK_NONE
) {

12276 i‡(
	`thd_sql_comm™d
(
thd
Ë=
SQLCOM_LOCK_TABLES


12277 && 
	`THDVAR
(
thd
, 
èbÀ_locks
)

12278 && 
	`thd_ã°_›ti⁄s
(
thd
, 
OPTION_NOT_AUTOCOMMIT
)

12279 && 
	`thd_ö_lock_èbÀs
(
thd
)) {

12281 
dbîr_t
 
îr‹
 = 
	`row_lock_èbÀ_f‹_mysql
(

12282 
¥ebuût
, 
NULL
, 0);

12284 i‡(
îr‹
 !
DB_SUCCESS
) {

12285 
	`DBUG_RETURN
(

12286 
	`c⁄vît_îr‹_code_to_mysql
(

12287 
îr‹
, 0, 
thd
));

12291 
åx
->
mysql_n_èbÀs_locked
++;

12294 
åx
->
n_mysql_èbÀs_ö_u£
++;

12295 
¥ebuût
->
mysql_has_locked
 = 
TRUE
;

12297 i‡(!
	`åx_is_°¨ãd
(
åx
)

12298 && (
¥ebuût
->
£À˘_lock_ty≥
 !
LOCK_NONE


12299 || 
¥ebuût
->
°‹ed_£À˘_lock_ty≥
 !
LOCK_NONE
)) {

12301 ++
åx
->
wûl_lock
;

12304 
	`DBUG_RETURN
(0);

12309 
åx
->
n_mysql_èbÀs_ö_u£
--;

12310 
¥ebuût
->
mysql_has_locked
 = 
FALSE
;

12316 
	`åx_£¨ch_œtch_ªÀa£_if_ª£rved
(
åx
);

12318 
	`önoba£_§v_c⁄c_f‹˚_exô_önodb
(
åx
);

12323 i‡(
åx
->
n_mysql_èbÀs_ö_u£
 == 0) {

12325 
åx
->
mysql_n_èbÀs_locked
 = 0;

12326 
¥ebuût
->
u£d_ö_HANDLER
 = 
FALSE
;

12328 i‡(!
	`thd_ã°_›ti⁄s
(

12329 
thd
, 
OPTION_NOT_AUTOCOMMIT
 | 
OPTION_BEGIN
)) {

12331 i‡(
	`åx_is_°¨ãd
(
åx
)) {

12332 
	`önoba£_commô
(
ht
, 
thd
, 
TRUE
);

12335 } i‡(
åx
->
isﬁ©i⁄_Àvñ
 <
TRX_ISO_READ_COMMITTED


12336 && 
åx
->
globÆ_ªad_võw
) {

12341 
	`ªad_võw_˛o£_f‹_mysql
(
åx
);

12345 i‡(!
	`åx_is_°¨ãd
(
åx
)

12346 && (
¥ebuût
->
£À˘_lock_ty≥
 !
LOCK_NONE


12347 || 
¥ebuût
->
°‹ed_£À˘_lock_ty≥
 !
LOCK_NONE
)) {

12349 ++
åx
->
wûl_lock
;

12352 
	`DBUG_RETURN
(0);

12353 
	}
}

12359 
UNIV_INTERN


12361 
	gha_önoba£
::
	$å™ß˘i⁄Æ_èbÀ_lock
(

12363 
THD
* 
thd
,

12364 
lock_ty≥
)

12366 
åx_t
* 
åx
;

12368 
	`DBUG_ENTER
("ha_innobase::transactional_table_lock");

12369 
	`DBUG_PRINT
("íãr",("lock_ty≥: %d", 
lock_ty≥
));

12375 
	`upd©e_thd
(
thd
);

12377 i‡(!
	`thd_èbÀ•a˚_›
(
thd
)) {

12379 i‡(
	`di˘_èbÀ_is_disˇrded
(
¥ebuût
->
èbÀ
)) {

12381 
	`ib_£ndîrf
(

12382 
thd
, 
IB_LOG_LEVEL_ERROR
,

12383 
ER_TABLESPACE_DISCARDED
,

12384 
èbÀ
->
s
->
èbÀ_«me
.
°r
);

12386 } i‡(
¥ebuût
->
èbÀ
->
ibd_fûe_missög
) {

12388 
	`ib_£ndîrf
(

12389 
thd
, 
IB_LOG_LEVEL_ERROR
,

12390 
ER_TABLESPACE_MISSING
,

12391 
èbÀ
->
s
->
èbÀ_«me
.
°r
);

12394 
	`DBUG_RETURN
(
HA_ERR_CRASHED
);

12397 
åx
 = 
¥ebuût
->trx;

12399 
¥ebuût
->
sql_°©_°¨t
 = 
TRUE
;

12400 
¥ebuût
->
höt_√ed_to_„tch_exåa_cﬁs
 = 0;

12402 
	`ª£t_ãm∂©e
();

12404 i‡(
lock_ty≥
 =
F_WRLCK
) {

12405 
¥ebuût
->
£À˘_lock_ty≥
 = 
LOCK_X
;

12406 
¥ebuût
->
°‹ed_£À˘_lock_ty≥
 = 
LOCK_X
;

12407 } i‡(
lock_ty≥
 =
F_RDLCK
) {

12408 
¥ebuût
->
£À˘_lock_ty≥
 = 
LOCK_S
;

12409 
¥ebuût
->
°‹ed_£À˘_lock_ty≥
 = 
LOCK_S
;

12411 
	`ib_logf
(
IB_LOG_LEVEL_ERROR
,

12415 
èbÀ
->
s
->
èbÀ_«me
.
°r
, 
lock_ty≥
);

12417 
	`DBUG_RETURN
(
HA_ERR_CRASHED
);

12422 
	`önoba£_ªgi°î_åx
(
ht
, 
thd
, 
åx
);

12424 i‡(
	`THDVAR
(
thd
, 
èbÀ_locks
Ë&& 
	`thd_ö_lock_èbÀs
(thd)) {

12425 
dbîr_t
 
îr‹
;

12427 
îr‹
 = 
	`row_lock_èbÀ_f‹_mysql
(
¥ebuût
, 
NULL
, 0);

12429 i‡(
îr‹
 !
DB_SUCCESS
) {

12430 
	`DBUG_RETURN
(

12431 
	`c⁄vît_îr‹_code_to_mysql
(

12432 
îr‹
, 
¥ebuût
->
èbÀ
->
Êags
, 
thd
));

12435 i‡(
	`thd_ã°_›ti⁄s
(

12436 
thd
, 
OPTION_NOT_AUTOCOMMIT
 | 
OPTION_BEGIN
)) {

12442 
	`åx_m¨k_sql_°©_íd
(
åx
);

12446 
	`DBUG_RETURN
(0);

12447 
	}
}

12453 
	$önodb_exp‹t_°©us
()

12456 i‡(
önodb_öôed
) {

12457 
	`§v_exp‹t_önodb_°©us
();

12459 
	}
}

12467 
	$önodb_show_°©us
(

12469 
h™dÀπ⁄
* 
ht⁄
,

12470 
THD
* 
thd
,

12471 
°©_¥öt_‚
* 
°©_¥öt
)

12473 
åx_t
* 
åx
;

12474 c⁄° 
åunˇãd_msg
[] = "...Åruncated...\n";

12475 c⁄° 
MAX_STATUS_SIZE
 = 1048576;

12476 
ulöt
 
åx_li°_°¨t
 = 
ULINT_UNDEFINED
;

12477 
ulöt
 
åx_li°_íd
 = 
ULINT_UNDEFINED
;

12478 
boﬁ
 
ªt_vÆ
;

12480 
	`DBUG_ENTER
("innodb_show_status");

12481 
	`DBUG_ASSERT
(
ht⁄
 =
önodb_ht⁄_±r
);

12486 i‡(
§v_ªad_⁄ly_mode
) {

12487 
	`DBUG_RETURN
(0);

12490 
åx
 = 
	`check_åx_exi°s
(
thd
);

12492 
	`åx_£¨ch_œtch_ªÀa£_if_ª£rved
(
åx
);

12494 
	`önoba£_§v_c⁄c_f‹˚_exô_önodb
(
åx
);

12499 * 
°r
;

12500 
ssize_t
 
Êí
, 
ußbÀ_Àn
;

12502 
	`muãx_íãr
(&
§v_m⁄ô‹_fûe_muãx
);

12503 
	`ªwöd
(
§v_m⁄ô‹_fûe
);

12505 
	`§v_¥ötf_önodb_m⁄ô‹
(
§v_m⁄ô‹_fûe
, 
FALSE
,

12506 &
åx_li°_°¨t
, &
åx_li°_íd
);

12508 
	`os_fûe_£t_eof
(
§v_m⁄ô‹_fûe
);

12510 i‡((
Êí
 = 
	`·ñl
(
§v_m⁄ô‹_fûe
)) < 0) {

12511 
Êí
 = 0;

12514 i‡(
Êí
 > 
MAX_STATUS_SIZE
) {

12515 
ußbÀ_Àn
 = 
MAX_STATUS_SIZE
;

12516 
§v_åunˇãd_°©us_wrôes
++;

12518 
ußbÀ_Àn
 = 
Êí
;

12524 i‡(!(
°r
 = (*Ë
	`my_mÆloc
(
ußbÀ_Àn
 + 1, 
	`MYF
(0)))) {

12525 
	`muãx_exô
(&
§v_m⁄ô‹_fûe_muãx
);

12526 
	`DBUG_RETURN
(1);

12529 
	`ªwöd
(
§v_m⁄ô‹_fûe
);

12531 i‡(
Êí
 < 
MAX_STATUS_SIZE
) {

12533 
Êí
 = 
	`‰ód
(
°r
, 1, fÀn, 
§v_m⁄ô‹_fûe
);

12534 } i‡(
åx_li°_íd
 < (
ulöt
Ë
Êí


12535 && 
åx_li°_°¨t
 < 
åx_li°_íd


12536 && 
åx_li°_°¨t
 + (
Êí
 - 
åx_li°_íd
)

12537 < 
MAX_STATUS_SIZE
 -  
åunˇãd_msg
 - 1) {

12540 
ssize_t
 
Àn
 = 
	`‰ód
(
°r
, 1, 
åx_li°_°¨t
, 
§v_m⁄ô‹_fûe
);

12542 
	`mem˝y
(
°r
 + 
Àn
, 
åunˇãd_msg
, Åruncated_msg - 1);

12543 
Àn
 + 
åunˇãd_msg
 - 1;

12544 
ußbÀ_Àn
 = (
MAX_STATUS_SIZE
 - 1Ë- 
Àn
;

12545 
	`f£ek
(
§v_m⁄ô‹_fûe
,

12546 
°©ic_ˇ°
<>(
Êí
 - 
ußbÀ_Àn
), 
SEEK_SET
);

12547 
Àn
 +
	`‰ód
(
°r
 +Üí, 1, 
ußbÀ_Àn
, 
§v_m⁄ô‹_fûe
);

12548 
Êí
 = 
Àn
;

12551 
Êí
 = 
	`‰ód
(
°r
, 1, 
MAX_STATUS_SIZE
 - 1, 
§v_m⁄ô‹_fûe
);

12554 
	`muãx_exô
(&
§v_m⁄ô‹_fûe_muãx
);

12556 
ªt_vÆ

	`°©_¥öt
(

12557 
thd
, 
önoba£_ht⁄_«me
,

12558 
°©ic_ˇ°
<
uöt
>(
	`°æí
(
önoba£_ht⁄_«me
)),

12559 
	`STRING_WITH_LEN
(""), 
°r
, 
°©ic_ˇ°
<
uöt
>(
Êí
));

12561 
	`my_‰ì
(
°r
);

12563 
	`DBUG_RETURN
(
ªt_vÆ
);

12564 
	}
}

12571 
	$önodb_muãx_show_°©us
(

12573 
h™dÀπ⁄
* 
ht⁄
,

12574 
THD
* 
thd
,

12576 
°©_¥öt_‚
* 
°©_¥öt
)

12579 
buf1
[
IO_SIZE
];

12580 
buf2
[
IO_SIZE
];

12581 
ib_muãx_t
* 
muãx
;

12582 
rw_lock_t
* 
lock
;

12583 
ulöt
 
block_muãx_oswaô_cou¡
 = 0;

12584 
ulöt
 
block_lock_oswaô_cou¡
 = 0;

12585 
ib_muãx_t
* 
block_muãx
 = 
NULL
;

12586 
rw_lock_t
* 
block_lock
 = 
NULL
;

12587 #ifde‡
UNIV_DEBUG


12588 
ulöt
 
rw_lock_cou¡
= 0;

12589 
ulöt
 
rw_lock_cou¡_•ö_lo›
= 0;

12590 
ulöt
 
rw_lock_cou¡_•ö_rounds
= 0;

12591 
ulöt
 
rw_lock_cou¡_os_waô
= 0;

12592 
ulöt
 
rw_lock_cou¡_os_yõld
= 0;

12593 
ul⁄gl⁄g
 
rw_lock_waô_time
= 0;

12595 
uöt
 
buf1Àn
;

12596 
uöt
 
buf2Àn
;

12597 
uöt
 
ht⁄_«me_Àn
;

12599 
ht⁄_«me_Àn
 = (
uöt
Ë
	`°æí
(
önoba£_ht⁄_«me
);

12601 
	`DBUG_ENTER
("innodb_mutex_show_status");

12602 
	`DBUG_ASSERT
(
ht⁄
 =
önodb_ht⁄_±r
);

12604 
	`muãx_íãr
(&
muãx_li°_muãx
);

12606 
muãx
 = 
	`UT_LIST_GET_FIRST
(
muãx_li°
); muãx !
NULL
;

12607 
muãx
 = 
	`UT_LIST_GET_NEXT
(
li°
, mutex)) {

12608 i‡(
muãx
->
cou¡_os_waô
 == 0) {

12612 i‡(
	`buf_poﬁ_is_block_muãx
(
muãx
)) {

12613 
block_muãx
 = 
muãx
;

12614 
block_muãx_oswaô_cou¡
 +
muãx
->
cou¡_os_waô
;

12618 
buf1Àn
(
uöt
Ë
	`my_¢¥ötf
(
buf1
, (buf1), "%s:%lu",

12619 
	`önoba£_ba£«me
(
muãx
->
cfûe_«me
),

12620 (
ul⁄g
Ë
muãx
->
˛öe
);

12621 
buf2Àn
(
uöt
Ë
	`my_¢¥ötf
(
buf2
, (buf2), "os_waits=%lu",

12622 (
ul⁄g
Ë
muãx
->
cou¡_os_waô
);

12624 i‡(
	`°©_¥öt
(
thd
, 
önoba£_ht⁄_«me
,

12625 
ht⁄_«me_Àn
, 
buf1
, 
buf1Àn
,

12626 
buf2
, 
buf2Àn
)) {

12627 
	`muãx_exô
(&
muãx_li°_muãx
);

12628 
	`DBUG_RETURN
(1);

12632 i‡(
block_muãx
) {

12633 
buf1Àn
 = (
uöt
Ë
	`my_¢¥ötf
(
buf1
,  buf1,

12635 
	`önoba£_ba£«me
(

12636 
block_muãx
->
cfûe_«me
),

12637 (
ul⁄g
Ë
block_muãx
->
˛öe
);

12638 
buf2Àn
 = (
uöt
Ë
	`my_¢¥ötf
(
buf2
,  buf2,

12640 (
ul⁄g
Ë
block_muãx_oswaô_cou¡
);

12642 i‡(
	`°©_¥öt
(
thd
, 
önoba£_ht⁄_«me
,

12643 
ht⁄_«me_Àn
, 
buf1
, 
buf1Àn
,

12644 
buf2
, 
buf2Àn
)) {

12645 
	`muãx_exô
(&
muãx_li°_muãx
);

12646 
	`DBUG_RETURN
(1);

12650 
	`muãx_exô
(&
muãx_li°_muãx
);

12652 
	`muãx_íãr
(&
rw_lock_li°_muãx
);

12654 
lock
 = 
	`UT_LIST_GET_FIRST
(
rw_lock_li°
);Üock !
NULL
;

12655 
lock
 = 
	`UT_LIST_GET_NEXT
(
li°
,Üock)) {

12656 i‡(
lock
->
cou¡_os_waô
 == 0) {

12660 i‡(
	`buf_poﬁ_is_block_lock
(
lock
)) {

12661 
block_lock
 = 
lock
;

12662 
block_lock_oswaô_cou¡
 +
lock
->
cou¡_os_waô
;

12666 
buf1Àn
 = (
uöt
Ë
	`my_¢¥ötf
(

12667 
buf1
,  buf1, "%s:%lu",

12668 
	`önoba£_ba£«me
(
lock
->
cfûe_«me
),

12669 
°©ic_ˇ°
<
ul⁄g
>(
lock
->
˛öe
));

12670 
buf2Àn
 = (
uöt
Ë
	`my_¢¥ötf
(

12671 
buf2
,  buf2, "os_waits=%lu",

12672 
°©ic_ˇ°
<
ul⁄g
>(
lock
->
cou¡_os_waô
));

12674 i‡(
	`°©_¥öt
(
thd
, 
önoba£_ht⁄_«me
,

12675 
ht⁄_«me_Àn
, 
buf1
, 
buf1Àn
,

12676 
buf2
, 
buf2Àn
)) {

12677 
	`muãx_exô
(&
rw_lock_li°_muãx
);

12678 
	`DBUG_RETURN
(1);

12682 i‡(
block_lock
) {

12683 
buf1Àn
 = (
uöt
Ë
	`my_¢¥ötf
(
buf1
,  buf1,

12685 
	`önoba£_ba£«me
(

12686 
block_lock
->
cfûe_«me
),

12687 (
ul⁄g
Ë
block_lock
->
˛öe
);

12688 
buf2Àn
 = (
uöt
Ë
	`my_¢¥ötf
(
buf2
,  buf2,

12690 (
ul⁄g
Ë
block_lock_oswaô_cou¡
);

12692 i‡(
	`°©_¥öt
(
thd
, 
önoba£_ht⁄_«me
,

12693 
ht⁄_«me_Àn
, 
buf1
, 
buf1Àn
,

12694 
buf2
, 
buf2Àn
)) {

12695 
	`muãx_exô
(&
rw_lock_li°_muãx
);

12696 
	`DBUG_RETURN
(1);

12700 
	`muãx_exô
(&
rw_lock_li°_muãx
);

12702 #ifde‡
UNIV_DEBUG


12703 
buf2Àn
 = 
°©ic_ˇ°
<
uöt
>(
	`my_¢¥ötf
(
buf2
,  buf2,

12706 (
ul⁄g
Ë
rw_lock_cou¡
,

12707 (
ul⁄g
Ë
rw_lock_cou¡_•ö_lo›
,

12708 (
ul⁄g
Ë
rw_lock_cou¡_•ö_rounds
,

12709 (
ul⁄g
Ë
rw_lock_cou¡_os_waô
,

12710 (
ul⁄g
Ë
rw_lock_cou¡_os_yõld
,

12711 (
ul⁄g
Ë(
rw_lock_waô_time
 / 1000)));

12713 i‡(
	`°©_¥öt
(
thd
, 
önoba£_ht⁄_«me
, 
ht⁄_«me_Àn
,

12714 
	`STRING_WITH_LEN
("rw_lock_muãxes"), 
buf2
, 
buf2Àn
)) {

12715 
	`DBUG_RETURN
(1);

12720 
	`DBUG_RETURN
(0);

12721 
	}
}

12727 
boﬁ


12728 
	$önoba£_show_°©us
(

12730 
h™dÀπ⁄
* 
ht⁄
,

12731 
THD
* 
thd
,

12733 
°©_¥öt_‚
* 
°©_¥öt
,

12734 
ha_°©_ty≥
 
°©_ty≥
)

12736 
	`DBUG_ASSERT
(
ht⁄
 =
önodb_ht⁄_±r
);

12738 
°©_ty≥
) {

12739 
HA_ENGINE_STATUS
:

12741 (
	`önodb_show_°©us
(
ht⁄
, 
thd
, 
°©_¥öt
) != 0);

12743 
HA_ENGINE_MUTEX
:

12745 (
	`önodb_muãx_show_°©us
(
ht⁄
, 
thd
, 
°©_¥öt
) != 0);

12747 
HA_ENGINE_LOGS
:

12753 (
Ál£
);

12754 
	}
}

12760 
INNOBASE_SHARE
*

12761 
	$gë_sh¨e
(

12763 c⁄° * 
èbÀ_«me
)

12765 
INNOBASE_SHARE
* 
sh¨e
;

12767 
	`mysql_muãx_lock
(&
önoba£_sh¨e_muãx
);

12769 
ulöt
 
fﬁd
 = 
	`ut_fﬁd_°rög
(
èbÀ_«me
);

12771 
	`HASH_SEARCH
(
èbÀ_«me_hash
, 
önoba£_›í_èbÀs
, 
fﬁd
,

12772 
INNOBASE_SHARE
*, 
sh¨e
,

12773 
	`ut_ad
(
sh¨e
->
u£_cou¡
 > 0),

12774 !
	`°rcmp
(
sh¨e
->
èbÀ_«me
,Åable_name));

12776 i‡(!
sh¨e
) {

12778 
uöt
 
Àngth
 = (uötË
	`°æí
(
èbÀ_«me
);

12783 
sh¨e
 = (
INNOBASE_SHARE
*Ë
	`my_mÆloc
((*sh¨e)+
Àngth
+1,

12784 
	`MYF
(
MY_FAE
 | 
MY_ZEROFILL
));

12786 
sh¨e
->
èbÀ_«me
 = (*Ë
	`mem˝y
(share + 1,

12787 
èbÀ_«me
, 
Àngth
 + 1);

12789 
	`HASH_INSERT
(
INNOBASE_SHARE
, 
èbÀ_«me_hash
,

12790 
önoba£_›í_èbÀs
, 
fﬁd
, 
sh¨e
);

12792 
	`thr_lock_öô
(&
sh¨e
->
lock
);

12795 
sh¨e
->
idx_å™s_tbl
.
ödex_m≠pög
 = 
NULL
;

12796 
sh¨e
->
idx_å™s_tbl
.
ödex_cou¡
 = 0;

12797 
sh¨e
->
idx_å™s_tbl
.
¨øy_size
 = 0;

12800 
sh¨e
->
u£_cou¡
++;

12801 
	`mysql_muãx_u∆ock
(&
önoba£_sh¨e_muãx
);

12803 (
sh¨e
);

12804 
	}
}

12810 
	$‰ì_sh¨e
(

12812 
INNOBASE_SHARE
* 
sh¨e
)

12814 
	`mysql_muãx_lock
(&
önoba£_sh¨e_muãx
);

12816 #ifde‡
UNIV_DEBUG


12817 
INNOBASE_SHARE
* 
sh¨e2
;

12818 
ulöt
 
fﬁd
 = 
	`ut_fﬁd_°rög
(
sh¨e
->
èbÀ_«me
);

12820 
	`HASH_SEARCH
(
èbÀ_«me_hash
, 
önoba£_›í_èbÀs
, 
fﬁd
,

12821 
INNOBASE_SHARE
*, 
sh¨e2
,

12822 
	`ut_ad
(
sh¨e
->
u£_cou¡
 > 0),

12823 !
	`°rcmp
(
sh¨e
->
èbÀ_«me
, 
sh¨e2
->table_name));

12825 
	`ut_a
(
sh¨e2
 =
sh¨e
);

12828 i‡(!--
sh¨e
->
u£_cou¡
) {

12829 
ulöt
 
fﬁd
 = 
	`ut_fﬁd_°rög
(
sh¨e
->
èbÀ_«me
);

12831 
	`HASH_DELETE
(
INNOBASE_SHARE
, 
èbÀ_«me_hash
,

12832 
önoba£_›í_èbÀs
, 
fﬁd
, 
sh¨e
);

12833 
	`thr_lock_dñëe
(&
sh¨e
->
lock
);

12836 
	`my_‰ì
(
sh¨e
->
idx_å™s_tbl
.
ödex_m≠pög
);

12838 
	`my_‰ì
(
sh¨e
);

12844 
	`mysql_muãx_u∆ock
(&
önoba£_sh¨e_muãx
);

12845 
	}
}

12856 
UNIV_INTERN


12857 
THR_LOCK_DATA
**

12858 
	gha_önoba£
::
	$°‹e_lock
(

12860 
THD
* 
thd
,

12861 
THR_LOCK_DATA
** 
to
,

12866 
thr_lock_ty≥
 
lock_ty≥
)

12870 
åx_t
* 
åx
;

12876 
åx
 = 
	`check_åx_exi°s
(
thd
);

12885 i‡(
lock_ty≥
 !
TL_IGNORE


12886 && 
åx
->
n_mysql_èbÀs_ö_u£
 == 0) {

12887 
åx
->
isﬁ©i⁄_Àvñ
 = 
	`önoba£_m≠_isﬁ©i⁄_Àvñ
(

12888 (
íum_tx_isﬁ©i⁄
Ë
	`thd_tx_isﬁ©i⁄
(
thd
));

12890 i‡(
åx
->
isﬁ©i⁄_Àvñ
 <
TRX_ISO_READ_COMMITTED


12891 && 
åx
->
globÆ_ªad_võw
) {

12896 
	`ªad_võw_˛o£_f‹_mysql
(
åx
);

12900 
	`DBUG_ASSERT
(
	`EQ_CURRENT_THD
(
thd
));

12901 c⁄° 
boﬁ
 
ö_lock_èbÀs
 = 
	`thd_ö_lock_èbÀs
(
thd
);

12902 c⁄° 
uöt
 
sql_comm™d
 = 
	`thd_sql_comm™d
(
thd
);

12904 i‡(
§v_ªad_⁄ly_mode


12905 && (
sql_comm™d
 =
SQLCOM_UPDATE


12906 || 
sql_comm™d
 =
SQLCOM_INSERT


12907 || 
sql_comm™d
 =
SQLCOM_REPLACE


12908 || 
sql_comm™d
 =
SQLCOM_DROP_TABLE


12909 || 
sql_comm™d
 =
SQLCOM_ALTER_TABLE


12910 || 
sql_comm™d
 =
SQLCOM_OPTIMIZE


12911 || (
sql_comm™d
 =
SQLCOM_CREATE_TABLE


12912 && (
lock_ty≥
 >
TL_WRITE_CONCURRENT_INSERT


12913 && 
lock_ty≥
 <
TL_WRITE
))

12914 || 
sql_comm™d
 =
SQLCOM_CREATE_INDEX


12915 || 
sql_comm™d
 =
SQLCOM_DROP_INDEX


12916 || 
sql_comm™d
 =
SQLCOM_DELETE
)) {

12918 
	`ib_£ndîrf
(
åx
->
mysql_thd
,

12919 
IB_LOG_LEVEL_WARN
, 
ER_READ_ONLY_MODE
);

12921 } i‡(
sql_comm™d
 =
SQLCOM_FLUSH


12922 && 
lock_ty≥
 =
TL_READ_NO_INSERT
) {

12931 
dbîr_t
 
îr
 = 
	`row_quõs˚_£t_°©e
(

12932 
¥ebuût
->
èbÀ
, 
QUIESCE_START
, 
åx
);

12934 
	`ut_a
(
îr
 =
DB_SUCCESS
 ||Éº =
DB_UNSUPPORTED
);

12936 i‡(
åx
->
isﬁ©i⁄_Àvñ
 =
TRX_ISO_SERIALIZABLE
) {

12937 
¥ebuût
->
£À˘_lock_ty≥
 = 
LOCK_S
;

12938 
¥ebuût
->
°‹ed_£À˘_lock_ty≥
 = 
LOCK_S
;

12940 
¥ebuût
->
£À˘_lock_ty≥
 = 
LOCK_NONE
;

12941 
¥ebuût
->
°‹ed_£À˘_lock_ty≥
 = 
LOCK_NONE
;

12945 } i‡(
sql_comm™d
 =
SQLCOM_DROP_TABLE
) {

12952 } i‡((
lock_ty≥
 =
TL_READ
 && 
ö_lock_èbÀs
)

12953 || (
lock_ty≥
 =
TL_READ_HIGH_PRIORITY
 && 
ö_lock_èbÀs
)

12954 || 
lock_ty≥
 =
TL_READ_WITH_SHARED_LOCKS


12955 || 
lock_ty≥
 =
TL_READ_NO_INSERT


12956 || (
lock_ty≥
 !
TL_IGNORE


12957 && 
sql_comm™d
 !
SQLCOM_SELECT
)) {

12979 i‡(
sql_comm™d
 =
SQLCOM_CHECKSUM


12980 || ((
§v_locks_unß„_f‹_bölog


12981 || 
åx
->
isﬁ©i⁄_Àvñ
 <
TRX_ISO_READ_COMMITTED
)

12982 && 
åx
->
isﬁ©i⁄_Àvñ
 !
TRX_ISO_SERIALIZABLE


12983 && (
lock_ty≥
 =
TL_READ


12984 || 
lock_ty≥
 =
TL_READ_NO_INSERT
)

12985 && (
sql_comm™d
 =
SQLCOM_INSERT_SELECT


12986 || 
sql_comm™d
 =
SQLCOM_REPLACE_SELECT


12987 || 
sql_comm™d
 =
SQLCOM_UPDATE


12988 || 
sql_comm™d
 =
SQLCOM_CREATE_TABLE
))) {

13000 
¥ebuût
->
£À˘_lock_ty≥
 = 
LOCK_NONE
;

13001 
¥ebuût
->
°‹ed_£À˘_lock_ty≥
 = 
LOCK_NONE
;

13003 
¥ebuût
->
£À˘_lock_ty≥
 = 
LOCK_S
;

13004 
¥ebuût
->
°‹ed_£À˘_lock_ty≥
 = 
LOCK_S
;

13007 } i‡(
lock_ty≥
 !
TL_IGNORE
) {

13012 
¥ebuût
->
£À˘_lock_ty≥
 = 
LOCK_NONE
;

13013 
¥ebuût
->
°‹ed_£À˘_lock_ty≥
 = 
LOCK_NONE
;

13016 i‡(
lock_ty≥
 !
TL_IGNORE
 && 
lock
.
ty≥
 =
TL_UNLOCK
) {

13026 i‡(
lock_ty≥
 =
TL_READ


13027 && 
sql_comm™d
 =
SQLCOM_LOCK_TABLES
) {

13039 
lock_ty≥
 = 
TL_READ_NO_INSERT
;

13052 i‡((
lock_ty≥
 >
TL_WRITE_CONCURRENT_INSERT


13053 && 
lock_ty≥
 <
TL_WRITE
)

13054 && !(
ö_lock_èbÀs


13055 && 
sql_comm™d
 =
SQLCOM_LOCK_TABLES
)

13056 && !
	`thd_èbÀ•a˚_›
(
thd
)

13057 && 
sql_comm™d
 !
SQLCOM_TRUNCATE


13058 && 
sql_comm™d
 !
SQLCOM_OPTIMIZE


13059 && 
sql_comm™d
 !
SQLCOM_CREATE_TABLE
) {

13061 
lock_ty≥
 = 
TL_WRITE_ALLOW_WRITE
;

13074 i‡(
lock_ty≥
 =
TL_READ_NO_INSERT


13075 && 
sql_comm™d
 !
SQLCOM_LOCK_TABLES
) {

13077 
lock_ty≥
 = 
TL_READ
;

13080 
lock
.
ty≥
 = 
lock_ty≥
;

13083 *
to
++&
lock
;

13085 i‡(!
	`åx_is_°¨ãd
(
åx
)

13086 && (
¥ebuût
->
£À˘_lock_ty≥
 !
LOCK_NONE


13087 || 
¥ebuût
->
°‹ed_£À˘_lock_ty≥
 !
LOCK_NONE
)) {

13089 ++
åx
->
wûl_lock
;

13092 (
to
);

13093 
	}
}

13100 
UNIV_INTERN


13101 
dbîr_t


13102 
	gha_önoba£
::
	$önoba£_gë_autoöc
(

13104 
ul⁄gl⁄g
* 
vÆue
)

13106 *
vÆue
 = 0;

13108 
¥ebuût
->
autoöc_îr‹
 = 
	`önoba£_lock_autoöc
();

13110 i‡(
¥ebuût
->
autoöc_îr‹
 =
DB_SUCCESS
) {

13113 *
vÆue
 = 
	`di˘_èbÀ_autoöc_ªad
(
¥ebuût
->
èbÀ
);

13116 i‡(*
vÆue
 == 0) {

13117 
¥ebuût
->
autoöc_îr‹
 = 
DB_UNSUPPORTED
;

13118 
	`di˘_èbÀ_autoöc_u∆ock
(
¥ebuût
->
èbÀ
);

13122 (
¥ebuût
->
autoöc_îr‹
);

13123 
	}
}

13129 
UNIV_INTERN


13130 
ul⁄gl⁄g


13131 
	gha_önoba£
::
	$önoba£_≥ek_autoöc
()

13134 
ul⁄gl⁄g
 
auto_öc
;

13135 
di˘_èbÀ_t
* 
önodb_èbÀ
;

13137 
	`ut_a
(
¥ebuût
 !
NULL
);

13138 
	`ut_a
(
¥ebuût
->
èbÀ
 !
NULL
);

13140 
önodb_èbÀ
 = 
¥ebuût
->
èbÀ
;

13142 
	`di˘_èbÀ_autoöc_lock
(
önodb_èbÀ
);

13144 
auto_öc
 = 
	`di˘_èbÀ_autoöc_ªad
(
önodb_èbÀ
);

13146 i‡(
auto_öc
 == 0) {

13147 
	`ut_¥öt_time°amp
(
°dîr
);

13148 
	`Ârötf
(
°dîr
, " InnoDB: AUTOINCÇext value generation "

13149 "i†dißbÀd f‹ '%s'\n", 
önodb_èbÀ
->
«me
);

13152 
	`di˘_èbÀ_autoöc_u∆ock
(
önodb_èbÀ
);

13154 (
auto_öc
);

13155 
	}
}

13159 
UNIV_INTERN


13161 
	gha_önoba£
::
	$gë_auto_ö¸emít
(

13163 
ul⁄gl⁄g
 
off£t
,

13164 
ul⁄gl⁄g
 
ö¸emít
,

13166 
ul⁄gl⁄g
 
nb_desúed_vÆues
,

13168 
ul⁄gl⁄g
* 
fú°_vÆue
,

13169 
ul⁄gl⁄g
* 
nb_ª£rved_vÆues
)

13172 
åx_t
* 
åx
;

13173 
dbîr_t
 
îr‹
;

13174 
ul⁄gl⁄g
 
autoöc
 = 0;

13177 
	`upd©e_thd
(
	`ha_thd
());

13179 
îr‹
 = 
	`önoba£_gë_autoöc
(&
autoöc
);

13181 i‡(
îr‹
 !
DB_SUCCESS
) {

13182 *
fú°_vÆue
 = (~(
ul⁄gl⁄g
) 0);

13194 
åx
 = 
¥ebuût
->trx;

13203 
ul⁄gl⁄g
 
cﬁ_max_vÆue
 = 
	`önoba£_gë_öt_cﬁ_max_vÆue
(

13204 
èbÀ
->
√xt_numbî_fõld
);

13207 i‡(
åx
->
n_autoöc_rows
 == 0) {

13209 
åx
->
n_autoöc_rows
 = (
ulöt
Ë
nb_desúed_vÆues
;

13213 i‡(
nb_desúed_vÆues
 == 0) {

13215 
åx
->
n_autoöc_rows
 = 1;

13218 
	`£t_if_biggî
(*
fú°_vÆue
, 
autoöc
);

13220 } i‡(
¥ebuût
->
autoöc_œ°_vÆue
 == 0) {

13221 
	`£t_if_biggî
(*
fú°_vÆue
, 
autoöc
);

13223 } i‡(*
fú°_vÆue
 > 
cﬁ_max_vÆue
 && 
åx
->
n_autoöc_rows
 > 0) {

13225 
	`ut_a
(
autoöc
 > 
åx
->
n_autoöc_rows
);

13226 *
fú°_vÆue
 = (
autoöc
 - 
åx
->
n_autoöc_rows
) - 1;

13229 *
nb_ª£rved_vÆues
 = 
åx
->
n_autoöc_rows
;

13233 i‡(
önoba£_autoöc_lock_mode
 !
AUTOINC_OLD_STYLE_LOCKING
) {

13234 
ul⁄gl⁄g
 
cuºít
;

13235 
ul⁄gl⁄g
 
√xt_vÆue
;

13237 
cuºít
 = *
fú°_vÆue
 > 
cﬁ_max_vÆue
 ? 
autoöc
 : *first_value;

13242 i‡(
¥ebuût
->
autoöc_ö¸emít
 > 
ö¸emít
) {

13244 
cuºít
 = 
autoöc
 - 
¥ebuût
->
autoöc_ö¸emít
;

13246 
cuºít
 = 
	`önoba£_√xt_autoöc
(

13247 
cuºít
, 1, 
ö¸emít
, 1, 
cﬁ_max_vÆue
);

13249 
	`di˘_èbÀ_autoöc_öôülize
(
¥ebuût
->
èbÀ
, 
cuºít
);

13251 *
fú°_vÆue
 = 
cuºít
;

13255 
√xt_vÆue
 = 
	`önoba£_√xt_autoöc
(

13256 
cuºít
, *
nb_ª£rved_vÆues
, 
ö¸emít
, 
off£t
,

13257 
cﬁ_max_vÆue
);

13259 
¥ebuût
->
autoöc_œ°_vÆue
 = 
√xt_vÆue
;

13261 i‡(
¥ebuût
->
autoöc_œ°_vÆue
 < *
fú°_vÆue
) {

13262 *
fú°_vÆue
 = (~(
ul⁄gl⁄g
) 0);

13265 
	`di˘_èbÀ_autoöc_upd©e_if_gª©î
(

13266 
¥ebuût
->
èbÀ
,Öªbuût->
autoöc_œ°_vÆue
);

13271 
¥ebuût
->
autoöc_œ°_vÆue
 = 0;

13278 
¥ebuût
->
autoöc_off£t
 = 
off£t
;

13279 
¥ebuût
->
autoöc_ö¸emít
 = 
ö¸emít
;

13281 
	`di˘_èbÀ_autoöc_u∆ock
(
¥ebuût
->
èbÀ
);

13282 
	}
}

13290 
UNIV_INTERN


13292 
	gha_önoba£
::
	$ª£t_auto_ö¸emít
(

13294 
ul⁄gl⁄g
 
vÆue
)

13296 
	`DBUG_ENTER
("ha_innobase::reset_auto_increment");

13298 
dbîr_t
 
îr‹
;

13300 
	`upd©e_thd
(
	`ha_thd
());

13302 
îr‹
 = 
	`row_lock_èbÀ_autoöc_f‹_mysql
(
¥ebuût
);

13304 i‡(
îr‹
 !
DB_SUCCESS
) {

13305 
	`DBUG_RETURN
(
	`c⁄vît_îr‹_code_to_mysql
(

13306 
îr‹
, 
¥ebuût
->
èbÀ
->
Êags
, 
u£r_thd
));

13310 i‡(
vÆue
 == 0) {

13311 
vÆue
 = 1;

13314 
	`önoba£_ª£t_autoöc
(
vÆue
);

13316 
	`DBUG_RETURN
(0);

13317 
	}
}

13321 
UNIV_INTERN


13322 
boﬁ


13323 
	gha_önoba£
::
	$gë_îr‹_mesßge
(

13325 
îr‹
,

13326 
Såög
* 
buf
)

13328 
åx_t
* 
åx
 = 
	`check_åx_exi°s
(
	`ha_thd
());

13330 
buf
->
	`c›y
(
åx
->
dëaûed_îr‹
, (
uöt
Ë
	`°æí
(trx->detailed_error),

13331 
sy°em_ch¨£t_öfo
);

13333 (
FALSE
);

13334 
	}
}

13354 
boﬁ


13355 
	gha_önoba£
::
	$gë_f‹eign_dup_key
(

13357 * 
chûd_èbÀ_«me
,

13358 
uöt
 
chûd_èbÀ_«me_Àn
,

13359 * 
chûd_key_«me
,

13360 
uöt
 
chûd_key_«me_Àn
)

13362 c⁄° 
di˘_ödex_t
* 
îr_ödex
;

13364 
	`ut_a
(
¥ebuût
->
åx
 !
NULL
);

13365 
	`ut_a
(
¥ebuût
->
åx
->
magic_n
 =
TRX_MAGIC_N
);

13367 
îr_ödex
 = 
	`åx_gë_îr‹_öfo
(
¥ebuût
->
åx
);

13369 i‡(
îr_ödex
 =
NULL
) {

13370 (
Ál£
);

13376 * 
p
;

13377 
p
 = 
	`°rchr
(
îr_ödex
->
èbÀ
->
«me
, '/');

13379 i‡(
p
 !
NULL
) {

13380 
p
++;

13382 
p
 = 
îr_ödex
->
èbÀ
->
«me
;

13384 
uöt
 
Àn
;

13385 
Àn
 = 
	`fûíame_to_èbÀ«me
(
p
, 
chûd_èbÀ_«me
, 
chûd_èbÀ_«me_Àn
);

13386 
chûd_èbÀ_«me
[
Àn
] = '\0';

13389 
	`ut_¢¥ötf
(
chûd_key_«me
, 
chûd_key_«me_Àn
, "%s", 
îr_ödex
->
«me
);

13391 (
åue
);

13392 
	}
}

13399 
UNIV_INTERN


13401 
	gha_önoba£
::
	$cmp_ªf
(

13403 c⁄° 
uch¨
* 
ªf1
,

13405 c⁄° 
uch¨
* 
ªf2
)

13408 
íum_fõld_ty≥s
 
mysql_ty≥
;

13409 
Fõld
* 
fõld
;

13410 
KEY_PART_INFO
* 
key_∑π
;

13411 
KEY_PART_INFO
* 
key_∑π_íd
;

13412 
uöt
 
Àn1
;

13413 
uöt
 
Àn2
;

13414 
ªsu…
;

13416 i‡(
¥ebuût
->
˛u°_ödex_was_gíî©ed
) {

13419 (
	`memcmp
(
ªf1
, 
ªf2
, 
DATA_ROW_ID_LEN
));

13425 
key_∑π
 = 
èbÀ
->
key_öfo
[èbÀ->
s
->
¥im¨y_key
].key_part;

13427 
key_∑π_íd
 = 
key_∑π


13428 + 
èbÀ
->
key_öfo
[èbÀ->
s
->
¥im¨y_key
].
u£r_deföed_key_∑πs
;

13430 ; 
key_∑π
 !
key_∑π_íd
; ++key_part) {

13431 
fõld
 = 
key_∑π
->field;

13432 
mysql_ty≥
 = 
fõld
->
	`ty≥
();

13434 i‡(
mysql_ty≥
 =
MYSQL_TYPE_TINY_BLOB


13435 || 
mysql_ty≥
 =
MYSQL_TYPE_MEDIUM_BLOB


13436 || 
mysql_ty≥
 =
MYSQL_TYPE_BLOB


13437 || 
mysql_ty≥
 =
MYSQL_TYPE_LONG_BLOB
) {

13442 
Àn1
 = 
	`önoba£_ªad_‰om_2_lôée_ídün
(
ªf1
);

13443 
Àn2
 = 
	`önoba£_ªad_‰om_2_lôée_ídün
(
ªf2
);

13445 
ªsu…
 = ((
Fõld_blob
*Ë
fõld
)->
	`cmp
(

13446 
ªf1
 + 2, 
Àn1
, 
ªf2
 + 2, 
Àn2
);

13448 
ªsu…
 = 
fõld
->
	`key_cmp
(
ªf1
, 
ªf2
);

13451 i‡(
ªsu…
) {

13453 (
ªsu…
);

13456 
ªf1
 +
key_∑π
->
°‹e_Àngth
;

13457 
ªf2
 +
key_∑π
->
°‹e_Àngth
;

13461 
	}
}

13466 
UNIV_INTERN


13467 
my_boﬁ


13468 
	gha_önoba£
::
	$ªgi°î_quîy_ˇche_èbÀ
(

13470 
THD
* 
thd
,

13471 * 
èbÀ_key
,

13473 
uöt
 
key_Àngth
,

13475 
qc_ígöe_ˇŒback
*

13476 
ˇŒ_back
,

13479 
ul⁄gl⁄g
 *
ígöe_d©a
)

13481 *
ˇŒ_back
 = 
önoba£_quîy_ˇchög_of_èbÀ_≥rmôãd
;

13482 *
ígöe_d©a
 = 0;

13483 (
	`önoba£_quîy_ˇchög_of_èbÀ_≥rmôãd
(
thd
, 
èbÀ_key
,

13484 
key_Àngth
,

13485 
ígöe_d©a
));

13486 
	}
}

13490 
UNIV_INTERN


13492 
	gha_önoba£
::
	$gë_mysql_bö_log_«me
()

13495 (
åx_sys_mysql_bö_log_«me
);

13496 
	}
}

13500 
UNIV_INTERN


13501 
ul⁄gl⁄g


13502 
	gha_önoba£
::
	$gë_mysql_bö_log_pos
()

13508 (
åx_sys_mysql_bö_log_pos
);

13509 
	}
}

13517 
UNIV_INTERN


13518 
ulöt


13519 
	$önoba£_gë_©_mo°_n_mbch¨s
(

13521 
ulöt
 
ch¨£t_id
,

13522 
ulöt
 
¥efix_Àn
,

13525 
ulöt
 
d©a_Àn
,

13526 c⁄° * 
°r
)

13528 
ulöt
 
ch¨_Àngth
;

13529 
ulöt
 
n_ch¨s
;

13530 
CHARSET_INFO
* 
ch¨£t
;

13532 
ch¨£t
 = 
	`gë_ch¨£t
((
uöt
Ë
ch¨£t_id
, 
	`MYF
(
MY_WME
));

13534 
	`ut_ad
(
ch¨£t
);

13535 
	`ut_ad
(
ch¨£t
->
mbmaxÀn
);

13539 
n_ch¨s
 = 
¥efix_Àn
 / 
ch¨£t
->
mbmaxÀn
;

13546 i‡(
ch¨£t
->
mbmaxÀn
 > 1) {

13565 
ch¨_Àngth
 = 
	`my_ch¨pos
(
ch¨£t
, 
°r
,

13566 
°r
 + 
d©a_Àn
, (Ë
n_ch¨s
);

13567 i‡(
ch¨_Àngth
 > 
d©a_Àn
) {

13568 
ch¨_Àngth
 = 
d©a_Àn
;

13571 i‡(
d©a_Àn
 < 
¥efix_Àn
) {

13572 
ch¨_Àngth
 = 
d©a_Àn
;

13574 
ch¨_Àngth
 = 
¥efix_Àn
;

13578 (
ch¨_Àngth
);

13579 
	}
}

13586 
	$önoba£_xa_¥ï¨e
(

13588 
h™dÀπ⁄
* 
ht⁄
,

13589 
THD
* 
thd
,

13592 
boﬁ
 
¥ï¨e_åx
)

13596 
îr‹
 = 0;

13597 
åx_t
* 
åx
 = 
	`check_åx_exi°s
(
thd
);

13599 
	`DBUG_ASSERT
(
ht⁄
 =
önodb_ht⁄_±r
);

13604 i‡(!
åx
->
suµ‹t_xa
) {

13609 
	`thd_gë_xid
(
thd
, (
MYSQL_XID
*Ë&
åx
->
xid
);

13615 
	`åx_£¨ch_œtch_ªÀa£_if_ª£rved
(
åx
);

13617 
	`önoba£_§v_c⁄c_f‹˚_exô_önodb
(
åx
);

13619 i‡(!
	`åx_is_ªgi°îed_f‹_2pc
(
åx
Ë&& 
	`åx_is_°¨ãd
(trx)) {

13621 
	`sql_¥öt_îr‹
("TransactionÇotÑegistered for MySQL 2PC, "

13625 i‡(
¥ï¨e_åx


13626 || (!
	`thd_ã°_›ti⁄s
(
thd
, 
OPTION_NOT_AUTOCOMMIT
 | 
OPTION_BEGIN
))) {

13631 
	`ut_ad
(
	`åx_is_ªgi°îed_f‹_2pc
(
åx
));

13633 
	`åx_¥ï¨e_f‹_mysql
(
åx
);

13635 
îr‹
 = 0;

13643 
	`lock_u∆ock_èbÀ_autoöc
(
åx
);

13649 
	`åx_m¨k_sql_°©_íd
(
åx
);

13652 i‡(
	`thd_sql_comm™d
(
thd
Ë!
SQLCOM_XA_PREPARE


13653 && (
¥ï¨e_åx


13654 || !
	`thd_ã°_›ti⁄s
(

13655 
thd
, 
OPTION_NOT_AUTOCOMMIT
 | 
OPTION_BEGIN
))) {

13670 (
îr‹
);

13671 
	}
}

13678 
	$önoba£_xa_ªcovî
(

13680 
h™dÀπ⁄
* 
ht⁄
,

13681 
XID
* 
xid_li°
,

13682 
uöt
 
Àn
)

13684 
	`DBUG_ASSERT
(
ht⁄
 =
önodb_ht⁄_±r
);

13686 i‡(
Àn
 =0 || 
xid_li°
 =
NULL
) {

13691 (
	`åx_ªcovî_f‹_mysql
(
xid_li°
, 
Àn
));

13692 
	}
}

13700 
	$önoba£_commô_by_xid
(

13702 
h™dÀπ⁄
* 
ht⁄
,

13703 
XID
* 
xid
)

13705 
åx_t
* 
åx
;

13707 
	`DBUG_ASSERT
(
ht⁄
 =
önodb_ht⁄_±r
);

13709 
åx
 = 
	`åx_gë_åx_by_xid
(
xid
);

13711 i‡(
åx
) {

13712 
	`önoba£_commô_low
(
åx
);

13713 
	`åx_‰ì_f‹_background
(
åx
);

13714 (
XA_OK
);

13716 (
XAER_NOTA
);

13718 
	}
}

13726 
	$önoba£_rﬁlback_by_xid
(

13728 
h™dÀπ⁄
* 
ht⁄
,

13729 
XID
* 
xid
)

13732 
åx_t
* 
åx
;

13734 
	`DBUG_ASSERT
(
ht⁄
 =
önodb_ht⁄_±r
);

13736 
åx
 = 
	`åx_gë_åx_by_xid
(
xid
);

13738 i‡(
åx
) {

13739 
ªt
 = 
	`önoba£_rﬁlback_åx
(
åx
);

13740 
	`åx_‰ì_f‹_background
(
åx
);

13741 (
ªt
);

13743 (
XAER_NOTA
);

13745 
	}
}

13755 
	$önoba£_¸óã_curs‹_võw
(

13757 
h™dÀπ⁄
* 
ht⁄
,

13758 
THD
* 
thd
)

13760 
	`DBUG_ASSERT
(
ht⁄
 =
önodb_ht⁄_±r
);

13762 (
	`ªad_curs‹_võw_¸óã_f‹_mysql
(
	`check_åx_exi°s
(
thd
)));

13763 
	}
}

13771 
	$önoba£_˛o£_curs‹_võw
(

13773 
h™dÀπ⁄
* 
ht⁄
,

13774 
THD
* 
thd
,

13775 * 
curvõw
)

13777 
	`DBUG_ASSERT
(
ht⁄
 =
önodb_ht⁄_±r
);

13779 
	`ªad_curs‹_võw_˛o£_f‹_mysql
(
	`check_åx_exi°s
(
thd
),

13780 (
curs‹_võw_t
*Ë
curvõw
);

13781 
	}
}

13790 
	$önoba£_£t_curs‹_võw
(

13792 
h™dÀπ⁄
* 
ht⁄
,

13793 
THD
* 
thd
,

13794 * 
curvõw
)

13796 
	`DBUG_ASSERT
(
ht⁄
 =
önodb_ht⁄_±r
);

13798 
	`ªad_curs‹_£t_f‹_mysql
(
	`check_åx_exi°s
(
thd
),

13799 (
curs‹_võw_t
*Ë
curvõw
);

13800 
	}
}

13804 
UNIV_INTERN


13805 
boﬁ


13806 
	gha_önoba£
::
	$check_if_öcom∑tibÀ_d©a
(

13808 
HA_CREATE_INFO
* 
öfo
,

13809 
uöt
 
èbÀ_ch™ges
)

13811 
	`önoba£_c›y_‰m_Êags_‰om_¸óã_öfo
(
¥ebuût
->
èbÀ
, 
öfo
);

13813 i‡(
èbÀ_ch™ges
 !
IS_EQUAL_YES
) {

13815 (
COMPATIBLE_DATA_NO
);

13819 i‡((
öfo
->
u£d_fõlds
 & 
HA_CREATE_USED_AUTO
) &&

13820 
öfo
->
auto_ö¸emít_vÆue
 != 0) {

13822 (
COMPATIBLE_DATA_NO
);

13826 i‡((
öfo
->
u£d_fõlds
 & 
HA_CREATE_USED_ROW_FORMAT
)

13827 && 
öfo
->
row_ty≥
 !
	`gë_row_ty≥
()) {

13829 (
COMPATIBLE_DATA_NO
);

13833 i‡(
öfo
->
u£d_fõlds
 & 
HA_CREATE_USED_KEY_BLOCK_SIZE
) {

13834 (
COMPATIBLE_DATA_NO
);

13837 (
COMPATIBLE_DATA_YES
);

13838 
	}
}

13845 
	$önodb_io_ˇ∑côy_max_upd©e
(

13847 
THD
* 
thd
,

13848 
°_mysql_sys_v¨
* 
v¨
,

13850 * 
v¨_±r
,

13852 c⁄° * 
ßve
)

13855 
ul⁄g
 
ö_vÆ
 = *
°©ic_ˇ°
<c⁄° ul⁄g*>(
ßve
);

13856 i‡(
ö_vÆ
 < 
§v_io_ˇ∑côy
) {

13857 
ö_vÆ
 = 
§v_io_ˇ∑côy
;

13858 
	`push_w¨nög_¥ötf
(
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

13859 
ER_WRONG_ARGUMENTS
,

13862 
	`push_w¨nög_¥ötf
(
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

13863 
ER_WRONG_ARGUMENTS
,

13865 
§v_io_ˇ∑côy
);

13868 
§v_max_io_ˇ∑côy
 = 
ö_vÆ
;

13869 
	}
}

13876 
	$önodb_io_ˇ∑côy_upd©e
(

13878 
THD
* 
thd
,

13879 
°_mysql_sys_v¨
* 
v¨
,

13881 * 
v¨_±r
,

13883 c⁄° * 
ßve
)

13886 
ul⁄g
 
ö_vÆ
 = *
°©ic_ˇ°
<c⁄° ul⁄g*>(
ßve
);

13887 i‡(
ö_vÆ
 > 
§v_max_io_ˇ∑côy
) {

13888 
ö_vÆ
 = 
§v_max_io_ˇ∑côy
;

13889 
	`push_w¨nög_¥ötf
(
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

13890 
ER_WRONG_ARGUMENTS
,

13893 
	`push_w¨nög_¥ötf
(
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

13894 
ER_WRONG_ARGUMENTS
,

13896 
§v_max_io_ˇ∑côy
);

13899 
§v_io_ˇ∑côy
 = 
ö_vÆ
;

13900 
	}
}

13907 
	$önodb_max_dúty_∑ges_p˘_upd©e
(

13909 
THD
* 
thd
,

13910 
°_mysql_sys_v¨
* 
v¨
,

13912 * 
v¨_±r
,

13914 c⁄° * 
ßve
)

13917 
ul⁄g
 
ö_vÆ
 = *
°©ic_ˇ°
<c⁄° ul⁄g*>(
ßve
);

13918 i‡(
ö_vÆ
 < 
§v_max_dúty_∑ges_p˘_lwm
) {

13919 
	`push_w¨nög_¥ötf
(
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

13920 
ER_WRONG_ARGUMENTS
,

13924 
	`push_w¨nög_¥ötf
(
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

13925 
ER_WRONG_ARGUMENTS
,

13928 
ö_vÆ
);

13930 
§v_max_dúty_∑ges_p˘_lwm
 = 
ö_vÆ
;

13933 
§v_max_buf_poﬁ_modifõd_p˘
 = 
ö_vÆ
;

13934 
	}
}

13941 
	$önodb_max_dúty_∑ges_p˘_lwm_upd©e
(

13943 
THD
* 
thd
,

13944 
°_mysql_sys_v¨
* 
v¨
,

13946 * 
v¨_±r
,

13948 c⁄° * 
ßve
)

13951 
ul⁄g
 
ö_vÆ
 = *
°©ic_ˇ°
<c⁄° ul⁄g*>(
ßve
);

13952 i‡(
ö_vÆ
 > 
§v_max_buf_poﬁ_modifõd_p˘
) {

13953 
ö_vÆ
 = 
§v_max_buf_poﬁ_modifõd_p˘
;

13954 
	`push_w¨nög_¥ötf
(
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

13955 
ER_WRONG_ARGUMENTS
,

13959 
	`push_w¨nög_¥ötf
(
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

13960 
ER_WRONG_ARGUMENTS
,

13963 
ö_vÆ
);

13966 
§v_max_dúty_∑ges_p˘_lwm
 = 
ö_vÆ
;

13967 
	}
}

13973 
uöt


13974 
	$önoba£_fûe_f‹m©_«me_lookup
(

13976 c⁄° * 
f‹m©_«me
)

13978 * 
ídp
;

13979 
uöt
 
f‹m©_id
;

13981 
	`ut_a
(
f‹m©_«me
 !
NULL
);

13985 
f‹m©_id
 = (
uöt
Ë
	`°πoul
(
f‹m©_«me
, &
ídp
, 10);

13988 i‡(*
ídp
 ='\0' && *
f‹m©_«me
 != '\0') {

13990 i‡(
f‹m©_id
 <
UNIV_FORMAT_MAX
) {

13992 (
f‹m©_id
);

13996 
f‹m©_id
 = 0; f‹m©_id <
UNIV_FORMAT_MAX
;

13997 
f‹m©_id
++) {

13998 c⁄° * 
«me
;

14000 
«me
 = 
	`åx_sys_fûe_f‹m©_id_to_«me
(
f‹m©_id
);

14002 i‡(!
	`önoba£_°rˇ£cmp
(
f‹m©_«me
, 
«me
)) {

14004 (
f‹m©_id
);

14009 (
UNIV_FORMAT_MAX
 + 1);

14010 
	}
}

14018 
	$önoba£_fûe_f‹m©_vÆid©e_™d_£t
(

14020 c⁄° * 
f‹m©_max
)

14022 
uöt
 
f‹m©_id
;

14024 
f‹m©_id
 = 
	`önoba£_fûe_f‹m©_«me_lookup
(
f‹m©_max
);

14026 i‡(
f‹m©_id
 < 
UNIV_FORMAT_MAX
 + 1) {

14027 
§v_max_fûe_f‹m©_©_°¨tup
 = 
f‹m©_id
;

14029 ((Ë
f‹m©_id
);

14033 
	}
}

14041 
	$önodb_fûe_f‹m©_«me_vÆid©e
(

14043 
THD
* 
thd
,

14044 
°_mysql_sys_v¨
* 
v¨
,

14046 * 
ßve
,

14048 
°_mysql_vÆue
* 
vÆue
)

14050 c⁄° * 
fûe_f‹m©_öput
;

14051 
buff
[
STRING_BUFFER_USUAL_SIZE
];

14052 
Àn
 = (
buff
);

14054 
	`ut_a
(
ßve
 !
NULL
);

14055 
	`ut_a
(
vÆue
 !
NULL
);

14057 
fûe_f‹m©_öput
 = 
vÆue
->
	`vÆ_°r
(vÆue, 
buff
, &
Àn
);

14059 i‡(
fûe_f‹m©_öput
 !
NULL
) {

14060 
uöt
 
f‹m©_id
;

14062 
f‹m©_id
 = 
	`önoba£_fûe_f‹m©_«me_lookup
(

14063 
fûe_f‹m©_öput
);

14065 i‡(
f‹m©_id
 <
UNIV_FORMAT_MAX
) {

14069 *
°©ic_ˇ°
<c⁄° **>(
ßve
) =

14070 
	`åx_sys_fûe_f‹m©_id_to_«me
(
f‹m©_id
);

14076 *
°©ic_ˇ°
<c⁄° **>(
ßve
Ë
NULL
;

14078 
	}
}

14085 
	$önodb_fûe_f‹m©_«me_upd©e
(

14087 
THD
* 
thd
,

14088 
°_mysql_sys_v¨
* 
v¨
,

14090 * 
v¨_±r
,

14092 c⁄° * 
ßve
)

14095 c⁄° * 
f‹m©_«me
;

14097 
	`ut_a
(
v¨_±r
 !
NULL
);

14098 
	`ut_a
(
ßve
 !
NULL
);

14100 
f‹m©_«me
 = *
°©ic_ˇ°
<c⁄° *c⁄°*>(
ßve
);

14102 i‡(
f‹m©_«me
) {

14103 
uöt
 
f‹m©_id
;

14105 
f‹m©_id
 = 
	`önoba£_fûe_f‹m©_«me_lookup
(
f‹m©_«me
);

14107 i‡(
f‹m©_id
 <
UNIV_FORMAT_MAX
) {

14108 
§v_fûe_f‹m©
 = 
f‹m©_id
;

14112 *
°©ic_ˇ°
<c⁄° **>(
v¨_±r
)

14113 
	`åx_sys_fûe_f‹m©_id_to_«me
(
§v_fûe_f‹m©
);

14114 
	}
}

14122 
	$önodb_fûe_f‹m©_max_vÆid©e
(

14124 
THD
* 
thd
,

14125 
°_mysql_sys_v¨
* 
v¨
,

14127 * 
ßve
,

14129 
°_mysql_vÆue
* 
vÆue
)

14131 c⁄° * 
fûe_f‹m©_öput
;

14132 
buff
[
STRING_BUFFER_USUAL_SIZE
];

14133 
Àn
 = (
buff
);

14134 
f‹m©_id
;

14136 
	`ut_a
(
ßve
 !
NULL
);

14137 
	`ut_a
(
vÆue
 !
NULL
);

14139 
fûe_f‹m©_öput
 = 
vÆue
->
	`vÆ_°r
(vÆue, 
buff
, &
Àn
);

14141 i‡(
fûe_f‹m©_öput
 !
NULL
) {

14143 
f‹m©_id
 = 
	`önoba£_fûe_f‹m©_vÆid©e_™d_£t
(

14144 
fûe_f‹m©_öput
);

14146 i‡(
f‹m©_id
 >= 0) {

14149 *
°©ic_ˇ°
<c⁄° **>(
ßve
) =

14150 
	`åx_sys_fûe_f‹m©_id_to_«me
(

14151 (
uöt
Ë
f‹m©_id
);

14156 
	`push_w¨nög_¥ötf
(
thd
,

14157 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

14158 
ER_WRONG_ARGUMENTS
,

14162 
	`åx_sys_fûe_f‹m©_id_to_«me
(
UNIV_FORMAT_MAX
),

14163 
UNIV_FORMAT_MAX
);

14167 *
°©ic_ˇ°
<c⁄° **>(
ßve
Ë
NULL
;

14169 
	}
}

14176 
	$önodb_fûe_f‹m©_max_upd©e
(

14178 
THD
* 
thd
,

14179 
°_mysql_sys_v¨
* 
v¨
,

14181 * 
v¨_±r
,

14183 c⁄° * 
ßve
)

14186 c⁄° * 
f‹m©_«me_ö
;

14187 c⁄° ** 
f‹m©_«me_out
;

14188 
uöt
 
f‹m©_id
;

14190 
	`ut_a
(
ßve
 !
NULL
);

14191 
	`ut_a
(
v¨_±r
 !
NULL
);

14193 
f‹m©_«me_ö
 = *
°©ic_ˇ°
<c⁄° *c⁄°*>(
ßve
);

14195 i‡(!
f‹m©_«me_ö
) {

14200 
f‹m©_id
 = 
	`önoba£_fûe_f‹m©_«me_lookup
(
f‹m©_«me_ö
);

14202 i‡(
f‹m©_id
 > 
UNIV_FORMAT_MAX
) {

14204 
	`push_w¨nög_¥ötf
(
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

14205 
ER_WRONG_ARGUMENTS
,

14207 
f‹m©_«me_ö
);

14211 
f‹m©_«me_out
 = 
°©ic_ˇ°
<c⁄° **>(
v¨_±r
);

14214 i‡(
	`åx_sys_fûe_f‹m©_max_£t
(
f‹m©_id
, 
f‹m©_«me_out
)) {

14215 
	`ut_¥öt_time°amp
(
°dîr
);

14216 
	`Ârötf
(
°dîr
,

14218 "èbÀ•a˚ i†now sëÅÿ%s.\n", *
f‹m©_«me_out
);

14220 
	}
}

14228 
	$önodb_°›w‹d_èbÀ_vÆid©e
(

14230 
THD
* 
thd
,

14231 
°_mysql_sys_v¨
* 
v¨
,

14233 * 
ßve
,

14235 
°_mysql_vÆue
* 
vÆue
)

14237 c⁄° * 
°›w‹d_èbÀ_«me
;

14238 
buff
[
STRING_BUFFER_USUAL_SIZE
];

14239 
Àn
 = (
buff
);

14240 
åx_t
* 
åx
;

14241 
ªt
 = 1;

14243 
	`ut_a
(
ßve
 !
NULL
);

14244 
	`ut_a
(
vÆue
 !
NULL
);

14246 
°›w‹d_èbÀ_«me
 = 
vÆue
->
	`vÆ_°r
(vÆue, 
buff
, &
Àn
);

14248 
åx
 = 
	`check_åx_exi°s
(
thd
);

14250 
	`row_mysql_lock_d©a_di˘i⁄¨y
(
åx
);

14254 i‡(!
°›w‹d_èbÀ_«me


14255 || 
	`·s_vÆid_°›w‹d_èbÀ
(
°›w‹d_èbÀ_«me
)) {

14256 *
°©ic_ˇ°
<c⁄° **>(
ßve
Ë
°›w‹d_èbÀ_«me
;

14257 
ªt
 = 0;

14260 
	`row_mysql_u∆ock_d©a_di˘i⁄¨y
(
åx
);

14262 (
ªt
);

14263 
	}
}

14271 
	$önodb_öã∫Æ_èbÀ_vÆid©e
(

14273 
THD
* 
thd
,

14274 
°_mysql_sys_v¨
* 
v¨
,

14276 * 
ßve
,

14278 
°_mysql_vÆue
* 
vÆue
)

14280 c⁄° * 
èbÀ_«me
;

14281 
buff
[
STRING_BUFFER_USUAL_SIZE
];

14282 
Àn
 = (
buff
);

14283 
ªt
 = 1;

14284 
di˘_èbÀ_t
* 
u£r_èbÀ
;

14286 
	`ut_a
(
ßve
 !
NULL
);

14287 
	`ut_a
(
vÆue
 !
NULL
);

14289 
èbÀ_«me
 = 
vÆue
->
	`vÆ_°r
(vÆue, 
buff
, &
Àn
);

14291 i‡(!
èbÀ_«me
) {

14292 *
°©ic_ˇ°
<c⁄° **>(
ßve
Ë
NULL
;

14296 
u£r_èbÀ
 = 
	`di˘_èbÀ_›í_⁄_«me
(

14297 
èbÀ_«me
, 
FALSE
, 
TRUE
, 
DICT_ERR_IGNORE_NONE
);

14299 i‡(
u£r_èbÀ
) {

14300 i‡(
	`di˘_èbÀ_has_·s_ödex
(
u£r_èbÀ
)) {

14301 *
°©ic_ˇ°
<c⁄° **>(
ßve
Ë
èbÀ_«me
;

14302 
ªt
 = 0;

14305 
	`di˘_èbÀ_˛o£
(
u£r_èbÀ
, 
FALSE
, 
TRUE
);

14308 (
ªt
);

14309 
	}
}

14317 
	$önodb_öã∫Æ_èbÀ_upd©e
(

14319 
THD
* 
thd
,

14320 
°_mysql_sys_v¨
* 
v¨
,

14322 * 
v¨_±r
,

14324 c⁄° * 
ßve
)

14327 c⁄° * 
èbÀ_«me
;

14328 * 
ﬁd
;

14330 
	`ut_a
(
ßve
 !
NULL
);

14331 
	`ut_a
(
v¨_±r
 !
NULL
);

14333 
èbÀ_«me
 = *
°©ic_ˇ°
<c⁄° *c⁄°*>(
ßve
);

14334 
ﬁd
 = *(**Ë
v¨_±r
;

14336 i‡(
èbÀ_«me
) {

14337 *(**Ë
v¨_±r
 = 
	`my_°rdup
(
èbÀ_«me
, 
	`MYF
(0));

14339 *(**Ë
v¨_±r
 = 
NULL
;

14342 i‡(
ﬁd
) {

14343 
	`my_‰ì
(
ﬁd
);

14346 
·s_öã∫Æ_tbl_«me
 = *(**Ë
v¨_±r
;

14347 
	}
}

14354 
	$önodb_ad≠tive_hash_ödex_upd©e
(

14356 
THD
* 
thd
,

14357 
°_mysql_sys_v¨
* 
v¨
,

14359 * 
v¨_±r
,

14361 c⁄° * 
ßve
)

14364 i‡(*(
my_boﬁ
*Ë
ßve
) {

14365 
	`bå_£¨ch_íabÀ
();

14367 
	`bå_£¨ch_dißbÀ
();

14369 
	}
}

14376 
	$önodb_cmp_≥r_ödex_upd©e
(

14378 
THD
* 
thd
,

14379 
°_mysql_sys_v¨
* 
v¨
,

14381 * 
v¨_±r
,

14383 c⁄° * 
ßve
)

14388 i‡(!
§v_cmp_≥r_ödex_íabÀd
 && *(
my_boﬁ
*Ë
ßve
) {

14389 
	`∑ge_zù_ª£t_°©_≥r_ödex
();

14392 
§v_cmp_≥r_ödex_íabÀd
 = !!(*(
my_boﬁ
*Ë
ßve
);

14393 
	}
}

14400 
	$önodb_ﬁd_blocks_p˘_upd©e
(

14402 
THD
* 
thd
,

14403 
°_mysql_sys_v¨
* 
v¨
,

14405 * 
v¨_±r
,

14407 c⁄° * 
ßve
)

14410 
önoba£_ﬁd_blocks_p˘
 = 
°©ic_ˇ°
<
uöt
>(

14411 
	`buf_LRU_ﬁd_øtio_upd©e
(

14412 *
°©ic_ˇ°
<c⁄° 
uöt
*>(
ßve
), 
TRUE
));

14413 
	}
}

14420 
	$önodb_ch™ge_buf„r_max_size_upd©e
(

14422 
THD
* 
thd
,

14423 
°_mysql_sys_v¨
* 
v¨
,

14425 * 
v¨_±r
,

14427 c⁄° * 
ßve
)

14430 
önoba£_ch™ge_buf„r_max_size
 =

14431 (*
°©ic_ˇ°
<c⁄° 
uöt
*>(
ßve
));

14432 
	`ibuf_max_size_upd©e
(
önoba£_ch™ge_buf„r_max_size
);

14433 
	}
}

14435 #ifde‡
UNIV_DEBUG


14436 
ul⁄g
 
	g§v_fû_make_∑ge_dúty_debug
 = 0;

14437 
ul⁄g
 
	g§v_ßved_∑ge_numbî_debug
 = 0;

14443 
	$önodb_ßve_∑ge_no
(

14445 
THD
* 
thd
,

14446 
°_mysql_sys_v¨
* 
v¨
,

14448 * 
v¨_±r
,

14450 c⁄° * 
ßve
)

14453 
§v_ßved_∑ge_numbî_debug
 = *
°©ic_ˇ°
<c⁄° 
ul⁄g
*>(
ßve
);

14455 
	`ib_logf
(
IB_LOG_LEVEL_INFO
,

14457 
§v_ßved_∑ge_numbî_debug
);

14458 
	}
}

14464 
	$önodb_make_∑ge_dúty
(

14466 
THD
* 
thd
,

14467 
°_mysql_sys_v¨
* 
v¨
,

14469 * 
v¨_±r
,

14471 c⁄° * 
ßve
)

14474 
må_t
 
må
;

14475 
ul⁄g
 
•a˚_id
 = *
°©ic_ˇ°
<c⁄° ul⁄g*>(
ßve
);

14477 
	`må_°¨t
(&
må
);

14479 
buf_block_t
* 
block
 = 
	`buf_∑ge_gë
(

14480 
•a˚_id
, 0, 
§v_ßved_∑ge_numbî_debug
, 
RW_X_LATCH
, &
må
);

14482 i‡(
block
) {

14483 
byã
* 
∑ge
 = 
block
->
‰ame
;

14484 
	`ib_logf
(
IB_LOG_LEVEL_INFO
,

14486 
	`∑ge_gë_∑ge_no
(
∑ge
),

14487 
	`∑ge_gë_•a˚_id
(
∑ge
));

14488 
	`mlog_wrôe_ulöt
(
∑ge
 + 
FIL_PAGE_TYPE
,

14489 
	`fû_∑ge_gë_ty≥
(
∑ge
),

14490 
MLOG_2BYTES
, &
må
);

14492 
	`må_commô
(&
må
);

14493 
	}
}

14503 
ibuf_u£_t


14504 
	$önodb_föd_ch™ge_buf„rög_vÆue
(

14506 c⁄° * 
öput_«me
)

14509 
ulöt
 
u£
;

14511 
u£
 = 0; u£ < 
	`UT_ARR_SIZE
(
önoba£_ch™ge_buf„rög_vÆues
);

14512 
u£
++) {

14514 i‡(!
	`önoba£_°rˇ£cmp
(

14515 
öput_«me
, 
önoba£_ch™ge_buf„rög_vÆues
[
u£
])) {

14516 ((
ibuf_u£_t
Ë
u£
);

14521 (
IBUF_USE_COUNT
);

14522 
	}
}

14530 
	$önodb_ch™ge_buf„rög_vÆid©e
(

14532 
THD
* 
thd
,

14533 
°_mysql_sys_v¨
* 
v¨
,

14535 * 
ßve
,

14537 
°_mysql_vÆue
* 
vÆue
)

14539 c⁄° * 
ch™ge_buf„rög_öput
;

14540 
buff
[
STRING_BUFFER_USUAL_SIZE
];

14541 
Àn
 = (
buff
);

14543 
	`ut_a
(
ßve
 !
NULL
);

14544 
	`ut_a
(
vÆue
 !
NULL
);

14546 
ch™ge_buf„rög_öput
 = 
vÆue
->
	`vÆ_°r
(vÆue, 
buff
, &
Àn
);

14548 i‡(
ch™ge_buf„rög_öput
 !
NULL
) {

14549 
ibuf_u£_t
 
u£
;

14551 
u£
 = 
	`önodb_föd_ch™ge_buf„rög_vÆue
(

14552 
ch™ge_buf„rög_öput
);

14554 i‡(
u£
 !
IBUF_USE_COUNT
) {

14556 *
°©ic_ˇ°
<c⁄° **>(
ßve
) =

14557 
önoba£_ch™ge_buf„rög_vÆues
[
u£
];

14566 
	}
}

14573 
	$önodb_ch™ge_buf„rög_upd©e
(

14575 
THD
* 
thd
,

14576 
°_mysql_sys_v¨
* 
v¨
,

14578 * 
v¨_±r
,

14580 c⁄° * 
ßve
)

14583 
ibuf_u£_t
 
u£
;

14585 
	`ut_a
(
v¨_±r
 !
NULL
);

14586 
	`ut_a
(
ßve
 !
NULL
);

14588 
u£
 = 
	`önodb_föd_ch™ge_buf„rög_vÆue
(

14589 *
°©ic_ˇ°
<c⁄° *c⁄°*>(
ßve
));

14591 
	`ut_a
(
u£
 < 
IBUF_USE_COUNT
);

14593 
ibuf_u£
 = 
u£
;

14594 *
°©ic_ˇ°
<c⁄° **>(
v¨_±r
) =

14595 *
°©ic_ˇ°
<c⁄° *c⁄°*>(
ßve
);

14596 
	}
}

14603 
	$önodb_°©s_ßm∂e_∑ges_upd©e
(

14605 
THD
* 
thd
,

14606 
°_mysql_sys_v¨
* 
v¨
,

14608 * 
v¨_±r
,

14610 c⁄° * 
ßve
)

14613 
	#STATS_SAMPLE_PAGES_DEPRECATED_MSG
 \

14617 "ö°ód."

	)

14619 
	`push_w¨nög
(
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

14620 
HA_ERR_WRONG_COMMAND
, 
STATS_SAMPLE_PAGES_DEPRECATED_MSG
);

14622 
	`ut_¥öt_time°amp
(
°dîr
);

14623 
	`Ârötf
(
°dîr
,

14625 
STATS_SAMPLE_PAGES_DEPRECATED_MSG
);

14627 
§v_°©s_å™sõ¡_ßm∂e_∑ges
 =

14628 *
°©ic_ˇ°
<c⁄° *>(
ßve
);

14629 
	}
}

14636 
	$önodb_m⁄ô‹_£t_›ti⁄
(

14638 c⁄° 
m⁄ô‹_öfo_t
* 
m⁄ô‹_öfo
,

14640 
m⁄_›ti⁄_t
 
£t_›ti⁄
)

14643 
m⁄ô‹_id_t
 
m⁄ô‹_id
 = 
m⁄ô‹_öfo
->monitor_id;

14648 
	`ut_a
(!(
m⁄ô‹_öfo
->
m⁄ô‹_ty≥
 & 
MONITOR_GROUP_MODULE
));

14650 
£t_›ti⁄
) {

14651 
MONITOR_TURN_ON
:

14652 
	`MONITOR_ON
(
m⁄ô‹_id
);

14653 
	`MONITOR_INIT
(
m⁄ô‹_id
);

14654 
	`MONITOR_SET_START
(
m⁄ô‹_id
);

14660 i‡(
m⁄ô‹_öfo
->
m⁄ô‹_ty≥


14661 & 
MONITOR_EXISTING
) {

14662 
	`§v_m⁄_¥o˚ss_exi°ög_cou¡î
(

14663 
m⁄ô‹_id
, 
MONITOR_TURN_ON
);

14667 
MONITOR_TURN_OFF
:

14668 i‡(
m⁄ô‹_öfo
->
m⁄ô‹_ty≥
 & 
MONITOR_EXISTING
) {

14669 
	`§v_m⁄_¥o˚ss_exi°ög_cou¡î
(

14670 
m⁄ô‹_id
, 
MONITOR_TURN_OFF
);

14673 
	`MONITOR_OFF
(
m⁄ô‹_id
);

14674 
	`MONITOR_SET_OFF
(
m⁄ô‹_id
);

14677 
MONITOR_RESET_VALUE
:

14678 
	`§v_m⁄_ª£t
(
m⁄ô‹_id
);

14681 
MONITOR_RESET_ALL_VALUE
:

14682 
	`§v_m⁄_ª£t_Æl
(
m⁄ô‹_id
);

14686 
ut_îr‹
;

14688 
	}
}

14696 
	$önodb_m⁄ô‹_upd©e_wûdˇrd
(

14698 c⁄° * 
«me
,

14699 
m⁄_›ti⁄_t
 
£t_›ti⁄
)

14702 
	`ut_a
(
«me
);

14704 
ulöt
 
u£
 = 0; u£ < 
NUM_MONITOR
; use++) {

14705 
ulöt
 
ty≥
;

14706 
m⁄ô‹_id_t
 
m⁄ô‹_id
 = 
°©ic_ˇ°
<m⁄ô‹_id_t>(
u£
);

14707 
m⁄ô‹_öfo_t
* 
m⁄ô‹_öfo
;

14709 i‡(!
	`önoba£_wûdˇ£cmp
(

14710 
	`§v_m⁄_gë_«me
(
m⁄ô‹_id
), 
«me
)) {

14711 
m⁄ô‹_öfo
 = 
	`§v_m⁄_gë_öfo
(
m⁄ô‹_id
);

14713 
ty≥
 = 
m⁄ô‹_öfo
->
m⁄ô‹_ty≥
;

14719 i‡(!(
ty≥
 & 
MONITOR_MODULE
)

14720 && !(
ty≥
 & 
MONITOR_GROUP_MODULE
)) {

14721 
	`önodb_m⁄ô‹_£t_›ti⁄
(
m⁄ô‹_öfo
,

14722 
£t_›ti⁄
);

14729 i‡(
ty≥
 & 
MONITOR_GROUP_MODULE
) {

14730 i‡((
m⁄ô‹_id
 >
MONITOR_MODULE_BUF_PAGE
)

14731 && (
m⁄ô‹_id
 < 
MONITOR_MODULE_OS
)) {

14732 i‡(
£t_›ti⁄
 =
MONITOR_TURN_ON


14733 && 
	`MONITOR_IS_ON
(

14734 
MONITOR_MODULE_BUF_PAGE
)) {

14738 
	`§v_m⁄_£t_moduÀ_c⁄åﬁ
(

14739 
MONITOR_MODULE_BUF_PAGE
,

14740 
£t_›ti⁄
);

14745 
	`ut_ad
(0);

14750 
	}
}

14757 
ulöt


14758 
	$önodb_m⁄ô‹_id_by_«me_gë
(

14760 c⁄° * 
«me
)

14762 
	`ut_a
(
«me
);

14769 i‡(
	`°rchr
(
«me
, '%')) {

14770 (
MONITOR_WILDCARD_MATCH
);

14774 
ulöt
 
i
 = 0; i < 
NUM_MONITOR
; i++) {

14775 i‡(!
	`önoba£_°rˇ£cmp
(

14776 
«me
, 
	`§v_m⁄_gë_«me
(
°©ic_ˇ°
<
m⁄ô‹_id_t
>(
i
)))) {

14777 (
i
);

14781 (
MONITOR_NO_MATCH
);

14782 
	}
}

14788 
iboﬁ


14789 
	$önodb_m⁄ô‹_vÆid©e_wûdˇrd_«me
(

14791 c⁄° * 
«me
)

14793 
ulöt
 
i
 = 0; i < 
NUM_MONITOR
; i++) {

14794 i‡(!
	`önoba£_wûdˇ£cmp
(

14795 
	`§v_m⁄_gë_«me
(
°©ic_ˇ°
<
m⁄ô‹_id_t
>(
i
)), 
«me
)) {

14796 (
TRUE
);

14800 (
FALSE
);

14801 
	}
}

14808 
	$önodb_m⁄ô‹_vÆid_by«me
(

14810 * 
ßve
,

14812 c⁄° * 
«me
)

14814 
ulöt
 
u£
;

14815 
m⁄ô‹_öfo_t
* 
m⁄ô‹_öfo
;

14817 i‡(!
«me
) {

14821 
u£
 = 
	`önodb_m⁄ô‹_id_by_«me_gë
(
«me
);

14824 i‡(
u£
 =
MONITOR_NO_MATCH
) {

14828 i‡(
u£
 < 
NUM_MONITOR
) {

14829 
m⁄ô‹_öfo
 = 
	`§v_m⁄_gë_öfo
((
m⁄ô‹_id_t
Ë
u£
);

14836 i‡((
m⁄ô‹_öfo
->
m⁄ô‹_ty≥
 & 
MONITOR_GROUP_MODULE
)

14837 && (!(
m⁄ô‹_öfo
->
m⁄ô‹_ty≥
 & 
MONITOR_MODULE
))) {

14838 
	`sql_¥öt_w¨nög
(

14844 
«me
);

14850 
	`ut_a
(
u£
 =
MONITOR_WILDCARD_MATCH
);

14855 i‡(!
	`önodb_m⁄ô‹_vÆid©e_wûdˇrd_«me
(
«me
)) {

14861 *
°©ic_ˇ°
<c⁄° **>(
ßve
Ë
«me
;

14864 
	}
}

14871 
	$önodb_m⁄ô‹_vÆid©e
(

14873 
THD
* 
thd
,

14874 
°_mysql_sys_v¨
* 
v¨
,

14876 * 
ßve
,

14878 
°_mysql_vÆue
* 
vÆue
)

14880 c⁄° * 
«me
;

14881 * 
m⁄ô‹_«me
;

14882 
buff
[
STRING_BUFFER_USUAL_SIZE
];

14883 
Àn
 = (
buff
);

14884 
ªt
;

14886 
	`ut_a
(
ßve
 !
NULL
);

14887 
	`ut_a
(
vÆue
 !
NULL
);

14889 
«me
 = 
vÆue
->
	`vÆ_°r
(vÆue, 
buff
, &
Àn
);

14895 i‡(
«me
) {

14896 
m⁄ô‹_«me
 = 
	`my_°rdup
(
«me
, 
	`MYF
(0));

14901 
ªt
 = 
	`önodb_m⁄ô‹_vÆid_by«me
(
ßve
, 
m⁄ô‹_«me
);

14903 i‡(
ªt
) {

14905 
	`my_‰ì
(
m⁄ô‹_«me
);

14910 
	`ut_ad
(*
°©ic_ˇ°
<**>(
ßve
Ë=
m⁄ô‹_«me
);

14913 (
ªt
);

14914 
	}
}

14922 
	$önodb_m⁄ô‹_upd©e
(

14924 
THD
* 
thd
,

14925 * 
v¨_±r
,

14927 c⁄° * 
ßve
,

14929 
m⁄_›ti⁄_t
 
£t_›ti⁄
,

14932 
iboﬁ
 
‰ì_mem
)

14935 
m⁄ô‹_öfo_t
* 
m⁄ô‹_öfo
;

14936 
ulöt
 
m⁄ô‹_id
;

14937 
ulöt
 
îr_m⁄ô‹
 = 0;

14938 c⁄° * 
«me
;

14940 
	`ut_a
(
ßve
 !
NULL
);

14942 
«me
 = *
°©ic_ˇ°
<c⁄° *c⁄°*>(
ßve
);

14944 i‡(!
«me
) {

14945 
m⁄ô‹_id
 = 
MONITOR_DEFAULT_START
;

14947 
m⁄ô‹_id
 = 
	`önodb_m⁄ô‹_id_by_«me_gë
(
«me
);

14950 i‡(
m⁄ô‹_id
 =
MONITOR_NO_MATCH
) {

14955 i‡(
m⁄ô‹_id
 =
MONITOR_DEFAULT_START
) {

14960 i‡(
thd
) {

14961 
	`push_w¨nög_¥ötf
(

14962 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

14963 
ER_NO_DEFAULT
,

14968 
	`sql_¥öt_îr‹
(

14974 i‡(
v¨_±r
) {

14975 *(c⁄° **Ë
v¨_±r
 = 
NULL
;

14977 } i‡(
m⁄ô‹_id
 =
MONITOR_WILDCARD_MATCH
) {

14978 
	`önodb_m⁄ô‹_upd©e_wûdˇrd
(
«me
, 
£t_›ti⁄
);

14980 
m⁄ô‹_öfo
 = 
	`§v_m⁄_gë_öfo
(

14981 
°©ic_ˇ°
<
m⁄ô‹_id_t
>(
m⁄ô‹_id
));

14983 
	`ut_a
(
m⁄ô‹_öfo
);

14988 i‡(
£t_›ti⁄
 =
MONITOR_TURN_ON


14989 && 
	`MONITOR_IS_ON
(
m⁄ô‹_id
)) {

14990 
îr_m⁄ô‹
 = 
m⁄ô‹_id
;

14991 
exô
;

14994 i‡(
v¨_±r
) {

14995 *(c⁄° **Ë
v¨_±r
 = 
m⁄ô‹_öfo
->
m⁄ô‹_«me
;

15001 i‡(
m⁄ô‹_öfo
->
m⁄ô‹_ty≥
 & 
MONITOR_MODULE
) {

15002 
	`§v_m⁄_£t_moduÀ_c⁄åﬁ
(

15003 
°©ic_ˇ°
<
m⁄ô‹_id_t
>(
m⁄ô‹_id
),

15004 
£t_›ti⁄
);

15006 
	`önodb_m⁄ô‹_£t_›ti⁄
(
m⁄ô‹_öfo
, 
£t_›ti⁄
);

15009 
exô
:

15013 i‡(
îr_m⁄ô‹
) {

15014 
	`sql_¥öt_w¨nög
("Monitor %s isálreadyÉnabled.",

15015 
	`§v_m⁄_gë_«me
((
m⁄ô‹_id_t
Ë
îr_m⁄ô‹
));

15018 i‡(
‰ì_mem
 && 
«me
) {

15019 
	`my_‰ì
((*Ë
«me
);

15023 
	}
}

15025 #ifde‡
__WIN__


15034 
	$önodb_§v_buf_dump_fûíame_vÆid©e
(

15036 
THD
* 
thd
,

15037 
°_mysql_sys_v¨
* 
v¨
,

15039 * 
ßve
,

15041 
°_mysql_vÆue
* 
vÆue
)

15043 c⁄° * 
buf_«me
;

15044 
buff
[
OS_FILE_MAX_PATH
];

15045 
Àn
(
buff
);

15047 
	`ut_a
(
ßve
 !
NULL
);

15048 
	`ut_a
(
vÆue
 !
NULL
);

15050 
buf_«me
 = 
vÆue
->
	`vÆ_°r
(vÆue, 
buff
, &
Àn
);

15052 i‡(
buf_«me
) {

15053 i‡(
	`is_fûíame_Ælowed
(
buf_«me
, 
Àn
, 
FALSE
)){

15054 *
°©ic_ˇ°
<c⁄° **>(
ßve
Ë
buf_«me
;

15057 
	`push_w¨nög_¥ötf
(
thd
,

15058 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

15059 
ER_WRONG_ARGUMENTS
,

15067 
	}
}

15069 
	#önodb_§v_buf_dump_fûíame_vÆid©e
 
NULL


	)

15072 #ifde‡
UNIV_DEBUG


15073 * 
	g§v_buf„r_poﬁ_evi˘
;

15079 
__©åibuã__
((
w¨n_unu£d_ªsu…
))

15080 
boﬁ


15081 
	$önodb_buf„r_poﬁ_evi˘_uncom¥es£d
()

15084 
boﬁ
 
Æl_evi˘ed
 = 
åue
;

15086 
ulöt
 
i
 = 0; i < 
§v_buf_poﬁ_ö°™˚s
; i++) {

15087 
buf_poﬁ_t
* 
buf_poﬁ
 = &
buf_poﬁ_±r
[
i
];

15089 
	`buf_poﬁ_muãx_íãr
(
buf_poﬁ
);

15091 
buf_block_t
* 
block
 = 
	`UT_LIST_GET_LAST
(

15092 
buf_poﬁ
->
unzù_LRU
);

15093 
block
 !
NULL
; ) {

15094 
buf_block_t
* 
¥ev_block
 = 
	`UT_LIST_GET_PREV
(

15095 
unzù_LRU
, 
block
);

15096 
	`ut_ad
(
	`buf_block_gë_°©e
(
block
)

15097 =
BUF_BLOCK_FILE_PAGE
);

15098 
	`ut_ad
(
block
->
ö_unzù_LRU_li°
);

15099 
	`ut_ad
(
block
->
∑ge
.
ö_LRU_li°
);

15101 i‡(!
	`buf_LRU_‰ì_∑ge
(&
block
->
∑ge
, 
Ál£
)) {

15102 
Æl_evi˘ed
 = 
Ál£
;

15105 
block
 = 
¥ev_block
;

15108 
	`buf_poﬁ_muãx_exô
(
buf_poﬁ
);

15111 (
Æl_evi˘ed
);

15112 
	}
}

15121 
	$önodb_buf„r_poﬁ_evi˘_upd©e
(

15123 
THD
* 
thd
,

15124 
°_mysql_sys_v¨
*
v¨
,

15125 * 
v¨_±r
,

15126 c⁄° * 
ßve
)

15129 i‡(c⁄° * 
›
 = *
°©ic_ˇ°
<c⁄° *c⁄°*>(
ßve
)) {

15130 i‡(!
	`°rcmp
(
›
, "uncompressed")) {

15131 
uöt
 
åõs
 = 0;Åries < 10000;Åries++) {

15132 i‡(
	`önodb_buf„r_poﬁ_evi˘_uncom¥es£d
()) {

15136 
	`os_thªad_¶ìp
(10000);

15140 
	`ut_ad
(0);

15143 
	}
}

15152 
	$önodb_íabÀ_m⁄ô‹_upd©e
(

15154 
THD
* 
thd
,

15155 
°_mysql_sys_v¨
* 
v¨
,

15157 * 
v¨_±r
,

15159 c⁄° * 
ßve
)

15162 
	`önodb_m⁄ô‹_upd©e
(
thd
, 
v¨_±r
, 
ßve
, 
MONITOR_TURN_ON
, 
TRUE
);

15163 
	}
}

15170 
	$önodb_dißbÀ_m⁄ô‹_upd©e
(

15172 
THD
* 
thd
,

15173 
°_mysql_sys_v¨
* 
v¨
,

15175 * 
v¨_±r
,

15177 c⁄° * 
ßve
)

15180 
	`önodb_m⁄ô‹_upd©e
(
thd
, 
v¨_±r
, 
ßve
, 
MONITOR_TURN_OFF
, 
TRUE
);

15181 
	}
}

15189 
	$önodb_ª£t_m⁄ô‹_upd©e
(

15191 
THD
* 
thd
,

15192 
°_mysql_sys_v¨
* 
v¨
,

15194 * 
v¨_±r
,

15196 c⁄° * 
ßve
)

15199 
	`önodb_m⁄ô‹_upd©e
(
thd
, 
v¨_±r
, 
ßve
, 
MONITOR_RESET_VALUE
, 
TRUE
);

15200 
	}
}

15208 
	$önodb_ª£t_Æl_m⁄ô‹_upd©e
(

15210 
THD
* 
thd
,

15211 
°_mysql_sys_v¨
* 
v¨
,

15213 * 
v¨_±r
,

15215 c⁄° * 
ßve
)

15218 
	`önodb_m⁄ô‹_upd©e
(
thd
, 
v¨_±r
, 
ßve
, 
MONITOR_RESET_ALL_VALUE
,

15219 
TRUE
);

15220 
	}
}

15230 
	$önodb_íabÀ_m⁄ô‹_©_°¨tup
(

15232 * 
°r
)

15234 c⁄° * 
£p
 = " ;,";

15235 * 
œ°
;

15237 
	`ut_a
(
°r
);

15243 * 
›ti⁄
 = 
	`°πok_r
(
°r
, 
£p
, &
œ°
);

15244 
›ti⁄
;

15245 
›ti⁄
 = 
	`°πok_r
(
NULL
, 
£p
, &
œ°
)) {

15246 
ulöt
 
ªt
;

15247 * 
›ti⁄_«me
;

15249 
ªt
 = 
	`önodb_m⁄ô‹_vÆid_by«me
(&
›ti⁄_«me
, 
›ti⁄
);

15252 i‡(!
ªt
) {

15253 
	`önodb_m⁄ô‹_upd©e
(
NULL
, NULL, &
›ti⁄
,

15254 
MONITOR_TURN_ON
, 
FALSE
);

15256 
	`sql_¥öt_w¨nög
("Invalid monitor counter"

15257 "Çame: '%s'", 
›ti⁄
);

15260 
	}
}

15267 
	$show_önodb_v¨s
(

15269 
THD
* 
thd
,

15270 
SHOW_VAR
* 
v¨
,

15271 * 
buff
)

15273 
	`önodb_exp‹t_°©us
();

15274 
v¨
->
ty≥
 = 
SHOW_ARRAY
;

15275 
v¨
->
vÆue
 = (*Ë&
önodb_°©us_v¨übÀs
;

15278 
	}
}

15286 
UNIV_INTERN


15287 
boﬁ


15288 
	$önoba£_ödex_«me_is_ª£rved
(

15290 
THD
* 
thd
,

15291 c⁄° 
KEY
* 
key_öfo
,

15292 
ulöt
 
num_of_keys
)

15295 c⁄° 
KEY
* 
key
;

15296 
uöt
 
key_num
;

15298 
key_num
 = 0; key_num < 
num_of_keys
; key_num++) {

15299 
key
 = &
key_öfo
[
key_num
];

15301 i‡(
	`önoba£_°rˇ£cmp
(
key
->
«me
,

15302 
önoba£_ödex_ª£rve_«me
) == 0) {

15304 
	`push_w¨nög_¥ötf
(
thd
,

15305 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
,

15306 
ER_WRONG_NAME_FOR_INDEX
,

15311 
önoba£_ödex_ª£rve_«me
);

15313 
	`my_îr‹
(
ER_WRONG_NAME_FOR_INDEX
, 
	`MYF
(0),

15314 
önoba£_ödex_ª£rve_«me
);

15316 (
åue
);

15320 (
Ál£
);

15321 
	}
}

15327 
UNIV_INTERN


15329 
	$önoba£_·s_ªåõve_ønkög
(

15331 
FT_INFO
 * 
·s_hdl
)

15333 
row_¥ebuût_t
* 
·_¥ebuût
;

15334 
·s_ªsu…_t
* 
ªsu…
;

15336 
ªsu…
 = ((
NEW_FT_INFO
*Ë
·s_hdl
)->
·_ªsu…
;

15338 
·_¥ebuût
 = ((
NEW_FT_INFO
*Ë
·s_hdl
)->ft_prebuilt;

15340 i‡(
·_¥ebuût
->
ªad_ju°_key
) {

15341 
·s_ønkög_t
* 
ønkög
 =

15342 
	`rbt_vÆue
(
·s_ønkög_t
, 
ªsu…
->
cuºít
);

15343 (
ønkög
->
ønk
);

15348 (
	`·s_ªåõve_ønkög
(
ªsu…
, 
·_¥ebuût
->
·s_doc_id
));

15349 
	}
}

15353 
UNIV_INTERN


15355 
	$önoba£_·s_˛o£_ønkög
(

15357 
FT_INFO
 * 
·s_hdl
)

15359 
·s_ªsu…_t
* 
ªsu…
;

15361 ((
NEW_FT_INFO
*Ë
·s_hdl
)->
·_¥ebuût
->
ö_·s_quîy
 = 
Ál£
;

15363 
ªsu…
 = ((
NEW_FT_INFO
*Ë
·s_hdl
)->
·_ªsu…
;

15365 
	`·s_quîy_‰ì_ªsu…
(
ªsu…
);

15367 
	`my_‰ì
((
uch¨
*Ë
·s_hdl
);

15371 
	}
}

15377 
UNIV_INTERN


15379 
	$önoba£_·s_föd_ønkög
(

15381 
FT_INFO
* 
·s_hdl
,

15382 
uch¨
* 
ªc‹d
,

15383 
uöt
 
Àn
)

15385 
row_¥ebuût_t
* 
·_¥ebuût
;

15386 
·s_ªsu…_t
* 
ªsu…
;

15388 
·_¥ebuût
 = ((
NEW_FT_INFO
*Ë
·s_hdl
)->ft_prebuilt;

15389 
ªsu…
 = ((
NEW_FT_INFO
*Ë
·s_hdl
)->
·_ªsu…
;

15393 (
	`·s_ªåõve_ønkög
(
ªsu…
, 
·_¥ebuût
->
·s_doc_id
));

15394 
	}
}

15396 #ifde‡
UNIV_DEBUG


15397 
my_boﬁ
 
	gönodb_purge_run_now
 = 
TRUE
;

15398 
my_boﬁ
 
	gönodb_purge_°›_now
 = 
TRUE
;

15399 
my_boﬁ
 
	gönodb_log_checkpoöt_now
 = 
TRUE
;

15400 
my_boﬁ
 
	gönodb_buf_Êush_li°_now
 = 
TRUE
;

15407 
purge_run_now_£t
(

15409 
THD
* 
thd


15410 
__©åibuã__
((
unu£d
)),

15411 
°_mysql_sys_v¨
* 
v¨


15413 
__©åibuã__
((
unu£d
)),

15414 * 
v¨_±r


15416 
__©åibuã__
((
unu£d
)),

15417 c⁄° * 
ßve
)

15420 i‡(*(
	gmy_boﬁ
*Ë
	gßve
 && 
åx_purge_°©e
(Ë!
PURGE_STATE_DISABLED
) {

15421 
åx_purge_run
();

15430 
purge_°›_now_£t
(

15432 
THD
* 
thd


15433 
__©åibuã__
((
unu£d
)),

15434 
°_mysql_sys_v¨
* 
v¨


15436 
__©åibuã__
((
unu£d
)),

15437 * 
v¨_±r


15439 
__©åibuã__
((
unu£d
)),

15440 c⁄° * 
ßve
)

15443 i‡(*(
	gmy_boﬁ
*Ë
	gßve
 && 
åx_purge_°©e
(Ë!
PURGE_STATE_DISABLED
) {

15444 
åx_purge_°›
();

15452 
checkpoöt_now_£t
(

15454 
THD
* 
thd


15455 
__©åibuã__
((
unu£d
)),

15456 
°_mysql_sys_v¨
* 
v¨


15458 
__©åibuã__
((
unu£d
)),

15459 * 
v¨_±r


15461 
__©åibuã__
((
unu£d
)),

15462 c⁄° * 
ßve
)

15465 i‡(*(
	gmy_boﬁ
*Ë
	gßve
) {

15466 
	glog_sys
->
	gœ°_checkpoöt_l¢
 <Üog_sys->
	gl¢
) {

15467 
log_make_checkpoöt_©
(
LSN_MAX
, 
TRUE
);

15468 
fû_Êush_fûe_•a˚s
(
FIL_LOG
);

15470 
fû_wrôe_Êushed_l¢_to_d©a_fûes
(
log_sys
->
l¢
, 0);

15471 
fû_Êush_fûe_•a˚s
(
FIL_TABLESPACE
);

15479 
buf_Êush_li°_now_£t
(

15481 
THD
* 
thd


15482 
__©åibuã__
((
unu£d
)),

15483 
°_mysql_sys_v¨
* 
v¨


15485 
__©åibuã__
((
unu£d
)),

15486 * 
v¨_±r


15488 
__©åibuã__
((
unu£d
)),

15489 c⁄° * 
ßve
)

15492 i‡(*(
	gmy_boﬁ
*Ë
	gßve
) {

15493 
buf_Êush_li°
(
ULINT_MAX
, 
LSN_MAX
, 
NULL
);

15494 
buf_Êush_waô_b©ch_íd
(
NULL
, 
BUF_FLUSH_LIST
);

15501 
uöt


15502 
	$önoba£_·s_gë_vîsi⁄
()

15509 
	}
}

15513 
ul⁄gl⁄g


15514 
	$önoba£_·s_Êags
()

15517 (
FTS_ORDERED_RESULT
 | 
FTS_DOCID_IN_RESULT
);

15518 
	}
}

15524 
ul⁄gl⁄g


15525 
	$önoba£_·s_ªåõve_docid
(

15527 
FT_INFO_EXT
 * 
·s_hdl
)

15529 
row_¥ebuût_t
* 
·_¥ebuût
;

15530 
·s_ªsu…_t
* 
ªsu…
;

15532 
·_¥ebuût
 = ((
NEW_FT_INFO
 *)
·s_hdl
)->ft_prebuilt;

15533 
ªsu…
 = ((
NEW_FT_INFO
 *)
·s_hdl
)->
·_ªsu…
;

15535 i‡(
·_¥ebuût
->
ªad_ju°_key
) {

15536 
·s_ønkög_t
* 
ønkög
 =

15537 
	`rbt_vÆue
(
·s_ønkög_t
, 
ªsu…
->
cuºít
);

15538 (
ønkög
->
doc_id
);

15541 (
·_¥ebuût
->
·s_doc_id
);

15542 
	}
}

15547 
ul⁄gl⁄g


15548 
	$önoba£_·s_cou¡_m©ches
(

15550 
FT_INFO_EXT
* 
·s_hdl
)

15552 
NEW_FT_INFO
* 
h™dÀ
 = (NEW_FT_INFO *Ë
·s_hdl
;

15554 i‡(
h™dÀ
->
·_ªsu…
->
ønkögs_by_id
 != 0) {

15555  
	`rbt_size
(
h™dÀ
->
·_ªsu…
->
ønkögs_by_id
);

15559 
	}
}

15573 
my_boﬁ
 
	gönodb_buf„r_poﬁ_dump_now
 = 
FALSE
;

15574 
my_boﬁ
 
	gönodb_buf„r_poﬁ_lﬂd_now
 = 
FALSE
;

15575 
my_boﬁ
 
	gönodb_buf„r_poﬁ_lﬂd_ab‹t
 = 
FALSE
;

15582 
buf„r_poﬁ_dump_now
(

15584 
THD
* 
thd


15585 
__©åibuã__
((
unu£d
)),

15586 
°_mysql_sys_v¨
* 
v¨


15588 
__©åibuã__
((
unu£d
)),

15589 * 
v¨_±r


15591 
__©åibuã__
((
unu£d
)),

15592 c⁄° * 
ßve
)

15595 i‡(*(
	gmy_boﬁ
*Ë
	gßve
 && !
	g§v_ªad_⁄ly_mode
) {

15596 
buf_dump_°¨t
();

15605 
buf„r_poﬁ_lﬂd_now
(

15607 
THD
* 
thd


15608 
__©åibuã__
((
unu£d
)),

15609 
°_mysql_sys_v¨
* 
v¨


15611 
__©åibuã__
((
unu£d
)),

15612 * 
v¨_±r


15614 
__©åibuã__
((
unu£d
)),

15615 c⁄° * 
ßve
)

15618 i‡(*(
	gmy_boﬁ
*Ë
	gßve
) {

15619 
buf_lﬂd_°¨t
();

15628 
buf„r_poﬁ_lﬂd_ab‹t
(

15630 
THD
* 
thd


15631 
__©åibuã__
((
unu£d
)),

15632 
°_mysql_sys_v¨
* 
v¨


15634 
__©åibuã__
((
unu£d
)),

15635 * 
v¨_±r


15637 
__©åibuã__
((
unu£d
)),

15638 c⁄° * 
ßve
)

15641 i‡(*(
	gmy_boﬁ
*Ë
	gßve
) {

15642 
buf_lﬂd_ab‹t
();

15654 
önodb_°©us_ouçut_upd©e
(

15655 
THD
* 
thd
 
__©åibuã__
((
unu£d
)),

15656 
°_mysql_sys_v¨
* 
v¨
 
__©åibuã__
((
unu£d
)),

15657 * 
v¨_±r
 
__©åibuã__
((
unu£d
)),

15658 c⁄° * 
ßve
 
__©åibuã__
((
unu£d
)))

15660 *
	g°©ic_ˇ°
<
	gmy_boﬁ
*>(
	gv¨_±r
Ë*
°©ic_ˇ°
<c⁄° 
my_boﬁ
*>(
ßve
);

15663 
os_evít_£t
(
lock_sys
->
timeout_evít
);

15666 
SHOW_VAR
 
	gönodb_°©us_v¨übÀs_exp‹t
[]= {

15667 {"I¬odb", (*Ë&
show_önodb_v¨s
, 
SHOW_FUNC
},

15668 {
NuŒS
, NuŒS, 
SHOW_LONG
}

15671 
°_mysql_°‹age_ígöe
 
	gönoba£_°‹age_ígöe
=

15672 { 
MYSQL_HANDLERTON_INTERFACE_VERSION
 };

15676 
MYSQL_SYSVAR_ENUM
(
checksum_Æg‹ôhm
, 
§v_checksum_Æg‹ôhm
,

15677 
PLUGIN_VAR_RQCMDARG
,

15697 
NULL
, NULL, 
SRV_CHECKSUM_ALGORITHM_INNODB
,

15698 &
önodb_checksum_Æg‹ôhm_ty≥lib
);

15700 
MYSQL_SYSVAR_BOOL
(
checksums
, 
önoba£_u£_checksums
,

15701 
PLUGIN_VAR_NOCMDARG
 | 
PLUGIN_VAR_READONLY
,

15706 
NULL
, NULL, 
TRUE
);

15708 
MYSQL_SYSVAR_STR
(
d©a_home_dú
, 
önoba£_d©a_home_dú
,

15709 
PLUGIN_VAR_READONLY
,

15711 
NULL
, NULL, NULL);

15713 #i‡
SSD_CACHE_FACE


15714 
MYSQL_SYSVAR_BOOL
(
u£_ssd_ˇche
, 
önoba£_u£_ssd_ˇche
,

15715 
PLUGIN_VAR_NOCMDARG
 | 
PLUGIN_VAR_READONLY
,

15717 
NULL
, NULL, 
FALSE
);

15719 
MYSQL_SYSVAR_STR
(
ssd_ˇche_fûe
, 
önoba£_ssd_ˇche_fûe
,

15720 
PLUGIN_VAR_READONLY
,

15722 
NULL
, NULL, NULL);

15724 
MYSQL_SYSVAR_LONGLONG
(
ssd_ˇche_size
, 
önoba£_ssd_ˇche_size
,

15725 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

15727 
NULL
, NULL, 2*1024*1024*1024L, 2*1024*1024*1024L, 
LONGLONG_MAX
, 1024*1024L);

15729 
MYSQL_SYSVAR_ULONG
(
ssd_ˇche_sˇn_dïth
, 
önoba£_ssd_ˇche_sˇn_dïth
,

15730 
PLUGIN_VAR_RQCMDARG
,

15732 
NULL
, NULL, 1024, 100, ~0UL, 0);

15736 
MYSQL_SYSVAR_BOOL
(
doubÀwrôe
, 
önoba£_u£_doubÀwrôe
,

15737 
PLUGIN_VAR_NOCMDARG
 | 
PLUGIN_VAR_READONLY
,

15740 
NULL
, NULL, 
TRUE
);

15742 
MYSQL_SYSVAR_ULONG
(
io_ˇ∑côy
, 
§v_io_ˇ∑côy
,

15743 
PLUGIN_VAR_RQCMDARG
,

15745 
NULL
, 
önodb_io_ˇ∑côy_upd©e
, 200, 100, ~0UL, 0);

15747 
MYSQL_SYSVAR_ULONG
(
io_ˇ∑côy_max
, 
§v_max_io_ˇ∑côy
,

15748 
PLUGIN_VAR_RQCMDARG
,

15750 
NULL
, 
önodb_io_ˇ∑côy_max_upd©e
,

15751 
SRV_MAX_IO_CAPACITY_DUMMY_DEFAULT
, 100,

15752 
SRV_MAX_IO_CAPACITY_LIMIT
, 0);

15754 #ifde‡
UNIV_DEBUG


15755 
MYSQL_SYSVAR_BOOL
(
purge_run_now
, 
önodb_purge_run_now
,

15756 
PLUGIN_VAR_OPCMDARG
,

15758 
NULL
, 
purge_run_now_£t
, 
FALSE
);

15760 
MYSQL_SYSVAR_BOOL
(
purge_°›_now
, 
önodb_purge_°›_now
,

15761 
PLUGIN_VAR_OPCMDARG
,

15763 
NULL
, 
purge_°›_now_£t
, 
FALSE
);

15765 
MYSQL_SYSVAR_BOOL
(
log_checkpoöt_now
, 
önodb_log_checkpoöt_now
,

15766 
PLUGIN_VAR_OPCMDARG
,

15768 
NULL
, 
checkpoöt_now_£t
, 
FALSE
);

15770 
MYSQL_SYSVAR_BOOL
(
buf_Êush_li°_now
, 
önodb_buf_Êush_li°_now
,

15771 
PLUGIN_VAR_OPCMDARG
,

15773 
NULL
, 
buf_Êush_li°_now_£t
, 
FALSE
);

15776 
MYSQL_SYSVAR_ULONG
(
purge_b©ch_size
, 
§v_purge_b©ch_size
,

15777 
PLUGIN_VAR_OPCMDARG
,

15779 
NULL
, NULL,

15784 
MYSQL_SYSVAR_ULONG
(
purge_thªads
, 
§v_n_purge_thªads
,

15785 
PLUGIN_VAR_OPCMDARG
 | 
PLUGIN_VAR_READONLY
,

15787 
NULL
, NULL,

15792 
MYSQL_SYSVAR_ULONG
(
sync_¨øy_size
, 
§v_sync_¨øy_size
,

15793 
PLUGIN_VAR_OPCMDARG
 | 
PLUGIN_VAR_READONLY
,

15795 
NULL
, NULL,

15800 
MYSQL_SYSVAR_ULONG
(
Á°_shutdown
, 
önoba£_Á°_shutdown
,

15801 
PLUGIN_VAR_OPCMDARG
,

15804 
NULL
, NULL, 1, 0, 2, 0);

15806 
MYSQL_SYSVAR_BOOL
(
fûe_≥r_èbÀ
, 
§v_fûe_≥r_èbÀ
,

15807 
PLUGIN_VAR_NOCMDARG
,

15809 
NULL
, NULL, 
TRUE
);

15811 
MYSQL_SYSVAR_STR
(
fûe_f‹m©
, 
önoba£_fûe_f‹m©_«me
,

15812 
PLUGIN_VAR_RQCMDARG
,

15814 
önodb_fûe_f‹m©_«me_vÆid©e
,

15815 
önodb_fûe_f‹m©_«me_upd©e
, "Antelope");

15823 
MYSQL_SYSVAR_BOOL
(
fûe_f‹m©_check
, 
önoba£_fûe_f‹m©_check
,

15824 
PLUGIN_VAR_NOCMDARG
 | 
PLUGIN_VAR_READONLY
,

15826 
NULL
, NULL, 
TRUE
);

15832 
MYSQL_SYSVAR_STR
(
fûe_f‹m©_max
, 
önoba£_fûe_f‹m©_max
,

15833 
PLUGIN_VAR_OPCMDARG
,

15835 
önodb_fûe_f‹m©_max_vÆid©e
,

15836 
önodb_fûe_f‹m©_max_upd©e
, "Antelope");

15838 
MYSQL_SYSVAR_STR
(
·_£rvî_°›w‹d_èbÀ
, 
önoba£_£rvî_°›w‹d_èbÀ
,

15839 
PLUGIN_VAR_OPCMDARG
 | 
PLUGIN_VAR_MEMALLOC
,

15841 
önodb_°›w‹d_èbÀ_vÆid©e
,

15842 
NULL
,

15843 
NULL
);

15845 
MYSQL_SYSVAR_UINT
(
Êush_log_©_timeout
, 
§v_Êush_log_©_timeout
,

15846 
PLUGIN_VAR_OPCMDARG
,

15848 
NULL
, NULL, 1, 0, 2700, 0);

15850 
MYSQL_SYSVAR_ULONG
(
Êush_log_©_åx_commô
, 
§v_Êush_log_©_åx_commô
,

15851 
PLUGIN_VAR_OPCMDARG
,

15855 
NULL
, NULL, 1, 0, 2, 0);

15857 
MYSQL_SYSVAR_STR
(
Êush_mëhod
, 
önoba£_fûe_Êush_mëhod
,

15858 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

15859 "Wôh which mëhodÅÿÊush d©a.", 
NULL
, NULL, NULL);

15861 
MYSQL_SYSVAR_BOOL
(
œrge_¥efix
, 
önoba£_œrge_¥efix
,

15862 
PLUGIN_VAR_NOCMDARG
,

15864 
NULL
, NULL, 
FALSE
);

15866 
MYSQL_SYSVAR_BOOL
(
f‹˚_lﬂd_c‹ru±ed
, 
§v_lﬂd_c‹ru±ed
,

15867 
PLUGIN_VAR_NOCMDARG
 | 
PLUGIN_VAR_READONLY
,

15869 
NULL
, NULL, 
FALSE
);

15871 
MYSQL_SYSVAR_BOOL
(
locks_unß„_f‹_bölog
, 
önoba£_locks_unß„_f‹_bölog
,

15872 
PLUGIN_VAR_NOCMDARG
 | 
PLUGIN_VAR_READONLY
,

15876 
NULL
, NULL, 
FALSE
);

15878 #ifde‡
UNIV_LOG_ARCHIVE


15879 
MYSQL_SYSVAR_STR
(
log_¨ch_dú
, 
önoba£_log_¨ch_dú
,

15880 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

15881 "WhîêfuŒÜog†should bê¨chived.", 
NULL
, NULL, NULL);

15883 
MYSQL_SYSVAR_BOOL
(
log_¨chive
, 
önoba£_log_¨chive
,

15884 
PLUGIN_VAR_OPCMDARG
 | 
PLUGIN_VAR_READONLY
,

15885 "SëÅÿ1 i‡you w™àtÿhavêlog†¨chived.", 
NULL
, NULL, 
FALSE
);

15888 
MYSQL_SYSVAR_STR
(
log_group_home_dú
, 
§v_log_group_home_dú
,

15889 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

15890 "P©hÅÿI¬oDBÜog fûes.", 
NULL
, NULL, NULL);

15892 
MYSQL_SYSVAR_ULONG
(
max_dúty_∑ges_p˘
, 
§v_max_buf_poﬁ_modifõd_p˘
,

15893 
PLUGIN_VAR_RQCMDARG
,

15895 
NULL
, 
önodb_max_dúty_∑ges_p˘_upd©e
, 75, 0, 99, 0);

15897 
MYSQL_SYSVAR_ULONG
(
max_dúty_∑ges_p˘_lwm
,

15898 
§v_max_dúty_∑ges_p˘_lwm
,

15899 
PLUGIN_VAR_RQCMDARG
,

15901 
NULL
, 
önodb_max_dúty_∑ges_p˘_lwm_upd©e
, 0, 0, 99, 0);

15903 
MYSQL_SYSVAR_ULONG
(
ad≠tive_Êushög_lwm
,

15904 
§v_ad≠tive_Êushög_lwm
,

15905 
PLUGIN_VAR_RQCMDARG
,

15907 
NULL
, NULL, 10, 0, 70, 0);

15909 
MYSQL_SYSVAR_BOOL
(
ad≠tive_Êushög
, 
§v_ad≠tive_Êushög
,

15910 
PLUGIN_VAR_NOCMDARG
,

15912 
NULL
, NULL, 
TRUE
);

15914 
MYSQL_SYSVAR_ULONG
(
Êushög_avg_lo›s
,

15915 
§v_Êushög_avg_lo›s
,

15916 
PLUGIN_VAR_RQCMDARG
,

15918 
NULL
, NULL, 30, 1, 1000, 0);

15920 
MYSQL_SYSVAR_ULONG
(
max_purge_œg
, 
§v_max_purge_œg
,

15921 
PLUGIN_VAR_RQCMDARG
,

15923 
NULL
, NULL, 0, 0, ~0UL, 0);

15925 
MYSQL_SYSVAR_ULONG
(
max_purge_œg_dñay
, 
§v_max_purge_œg_dñay
,

15926 
PLUGIN_VAR_RQCMDARG
,

15928 
NULL
, NULL,

15933 
MYSQL_SYSVAR_BOOL
(
rﬁlback_⁄_timeout
, 
önoba£_rﬁlback_⁄_timeout
,

15934 
PLUGIN_VAR_OPCMDARG
 | 
PLUGIN_VAR_READONLY
,

15936 
NULL
, NULL, 
FALSE
);

15938 
MYSQL_SYSVAR_BOOL
(
°©us_fûe
, 
önoba£_¸óã_°©us_fûe
,

15939 
PLUGIN_VAR_OPCMDARG
 | 
PLUGIN_VAR_NOSYSVAR
,

15941 
NULL
, NULL, 
FALSE
);

15943 
MYSQL_SYSVAR_BOOL
(
°©s_⁄_mëad©a
, 
önoba£_°©s_⁄_mëad©a
,

15944 
PLUGIN_VAR_OPCMDARG
,

15947 
NULL
, NULL, 
FALSE
);

15949 
MYSQL_SYSVAR_ULONGLONG
(
°©s_ßm∂e_∑ges
, 
§v_°©s_å™sõ¡_ßm∂e_∑ges
,

15950 
PLUGIN_VAR_RQCMDARG
,

15952 
NULL
, 
önodb_°©s_ßm∂e_∑ges_upd©e
, 8, 1, ~0ULL, 0);

15954 
MYSQL_SYSVAR_ULONGLONG
(
°©s_å™sõ¡_ßm∂e_∑ges
,

15955 
§v_°©s_å™sõ¡_ßm∂e_∑ges
,

15956 
PLUGIN_VAR_RQCMDARG
,

15959 
NULL
, NULL, 8, 1, ~0ULL, 0);

15961 
MYSQL_SYSVAR_BOOL
(
°©s_≥rsi°ít
, 
§v_°©s_≥rsi°ít
,

15962 
PLUGIN_VAR_OPCMDARG
,

15965 
NULL
, NULL, 
TRUE
);

15967 
MYSQL_SYSVAR_BOOL
(
°©s_auto_ªˇlc
, 
§v_°©s_auto_ªˇlc
,

15968 
PLUGIN_VAR_OPCMDARG
,

15973 
NULL
, NULL, 
TRUE
);

15975 
MYSQL_SYSVAR_ULONGLONG
(
°©s_≥rsi°ít_ßm∂e_∑ges
,

15976 
§v_°©s_≥rsi°ít_ßm∂e_∑ges
,

15977 
PLUGIN_VAR_RQCMDARG
,

15980 
NULL
, NULL, 20, 1, ~0ULL, 0);

15982 
MYSQL_SYSVAR_BOOL
(
ad≠tive_hash_ödex
, 
bå_£¨ch_íabÀd
,

15983 
PLUGIN_VAR_OPCMDARG
,

15986 
NULL
, 
önodb_ad≠tive_hash_ödex_upd©e
, 
TRUE
);

15988 
MYSQL_SYSVAR_ULONG
(
ª∂iˇti⁄_dñay
, 
§v_ª∂iˇti⁄_dñay
,

15989 
PLUGIN_VAR_RQCMDARG
,

15992 
NULL
, NULL, 0, 0, ~0UL, 0);

15994 
MYSQL_SYSVAR_UINT
(
com¥essi⁄_Àvñ
, 
∑ge_zù_Àvñ
,

15995 
PLUGIN_VAR_RQCMDARG
,

15998 
NULL
, NULL, 
DEFAULT_COMPRESSION_LEVEL
, 0, 9, 0);

16000 
MYSQL_SYSVAR_BOOL
(
log_com¥es£d_∑ges
, 
∑ge_zù_log_∑ges
,

16001 
PLUGIN_VAR_OPCMDARG
,

16007 
NULL
, NULL, 
TRUE
);

16009 
MYSQL_SYSVAR_LONG
(
addôi⁄Æ_mem_poﬁ_size
, 
önoba£_addôi⁄Æ_mem_poﬁ_size
,

16010 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

16015 
NULL
, NULL, 8*1024*1024L, 512*1024L, 
LONG_MAX
, 1024);

16017 
MYSQL_SYSVAR_ULONG
(
aut€xãnd_ö¸emít
, 
§v_auto_exãnd_ö¸emít
,

16018 
PLUGIN_VAR_RQCMDARG
,

16020 
NULL
, NULL, 64L, 1L, 1000L, 0);

16022 
MYSQL_SYSVAR_LONGLONG
(
buf„r_poﬁ_size
, 
önoba£_buf„r_poﬁ_size
,

16023 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

16025 
NULL
, NULL, 128*1024*1024L, 5*1024*1024L, 
LONGLONG_MAX
, 1024*1024L);

16027 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_PERF_DEBUG


16028 
MYSQL_SYSVAR_ULONG
(
∑ge_hash_locks
, 
§v_n_∑ge_hash_locks
,

16029 
PLUGIN_VAR_OPCMDARG
 | 
PLUGIN_VAR_READONLY
,

16031 
NULL
, NULL, 16, 1, 
MAX_PAGE_HASH_LOCKS
, 0);

16033 
MYSQL_SYSVAR_ULONG
(
doubÀwrôe_b©ch_size
, 
§v_doubÀwrôe_b©ch_size
,

16034 
PLUGIN_VAR_OPCMDARG
 | 
PLUGIN_VAR_READONLY
,

16036 
NULL
, NULL, 120, 1, 127, 0);

16039 
MYSQL_SYSVAR_LONG
(
buf„r_poﬁ_ö°™˚s
, 
önoba£_buf„r_poﬁ_ö°™˚s
,

16040 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

16042 
NULL
, NULL, 0L, 0L, 
MAX_BUFFER_POOLS
, 1L);

16044 
MYSQL_SYSVAR_STR
(
buf„r_poﬁ_fûíame
, 
§v_buf_dump_fûíame
,

16045 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_MEMALLOC
,

16047 
önodb_§v_buf_dump_fûíame_vÆid©e
, 
NULL
, 
SRV_BUF_DUMP_FILENAME_DEFAULT
);

16049 
MYSQL_SYSVAR_BOOL
(
buf„r_poﬁ_dump_now
, 
önodb_buf„r_poﬁ_dump_now
,

16050 
PLUGIN_VAR_RQCMDARG
,

16052 
NULL
, 
buf„r_poﬁ_dump_now
, 
FALSE
);

16054 
MYSQL_SYSVAR_BOOL
(
buf„r_poﬁ_dump_©_shutdown
, 
§v_buf„r_poﬁ_dump_©_shutdown
,

16055 
PLUGIN_VAR_RQCMDARG
,

16057 
NULL
, NULL, 
FALSE
);

16059 #ifde‡
UNIV_DEBUG


16060 
MYSQL_SYSVAR_STR
(
buf„r_poﬁ_evi˘
, 
§v_buf„r_poﬁ_evi˘
,

16061 
PLUGIN_VAR_RQCMDARG
,

16063 
NULL
, 
önodb_buf„r_poﬁ_evi˘_upd©e
, "");

16066 
MYSQL_SYSVAR_BOOL
(
buf„r_poﬁ_lﬂd_now
, 
önodb_buf„r_poﬁ_lﬂd_now
,

16067 
PLUGIN_VAR_RQCMDARG
,

16069 
NULL
, 
buf„r_poﬁ_lﬂd_now
, 
FALSE
);

16071 
MYSQL_SYSVAR_BOOL
(
buf„r_poﬁ_lﬂd_ab‹t
, 
önodb_buf„r_poﬁ_lﬂd_ab‹t
,

16072 
PLUGIN_VAR_RQCMDARG
,

16074 
NULL
, 
buf„r_poﬁ_lﬂd_ab‹t
, 
FALSE
);

16077 
MYSQL_SYSVAR_BOOL
(
buf„r_poﬁ_lﬂd_©_°¨tup
, 
§v_buf„r_poﬁ_lﬂd_©_°¨tup
,

16078 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

16080 
NULL
, NULL, 
FALSE
);

16082 
MYSQL_SYSVAR_ULONG
(
Ãu_sˇn_dïth
, 
§v_LRU_sˇn_dïth
,

16083 
PLUGIN_VAR_RQCMDARG
,

16085 
NULL
, NULL, 1024, 100, ~0UL, 0);

16087 
MYSQL_SYSVAR_ULONG
(
Êush_√ighb‹s
, 
§v_Êush_√ighb‹s
,

16088 
PLUGIN_VAR_OPCMDARG
,

16093 
NULL
, NULL, 1, 0, 2, 0);

16095 
MYSQL_SYSVAR_ULONG
(
commô_c⁄cuºícy
, 
önoba£_commô_c⁄cuºícy
,

16096 
PLUGIN_VAR_RQCMDARG
,

16098 
önoba£_commô_c⁄cuºícy_vÆid©e
, 
NULL
, 0, 0, 1000, 0);

16100 
MYSQL_SYSVAR_ULONG
(
c⁄cuºícy_tickës
, 
§v_n_‰ì_tickës_to_íãr
,

16101 
PLUGIN_VAR_RQCMDARG
,

16103 
NULL
, NULL, 5000L, 1L, ~0UL, 0);

16105 
MYSQL_SYSVAR_LONG
(
fûe_io_thªads
, 
önoba£_fûe_io_thªads
,

16106 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
 | 
PLUGIN_VAR_NOSYSVAR
,

16108 
NULL
, NULL, 4, 4, 64, 0);

16110 
MYSQL_SYSVAR_BOOL
(
·_íabÀ_düg_¥öt
, 
·s_íabÀ_düg_¥öt
,

16111 
PLUGIN_VAR_OPCMDARG
,

16113 
NULL
, NULL, 
FALSE
);

16115 
MYSQL_SYSVAR_BOOL
(
dißbÀ_s‹t_fûe_ˇche
, 
§v_dißbÀ_s‹t_fûe_ˇche
,

16116 
PLUGIN_VAR_OPCMDARG
,

16118 
NULL
, NULL, 
FALSE
);

16120 
MYSQL_SYSVAR_STR
(
·_aux_èbÀ
, 
·s_öã∫Æ_tbl_«me
,

16121 
PLUGIN_VAR_NOCMDARG
,

16123 
önodb_öã∫Æ_èbÀ_vÆid©e
,

16124 
önodb_öã∫Æ_èbÀ_upd©e
, 
NULL
);

16126 
MYSQL_SYSVAR_ULONG
(
·_ˇche_size
, 
·s_max_ˇche_size
,

16127 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

16129 
NULL
, NULL, 8000000, 1600000, 80000000, 0);

16131 
MYSQL_SYSVAR_ULONG
(
·_tŸÆ_ˇche_size
, 
·s_max_tŸÆ_ˇche_size
,

16132 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

16134 
NULL
, NULL, 640000000, 32000000, 1600000000, 0);

16136 
MYSQL_SYSVAR_ULONG
(
·_ªsu…_ˇche_limô
, 
·s_ªsu…_ˇche_limô
,

16137 
PLUGIN_VAR_RQCMDARG
,

16139 
NULL
, NULL, 2000000000L, 1000000L, 4294967295UL, 0);

16141 
MYSQL_SYSVAR_ULONG
(
·_mö_tokí_size
, 
·s_mö_tokí_size
,

16142 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

16144 
NULL
, NULL, 3, 0, 16, 0);

16146 
MYSQL_SYSVAR_ULONG
(
·_max_tokí_size
, 
·s_max_tokí_size
,

16147 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

16149 
NULL
, NULL, 
FTS_MAX_WORD_LEN_IN_CHAR
, 10, FTS_MAX_WORD_LEN_IN_CHAR, 0);

16152 
MYSQL_SYSVAR_ULONG
(
·_num_w‹d_›timize
, 
·s_num_w‹d_›timize
,

16153 
PLUGIN_VAR_OPCMDARG
,

16155 
NULL
, NULL, 2000, 1000, 10000, 0);

16157 
MYSQL_SYSVAR_ULONG
(
·_s‹t_∂l_degªe
, 
·s_s‹t_∂l_degªe
,

16158 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

16160 
NULL
, NULL, 2, 1, 16, 0);

16162 
MYSQL_SYSVAR_ULONG
(
s‹t_buf„r_size
, 
§v_s‹t_buf_size
,

16163 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

16165 
NULL
, NULL, 1048576, 65536, 64<<20, 0);

16167 
MYSQL_SYSVAR_ULONGLONG
(
⁄löe_Æãr_log_max_size
, 
§v_⁄löe_max_size
,

16168 
PLUGIN_VAR_RQCMDARG
,

16170 
NULL
, NULL, 128<<20, 65536, ~0ULL, 0);

16172 
MYSQL_SYSVAR_BOOL
(
›timize_fuŒãxt_⁄ly
, 
önodb_›timize_fuŒãxt_⁄ly
,

16173 
PLUGIN_VAR_NOCMDARG
,

16175 
NULL
, NULL, 
FALSE
);

16177 
MYSQL_SYSVAR_ULONG
(
ªad_io_thªads
, 
önoba£_ªad_io_thªads
,

16178 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

16180 
NULL
, NULL, 4, 1, 64, 0);

16182 
MYSQL_SYSVAR_ULONG
(
wrôe_io_thªads
, 
önoba£_wrôe_io_thªads
,

16183 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

16185 
NULL
, NULL, 4, 1, 64, 0);

16187 
MYSQL_SYSVAR_ULONG
(
f‹˚_ªcovîy
, 
§v_f‹˚_ªcovîy
,

16188 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

16190 
NULL
, NULL, 0, 0, 6, 0);

16192 #i‚de‡
DBUG_OFF


16193 
MYSQL_SYSVAR_ULONG
(
f‹˚_ªcovîy_¸ash
, 
§v_f‹˚_ªcovîy_¸ash
,

16194 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

16196 
NULL
, NULL, 0, 0, 10, 0);

16199 
MYSQL_SYSVAR_ULONG
(
∑ge_size
, 
§v_∑ge_size
,

16200 
PLUGIN_VAR_OPCMDARG
 | 
PLUGIN_VAR_READONLY
,

16202 
NULL
, NULL, 
UNIV_PAGE_SIZE_DEF
,

16203 
UNIV_PAGE_SIZE_MIN
, 
UNIV_PAGE_SIZE_MAX
, 0);

16205 
MYSQL_SYSVAR_LONG
(
log_buf„r_size
, 
önoba£_log_buf„r_size
,

16206 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

16208 
NULL
, NULL, 8*1024*1024L, 256*1024L, 
LONG_MAX
, 1024);

16210 
MYSQL_SYSVAR_LONGLONG
(
log_fûe_size
, 
önoba£_log_fûe_size
,

16211 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

16213 
NULL
, NULL, 48*1024*1024L, 1*1024*1024L, 
LONGLONG_MAX
, 1024*1024L);

16215 
MYSQL_SYSVAR_ULONG
(
log_fûes_ö_group
, 
§v_n_log_fûes
,

16216 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

16218 
NULL
, NULL, 2, 2, 
SRV_N_LOG_FILES_MAX
, 0);

16222 
MYSQL_SYSVAR_LONG
(
múr‹ed_log_groups
, 
önoba£_múr‹ed_log_groups
,

16223 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

16225 
NULL
, NULL, 0, 0, 10, 0);

16227 
MYSQL_SYSVAR_UINT
(
ﬁd_blocks_p˘
, 
önoba£_ﬁd_blocks_p˘
,

16228 
PLUGIN_VAR_RQCMDARG
,

16230 
NULL
, 
önodb_ﬁd_blocks_p˘_upd©e
, 100 * 3 / 8, 5, 95, 0);

16232 
MYSQL_SYSVAR_UINT
(
ﬁd_blocks_time
, 
buf_LRU_ﬁd_thªshﬁd_ms
,

16233 
PLUGIN_VAR_RQCMDARG
,

16237 
NULL
, NULL, 1000, 0, 
UINT_MAX32
, 0);

16239 
MYSQL_SYSVAR_LONG
(
›í_fûes
, 
önoba£_›í_fûes
,

16240 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

16242 
NULL
, NULL, 0L, 0L, 
LONG_MAX
, 0);

16244 
MYSQL_SYSVAR_ULONG
(
sync_•ö_lo›s
, 
§v_n_•ö_waô_rounds
,

16245 
PLUGIN_VAR_RQCMDARG
,

16247 
NULL
, NULL, 30L, 0L, ~0UL, 0);

16249 
MYSQL_SYSVAR_ULONG
(
•ö_waô_dñay
, 
§v_•ö_waô_dñay
,

16250 
PLUGIN_VAR_OPCMDARG
,

16252 
NULL
, NULL, 6L, 0L, ~0UL, 0);

16254 
MYSQL_SYSVAR_ULONG
(
thªad_c⁄cuºícy
, 
§v_thªad_c⁄cuºícy
,

16255 
PLUGIN_VAR_RQCMDARG
,

16257 
NULL
, NULL, 0, 0, 1000, 0);

16259 #ifde‡
HAVE_ATOMIC_BUILTINS


16260 
MYSQL_SYSVAR_ULONG
(

16261 
ad≠tive_max_¶ìp_dñay
, 
§v_ad≠tive_max_¶ìp_dñay
,

16262 
PLUGIN_VAR_RQCMDARG
,

16264 
NULL
, NULL,

16270 
MYSQL_SYSVAR_ULONG
(
thªad_¶ìp_dñay
, 
§v_thªad_¶ìp_dñay
,

16271 
PLUGIN_VAR_RQCMDARG
,

16274 
NULL
, NULL,

16279 
MYSQL_SYSVAR_STR
(
d©a_fûe_∑th
, 
önoba£_d©a_fûe_∑th
,

16280 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

16282 
NULL
, NULL, NULL);

16284 
MYSQL_SYSVAR_STR
(
undo_dúe˘‹y
, 
§v_undo_dú
,

16285 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

16287 
NULL
, NULL, ".");

16289 
MYSQL_SYSVAR_ULONG
(
undo_èbÀ•a˚s
, 
§v_undo_èbÀ•a˚s
,

16290 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

16292 
NULL
, NULL,

16297 
MYSQL_SYSVAR_ULONG
(
undo_logs
, 
§v_undo_logs
,

16298 
PLUGIN_VAR_OPCMDARG
,

16300 
NULL
, NULL,

16301 
TRX_SYS_N_RSEGS
,

16303 
TRX_SYS_N_RSEGS
, 0);

16306 
MYSQL_SYSVAR_ULONG
(
rﬁlback_£gmíts
, 
§v_undo_logs
,

16307 
PLUGIN_VAR_OPCMDARG
,

16309 
NULL
, NULL,

16310 
TRX_SYS_N_RSEGS
,

16312 
TRX_SYS_N_RSEGS
, 0);

16314 
MYSQL_SYSVAR_LONG
(
autoöc_lock_mode
, 
önoba£_autoöc_lock_mode
,

16315 
PLUGIN_VAR_RQCMDARG
 | 
PLUGIN_VAR_READONLY
,

16321 
NULL
, NULL,

16322 
AUTOINC_NEW_STYLE_LOCKING
,

16323 
AUTOINC_OLD_STYLE_LOCKING
,

16324 
AUTOINC_NO_LOCKING
, 0);

16326 
MYSQL_SYSVAR_STR
(
vîsi⁄
, 
önodb_vîsi⁄_°r
,

16327 
PLUGIN_VAR_NOCMDOPT
 | 
PLUGIN_VAR_READONLY
,

16328 "I¬oDB vîsi⁄", 
NULL
, NULL, 
INNODB_VERSION_STR
);

16330 
MYSQL_SYSVAR_BOOL
(
u£_sys_mÆloc
, 
§v_u£_sys_mÆloc
,

16331 
PLUGIN_VAR_NOCMDARG
 | 
PLUGIN_VAR_READONLY
,

16335 
NULL
, NULL, 
TRUE
);

16337 
MYSQL_SYSVAR_BOOL
(
u£_«tive_aio
, 
§v_u£_«tive_aio
,

16338 
PLUGIN_VAR_NOCMDARG
 | 
PLUGIN_VAR_READONLY
,

16340 
NULL
, NULL, 
TRUE
);

16342 
MYSQL_SYSVAR_BOOL
(
≠i_íabÀ_bölog
, 
ib_bölog_íabÀd
,

16343 
PLUGIN_VAR_NOCMDARG
 | 
PLUGIN_VAR_READONLY
,

16345 
NULL
, NULL, 
FALSE
);

16347 
MYSQL_SYSVAR_BOOL
(
≠i_íabÀ_mdl
, 
ib_mdl_íabÀd
,

16348 
PLUGIN_VAR_NOCMDARG
 | 
PLUGIN_VAR_READONLY
,

16350 
NULL
, NULL, 
FALSE
);

16352 
MYSQL_SYSVAR_BOOL
(
≠i_dißbÀ_rowlock
, 
ib_dißbÀ_row_lock
,

16353 
PLUGIN_VAR_NOCMDARG
 | 
PLUGIN_VAR_READONLY
,

16355 
NULL
, NULL, 
FALSE
);

16357 
MYSQL_SYSVAR_ULONG
(
≠i_åx_Àvñ
, 
ib_åx_Àvñ_£âög
,

16358 
PLUGIN_VAR_OPCMDARG
,

16360 
NULL
, NULL,

16365 
MYSQL_SYSVAR_ULONG
(
≠i_bk_commô_öãrvÆ
, 
ib_bk_commô_öãrvÆ
,

16366 
PLUGIN_VAR_OPCMDARG
,

16368 
NULL
, NULL,

16373 
MYSQL_SYSVAR_STR
(
ch™ge_buf„rög
, 
önoba£_ch™ge_buf„rög
,

16374 
PLUGIN_VAR_RQCMDARG
,

16377 
önodb_ch™ge_buf„rög_vÆid©e
,

16378 
önodb_ch™ge_buf„rög_upd©e
, "all");

16380 
MYSQL_SYSVAR_UINT
(
ch™ge_buf„r_max_size
,

16381 
önoba£_ch™ge_buf„r_max_size
,

16382 
PLUGIN_VAR_RQCMDARG
,

16385 
NULL
, 
önodb_ch™ge_buf„r_max_size_upd©e
,

16386 
CHANGE_BUFFER_DEFAULT_SIZE
, 0, 50, 0);

16388 
MYSQL_SYSVAR_ENUM
(
°©s_mëhod
, 
§v_önodb_°©s_mëhod
,

16389 
PLUGIN_VAR_RQCMDARG
,

16393 
NULL
, NULL, 
SRV_STATS_NULLS_EQUAL
, &
önodb_°©s_mëhod_ty≥lib
);

16395 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_IBUF_DEBUG


16396 
MYSQL_SYSVAR_UINT
(
ch™ge_buf„rög_debug
, 
ibuf_debug
,

16397 
PLUGIN_VAR_RQCMDARG
,

16399 
NULL
, NULL, 0, 0, 2, 0);

16401 
MYSQL_SYSVAR_BOOL
(
dißbÀ_background_mîge
,

16402 
§v_ibuf_dißbÀ_background_mîge
,

16403 
PLUGIN_VAR_NOCMDARG
 | 
PLUGIN_VAR_RQCMDARG
,

16405 
NULL
, NULL, 
FALSE
);

16408 
MYSQL_SYSVAR_BOOL
(
øndom_ªad_ahód
, 
§v_øndom_ªad_ahód
,

16409 
PLUGIN_VAR_NOCMDARG
,

16411 
NULL
, NULL, 
FALSE
);

16413 
MYSQL_SYSVAR_ULONG
(
ªad_ahód_thªshﬁd
, 
§v_ªad_ahód_thªshﬁd
,

16414 
PLUGIN_VAR_RQCMDARG
,

16417 
NULL
, NULL, 56, 0, 64, 0);

16419 
MYSQL_SYSVAR_STR
(
m⁄ô‹_íabÀ
, 
önoba£_íabÀ_m⁄ô‹_cou¡î
,

16420 
PLUGIN_VAR_RQCMDARG
,

16422 
önodb_m⁄ô‹_vÆid©e
,

16423 
önodb_íabÀ_m⁄ô‹_upd©e
, 
NULL
);

16425 
MYSQL_SYSVAR_STR
(
m⁄ô‹_dißbÀ
, 
önoba£_dißbÀ_m⁄ô‹_cou¡î
,

16426 
PLUGIN_VAR_RQCMDARG
,

16428 
önodb_m⁄ô‹_vÆid©e
,

16429 
önodb_dißbÀ_m⁄ô‹_upd©e
, 
NULL
);

16431 
MYSQL_SYSVAR_STR
(
m⁄ô‹_ª£t
, 
önoba£_ª£t_m⁄ô‹_cou¡î
,

16432 
PLUGIN_VAR_RQCMDARG
,

16434 
önodb_m⁄ô‹_vÆid©e
,

16435 
önodb_ª£t_m⁄ô‹_upd©e
, 
NULL
);

16437 
MYSQL_SYSVAR_STR
(
m⁄ô‹_ª£t_Æl
, 
önoba£_ª£t_Æl_m⁄ô‹_cou¡î
,

16438 
PLUGIN_VAR_RQCMDARG
,

16440 
önodb_m⁄ô‹_vÆid©e
,

16441 
önodb_ª£t_Æl_m⁄ô‹_upd©e
, 
NULL
);

16443 
MYSQL_SYSVAR_BOOL
(
°©us_ouçut
, 
§v_¥öt_önodb_m⁄ô‹
,

16444 
PLUGIN_VAR_OPCMDARG
, "Enable InnoDB monitor outputÅoÅheÉrrorÜog.",

16445 
NULL
, 
önodb_°©us_ouçut_upd©e
, 
FALSE
);

16447 
MYSQL_SYSVAR_BOOL
(
°©us_ouçut_locks
, 
§v_¥öt_önodb_lock_m⁄ô‹
,

16448 
PLUGIN_VAR_OPCMDARG
, "Enable InnoDBÜock monitor outputÅoÅheÉrrorÜog."

16450 
NULL
, 
önodb_°©us_ouçut_upd©e
, 
FALSE
);

16452 
MYSQL_SYSVAR_BOOL
(
¥öt_Æl_dódlocks
, 
§v_¥öt_Æl_dódlocks
,

16453 
PLUGIN_VAR_OPCMDARG
,

16455 
NULL
, NULL, 
FALSE
);

16457 
MYSQL_SYSVAR_ULONG
(
com¥essi⁄_Áûuª_thªshﬁd_p˘
,

16458 
zù_Áûuª_thªshﬁd_p˘
, 
PLUGIN_VAR_OPCMDARG
,

16462 
NULL
, NULL, 5, 0, 100, 0);

16464 
MYSQL_SYSVAR_ULONG
(
com¥essi⁄_∑d_p˘_max
,

16465 
zù_∑d_max
, 
PLUGIN_VAR_OPCMDARG
,

16468 
NULL
, NULL, 50, 0, 75, 0);

16470 
MYSQL_SYSVAR_BOOL
(
ªad_⁄ly
, 
§v_ªad_⁄ly_mode
,

16471 
PLUGIN_VAR_OPCMDARG
 | 
PLUGIN_VAR_READONLY
,

16473 
NULL
, NULL, 
FALSE
);

16475 
MYSQL_SYSVAR_BOOL
(
cmp_≥r_ödex_íabÀd
, 
§v_cmp_≥r_ödex_íabÀd
,

16476 
PLUGIN_VAR_OPCMDARG
,

16479 
NULL
, 
önodb_cmp_≥r_ödex_upd©e
, 
FALSE
);

16481 #ifde‡
UNIV_DEBUG


16482 
MYSQL_SYSVAR_UINT
(
åx_r£g_n_¶Ÿs_debug
,Årx_rseg_n_slots_debug,

16483 
PLUGIN_VAR_RQCMDARG
,

16485 
NULL
, NULL, 0, 0, 1024, 0);

16487 
MYSQL_SYSVAR_UINT
(
limô_›timi°ic_ö£π_debug
,

16488 
bå_cur_limô_›timi°ic_ö£π_debug
, 
PLUGIN_VAR_RQCMDARG
,

16490 
NULL
, NULL, 0, 0, 
UINT_MAX32
, 0);

16492 
MYSQL_SYSVAR_BOOL
(
åx_purge_võw_upd©e_⁄ly_debug
,

16493 
§v_purge_võw_upd©e_⁄ly_debug
, 
PLUGIN_VAR_NOCMDARG
,

16497 
NULL
, NULL, 
FALSE
);

16499 
MYSQL_SYSVAR_ULONG
(
fû_make_∑ge_dúty_debug
,

16500 
§v_fû_make_∑ge_dúty_debug
, 
PLUGIN_VAR_OPCMDARG
,

16502 
NULL
, 
önodb_make_∑ge_dúty
, 0, 0, 
UINT_MAX32
, 0);

16504 
MYSQL_SYSVAR_ULONG
(
ßved_∑ge_numbî_debug
,

16505 
§v_ßved_∑ge_numbî_debug
, 
PLUGIN_VAR_OPCMDARG
,

16507 
NULL
, 
önodb_ßve_∑ge_no
, 0, 0, 
UINT_MAX32
, 0);

16510 
°_mysql_sys_v¨
* 
	gönoba£_sy°em_v¨übÀs
[]= {

16511 
MYSQL_SYSVAR
(
addôi⁄Æ_mem_poﬁ_size
),

16512 
MYSQL_SYSVAR
(
≠i_åx_Àvñ
),

16513 
MYSQL_SYSVAR
(
≠i_bk_commô_öãrvÆ
),

16514 
MYSQL_SYSVAR
(
aut€xãnd_ö¸emít
),

16515 
MYSQL_SYSVAR
(
buf„r_poﬁ_size
),

16516 
MYSQL_SYSVAR
(
buf„r_poﬁ_ö°™˚s
),

16517 
MYSQL_SYSVAR
(
buf„r_poﬁ_fûíame
),

16518 
MYSQL_SYSVAR
(
buf„r_poﬁ_dump_now
),

16519 
MYSQL_SYSVAR
(
buf„r_poﬁ_dump_©_shutdown
),

16520 #ifde‡
UNIV_DEBUG


16521 
MYSQL_SYSVAR
(
buf„r_poﬁ_evi˘
),

16523 
MYSQL_SYSVAR
(
buf„r_poﬁ_lﬂd_now
),

16524 
MYSQL_SYSVAR
(
buf„r_poﬁ_lﬂd_ab‹t
),

16525 
MYSQL_SYSVAR
(
buf„r_poﬁ_lﬂd_©_°¨tup
),

16526 
MYSQL_SYSVAR
(
Ãu_sˇn_dïth
),

16527 
MYSQL_SYSVAR
(
Êush_√ighb‹s
),

16528 
MYSQL_SYSVAR
(
checksum_Æg‹ôhm
),

16529 
MYSQL_SYSVAR
(
checksums
),

16530 
MYSQL_SYSVAR
(
commô_c⁄cuºícy
),

16531 
MYSQL_SYSVAR
(
c⁄cuºícy_tickës
),

16532 
MYSQL_SYSVAR
(
com¥essi⁄_Àvñ
),

16533 
MYSQL_SYSVAR
(
d©a_fûe_∑th
),

16534 
MYSQL_SYSVAR
(
d©a_home_dú
),

16535 #i‡
SSD_CACHE_FACE


16536 
MYSQL_SYSVAR
(
u£_ssd_ˇche
),

16537 
MYSQL_SYSVAR
(
ssd_ˇche_fûe
),

16538 
MYSQL_SYSVAR
(
ssd_ˇche_size
),

16539 
MYSQL_SYSVAR
(
ssd_ˇche_sˇn_dïth
),

16541 
MYSQL_SYSVAR
(
doubÀwrôe
),

16542 
MYSQL_SYSVAR
(
≠i_íabÀ_bölog
),

16543 
MYSQL_SYSVAR
(
≠i_íabÀ_mdl
),

16544 
MYSQL_SYSVAR
(
≠i_dißbÀ_rowlock
),

16545 
MYSQL_SYSVAR
(
Á°_shutdown
),

16546 
MYSQL_SYSVAR
(
fûe_io_thªads
),

16547 
MYSQL_SYSVAR
(
ªad_io_thªads
),

16548 
MYSQL_SYSVAR
(
wrôe_io_thªads
),

16549 
MYSQL_SYSVAR
(
fûe_≥r_èbÀ
),

16550 
MYSQL_SYSVAR
(
fûe_f‹m©
),

16551 
MYSQL_SYSVAR
(
fûe_f‹m©_check
),

16552 
MYSQL_SYSVAR
(
fûe_f‹m©_max
),

16553 
MYSQL_SYSVAR
(
Êush_log_©_timeout
),

16554 
MYSQL_SYSVAR
(
Êush_log_©_åx_commô
),

16555 
MYSQL_SYSVAR
(
Êush_mëhod
),

16556 
MYSQL_SYSVAR
(
f‹˚_ªcovîy
),

16557 #i‚de‡
DBUG_OFF


16558 
MYSQL_SYSVAR
(
f‹˚_ªcovîy_¸ash
),

16560 
MYSQL_SYSVAR
(
·_ˇche_size
),

16561 
MYSQL_SYSVAR
(
·_tŸÆ_ˇche_size
),

16562 
MYSQL_SYSVAR
(
·_ªsu…_ˇche_limô
),

16563 
MYSQL_SYSVAR
(
·_íabÀ_°›w‹d
),

16564 
MYSQL_SYSVAR
(
·_max_tokí_size
),

16565 
MYSQL_SYSVAR
(
·_mö_tokí_size
),

16566 
MYSQL_SYSVAR
(
·_num_w‹d_›timize
),

16567 
MYSQL_SYSVAR
(
·_s‹t_∂l_degªe
),

16568 
MYSQL_SYSVAR
(
œrge_¥efix
),

16569 
MYSQL_SYSVAR
(
f‹˚_lﬂd_c‹ru±ed
),

16570 
MYSQL_SYSVAR
(
locks_unß„_f‹_bölog
),

16571 
MYSQL_SYSVAR
(
lock_waô_timeout
),

16572 #ifde‡
UNIV_LOG_ARCHIVE


16573 
MYSQL_SYSVAR
(
log_¨ch_dú
),

16574 
MYSQL_SYSVAR
(
log_¨chive
),

16576 
MYSQL_SYSVAR
(
∑ge_size
),

16577 
MYSQL_SYSVAR
(
log_buf„r_size
),

16578 
MYSQL_SYSVAR
(
log_fûe_size
),

16579 
MYSQL_SYSVAR
(
log_fûes_ö_group
),

16580 
MYSQL_SYSVAR
(
log_group_home_dú
),

16581 
MYSQL_SYSVAR
(
log_com¥es£d_∑ges
),

16582 
MYSQL_SYSVAR
(
max_dúty_∑ges_p˘
),

16583 
MYSQL_SYSVAR
(
max_dúty_∑ges_p˘_lwm
),

16584 
MYSQL_SYSVAR
(
ad≠tive_Êushög_lwm
),

16585 
MYSQL_SYSVAR
(
ad≠tive_Êushög
),

16586 
MYSQL_SYSVAR
(
Êushög_avg_lo›s
),

16587 
MYSQL_SYSVAR
(
max_purge_œg
),

16588 
MYSQL_SYSVAR
(
max_purge_œg_dñay
),

16589 
MYSQL_SYSVAR
(
múr‹ed_log_groups
),

16590 
MYSQL_SYSVAR
(
ﬁd_blocks_p˘
),

16591 
MYSQL_SYSVAR
(
ﬁd_blocks_time
),

16592 
MYSQL_SYSVAR
(
›í_fûes
),

16593 
MYSQL_SYSVAR
(
›timize_fuŒãxt_⁄ly
),

16594 
MYSQL_SYSVAR
(
rﬁlback_⁄_timeout
),

16595 
MYSQL_SYSVAR
(
·_aux_èbÀ
),

16596 
MYSQL_SYSVAR
(
·_íabÀ_düg_¥öt
),

16597 
MYSQL_SYSVAR
(
·_£rvî_°›w‹d_èbÀ
),

16598 
MYSQL_SYSVAR
(
·_u£r_°›w‹d_èbÀ
),

16599 
MYSQL_SYSVAR
(
dißbÀ_s‹t_fûe_ˇche
),

16600 
MYSQL_SYSVAR
(
°©s_⁄_mëad©a
),

16601 
MYSQL_SYSVAR
(
°©s_ßm∂e_∑ges
),

16602 
MYSQL_SYSVAR
(
°©s_å™sõ¡_ßm∂e_∑ges
),

16603 
MYSQL_SYSVAR
(
°©s_≥rsi°ít
),

16604 
MYSQL_SYSVAR
(
°©s_≥rsi°ít_ßm∂e_∑ges
),

16605 
MYSQL_SYSVAR
(
°©s_auto_ªˇlc
),

16606 
MYSQL_SYSVAR
(
ad≠tive_hash_ödex
),

16607 
MYSQL_SYSVAR
(
°©s_mëhod
),

16608 
MYSQL_SYSVAR
(
ª∂iˇti⁄_dñay
),

16609 
MYSQL_SYSVAR
(
°©us_fûe
),

16610 
MYSQL_SYSVAR
(
°ri˘_mode
),

16611 
MYSQL_SYSVAR
(
suµ‹t_xa
),

16612 
MYSQL_SYSVAR
(
s‹t_buf„r_size
),

16613 
MYSQL_SYSVAR
(
⁄löe_Æãr_log_max_size
),

16614 
MYSQL_SYSVAR
(
sync_•ö_lo›s
),

16615 
MYSQL_SYSVAR
(
•ö_waô_dñay
),

16616 
MYSQL_SYSVAR
(
èbÀ_locks
),

16617 
MYSQL_SYSVAR
(
thªad_c⁄cuºícy
),

16618 #ifde‡
HAVE_ATOMIC_BUILTINS


16619 
MYSQL_SYSVAR
(
ad≠tive_max_¶ìp_dñay
),

16621 
MYSQL_SYSVAR
(
thªad_¶ìp_dñay
),

16622 
MYSQL_SYSVAR
(
autoöc_lock_mode
),

16623 
MYSQL_SYSVAR
(
vîsi⁄
),

16624 
MYSQL_SYSVAR
(
u£_sys_mÆloc
),

16625 
MYSQL_SYSVAR
(
u£_«tive_aio
),

16626 
MYSQL_SYSVAR
(
ch™ge_buf„rög
),

16627 
MYSQL_SYSVAR
(
ch™ge_buf„r_max_size
),

16628 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_IBUF_DEBUG


16629 
MYSQL_SYSVAR
(
ch™ge_buf„rög_debug
),

16630 
MYSQL_SYSVAR
(
dißbÀ_background_mîge
),

16632 
MYSQL_SYSVAR
(
øndom_ªad_ahód
),

16633 
MYSQL_SYSVAR
(
ªad_ahód_thªshﬁd
),

16634 
MYSQL_SYSVAR
(
ªad_⁄ly
),

16635 
MYSQL_SYSVAR
(
io_ˇ∑côy
),

16636 
MYSQL_SYSVAR
(
io_ˇ∑côy_max
),

16637 
MYSQL_SYSVAR
(
m⁄ô‹_íabÀ
),

16638 
MYSQL_SYSVAR
(
m⁄ô‹_dißbÀ
),

16639 
MYSQL_SYSVAR
(
m⁄ô‹_ª£t
),

16640 
MYSQL_SYSVAR
(
m⁄ô‹_ª£t_Æl
),

16641 
MYSQL_SYSVAR
(
purge_thªads
),

16642 
MYSQL_SYSVAR
(
purge_b©ch_size
),

16643 #ifde‡
UNIV_DEBUG


16644 
MYSQL_SYSVAR
(
purge_run_now
),

16645 
MYSQL_SYSVAR
(
purge_°›_now
),

16646 
MYSQL_SYSVAR
(
log_checkpoöt_now
),

16647 
MYSQL_SYSVAR
(
buf_Êush_li°_now
),

16649 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_PERF_DEBUG


16650 
MYSQL_SYSVAR
(
∑ge_hash_locks
),

16651 
MYSQL_SYSVAR
(
doubÀwrôe_b©ch_size
),

16653 
MYSQL_SYSVAR
(
°©us_ouçut
),

16654 
MYSQL_SYSVAR
(
°©us_ouçut_locks
),

16655 
MYSQL_SYSVAR
(
¥öt_Æl_dódlocks
),

16656 
MYSQL_SYSVAR
(
cmp_≥r_ödex_íabÀd
),

16657 
MYSQL_SYSVAR
(
undo_logs
),

16658 
MYSQL_SYSVAR
(
rﬁlback_£gmíts
),

16659 
MYSQL_SYSVAR
(
undo_dúe˘‹y
),

16660 
MYSQL_SYSVAR
(
undo_èbÀ•a˚s
),

16661 
MYSQL_SYSVAR
(
sync_¨øy_size
),

16662 
MYSQL_SYSVAR
(
com¥essi⁄_Áûuª_thªshﬁd_p˘
),

16663 
MYSQL_SYSVAR
(
com¥essi⁄_∑d_p˘_max
),

16664 #ifde‡
UNIV_DEBUG


16665 
MYSQL_SYSVAR
(
åx_r£g_n_¶Ÿs_debug
),

16666 
MYSQL_SYSVAR
(
limô_›timi°ic_ö£π_debug
),

16667 
MYSQL_SYSVAR
(
åx_purge_võw_upd©e_⁄ly_debug
),

16668 
MYSQL_SYSVAR
(
fû_make_∑ge_dúty_debug
),

16669 
MYSQL_SYSVAR
(
ßved_∑ge_numbî_debug
),

16671 
NULL


16674 
	$mysql_de˛¨e_∂ugö
(
önoba£
)

16676 
MYSQL_STORAGE_ENGINE_PLUGIN
,

16677 &
önoba£_°‹age_ígöe
,

16678 
önoba£_ht⁄_«me
,

16679 
∂ugö_auth‹
,

16681 
PLUGIN_LICENSE_GPL
,

16682 
önoba£_öô
,

16683 
NULL
,

16684 
INNODB_VERSION_SHORT
,

16685 
önodb_°©us_v¨übÀs_exp‹t
,

16686 
önoba£_sy°em_v¨übÀs
,

16687 
NULL
,

16689 
	}
},

16690 
	gi_s_önodb_åx
,

16691 
	gi_s_önodb_locks
,

16692 
	gi_s_önodb_lock_waôs
,

16693 
	gi_s_önodb_cmp
,

16694 
	gi_s_önodb_cmp_ª£t
,

16695 
	gi_s_önodb_cmpmem
,

16696 
	gi_s_önodb_cmpmem_ª£t
,

16697 
	gi_s_önodb_cmp_≥r_ödex
,

16698 
	gi_s_önodb_cmp_≥r_ödex_ª£t
,

16699 
	gi_s_önodb_buf„r_∑ge
,

16700 
	gi_s_önodb_buf„r_∑ge_Ãu
,

16701 
	gi_s_önodb_buf„r_°©s
,

16702 
	gi_s_önodb_mërics
,

16703 
	gi_s_önodb_·_deÁu…_°›w‹d
,

16704 
	gi_s_önodb_·_dñëed
,

16705 
	gi_s_önodb_·_beög_dñëed
,

16706 
	gi_s_önodb_·_c⁄fig
,

16707 
	gi_s_önodb_·_ödex_ˇche
,

16708 
	gi_s_önodb_·_ödex_èbÀ
,

16709 
	gi_s_önodb_sys_èbÀs
,

16710 
	gi_s_önodb_sys_èbÀ°©s
,

16711 
	gi_s_önodb_sys_ödexes
,

16712 
	gi_s_önodb_sys_cﬁumns
,

16713 
	gi_s_önodb_sys_fõlds
,

16714 
	gi_s_önodb_sys_f‹eign
,

16715 
	gi_s_önodb_sys_f‹eign_cﬁs
,

16716 
	gi_s_önodb_sys_èbÀ•a˚s
,

16717 
i_s_önodb_sys_d©afûes


16719 
	gmysql_de˛¨e_∂ugö_íd
;

16732 
	$önoba£_commô_c⁄cuºícy_öô_deÁu…
()

16735 
	`MYSQL_SYSVAR_NAME
(
commô_c⁄cuºícy
).
def_vÆ


16736 
önoba£_commô_c⁄cuºícy
;

16737 
	}
}

16746 
	$önoba£_undo_logs_öô_deÁu…_max
()

16749 
	`MYSQL_SYSVAR_NAME
(
undo_logs
).
max_vÆ


16750 
	`MYSQL_SYSVAR_NAME
(
undo_logs
).
def_vÆ


16751 
°©ic_ˇ°
<>(
§v_avaûabÀ_undo_logs
);

16752 
	}
}

16754 #ifde‡
UNIV_COMPILE_TEST_FUNCS


16756 
	sönoba£_c⁄vît_«me_ã°_t
 {

16757 * 
	mbuf
;

16758 
ulöt
 
	mbuÊí
;

16759 c⁄° * 
	mid
;

16760 
ulöt
 
	midÀn
;

16761 * 
	mthd
;

16762 
iboﬁ
 
	mfûe_id
;

16764 c⁄° * 
	mex≥˘ed
;

16768 
	$ã°_önoba£_c⁄vît_«me
()

16770 
buf
[1024];

16771 
ulöt
 
i
;

16773 
önoba£_c⁄vît_«me_ã°_t
 
ã°_öput
[] = {

16774 {
buf
, (buf), "abcd", 4, 
NULL
, 
TRUE
, "\"abcd\""},

16775 {
buf
, 7, "abcd", 4, 
NULL
, 
TRUE
, "\"abcd\""},

16776 {
buf
, 6, "abcd", 4, 
NULL
, 
TRUE
, "\"abcd\""},

16777 {
buf
, 5, "abcd", 4, 
NULL
, 
TRUE
, "\"abc\""},

16778 {
buf
, 4, "abcd", 4, 
NULL
, 
TRUE
, "\"ab\""},

16780 {
buf
, (buf), "ab@0060cd", 9, 
NULL
, 
TRUE
, "\"ab`cd\""},

16781 {
buf
, 9, "ab@0060cd", 9, 
NULL
, 
TRUE
, "\"ab`cd\""},

16782 {
buf
, 8, "ab@0060cd", 9, 
NULL
, 
TRUE
, "\"ab`cd\""},

16783 {
buf
, 7, "ab@0060cd", 9, 
NULL
, 
TRUE
, "\"ab`cd\""},

16784 {
buf
, 6, "ab@0060cd", 9, 
NULL
, 
TRUE
, "\"ab`c\""},

16785 {
buf
, 5, "ab@0060cd", 9, 
NULL
, 
TRUE
, "\"ab`\""},

16786 {
buf
, 4, "ab@0060cd", 9, 
NULL
, 
TRUE
, "\"ab\""},

16788 {
buf
, (buf), "ab\"cd", 5, 
NULL
, 
TRUE
,

16790 {
buf
, 17, "ab\"cd", 5, 
NULL
, 
TRUE
,

16792 {
buf
, 16, "ab\"cd", 5, 
NULL
, 
TRUE
,

16794 {
buf
, 15, "ab\"cd", 5, 
NULL
, 
TRUE
,

16796 {
buf
, 14, "ab\"cd", 5, 
NULL
, 
TRUE
,

16798 {
buf
, 13, "ab\"cd", 5, 
NULL
, 
TRUE
,

16800 {
buf
, 12, "ab\"cd", 5, 
NULL
, 
TRUE
,

16802 {
buf
, 11, "ab\"cd", 5, 
NULL
, 
TRUE
,

16804 {
buf
, 10, "ab\"cd", 5, 
NULL
, 
TRUE
,

16807 {
buf
, (buf), "ab/cd", 5, 
NULL
, 
TRUE
, "\"ab\".\"cd\""},

16808 {
buf
, 9, "ab/cd", 5, 
NULL
, 
TRUE
, "\"ab\".\"cd\""},

16809 {
buf
, 8, "ab/cd", 5, 
NULL
, 
TRUE
, "\"ab\".\"c\""},

16810 {
buf
, 7, "ab/cd", 5, 
NULL
, 
TRUE
, "\"ab\".\"\""},

16811 {
buf
, 6, "ab/cd", 5, 
NULL
, 
TRUE
, "\"ab\"."},

16812 {
buf
, 5, "ab/cd", 5, 
NULL
, 
TRUE
, "\"ab\"."},

16813 {
buf
, 4, "ab/cd", 5, 
NULL
, 
TRUE
, "\"ab\""},

16814 {
buf
, 3, "ab/cd", 5, 
NULL
, 
TRUE
, "\"a\""},

16815 {
buf
, 2, "ab/cd", 5, 
NULL
, 
TRUE
, "\"\""},

16819 {
buf
, 0, "ab/cd", 5, 
NULL
, 
TRUE
, ""},

16822 
i
 = 0; i < (
ã°_öput
) / (test_input[0]); i++) {

16824 * 
íd
;

16825 
iboﬁ
 
ok
 = 
TRUE
;

16826 
size_t
 
ªs_Àn
;

16828 
	`Ârötf
(
°dîr
, "TESTING %lu, %s, %lu, %s\n",

16829 
ã°_öput
[
i
].
buÊí
,

16830 
ã°_öput
[
i
].
id
,

16831 
ã°_öput
[
i
].
idÀn
,

16832 
ã°_öput
[
i
].
ex≥˘ed
);

16834 
íd
 = 
	`önoba£_c⁄vît_«me
(

16835 
ã°_öput
[
i
].
buf
,

16836 
ã°_öput
[
i
].
buÊí
,

16837 
ã°_öput
[
i
].
id
,

16838 
ã°_öput
[
i
].
idÀn
,

16839 
ã°_öput
[
i
].
thd
,

16840 
ã°_öput
[
i
].
fûe_id
);

16842 
ªs_Àn
 = (
size_t
Ë(
íd
 - 
ã°_öput
[
i
].
buf
);

16844 i‡(
ªs_Àn
 !
	`°æí
(
ã°_öput
[
i
].
ex≥˘ed
)) {

16846 
	`Ârötf
(
°dîr
, "unexpectedÜen ofÅheÑesult: %u, "

16847 "ex≥˘ed: %u\n", (Ë
ªs_Àn
,

16848 (Ë
	`°æí
(
ã°_öput
[
i
].
ex≥˘ed
));

16849 
ok
 = 
FALSE
;

16852 i‡(
	`memcmp
(
ã°_öput
[
i
].
buf
,

16853 
ã°_öput
[
i
].
ex≥˘ed
,

16854 
	`°æí
(
ã°_öput
[
i
].
ex≥˘ed
)) != 0

16855 || !
ok
) {

16857 
	`Ârötf
(
°dîr
, "unexpectedÑesult: %.*s, "

16858 "ex≥˘ed: %s\n", (Ë
ªs_Àn
,

16859 
ã°_öput
[
i
].
buf
,

16860 
ã°_öput
[
i
].
ex≥˘ed
);

16861 
ok
 = 
FALSE
;

16864 i‡(
ok
) {

16865 
	`Ârötf
(
°dîr
, "OK:Ñes: %.*s\n\n", (Ë
ªs_Àn
,

16866 
buf
);

16868 
	`Ârötf
(
°dîr
, "FAILED\n\n");

16872 
	}
}

16885 
	gha_önoba£
::
	$mu…i_ønge_ªad_öô
(

16886 
RANGE_SEQ_IF
* 
£q
,

16887 * 
£q_öô_∑øm
,

16888 
uöt
 
n_ønges
,

16889 
uöt
 
mode
,

16890 
HANDLER_BUFFER
* 
buf
)

16892 (
ds_mº
.
	`dsmº_öô
(
this
, 
£q
, 
£q_öô_∑øm
,

16893 
n_ønges
, 
mode
, 
buf
));

16894 
	}
}

16897 
	gha_önoba£
::
	$mu…i_ønge_ªad_√xt
(

16898 ** 
ønge_öfo
)

16900 (
ds_mº
.
	`dsmº_√xt
(
ønge_öfo
));

16901 
	}
}

16903 
ha_rows


16904 
	gha_önoba£
::
	$mu…i_ønge_ªad_öfo_c⁄°
(

16905 
uöt
 
keyno
,

16906 
RANGE_SEQ_IF
* 
£q
,

16907 * 
£q_öô_∑øm
,

16908 
uöt
 
n_ønges
,

16909 
uöt
* 
bufsz
,

16910 
uöt
* 
Êags
,

16911 
Co°_e°im©e
* 
co°
)

16914 
ds_mº
.
	`öô
(
this
, 
èbÀ
);

16915 (
ds_mº
.
	`dsmº_öfo_c⁄°
(
keyno
, 
£q
, 
£q_öô_∑øm
,

16916 
n_ønges
, 
bufsz
, 
Êags
, 
co°
));

16917 
	}
}

16919 
ha_rows


16920 
	gha_önoba£
::
	$mu…i_ønge_ªad_öfo
(

16921 
uöt
 
keyno
,

16922 
uöt
 
n_ønges
,

16923 
uöt
 
keys
,

16924 
uöt
* 
bufsz
,

16925 
uöt
* 
Êags
,

16926 
Co°_e°im©e
* 
co°
)

16928 
ds_mº
.
	`öô
(
this
, 
èbÀ
);

16929 (
ds_mº
.
	`dsmº_öfo
(
keyno
, 
n_ønges
, 
keys
, 
bufsz
, 
Êags
, 
co°
));

16930 
	}
}

16940 
UNIV_INTERN


16941 
i˝_ªsu…


16942 
	$önoba£_ödex_c⁄d
(

16944 * 
fûe
)

16946 
	`DBUG_ENTER
("innobase_index_cond");

16948 
ha_önoba£
* 
h
 = 
ªöãΩªt_ˇ°
<
˛ass
 ha_önoba£*>(
fûe
);

16950 
	`DBUG_ASSERT
(
h
->
pushed_idx_c⁄d
);

16951 
	`DBUG_ASSERT
(
h
->
pushed_idx_c⁄d_keyno
 !
MAX_KEY
);

16953 i‡(
h
->
íd_ønge
 && h->
	`com∑ª_key_i˝
(h->end_range) > 0) {

16956 
	`DBUG_RETURN
(
ICP_OUT_OF_RANGE
);

16959 
	`DBUG_RETURN
(
h
->
pushed_idx_c⁄d
->
	`vÆ_öt
(Ë? 
ICP_MATCH
 : 
ICP_NO_MATCH
);

16960 
	}
}

16967 
UNIV_INTERN


16968 
˛ass
 
Iãm
*

16969 
	gha_önoba£
::
	$idx_c⁄d_push
(

16970 
uöt
 
keyno
,

16971 
˛ass
 
Iãm
* 
idx_c⁄d
)

16973 
	`DBUG_ENTER
("ha_innobase::idx_cond_push");

16974 
	`DBUG_ASSERT
(
keyno
 !
MAX_KEY
);

16975 
	`DBUG_ASSERT
(
idx_c⁄d
 !
NULL
);

16977 
pushed_idx_c⁄d
 = 
idx_c⁄d
;

16978 
pushed_idx_c⁄d_keyno
 = 
keyno
;

16979 
ö_ønge_check_pushed_down
 = 
TRUE
;

16981 
	`DBUG_RETURN
(
NULL
);

16982 
	}
}

16994 
UNIV_INTERN


16996 
	$ib_£ndîrf
(

16998 
THD
* 
thd
,

16999 
ib_log_Àvñ_t
 
Àvñ
,

17000 
ib_uöt32_t
 
code
,

17003 * 
°r
;

17004 
va_li°
 
¨gs
;

17005 c⁄° * 
f‹m©
 = 
	`önoba£_gë_îr_msg
(
code
);

17010 
	`ut_a
(
thd
 != 0);

17013 
	`ut_a
(
f‹m©
 != 0);

17015 
	`va_°¨t
(
¨gs
, 
code
);

17017 #ifde‡
__WIN__


17018 
size
 = 
	`_vs˝rötf
(
f‹m©
, 
¨gs
) + 1;

17019 
°r
 = 
°©ic_ˇ°
<*>(
	`mÆloc
(
size
));

17020 
°r
[
size
 - 1] = 0x0;

17021 
	`v¢¥ötf
(
°r
, 
size
, 
f‹m©
, 
¨gs
);

17022 #ñi‡
HAVE_VASPRINTF


17023 
ªt
;

17024 
ªt
 = 
	`va•rötf
(&
°r
, 
f‹m©
, 
¨gs
);

17025 
	`ut_a
(
ªt
 != -1);

17028 
°r
 = 
°©ic_ˇ°
<*>(
	`mÆloc
(
BUFSIZ
));

17029 
	`my_v¢¥ötf
(
°r
, 
BUFSIZ
, 
f‹m©
, 
¨gs
);

17032 
Sql_c⁄dôi⁄
::
íum_w¨nög_Àvñ
 
l
;

17034 
l
 = 
Sql_c⁄dôi⁄
::
WARN_LEVEL_NOTE
;

17036 
Àvñ
) {

17037 
IB_LOG_LEVEL_INFO
:

17039 
IB_LOG_LEVEL_WARN
:

17040 
l
 = 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
;

17042 
IB_LOG_LEVEL_ERROR
:

17044 
	`my_¥ötf_îr‹
(
code
, "%s", 
	`MYF
(0), 
°r
);

17046 
IB_LOG_LEVEL_FATAL
:

17047 
l
 = 
Sql_c⁄dôi⁄
::
WARN_LEVEL_END
;

17051 i‡(
Àvñ
 !
IB_LOG_LEVEL_ERROR
) {

17052 
	`push_w¨nög_¥ötf
(
thd
, 
l
, 
code
, "I¬oDB: %s", 
°r
);

17055 
	`va_íd
(
¨gs
);

17056 
	`‰ì
(
°r
);

17058 i‡(
Àvñ
 =
IB_LOG_LEVEL_FATAL
) {

17059 
ut_îr‹
;

17061 
	}
}

17074 
UNIV_INTERN


17076 
	$ib_îrf
(

17078 
THD
* 
thd
,

17079 
ib_log_Àvñ_t
 
Àvñ
,

17080 
ib_uöt32_t
 
code
,

17081 c⁄° * 
f‹m©
,

17084 * 
°r
;

17085 
va_li°
 
¨gs
;

17090 
	`ut_a
(
thd
 != 0);

17091 
	`ut_a
(
f‹m©
 != 0);

17093 
	`va_°¨t
(
¨gs
, 
f‹m©
);

17095 #ifde‡
__WIN__


17096 
size
 = 
	`_vs˝rötf
(
f‹m©
, 
¨gs
) + 1;

17097 
°r
 = 
°©ic_ˇ°
<*>(
	`mÆloc
(
size
));

17098 
°r
[
size
 - 1] = 0x0;

17099 
	`v¢¥ötf
(
°r
, 
size
, 
f‹m©
, 
¨gs
);

17100 #ñi‡
HAVE_VASPRINTF


17101 
ªt
;

17102 
ªt
 = 
	`va•rötf
(&
°r
, 
f‹m©
, 
¨gs
);

17103 
	`ut_a
(
ªt
 != -1);

17106 
°r
 = 
°©ic_ˇ°
<*>(
	`mÆloc
(
BUFSIZ
));

17107 
	`my_v¢¥ötf
(
°r
, 
BUFSIZ
, 
f‹m©
, 
¨gs
);

17110 
	`ib_£ndîrf
(
thd
, 
Àvñ
, 
code
, 
°r
);

17112 
	`va_íd
(
¨gs
);

17113 
	`‰ì
(
°r
);

17114 
	}
}

17118 
UNIV_INTERN


17120 
	$ib_logf
(

17122 
ib_log_Àvñ_t
 
Àvñ
,

17123 c⁄° * 
f‹m©
,

17126 * 
°r
;

17127 
va_li°
 
¨gs
;

17129 
	`va_°¨t
(
¨gs
, 
f‹m©
);

17131 #ifde‡
__WIN__


17132 
size
 = 
	`_vs˝rötf
(
f‹m©
, 
¨gs
) + 1;

17133 
°r
 = 
°©ic_ˇ°
<*>(
	`mÆloc
(
size
));

17134 
°r
[
size
 - 1] = 0x0;

17135 
	`v¢¥ötf
(
°r
, 
size
, 
f‹m©
, 
¨gs
);

17136 #ñi‡
HAVE_VASPRINTF


17137 
ªt
;

17138 
ªt
 = 
	`va•rötf
(&
°r
, 
f‹m©
, 
¨gs
);

17139 
	`ut_a
(
ªt
 != -1);

17142 
°r
 = 
°©ic_ˇ°
<*>(
	`mÆloc
(
BUFSIZ
));

17143 
	`my_v¢¥ötf
(
°r
, 
BUFSIZ
, 
f‹m©
, 
¨gs
);

17146 
Àvñ
) {

17147 
IB_LOG_LEVEL_INFO
:

17148 
	`sql_¥öt_öf‹m©i⁄
("I¬oDB: %s", 
°r
);

17150 
IB_LOG_LEVEL_WARN
:

17151 
	`sql_¥öt_w¨nög
("I¬oDB: %s", 
°r
);

17153 
IB_LOG_LEVEL_ERROR
:

17154 
	`sql_¥öt_îr‹
("I¬oDB: %s", 
°r
);

17156 
IB_LOG_LEVEL_FATAL
:

17157 
	`sql_¥öt_îr‹
("I¬oDB: %s", 
°r
);

17161 
	`va_íd
(
¨gs
);

17162 
	`‰ì
(
°r
);

17164 i‡(
Àvñ
 =
IB_LOG_LEVEL_FATAL
) {

17165 
ut_îr‹
;

17167 
	}
}

17172 
uöt


17173 
	$önoba£_c⁄vît_to_fûíame_ch¨£t
(

17175 * 
to
,

17176 c⁄° * 
‰om
,

17177 
ulöt
 
Àn
)

17179 
uöt
 
îr‹s
;

17180 
CHARSET_INFO
* 
cs_to
 = &
my_ch¨£t_fûíame
;

17181 
CHARSET_INFO
* 
cs_‰om
 = 
sy°em_ch¨£t_öfo
;

17183 (
	`°rc⁄vît
(

17184 
cs_‰om
, 
‰om
, 
cs_to
, 
to
, 
°©ic_ˇ°
<
uöt
>(
Àn
), &
îr‹s
));

17185 
	}
}

17190 
uöt


17191 
	$önoba£_c⁄vît_to_sy°em_ch¨£t
(

17193 * 
to
,

17194 c⁄° * 
‰om
,

17195 
ulöt
 
Àn
,

17196 
uöt
* 
îr‹s
)

17198 
CHARSET_INFO
* 
cs1
 = &
my_ch¨£t_fûíame
;

17199 
CHARSET_INFO
* 
cs2
 = 
sy°em_ch¨£t_öfo
;

17201 (
	`°rc⁄vît
(

17202 
cs1
, 
‰om
, 
cs2
, 
to
, 
°©ic_ˇ°
<
uöt
>(
Àn
), 
îr‹s
));

17203 
	}
}

17208 
	$ib_w¨n_row_too_big
(c⁄° 
di˘_èbÀ_t
* 
èbÀ
)

17212 c⁄° 
boﬁ
 
¥efix
 = (
	`di˘_tf_gë_f‹m©
(
èbÀ
->
Êags
)

17213 =
UNIV_FORMAT_A
);

17215 c⁄° 
ulöt
 
‰ì_•a˚
 = 
	`∑ge_gë_‰ì_•a˚_of_em±y
(

17216 
èbÀ
->
Êags
 & 
DICT_TF_COMPACT
) / 2;

17218 
THD
* 
thd
 = 
cuºít_thd
;

17220 
	`push_w¨nög_¥ötf
(

17221 
thd
, 
Sql_c⁄dôi⁄
::
WARN_LEVEL_WARN
, 
HA_ERR_TO_BIG_ROW
,

17224 " %d byã†i†°‹ed i∆öe.", 
‰ì_•a˚


17225 , 
¥efix
 ? "or using ROW_FORMAT=DYNAMIC or"

17227 , 
¥efix
 ? 
DICT_MAX_FIXED_COL_LEN
 : 0);

17228 
	}
}

	@srv0srv.cc

42 
	~"§v0§v.h
"

44 
	~"ut0mem.h
"

45 
	~"ut0ut.h
"

46 
	~"os0¥oc.h
"

47 
	~"mem0mem.h
"

48 
	~"mem0poﬁ.h
"

49 
	~"sync0sync.h
"

50 
	~"que0que.h
"

51 
	~"log0ªcv.h
"

52 
	~"∑rs0∑rs.h
"

53 
	~"u§0£ss.h
"

54 
	~"lock0lock.h
"

55 
	~"åx0purge.h
"

56 
	~"ibuf0ibuf.h
"

57 
	~"buf0Êu.h
"

58 
	~"buf0Ãu.h
"

59 
	~"bå0£a.h
"

60 
	~"di˘0lﬂd.h
"

61 
	~"di˘0boŸ.h
"

62 
	~"di˘0°©s_bg.h
"

63 
	~"§v0°¨t.h
"

64 
	~"row0mysql.h
"

65 
	~"ha_¥ŸŸy≥s.h
"

66 
	~"åx0i_s.h
"

67 
	~"os0sync.h
"

68 
	~"§v0m⁄.h
"

69 
	~"ut0¸c32.h
"

71 
	~"mysql/∂ugö.h
"

72 
	~"mysql/£rvi˚_thd_waô.h
"

75 
UNIV_INTERN
 
ulöt
 
	g§v_Áèl_£m≠h‹e_waô_thªshﬁd
 = 600;

79 
UNIV_INTERN
 
ulöt
 
	g§v_dml_√eded_dñay
 = 0;

81 
UNIV_INTERN
 
iboﬁ
 
	g§v_m⁄ô‹_a˘ive
 = 
FALSE
;

82 
UNIV_INTERN
 
iboﬁ
 
	g§v_îr‹_m⁄ô‹_a˘ive
 = 
FALSE
;

84 
UNIV_INTERN
 
iboﬁ
 
	g§v_buf_dump_thªad_a˘ive
 = 
FALSE
;

86 
UNIV_INTERN
 
iboﬁ
 
	g§v_di˘_°©s_thªad_a˘ive
 = 
FALSE
;

88 
UNIV_INTERN
 c⁄° * 
	g§v_maö_thªad_›_öfo
 = "";

91 c⁄° 
	g§v_mysql50_èbÀ_«me_¥efix
[10] = "#mysql50#";

98 
UNIV_INTERN
 * 
	g§v_d©a_home
 = 
NULL
;

101 
UNIV_INTERN
 * 
	g§v_undo_dú
 = 
NULL
;

104 
UNIV_INTERN
 
ul⁄g
 
	g§v_undo_èbÀ•a˚s
 = 8;

107 
UNIV_INTERN
 
ulöt
 
	g§v_undo_èbÀ•a˚s_›í
 = 8;

110 
UNIV_INTERN
 
ul⁄g
 
	g§v_undo_logs
 = 1;

112 #ifde‡
UNIV_LOG_ARCHIVE


113 
UNIV_INTERN
 * 
	g§v_¨ch_dú
 = 
NULL
;

119 
UNIV_INTERN
 
my_boﬁ
 
	g§v_ªad_⁄ly_mode
;

122 
UNIV_INTERN
 
my_boﬁ
 
	g§v_fûe_≥r_èbÀ
;

124 
UNIV_INTERN
 
ulöt
 
	g§v_fûe_f‹m©
 = 0;

128 
UNIV_INTERN
 
ulöt
 
	g§v_max_fûe_f‹m©_©_°¨tup
 = 
UNIV_FORMAT_MAX
;

130 #i‡
UNIV_FORMAT_A


136 
UNIV_INTERN
 
iboﬁ
 
	g§v_locks_unß„_f‹_bölog
 = 
FALSE
;

138 
UNIV_INTERN
 
ul⁄g
 
	g§v_s‹t_buf_size
 = 1048576;

140 
UNIV_INTERN
 
	g§v_⁄löe_max_size
;

146 
UNIV_INTERN
 
my_boﬁ
 
	g§v_u£_«tive_aio
 = 
TRUE
;

148 #ifde‡
__WIN__


160 
UNIV_INTERN
 
iboﬁ
 
	g§v_u£_«tive_c⁄dôi⁄s
 = 
FALSE
;

163 
UNIV_INTERN
 
ulöt
 
	g§v_n_d©a_fûes
 = 0;

164 
UNIV_INTERN
 ** 
	g§v_d©a_fûe_«mes
 = 
NULL
;

166 
UNIV_INTERN
 
ulöt
* 
	g§v_d©a_fûe_sizes
 = 
NULL
;

169 
UNIV_INTERN
 
iboﬁ
 
	g§v_auto_exãnd_œ°_d©a_fûe
 = 
FALSE
;

172 
UNIV_INTERN
 
ulöt
 
	g§v_œ°_fûe_size_max
 = 0;

175 
UNIV_INTERN
 
ul⁄g
 
	g§v_auto_exãnd_ö¸emít
 = 8;

176 
UNIV_INTERN
 
ulöt
* 
	g§v_d©a_fûe_is_øw_∑πôi⁄
 = 
NULL
;

181 
UNIV_INTERN
 
iboﬁ
 
	g§v_¸óãd_√w_øw
 = 
FALSE
;

183 
	~"Á˚0Á˚.h
"

184 #ifde‡
SSD_CACHE_FACE


185 
UNIV_INTERN
 
iboﬁ
 
	g§v_u£_ssd_ˇche
 = 
FALSE
;

186 
UNIV_INTERN
 * 
	g§v_ssd_ˇche_fûe
 = 
NULL
;

187 
UNIV_INTERN
 
ulöt
 
	g§v_ssd_ˇche_size
 = 
ULINT_MAX
;

188 
UNIV_INTERN
 
ulöt
 
	g§v_ssd_ˇche_tŸÆ_ªf
 = 0;

189 
UNIV_INTERN
 
ulöt
 
	g§v_ssd_ˇche_hô_ªf
 = 0;

190 
UNIV_INTERN
 
ulöt
 
	g§v_ssd_ˇche_sˇn_dïth
 = 0;

193 
UNIV_INTERN
 * 
	g§v_log_group_home_dú
 = 
NULL
;

195 
UNIV_INTERN
 
ul⁄g
 
	g§v_n_log_fûes
 = 
SRV_N_LOG_FILES_MAX
;

197 
UNIV_INTERN
 
ib_uöt64_t
 
	g§v_log_fûe_size
 = 
IB_UINT64_MAX
;

198 
UNIV_INTERN
 
ib_uöt64_t
 
	g§v_log_fûe_size_ªque°ed
;

200 
UNIV_INTERN
 
ulöt
 
	g§v_log_buf„r_size
 = 
ULINT_MAX
;

201 
UNIV_INTERN
 
ul⁄g
 
	g§v_Êush_log_©_åx_commô
 = 1;

202 
UNIV_INTERN
 
uöt
 
	g§v_Êush_log_©_timeout
 = 1;

203 
UNIV_INTERN
 
ul⁄g
 
	g§v_∑ge_size
 = 
UNIV_PAGE_SIZE_DEF
;

204 
UNIV_INTERN
 
ul⁄g
 
	g§v_∑ge_size_shi·
 = 
UNIV_PAGE_SIZE_SHIFT_DEF
;

208 
UNIV_INTERN
 
	g§v_ad≠tive_Êushög
 = 
TRUE
;

212 
	#MAX_MUTEX_NOWAIT
 20

	)

218 
	#MUTEX_NOWAIT
(
muãx_skù≥d
Ë((muãx_skù≥dË< 
MAX_MUTEX_NOWAIT
)

	)

222 
UNIV_INTERN
 c⁄° 
byã
* 
	g§v_œtö1_‹dîög
;

225 
UNIV_INTERN
 
my_boﬁ
 
	g§v_u£_sys_mÆloc
 = 
TRUE
;

227 
UNIV_INTERN
 
ulöt
 
	g§v_buf_poﬁ_size
 = 
ULINT_MAX
;

229 
UNIV_INTERN
 
ulöt
 
	g§v_buf_poﬁ_ö°™˚s
 = 1;

231 
UNIV_INTERN
 
ul⁄g
 
	g§v_n_∑ge_hash_locks
 = 16;

233 
UNIV_INTERN
 
ul⁄g
 
	g§v_LRU_sˇn_dïth
 = 1024;

235 
UNIV_INTERN
 
ul⁄g
 
	g§v_Êush_√ighb‹s
 = 1;

237 
UNIV_INTERN
 
ulöt
 
	g§v_buf_poﬁ_ﬁd_size
;

239 
UNIV_INTERN
 
ulöt
 
	g§v_buf_poﬁ_cuº_size
 = 0;

241 
UNIV_INTERN
 
ulöt
 
	g§v_mem_poﬁ_size
 = 
ULINT_MAX
;

242 
UNIV_INTERN
 
ulöt
 
	g§v_lock_èbÀ_size
 = 
ULINT_MAX
;

246 
UNIV_INTERN
 
ulöt
 
	g§v_n_fûe_io_thªads
 = 
ULINT_MAX
;

247 
UNIV_INTERN
 
ulöt
 
	g§v_n_ªad_io_thªads
 = 
ULINT_MAX
;

248 
UNIV_INTERN
 
ulöt
 
	g§v_n_wrôe_io_thªads
 = 
ULINT_MAX
;

251 
UNIV_INTERN
 
my_boﬁ
 
	g§v_øndom_ªad_ahód
 = 
FALSE
;

255 
UNIV_INTERN
 
ul⁄g
 
	g§v_ªad_ahód_thªshﬁd
 = 56;

257 #ifde‡
UNIV_LOG_ARCHIVE


258 
UNIV_INTERN
 
iboﬁ
 
	g§v_log_¨chive_⁄
 = 
FALSE
;

259 
UNIV_INTERN
 
iboﬁ
 
	g§v_¨chive_ªcovîy
 = 0;

260 
UNIV_INTERN
 
ib_uöt64_t
 
	g§v_¨chive_ªcovîy_limô_l¢
;

271 
UNIV_INTERN
 
ul⁄g
 
	g§v_ö£π_buf„r_b©ch_size
 = 20;

273 
UNIV_INTERN
 * 
	g§v_fûe_Êush_mëhod_°r
 = 
NULL
;

274 
UNIV_INTERN
 
ulöt
 
	g§v_unix_fûe_Êush_mëhod
 = 
SRV_UNIX_FSYNC
;

275 
UNIV_INTERN
 
ulöt
 
	g§v_wö_fûe_Êush_mëhod
 = 
SRV_WIN_IO_UNBUFFERED
;

277 
UNIV_INTERN
 
ulöt
 
	g§v_max_n_›í_fûes
 = 300;

280 
UNIV_INTERN
 
ul⁄g
 
	g§v_io_ˇ∑côy
 = 200;

281 
UNIV_INTERN
 
ul⁄g
 
	g§v_max_io_ˇ∑côy
 = 400;

288 
UNIV_INTERN
 
ul⁄g
 
	g§v_max_buf_poﬁ_modifõd_p˘
 = 75;

289 
UNIV_INTERN
 
ul⁄g
 
	g§v_max_dúty_∑ges_p˘_lwm
 = 50;

293 
UNIV_INTERN
 
ul⁄g
 
	g§v_ad≠tive_Êushög_lwm
 = 10;

296 
UNIV_INTERN
 
ul⁄g
 
	g§v_Êushög_avg_lo›s
 = 30;

299 
UNIV_INTERN
 
ul⁄g
 
	g§v_n_purge_thªads
 = 1;

302 
UNIV_INTERN
 
ul⁄g
 
	g§v_purge_b©ch_size
 = 20;

307 
UNIV_INTERN
 
ul⁄g
 
	g§v_önodb_°©s_mëhod
 = 
SRV_STATS_NULLS_EQUAL
;

309 
UNIV_INTERN
 
§v_°©s_t
 
	g§v_°©s
;

312 
UNIV_INTERN
 
exp‹t_v¨_t
 
	gexp‹t_v¨s
;

318 
UNIV_INTERN
 
ul⁄g
 
	g§v_f‹˚_ªcovîy
;

319 #i‚de‡
DBUG_OFF


322 
UNIV_INTERN
 
ul⁄g
 
	g§v_f‹˚_ªcovîy_¸ash
;

327 
UNIV_INTERN
 
my_boﬁ
 
	g§v_¥öt_Æl_dódlocks
 = 
FALSE
;

330 
UNIV_INTERN
 
my_boﬁ
 
	g§v_cmp_≥r_ödex_íabÀd
 = 
FALSE
;

336 
UNIV_INTERN
 
ulöt
 
	g§v_Á°_shutdown
 = 0;

339 
UNIV_INTERN
 
iboﬁ
 
	g§v_önodb_°©us
 = 
FALSE
;

347 
UNIV_INTERN
 
	g§v_°©s_å™sõ¡_ßm∂e_∑ges
 = 8;

348 
UNIV_INTERN
 
my_boﬁ
 
	g§v_°©s_≥rsi°ít
 = 
TRUE
;

349 
UNIV_INTERN
 
	g§v_°©s_≥rsi°ít_ßm∂e_∑ges
 = 20;

350 
UNIV_INTERN
 
my_boﬁ
 
	g§v_°©s_auto_ªˇlc
 = 
TRUE
;

352 
UNIV_INTERN
 
iboﬁ
 
	g§v_u£_doubÀwrôe_buf
 = 
TRUE
;

358 
UNIV_INTERN
 
ul⁄g
 
	g§v_doubÀwrôe_b©ch_size
 = 120;

360 
UNIV_INTERN
 
ul⁄g
 
	g§v_ª∂iˇti⁄_dñay
 = 0;

363 
UNIV_INTERN
 
ul⁄g
 
	g§v_n_•ö_waô_rounds
 = 30;

364 
UNIV_INTERN
 
ul⁄g
 
	g§v_•ö_waô_dñay
 = 6;

365 
UNIV_INTERN
 
iboﬁ
 
	g§v_¥i‹ôy_boo°
 = 
TRUE
;

367 #ifde‡
UNIV_DEBUG


368 
UNIV_INTERN
 
iboﬁ
 
	g§v_¥öt_thªad_ªÀa£s
 = 
FALSE
;

369 
UNIV_INTERN
 
iboﬁ
 
	g§v_¥öt_lock_waôs
 = 
FALSE
;

370 
UNIV_INTERN
 
iboﬁ
 
	g§v_¥öt_buf_io
 = 
FALSE
;

371 
UNIV_INTERN
 
iboﬁ
 
	g§v_¥öt_log_io
 = 
FALSE
;

372 
UNIV_INTERN
 
iboﬁ
 
	g§v_¥öt_œtch_waôs
 = 
FALSE
;

375 
ulöt
 
	g§v_n_rows_ö£πed_ﬁd
 = 0;

376 
ulöt
 
	g§v_n_rows_upd©ed_ﬁd
 = 0;

377 
ulöt
 
	g§v_n_rows_dñëed_ﬁd
 = 0;

378 
ulöt
 
	g§v_n_rows_ªad_ﬁd
 = 0;

380 
UNIV_INTERN
 
ulöt
 
	g§v_åunˇãd_°©us_wrôes
 = 0;

381 
UNIV_INTERN
 
ulöt
 
	g§v_avaûabÀ_undo_logs
 = 0;

385 
UNIV_INTERN
 
iboﬁ
 
	g§v_¥öt_vîbo£_log
 = 
TRUE
;

386 
UNIV_INTERN
 
my_boﬁ
 
	g§v_¥öt_önodb_m⁄ô‹
 = 
FALSE
;

387 
UNIV_INTERN
 
my_boﬁ
 
	g§v_¥öt_önodb_lock_m⁄ô‹
 = 
FALSE
;

388 
UNIV_INTERN
 
iboﬁ
 
	g§v_¥öt_önodb_èbÀ•a˚_m⁄ô‹
 = 
FALSE
;

389 
UNIV_INTERN
 
iboﬁ
 
	g§v_¥öt_önodb_èbÀ_m⁄ô‹
 = 
FALSE
;

394 
UNIV_INTERN
 c⁄° * 
	g§v_io_thªad_›_öfo
[
SRV_MAX_N_IO_THREADS
];

395 
UNIV_INTERN
 c⁄° * 
	g§v_io_thªad_fun˘i⁄
[
SRV_MAX_N_IO_THREADS
];

397 
UNIV_INTERN
 
time_t
 
	g§v_œ°_m⁄ô‹_time
;

399 
UNIV_INTERN
 
ib_muãx_t
 
	g§v_önodb_m⁄ô‹_muãx
;

402 
UNIV_INTERN
 
ib_muãx_t
 
	g§v_m⁄ô‹_fûe_muãx
;

404 #ifde‡
UNIV_PFS_MUTEX


405 #i‚de‡
HAVE_ATOMIC_BUILTINS


407 
UNIV_INTERN
 
mysql_pfs_key_t
 
	g£rvî_muãx_key
;

410 
UNIV_INTERN
 
mysql_pfs_key_t
 
	g§v_önodb_m⁄ô‹_muãx_key
;

412 
UNIV_INTERN
 
mysql_pfs_key_t
 
	g§v_m⁄ô‹_fûe_muãx_key
;

414 
UNIV_INTERN
 
mysql_pfs_key_t
 
	g§v_di˘_tmpfûe_muãx_key
;

416 
UNIV_INTERN
 
mysql_pfs_key_t
 
	g§v_misc_tmpfûe_muãx_key
;

418 
UNIV_INTERN
 
mysql_pfs_key_t
 
	g§v_sys_muãx_key
;

420 
UNIV_INTERN
 
mysql_pfs_key_t
 
	g§v_sys_èsks_muãx_key
;

424 
UNIV_INTERN
 
FILE
* 
	g§v_m⁄ô‹_fûe
;

428 
UNIV_INTERN
 
ib_muãx_t
 
	g§v_di˘_tmpfûe_muãx
;

430 
UNIV_INTERN
 
FILE
* 
	g§v_di˘_tmpfûe
;

434 
UNIV_INTERN
 
ib_muãx_t
 
	g§v_misc_tmpfûe_muãx
;

436 
UNIV_INTERN
 
FILE
* 
	g§v_misc_tmpfûe
;

438 
UNIV_INTERN
 
ulöt
 
	g§v_maö_thªad_¥o˚ss_no
 = 0;

439 
UNIV_INTERN
 
ulöt
 
	g§v_maö_thªad_id
 = 0;

444 
ulöt
 
	g§v_maö_a˘ive_lo›s
 = 0;

446 
ulöt
 
	g§v_maö_idÀ_lo›s
 = 0;

448 
ulöt
 
	g§v_maö_shutdown_lo›s
 = 0;

450 
ulöt
 
	g§v_log_wrôes_™d_Êush
 = 0;

456 
time_t
 
	g§v_œ°_log_Êush_time
;

466 
	#SRV_MASTER_CHECKPOINT_INTERVAL
 (7)

	)

467 
	#SRV_MASTER_PURGE_INTERVAL
 (10)

	)

468 #ifde‡
MEM_PERIODIC_CHECK


469 
	#SRV_MASTER_MEM_VALIDATE_INTERVAL
 (13)

	)

471 
	#SRV_MASTER_DICT_LRU_INTERVAL
 (47)

	)

474 
	#§v_sys_muãx_íãr
() do { \

475 
	`muãx_íãr
(&
§v_sys
->
muãx
); \

476 } 0)

	)

479 
	#§v_sys_muãx_own
(Ë(
	`muãx_own
(&
§v_sys
->
muãx
) \

480 && !
§v_ªad_⁄ly_mode
)

	)

483 
	#§v_sys_muãx_exô
() do { \

484 
	`muãx_exô
(&
§v_sys
->
muãx
); \

485 } 0)

	)

487 
	#„tch_lock_waô_timeout
(
åx
) \

488 ((
åx
)->
lock
.
Ælowed_to_waô
 \

489 ? 
	`thd_lock_waô_timeout
((
åx
)->
mysql_thd
) \

490 : 0)

	)

565 
	s§v_sys_t
{

566 
ib_muãx_t
 
	mèsks_muãx
;

568 
UT_LIST_BASE_NODE_T
(
que_thr_t
)

569 
	mèsks
;

571 
ib_muãx_t
 
	mmuãx
;

573 
ulöt
 
	mn_sys_thªads
;

576 
§v_¶Ÿ_t
* 
	msys_thªads
;

578 
ulöt
 
	mn_thªads_a˘ive
[
SRV_MASTER
 + 1];

582 
	m§v_°©s_t
::
ulöt_˘r_1_t


583 
a˘ivôy_cou¡
;

587 #i‚de‡
HAVE_ATOMIC_BUILTINS


589 
UNIV_INTERN
 
ib_muãx_t
 
	g£rvî_muãx
;

592 
§v_sys_t
* 
	g§v_sys
 = 
NULL
;

595 
UNIV_INTERN
 
os_evít_t
 
	g§v_m⁄ô‹_evít
;

598 
UNIV_INTERN
 
os_evít_t
 
	g§v_îr‹_evít
;

601 
UNIV_INTERN
 
os_evít_t
 
	g§v_buf_dump_evít
;

604 
UNIV_INTERN
 * 
	g§v_buf_dump_fûíame
;

608 
UNIV_INTERN
 
	g§v_buf„r_poﬁ_dump_©_shutdown
 = 
FALSE
;

609 
UNIV_INTERN
 
	g§v_buf„r_poﬁ_lﬂd_©_°¨tup
 = 
FALSE
;

612 c⁄° 
ulöt
 
	gSRV_PURGE_SLOT
 = 1;

615 c⁄° 
ulöt
 
	gSRV_MASTER_SLOT
 = 0;

621 
	$§v_¥öt_ma°î_thªad_öfo
(

623 
FILE
 *
fûe
)

625 
	`Ârötf
(
fûe
, "srv_master_threadÜoops: %lu srv_active, "

627 
§v_maö_a˘ive_lo›s
,

628 
§v_maö_shutdown_lo›s
,

629 
§v_maö_idÀ_lo›s
);

630 
	`Ârötf
(
fûe
, "srv_master_threadÜog flushánd writes: %lu\n",

631 
§v_log_wrôes_™d_Êush
);

632 
	}
}

636 
UNIV_INTERN


638 
	$§v_£t_io_thªad_›_öfo
(

640 
ulöt
 
i
,

641 c⁄° * 
°r
)

644 
	`ut_a
(
i
 < 
SRV_MAX_N_IO_THREADS
);

646 
§v_io_thªad_›_öfo
[
i
] = 
°r
;

647 
	}
}

651 
UNIV_INTERN


653 
	$§v_ª£t_io_thªad_›_öfo
()

656 
ulöt
 
i
 = 0; i < 
	`UT_ARR_SIZE
(
§v_io_thªad_›_öfo
); ++i) {

657 
§v_io_thªad_›_öfo
[
i
] = "not started yet";

659 
	}
}

661 #ifde‡
UNIV_DEBUG


666 
iboﬁ


667 
	$§v_thªad_ty≥_vÆid©e
(

669 
§v_thªad_ty≥
 
ty≥
)

671 
ty≥
) {

672 
SRV_NONE
:

674 
SRV_WORKER
:

675 
SRV_PURGE
:

676 
SRV_MASTER
:

677 (
TRUE
);

679 
ut_îr‹
;

680 (
FALSE
);

681 
	}
}

688 
§v_thªad_ty≥


689 
	$§v_¶Ÿ_gë_ty≥
(

691 c⁄° 
§v_¶Ÿ_t
* 
¶Ÿ
)

693 
§v_thªad_ty≥
 
ty≥
 = 
¶Ÿ
->type;

694 
	`ut_ad
(
	`§v_thªad_ty≥_vÆid©e
(
ty≥
));

695 (
ty≥
);

696 
	}
}

702 
§v_¶Ÿ_t
*

703 
	$§v_ª£rve_¶Ÿ
(

705 
§v_thªad_ty≥
 
ty≥
)

707 
§v_¶Ÿ_t
* 
¶Ÿ
 = 0;

709 
	`§v_sys_muãx_íãr
();

711 
	`ut_ad
(
	`§v_thªad_ty≥_vÆid©e
(
ty≥
));

713 
ty≥
) {

714 
SRV_MASTER
:

715 
¶Ÿ
 = &
§v_sys
->
sys_thªads
[
SRV_MASTER_SLOT
];

718 
SRV_PURGE
:

719 
¶Ÿ
 = &
§v_sys
->
sys_thªads
[
SRV_PURGE_SLOT
];

722 
SRV_WORKER
:

724 
¶Ÿ
 = &
§v_sys
->
sys_thªads
[2];

725 
¶Ÿ
->
ö_u£
;

726 ++
¶Ÿ
) {

728 
	`ut_a
(
¶Ÿ
 < &
§v_sys
->
sys_thªads
[

729 
§v_sys
->
n_sys_thªads
]);

733 
SRV_NONE
:

734 
ut_îr‹
;

737 
	`ut_a
(!
¶Ÿ
->
ö_u£
);

739 
¶Ÿ
->
ö_u£
 = 
TRUE
;

740 
¶Ÿ
->
su•íded
 = 
FALSE
;

741 
¶Ÿ
->
ty≥
 =Åype;

743 
	`ut_ad
(
	`§v_¶Ÿ_gë_ty≥
(
¶Ÿ
Ë=
ty≥
);

745 ++
§v_sys
->
n_thªads_a˘ive
[
ty≥
];

747 
	`§v_sys_muãx_exô
();

749 (
¶Ÿ
);

750 
	}
}

756 
ib_öt64_t


757 
	$§v_su•íd_thªad_low
(

759 
§v_¶Ÿ_t
* 
¶Ÿ
)

762 
	`ut_ad
(!
§v_ªad_⁄ly_mode
);

763 
	`ut_ad
(
	`§v_sys_muãx_own
());

765 
	`ut_ad
(
¶Ÿ
->
ö_u£
);

767 
§v_thªad_ty≥
 
ty≥
 = 
	`§v_¶Ÿ_gë_ty≥
(
¶Ÿ
);

769 
ty≥
) {

770 
SRV_NONE
:

771 
ut_îr‹
;

773 
SRV_MASTER
:

776 
	`ut_a
(
§v_sys
->
n_thªads_a˘ive
[
ty≥
] == 1);

779 
SRV_PURGE
:

782 
	`ut_a
(
§v_sys
->
n_thªads_a˘ive
[
ty≥
] == 1);

785 
SRV_WORKER
:

786 
	`ut_a
(
§v_n_purge_thªads
 > 1);

787 
	`ut_a
(
§v_sys
->
n_thªads_a˘ive
[
ty≥
] > 0);

791 
	`ut_a
(!
¶Ÿ
->
su•íded
);

792 
¶Ÿ
->
su•íded
 = 
TRUE
;

794 
	`ut_a
(
§v_sys
->
n_thªads_a˘ive
[
ty≥
] > 0);

796 
§v_sys
->
n_thªads_a˘ive
[
ty≥
]--;

798 (
	`os_evít_ª£t
(
¶Ÿ
->
evít
));

799 
	}
}

805 
ib_öt64_t


806 
	$§v_su•íd_thªad
(

808 
§v_¶Ÿ_t
* 
¶Ÿ
)

810 
	`§v_sys_muãx_íãr
();

812 
ib_öt64_t
 
sig_cou¡
 = 
	`§v_su•íd_thªad_low
(
¶Ÿ
);

814 
	`§v_sys_muãx_exô
();

816 (
sig_cou¡
);

817 
	}
}

824 
UNIV_INTERN


825 
ulöt


826 
	$§v_ªÀa£_thªads
(

828 
§v_thªad_ty≥
 
ty≥
,

829 
ulöt
 
n
)

831 
ulöt
 
i
;

832 
ulöt
 
cou¡
 = 0;

834 
	`ut_ad
(
	`§v_thªad_ty≥_vÆid©e
(
ty≥
));

835 
	`ut_ad
(
n
 > 0);

837 
	`§v_sys_muãx_íãr
();

839 
i
 = 0; i < 
§v_sys
->
n_sys_thªads
; i++) {

840 
§v_¶Ÿ_t
* 
¶Ÿ
;

842 
¶Ÿ
 = &
§v_sys
->
sys_thªads
[
i
];

844 i‡(
¶Ÿ
->
ö_u£


845 && 
	`§v_¶Ÿ_gë_ty≥
(
¶Ÿ
Ë=
ty≥


846 && 
¶Ÿ
->
su•íded
) {

848 
ty≥
) {

849 
SRV_NONE
:

850 
ut_îr‹
;

852 
SRV_MASTER
:

855 
	`ut_a
(
n
 == 1);

856 
	`ut_a
(
i
 =
SRV_MASTER_SLOT
);

857 
	`ut_a
(
§v_sys
->
n_thªads_a˘ive
[
ty≥
] == 0);

860 
SRV_PURGE
:

863 
	`ut_a
(
n
 == 1);

864 
	`ut_a
(
i
 =
SRV_PURGE_SLOT
);

865 
	`ut_a
(
§v_n_purge_thªads
 > 0);

866 
	`ut_a
(
§v_sys
->
n_thªads_a˘ive
[
ty≥
] == 0);

869 
SRV_WORKER
:

870 
	`ut_a
(
§v_n_purge_thªads
 > 1);

871 
	`ut_a
(
§v_sys
->
n_thªads_a˘ive
[
ty≥
]

872 < 
§v_n_purge_thªads
 - 1);

876 
¶Ÿ
->
su•íded
 = 
FALSE
;

878 ++
§v_sys
->
n_thªads_a˘ive
[
ty≥
];

880 
	`os_evít_£t
(
¶Ÿ
->
evít
);

882 i‡(++
cou¡
 =
n
) {

888 
	`§v_sys_muãx_exô
();

890 (
cou¡
);

891 
	}
}

897 
	$§v_‰ì_¶Ÿ
(

899 
§v_¶Ÿ_t
* 
¶Ÿ
)

901 
	`§v_sys_muãx_íãr
();

903 i‡(!
¶Ÿ
->
su•íded
) {

905 
	`§v_su•íd_thªad_low
(
¶Ÿ
);

909 
	`ut_ad
(
¶Ÿ
->
ö_u£
);

910 
¶Ÿ
->
ö_u£
 = 
FALSE
;

912 
	`§v_sys_muãx_exô
();

913 
	}
}

917 
UNIV_INTERN


919 
	$§v_öô
()

922 
ulöt
 
n_sys_thªads
 = 0;

923 
ulöt
 
§v_sys_sz
 = (*
§v_sys
);

925 #i‚de‡
HAVE_ATOMIC_BUILTINS


926 
	`muãx_¸óã
(
£rvî_muãx_key
, &
£rvî_muãx
, 
SYNC_ANY_LATCH
);

929 
	`muãx_¸óã
(
§v_önodb_m⁄ô‹_muãx_key
,

930 &
§v_önodb_m⁄ô‹_muãx
, 
SYNC_NO_ORDER_CHECK
);

932 i‡(!
§v_ªad_⁄ly_mode
) {

935 
n_sys_thªads
 = 
§v_n_purge_thªads
 + 1;

937 
§v_sys_sz
 +
n_sys_thªads
 * (*
§v_sys
->
sys_thªads
);

940 
§v_sys
 = 
°©ic_ˇ°
<
§v_sys_t
*>(
	`mem_zÆloc
(
§v_sys_sz
));

942 
§v_sys
->
n_sys_thªads
 =Ç_sys_threads;

944 i‡(!
§v_ªad_⁄ly_mode
) {

946 
	`muãx_¸óã
(
§v_sys_muãx_key
, &
§v_sys
->
muãx
, 
SYNC_THREADS
);

948 
	`muãx_¸óã
(
§v_sys_èsks_muãx_key
,

949 &
§v_sys
->
èsks_muãx
, 
SYNC_ANY_LATCH
);

951 
§v_sys
->
sys_thªads
 = (
§v_¶Ÿ_t
*) &srv_sys[1];

953 
ulöt
 
i
 = 0; i < 
§v_sys
->
n_sys_thªads
; ++i) {

954 
§v_¶Ÿ_t
* 
¶Ÿ
 = &
§v_sys
->
sys_thªads
[
i
];

956 
¶Ÿ
->
evít
 = 
	`os_evít_¸óã
();

958 
	`ut_a
(
¶Ÿ
->
evít
);

961 
§v_îr‹_evít
 = 
	`os_evít_¸óã
();

963 
§v_m⁄ô‹_evít
 = 
	`os_evít_¸óã
();

965 
§v_buf_dump_evít
 = 
	`os_evít_¸óã
();

967 
	`UT_LIST_INIT
(
§v_sys
->
èsks
);

978 
	`muãx_¸óã
(

979 
∑ge_zù_°©_≥r_ödex_muãx_key
,

980 &
∑ge_zù_°©_≥r_ödex_muãx
, 
SYNC_ANY_LATCH
);

984 
	`di˘_öd_öô
();

986 
	`§v_c⁄c_öô
();

989 
	`åx_i_s_ˇche_öô
(
åx_i_s_ˇche
);

991 
	`ut_¸c32_öô
();

993 
	`di˘_mem_öô
();

994 
	}
}

998 
UNIV_INTERN


1000 
	$§v_‰ì
()

1003 
	`§v_c⁄c_‰ì
();

1007 
	`mem_‰ì
(
§v_sys
);

1008 
§v_sys
 = 
NULL
;

1010 
	`åx_i_s_ˇche_‰ì
(
åx_i_s_ˇche
);

1012 i‡(!
§v_ªad_⁄ly_mode
) {

1013 
	`os_evít_‰ì
(
§v_buf_dump_evít
);

1014 
§v_buf_dump_evít
 = 
NULL
;

1016 
	}
}

1021 
UNIV_INTERN


1023 
	$§v_gíîÆ_öô
()

1026 
	`ut_mem_öô
();

1028 
	`ªcv_sys_v¨_öô
();

1029 
	`os_sync_öô
();

1030 
	`sync_öô
();

1031 
	`mem_öô
(
§v_mem_poﬁ_size
);

1032 
	`que_öô
();

1033 
	`row_mysql_öô
();

1034 
	}
}

1040 
	$§v_n‹mÆize_öô_vÆues
()

1043 
ulöt
 
n
;

1044 
ulöt
 
i
;

1046 
n
 = 
§v_n_d©a_fûes
;

1048 
i
 = 0; i < 
n
; i++) {

1049 
§v_d©a_fûe_sizes
[
i
] = srv_data_file_sizes[i]

1050 * ((1024 * 1024Ë/ 
UNIV_PAGE_SIZE
);

1053 
§v_œ°_fûe_size_max
 = srv_last_file_size_max

1054 * ((1024 * 1024Ë/ 
UNIV_PAGE_SIZE
);

1056 
§v_log_fûe_size
 = srv_log_fûe_sizê/ 
UNIV_PAGE_SIZE
;

1058 
§v_log_buf„r_size
 = srv_log_buf„r_sizê/ 
UNIV_PAGE_SIZE
;

1060 
§v_lock_èbÀ_size
 = 5 * (
§v_buf_poﬁ_size
 / 
UNIV_PAGE_SIZE
);

1061 
	}
}

1065 
UNIV_INTERN


1067 
	$§v_boŸ
()

1073 
	`§v_n‹mÆize_öô_vÆues
();

1078 
	`§v_gíîÆ_öô
();

1082 
	`§v_öô
();

1083 
	`§v_m⁄_¸óã
();

1084 
	}
}

1090 
	$§v_ª‰esh_önodb_m⁄ô‹_°©s
()

1093 
	`muãx_íãr
(&
§v_önodb_m⁄ô‹_muãx
);

1095 
§v_œ°_m⁄ô‹_time
 = 
	`time
(
NULL
);

1097 
	`os_aio_ª‰esh_°©s
();

1099 
bå_cur_n_£a_ﬁd
 = 
bå_cur_n_£a
;

1100 
bå_cur_n_n⁄_£a_ﬁd
 = 
bå_cur_n_n⁄_£a
;

1102 
	`log_ª‰esh_°©s
();

1104 
	`buf_ª‰esh_io_°©s_Æl
();

1106 
§v_n_rows_ö£πed_ﬁd
 = 
§v_°©s
.
n_rows_ö£πed
;

1107 
§v_n_rows_upd©ed_ﬁd
 = 
§v_°©s
.
n_rows_upd©ed
;

1108 
§v_n_rows_dñëed_ﬁd
 = 
§v_°©s
.
n_rows_dñëed
;

1109 
§v_n_rows_ªad_ﬁd
 = 
§v_°©s
.
n_rows_ªad
;

1111 
	`muãx_exô
(&
§v_önodb_m⁄ô‹_muãx
);

1112 
	}
}

1118 
UNIV_INTERN


1119 
iboﬁ


1120 
	$§v_¥ötf_önodb_m⁄ô‹
(

1122 
FILE
* 
fûe
,

1123 
iboﬁ
 
nowaô
,

1125 
ulöt
* 
åx_°¨t_pos
,

1127 
ulöt
* 
åx_íd
)

1130 
time_ñ≠£d
;

1131 
time_t
 
cuºít_time
;

1132 
ulöt
 
n_ª£rved
;

1133 
iboﬁ
 
ªt
;

1135 
	`muãx_íãr
(&
§v_önodb_m⁄ô‹_muãx
);

1137 
cuºít_time
 = 
	`time
(
NULL
);

1143 
time_ñ≠£d
 = 
	`dif·ime
(
cuºít_time
, 
§v_œ°_m⁄ô‹_time
)

1146 
§v_œ°_m⁄ô‹_time
 = 
	`time
(
NULL
);

1148 
	`Âuts
("\n=====================================\n", 
fûe
);

1150 
	`ut_¥öt_time°amp
(
fûe
);

1151 
	`Ârötf
(
fûe
,

1155 (
ul⁄g
Ë
time_ñ≠£d
);

1157 
	`Âuts
("-----------------\n"

1159 "-----------------\n", 
fûe
);

1160 
	`§v_¥öt_ma°î_thªad_öfo
(
fûe
);

1162 
	`Âuts
("----------\n"

1164 "----------\n", 
fûe
);

1165 
	`sync_¥öt
(
fûe
);

1172 
	`muãx_íãr
(&
di˘_f‹eign_îr_muãx
);

1174 i‡(!
§v_ªad_⁄ly_mode
 && 
	`·ñl
(
di˘_f‹eign_îr_fûe
) != 0L) {

1175 
	`Âuts
("------------------------\n"

1177 "------------------------\n", 
fûe
);

1178 
	`ut_c›y_fûe
(
fûe
, 
di˘_f‹eign_îr_fûe
);

1181 
	`muãx_exô
(&
di˘_f‹eign_îr_muãx
);

1187 
ªt
 = 
	`lock_¥öt_öfo_summ¨y
(
fûe
, 
nowaô
);

1189 i‡(
ªt
) {

1190 i‡(
åx_°¨t_pos
) {

1191 
t
 = 
	`·ñl
(
fûe
);

1192 i‡(
t
 < 0) {

1193 *
åx_°¨t_pos
 = 
ULINT_UNDEFINED
;

1195 *
åx_°¨t_pos
 = (
ulöt
Ë
t
;

1203 
	`lock_¥öt_öfo_Æl_å™ß˘i⁄s
(
fûe
);

1205 i‡(
åx_íd
) {

1206 
t
 = 
	`·ñl
(
fûe
);

1207 i‡(
t
 < 0) {

1208 *
åx_íd
 = 
ULINT_UNDEFINED
;

1210 *
åx_íd
 = (
ulöt
Ë
t
;

1215 
	`Âuts
("--------\n"

1217 "--------\n", 
fûe
);

1218 
	`os_aio_¥öt
(
fûe
);

1220 
	`Âuts
("-------------------------------------\n"

1222 "-------------------------------------\n", 
fûe
);

1223 
	`ibuf_¥öt
(
fûe
);

1225 
	`ha_¥öt_öfo
(
fûe
, 
bå_£¨ch_sys
->
hash_ödex
);

1227 
	`Ârötf
(
fûe
,

1229 (
bå_cur_n_£a
 - 
bå_cur_n_£a_ﬁd
)

1230 / 
time_ñ≠£d
,

1231 (
bå_cur_n_n⁄_£a
 - 
bå_cur_n_n⁄_£a_ﬁd
)

1232 / 
time_ñ≠£d
);

1233 
bå_cur_n_£a_ﬁd
 = 
bå_cur_n_£a
;

1234 
bå_cur_n_n⁄_£a_ﬁd
 = 
bå_cur_n_n⁄_£a
;

1236 
	`Âuts
("---\n"

1238 "---\n", 
fûe
);

1239 
	`log_¥öt
(
fûe
);

1241 
	`Âuts
("----------------------\n"

1243 "----------------------\n", 
fûe
);

1244 
	`Ârötf
(
fûe
,

1245 "TŸÆ mem‹yáŒoˇãd " 
ULINTPF


1246 "; i¿addôi⁄ÆÖoﬁáŒoˇãd " 
ULINTPF
 "\n",

1247 
ut_tŸÆ_Æloˇãd_mem‹y
,

1248 
	`mem_poﬁ_gë_ª£rved
(
mem_comm_poﬁ
));

1249 
	`Ârötf
(
fûe
, "Di˘i⁄¨y mem‹yáŒoˇãd " 
ULINTPF
 "\n",

1250 
di˘_sys
->
size
);

1252 
	`buf_¥öt_io
(
fûe
);

1254 #ifde‡
SSD_CACHE_FACE


1255 i‡(
§v_u£_ssd_ˇche
) {

1256 
	`Âuts
("-----------------------\n"

1258 "-----------------------\n", 
fûe
);

1259 
	`Ârötf
(
fûe
, "FaCEÅotalÑeference count: %lu\n"

1262 
§v_ssd_ˇche_tŸÆ_ªf
,

1263 
§v_ssd_ˇche_hô_ªf
,

1264 (
ul⁄g
Ë(1000 * 
§v_ssd_ˇche_hô_ªf


1265 / 
§v_ssd_ˇche_tŸÆ_ªf
));

1269 
	`Âuts
("--------------\n"

1271 "--------------\n", 
fûe
);

1272 
	`Ârötf
(
fûe
, "%ld queries inside InnoDB, %lu queries in queue\n",

1273 (Ë
	`§v_c⁄c_gë_a˘ive_thªads
(),

1274 
	`§v_c⁄c_gë_waôög_thªads
());

1277 
	`Ârötf
(
fûe
, "%luÑead views open inside InnoDB\n",

1278 
	`UT_LIST_GET_LEN
(
åx_sys
->
võw_li°
));

1280 
n_ª£rved
 = 
	`fû_•a˚_gë_n_ª£rved_exã¡s
(0);

1281 i‡(
n_ª£rved
 > 0) {

1282 
	`Ârötf
(
fûe
,

1285 (
ul⁄g
Ë
n_ª£rved
);

1288 #ifde‡
UNIV_LINUX


1289 
	`Ârötf
(
fûe
, "MainÅhreadÖrocessÇo. %lu, id %lu, state: %s\n",

1290 (
ul⁄g
Ë
§v_maö_thªad_¥o˚ss_no
,

1291 (
ul⁄g
Ë
§v_maö_thªad_id
,

1292 
§v_maö_thªad_›_öfo
);

1294 
	`Ârötf
(
fûe
, "MainÅhread id %lu, state: %s\n",

1295 (
ul⁄g
Ë
§v_maö_thªad_id
,

1296 
§v_maö_thªad_›_öfo
);

1298 
	`Ârötf
(
fûe
,

1299 "Numbî o‡row†ö£πed " 
ULINTPF


1300 ", upd©ed " 
ULINTPF
 ", deleted " ULINTPF

1301 ",Ñód " 
ULINTPF
 "\n",

1302 (
ulöt
Ë
§v_°©s
.
n_rows_ö£πed
,

1303 (
ulöt
Ë
§v_°©s
.
n_rows_upd©ed
,

1304 (
ulöt
Ë
§v_°©s
.
n_rows_dñëed
,

1305 (
ulöt
Ë
§v_°©s
.
n_rows_ªad
);

1306 
	`Ârötf
(
fûe
,

1309 ((
ulöt
Ë
§v_°©s
.
n_rows_ö£πed
 - 
§v_n_rows_ö£πed_ﬁd
)

1310 / 
time_ñ≠£d
,

1311 ((
ulöt
Ë
§v_°©s
.
n_rows_upd©ed
 - 
§v_n_rows_upd©ed_ﬁd
)

1312 / 
time_ñ≠£d
,

1313 ((
ulöt
Ë
§v_°©s
.
n_rows_dñëed
 - 
§v_n_rows_dñëed_ﬁd
)

1314 / 
time_ñ≠£d
,

1315 ((
ulöt
Ë
§v_°©s
.
n_rows_ªad
 - 
§v_n_rows_ªad_ﬁd
)

1316 / 
time_ñ≠£d
);

1318 
§v_n_rows_ö£πed_ﬁd
 = 
§v_°©s
.
n_rows_ö£πed
;

1319 
§v_n_rows_upd©ed_ﬁd
 = 
§v_°©s
.
n_rows_upd©ed
;

1320 
§v_n_rows_dñëed_ﬁd
 = 
§v_°©s
.
n_rows_dñëed
;

1321 
§v_n_rows_ªad_ﬁd
 = 
§v_°©s
.
n_rows_ªad
;

1323 
	`Âuts
("----------------------------\n"

1325 "============================\n", 
fûe
);

1326 
	`muãx_exô
(&
§v_önodb_m⁄ô‹_muãx
);

1327 
	`fÊush
(
fûe
);

1329 (
ªt
);

1330 
	}
}

1334 
UNIV_INTERN


1336 
	$§v_exp‹t_önodb_°©us
()

1339 
buf_poﬁ_°©_t
 
°©
;

1340 
buf_poﬁs_li°_size_t
 
buf_poﬁs_li°_size
;

1341 
ulöt
 
LRU_Àn
;

1342 
ulöt
 
‰ì_Àn
;

1343 
ulöt
 
Êush_li°_Àn
;

1345 
	`buf_gë_tŸÆ_°©
(&
°©
);

1346 
	`buf_gë_tŸÆ_li°_Àn
(&
LRU_Àn
, &
‰ì_Àn
, &
Êush_li°_Àn
);

1347 
	`buf_gë_tŸÆ_li°_size_ö_byãs
(&
buf_poﬁs_li°_size
);

1349 
	`muãx_íãr
(&
§v_önodb_m⁄ô‹_muãx
);

1351 
exp‹t_v¨s
.
önodb_d©a_≥ndög_ªads
 =

1352 
os_n_≥ndög_ªads
;

1354 
exp‹t_v¨s
.
önodb_d©a_≥ndög_wrôes
 =

1355 
os_n_≥ndög_wrôes
;

1357 
exp‹t_v¨s
.
önodb_d©a_≥ndög_fsyncs
 =

1358 
fû_n_≥ndög_log_Êushes


1359 + 
fû_n_≥ndög_èbÀ•a˚_Êushes
;

1361 
exp‹t_v¨s
.
önodb_d©a_fsyncs
 = 
os_n_fsyncs
;

1363 
exp‹t_v¨s
.
önodb_d©a_ªad
 = 
§v_°©s
.
d©a_ªad
;

1365 
exp‹t_v¨s
.
önodb_d©a_ªads
 = 
os_n_fûe_ªads
;

1367 
exp‹t_v¨s
.
önodb_d©a_wrôes
 = 
os_n_fûe_wrôes
;

1369 
exp‹t_v¨s
.
önodb_d©a_wrôãn
 = 
§v_°©s
.
d©a_wrôãn
;

1371 
exp‹t_v¨s
.
önodb_buf„r_poﬁ_ªad_ªque°s
 = 
°©
.
n_∑ge_gës
;

1373 
exp‹t_v¨s
.
önodb_buf„r_poﬁ_wrôe_ªque°s
 =

1374 
§v_°©s
.
buf_poﬁ_wrôe_ªque°s
;

1376 
exp‹t_v¨s
.
önodb_buf„r_poﬁ_waô_‰ì
 =

1377 
§v_°©s
.
buf_poﬁ_waô_‰ì
;

1379 
exp‹t_v¨s
.
önodb_buf„r_poﬁ_∑ges_Êushed
 =

1380 
§v_°©s
.
buf_poﬁ_Êushed
;

1382 
exp‹t_v¨s
.
önodb_buf„r_poﬁ_ªads
 = 
§v_°©s
.
buf_poﬁ_ªads
;

1384 
exp‹t_v¨s
.
önodb_buf„r_poﬁ_ªad_ahód_∫d
 =

1385 
°©
.
n_ø_∑ges_ªad_∫d
;

1387 
exp‹t_v¨s
.
önodb_buf„r_poﬁ_ªad_ahód
 =

1388 
°©
.
n_ø_∑ges_ªad
;

1390 
exp‹t_v¨s
.
önodb_buf„r_poﬁ_ªad_ahód_evi˘ed
 =

1391 
°©
.
n_ø_∑ges_evi˘ed
;

1393 
exp‹t_v¨s
.
önodb_buf„r_poﬁ_∑ges_d©a
 = 
LRU_Àn
;

1395 
exp‹t_v¨s
.
önodb_buf„r_poﬁ_byãs_d©a
 =

1396 
buf_poﬁs_li°_size
.
LRU_byãs


1397 + 
buf_poﬁs_li°_size
.
unzù_LRU_byãs
;

1399 
exp‹t_v¨s
.
önodb_buf„r_poﬁ_∑ges_dúty
 = 
Êush_li°_Àn
;

1401 
exp‹t_v¨s
.
önodb_buf„r_poﬁ_byãs_dúty
 =

1402 
buf_poﬁs_li°_size
.
Êush_li°_byãs
;

1404 
exp‹t_v¨s
.
önodb_buf„r_poﬁ_∑ges_‰ì
 = 
‰ì_Àn
;

1406 #ifde‡
UNIV_DEBUG


1407 
exp‹t_v¨s
.
önodb_buf„r_poﬁ_∑ges_œtched
 =

1408 
	`buf_gë_œtched_∑ges_numbî
();

1410 
exp‹t_v¨s
.
önodb_buf„r_poﬁ_∑ges_tŸÆ
 = 
	`buf_poﬁ_gë_n_∑ges
();

1412 
exp‹t_v¨s
.
önodb_buf„r_poﬁ_∑ges_misc
 =

1413 
	`buf_poﬁ_gë_n_∑ges
(Ë- 
LRU_Àn
 - 
‰ì_Àn
;

1415 #ifde‡
HAVE_ATOMIC_BUILTINS


1416 
exp‹t_v¨s
.
önodb_have_©omic_buûtös
 = 1;

1418 
exp‹t_v¨s
.
önodb_have_©omic_buûtös
 = 0;

1420 
exp‹t_v¨s
.
önodb_∑ge_size
 = 
UNIV_PAGE_SIZE
;

1422 
exp‹t_v¨s
.
önodb_log_waôs
 = 
§v_°©s
.
log_waôs
;

1424 
exp‹t_v¨s
.
önodb_os_log_wrôãn
 = 
§v_°©s
.
os_log_wrôãn
;

1426 
exp‹t_v¨s
.
önodb_os_log_fsyncs
 = 
fû_n_log_Êushes
;

1428 
exp‹t_v¨s
.
önodb_os_log_≥ndög_fsyncs
 = 
fû_n_≥ndög_log_Êushes
;

1430 
exp‹t_v¨s
.
önodb_os_log_≥ndög_wrôes
 =

1431 
§v_°©s
.
os_log_≥ndög_wrôes
;

1433 
exp‹t_v¨s
.
önodb_log_wrôe_ªque°s
 = 
§v_°©s
.
log_wrôe_ªque°s
;

1435 
exp‹t_v¨s
.
önodb_log_wrôes
 = 
§v_°©s
.
log_wrôes
;

1437 
exp‹t_v¨s
.
önodb_dblwr_∑ges_wrôãn
 =

1438 
§v_°©s
.
dblwr_∑ges_wrôãn
;

1440 
exp‹t_v¨s
.
önodb_dblwr_wrôes
 = 
§v_°©s
.
dblwr_wrôes
;

1442 
exp‹t_v¨s
.
önodb_∑ges_¸óãd
 = 
°©
.
n_∑ges_¸óãd
;

1444 
exp‹t_v¨s
.
önodb_∑ges_ªad
 = 
°©
.
n_∑ges_ªad
;

1446 
exp‹t_v¨s
.
önodb_∑ges_wrôãn
 = 
°©
.
n_∑ges_wrôãn
;

1448 
exp‹t_v¨s
.
önodb_row_lock_waôs
 = 
§v_°©s
.
n_lock_waô_cou¡
;

1450 
exp‹t_v¨s
.
önodb_row_lock_cuºít_waôs
 =

1451 
§v_°©s
.
n_lock_waô_cuºít_cou¡
;

1453 
exp‹t_v¨s
.
önodb_row_lock_time
 = 
§v_°©s
.
n_lock_waô_time
 / 1000;

1455 i‡(
§v_°©s
.
n_lock_waô_cou¡
 > 0) {

1457 
exp‹t_v¨s
.
önodb_row_lock_time_avg
 = (
ulöt
)

1458 (
§v_°©s
.
n_lock_waô_time


1459 / 1000 / 
§v_°©s
.
n_lock_waô_cou¡
);

1462 
exp‹t_v¨s
.
önodb_row_lock_time_avg
 = 0;

1465 
exp‹t_v¨s
.
önodb_row_lock_time_max
 =

1466 
lock_sys
->
n_lock_max_waô_time
 / 1000;

1468 
exp‹t_v¨s
.
önodb_rows_ªad
 = 
§v_°©s
.
n_rows_ªad
;

1470 
exp‹t_v¨s
.
önodb_rows_ö£πed
 = 
§v_°©s
.
n_rows_ö£πed
;

1472 
exp‹t_v¨s
.
önodb_rows_upd©ed
 = 
§v_°©s
.
n_rows_upd©ed
;

1474 
exp‹t_v¨s
.
önodb_rows_dñëed
 = 
§v_°©s
.
n_rows_dñëed
;

1476 
exp‹t_v¨s
.
önodb_num_›í_fûes
 = 
fû_n_fûe_›íed
;

1478 
exp‹t_v¨s
.
önodb_åunˇãd_°©us_wrôes
 =

1479 
§v_åunˇãd_°©us_wrôes
;

1481 
exp‹t_v¨s
.
önodb_avaûabÀ_undo_logs
 = 
§v_avaûabÀ_undo_logs
;

1483 #ifde‡
UNIV_DEBUG


1484 
	`rw_lock_s_lock
(&
purge_sys
->
œtch
);

1485 
åx_id_t
 
d⁄e_åx_no
 = 
purge_sys
->
d⁄e
.
åx_no
;

1486 
åx_id_t
 
up_limô_id
 = 
purge_sys
->
võw


1487 ? 
purge_sys
->
võw
->
up_limô_id


1489 
	`rw_lock_s_u∆ock
(&
purge_sys
->
œtch
);

1491 
	`muãx_íãr
(&
åx_sys
->
muãx
);

1492 
åx_id_t
 
max_åx_id
 = 
åx_sys
->
rw_max_åx_id
;

1493 
	`muãx_exô
(&
åx_sys
->
muãx
);

1495 i‡(!
d⁄e_åx_no
 || 
max_åx_id
 < done_trx_no - 1) {

1496 
exp‹t_v¨s
.
önodb_purge_åx_id_age
 = 0;

1498 
exp‹t_v¨s
.
önodb_purge_åx_id_age
 =

1499 (
ulöt
Ë(
max_åx_id
 - 
d⁄e_åx_no
 + 1);

1502 i‡(!
up_limô_id


1503 || 
max_åx_id
 < 
up_limô_id
) {

1504 
exp‹t_v¨s
.
önodb_purge_võw_åx_id_age
 = 0;

1506 
exp‹t_v¨s
.
önodb_purge_võw_åx_id_age
 =

1507 (
ulöt
Ë(
max_åx_id
 - 
up_limô_id
);

1511 
	`muãx_exô
(&
§v_önodb_m⁄ô‹_muãx
);

1512 
	}
}

1517 "C" 
UNIV_INTERN


1518 
os_thªad_ªt_t


1519 
	$DECLARE_THREAD
(
§v_m⁄ô‹_thªad
)(

1521 * 
¨g
 
	`__©åibuã__
((
unu£d
)))

1525 
ib_öt64_t
 
sig_cou¡
;

1526 
time_ñ≠£d
;

1527 
time_t
 
cuºít_time
;

1528 
time_t
 
œ°_èbÀ_m⁄ô‹_time
;

1529 
time_t
 
œ°_èbÀ•a˚_m⁄ô‹_time
;

1530 
time_t
 
œ°_m⁄ô‹_time
;

1531 
ulöt
 
muãx_skù≥d
;

1532 
iboﬁ
 
œ°_§v_¥öt_m⁄ô‹
;

1534 
	`ut_ad
(!
§v_ªad_⁄ly_mode
);

1536 #ifde‡
UNIV_DEBUG_THREAD_CREATION


1537 
	`Ârötf
(
°dîr
, "LockÅimeoutÅhread starts, id %lu\n",

1538 
	`os_thªad_pf
(
	`os_thªad_gë_cuº_id
()));

1541 #ifde‡
UNIV_PFS_THREAD


1542 
	`pfs_ªgi°î_thªad
(
§v_m⁄ô‹_thªad_key
);

1544 
§v_m⁄ô‹_a˘ive
 = 
TRUE
;

1546 
	`UT_NOT_USED
(
¨g
);

1547 
§v_œ°_m⁄ô‹_time
 = 
	`ut_time
();

1548 
œ°_èbÀ_m⁄ô‹_time
 = 
	`ut_time
();

1549 
œ°_èbÀ•a˚_m⁄ô‹_time
 = 
	`ut_time
();

1550 
œ°_m⁄ô‹_time
 = 
	`ut_time
();

1551 
muãx_skù≥d
 = 0;

1552 
œ°_§v_¥öt_m⁄ô‹
 = 
§v_¥öt_önodb_m⁄ô‹
;

1553 
lo›
:

1557 
sig_cou¡
 = 
	`os_evít_ª£t
(
§v_m⁄ô‹_evít
);

1559 
	`os_evít_waô_time_low
(
§v_m⁄ô‹_evít
, 5000000, 
sig_cou¡
);

1561 
cuºít_time
 = 
	`ut_time
();

1563 
time_ñ≠£d
 = 
	`dif·ime
(
cuºít_time
, 
œ°_m⁄ô‹_time
);

1565 i‡(
time_ñ≠£d
 > 15) {

1566 
œ°_m⁄ô‹_time
 = 
	`ut_time
();

1568 i‡(
§v_¥öt_önodb_m⁄ô‹
) {

1574 i‡(!
œ°_§v_¥öt_m⁄ô‹
) {

1575 
muãx_skù≥d
 = 0;

1576 
œ°_§v_¥öt_m⁄ô‹
 = 
TRUE
;

1579 i‡(!
	`§v_¥ötf_önodb_m⁄ô‹
(
°dîr
,

1580 
	`MUTEX_NOWAIT
(
muãx_skù≥d
),

1581 
NULL
, NULL)) {

1582 
muãx_skù≥d
++;

1585 
muãx_skù≥d
 = 0;

1588 
œ°_§v_¥öt_m⁄ô‹
 = 
FALSE
;

1595 i‡(!
§v_ªad_⁄ly_mode
 && 
§v_önodb_°©us
) {

1596 
	`muãx_íãr
(&
§v_m⁄ô‹_fûe_muãx
);

1597 
	`ªwöd
(
§v_m⁄ô‹_fûe
);

1598 i‡(!
	`§v_¥ötf_önodb_m⁄ô‹
(
§v_m⁄ô‹_fûe
,

1599 
	`MUTEX_NOWAIT
(
muãx_skù≥d
),

1600 
NULL
, NULL)) {

1601 
muãx_skù≥d
++;

1603 
muãx_skù≥d
 = 0;

1606 
	`os_fûe_£t_eof
(
§v_m⁄ô‹_fûe
);

1607 
	`muãx_exô
(&
§v_m⁄ô‹_fûe_muãx
);

1610 i‡(
§v_¥öt_önodb_èbÀ•a˚_m⁄ô‹


1611 && 
	`dif·ime
(
cuºít_time
,

1612 
œ°_èbÀ•a˚_m⁄ô‹_time
) > 60) {

1613 
œ°_èbÀ•a˚_m⁄ô‹_time
 = 
	`ut_time
();

1615 
	`Âuts
("========================"

1617 
°dîr
);

1619 
	`ut_¥öt_time°amp
(
°dîr
);

1621 
	`Âuts
(" INNODB TABLESPACE MONITOR OUTPUT\n"

1624 
°dîr
);

1626 
	`f•_¥öt
(0);

1627 
	`Âuts
("VÆid©ögÅabÀ•a˚\n", 
°dîr
);

1628 
	`f•_vÆid©e
(0);

1629 
	`Âuts
("Validation ok\n"

1633 
°dîr
);

1636 i‡(
§v_¥öt_önodb_èbÀ_m⁄ô‹


1637 && 
	`dif·ime
(
cuºít_time
, 
œ°_èbÀ_m⁄ô‹_time
) > 60) {

1639 
œ°_èbÀ_m⁄ô‹_time
 = 
	`ut_time
();

1641 
	`Ârötf
(
°dîr
, "Warning: %s\n",

1642 
DEPRECATED_MSG_INNODB_TABLE_MONITOR
);

1644 
	`Âuts
("===========================================\n",

1645 
°dîr
);

1647 
	`ut_¥öt_time°amp
(
°dîr
);

1649 
	`Âuts
(" INNODB TABLE MONITOR OUTPUT\n"

1651 
°dîr
);

1652 
	`di˘_¥öt
();

1654 
	`Âuts
("-----------------------------------\n"

1657 
°dîr
);

1659 
	`Ârötf
(
°dîr
, "Warning: %s\n",

1660 
DEPRECATED_MSG_INNODB_TABLE_MONITOR
);

1664 i‡(
§v_shutdown_°©e
 >
SRV_SHUTDOWN_CLEANUP
) {

1665 
exô_func
;

1668 i‡(
§v_¥öt_önodb_m⁄ô‹


1669 || 
§v_¥öt_önodb_lock_m⁄ô‹


1670 || 
§v_¥öt_önodb_èbÀ•a˚_m⁄ô‹


1671 || 
§v_¥öt_önodb_èbÀ_m⁄ô‹
) {

1672 
lo›
;

1675 
lo›
;

1677 
exô_func
:

1678 
§v_m⁄ô‹_a˘ive
 = 
FALSE
;

1683 
	`os_thªad_exô
(
NULL
);

1685 
OS_THREAD_DUMMY_RETURN
;

1686 
	}
}

1692 "C" 
UNIV_INTERN


1693 
os_thªad_ªt_t


1694 
	$DECLARE_THREAD
(
§v_îr‹_m⁄ô‹_thªad
)(

1696 * 
¨g
 
	`__©åibuã__
((
unu£d
)))

1701 
ulöt
 
Áèl_˙t
 = 0;

1702 
l¢_t
 
ﬁd_l¢
;

1703 
l¢_t
 
√w_l¢
;

1704 
ib_öt64_t
 
sig_cou¡
;

1706 
os_thªad_id_t
 
waôî
 = 
	`os_thªad_gë_cuº_id
();

1707 
os_thªad_id_t
 
ﬁd_waôî
 = 
waôî
;

1709 c⁄° * 
£ma
 = 
NULL
;

1710 c⁄° * 
ﬁd_£ma
 = 
NULL
;

1712 
	`ut_ad
(!
§v_ªad_⁄ly_mode
);

1714 
ﬁd_l¢
 = 
§v_°¨t_l¢
;

1716 #ifde‡
UNIV_DEBUG_THREAD_CREATION


1717 
	`Ârötf
(
°dîr
, "Error monitorÅhread starts, id %lu\n",

1718 
	`os_thªad_pf
(
	`os_thªad_gë_cuº_id
()));

1721 #ifde‡
UNIV_PFS_THREAD


1722 
	`pfs_ªgi°î_thªad
(
§v_îr‹_m⁄ô‹_thªad_key
);

1724 
§v_îr‹_m⁄ô‹_a˘ive
 = 
TRUE
;

1726 
lo›
:

1730 
√w_l¢
 = 
	`log_gë_l¢
();

1732 i‡(
√w_l¢
 < 
ﬁd_l¢
) {

1733 
	`ut_¥öt_time°amp
(
°dîr
);

1734 
	`Ârötf
(
°dîr
,

1735 " I¬oDB: Eº‹: oldÜog sequí˚Çumbî " 
LSN_PF


1737 "I¬oDB:Åh™Åhê√wÜog sequí˚Çumbî " 
LSN_PF
 "!\n"

1740 
ﬁd_l¢
, 
√w_l¢
);

1741 
	`ut_ad
(0);

1744 
ﬁd_l¢
 = 
√w_l¢
;

1746 i‡(
	`dif·ime
(
	`time
(
NULL
), 
§v_œ°_m⁄ô‹_time
) > 60) {

1750 
	`§v_ª‰esh_önodb_m⁄ô‹_°©s
();

1755 
	`buf_LRU_°©_upd©e
();

1761 
	`sync_¨r_wake_thªads_if_£ma_‰ì
();

1763 i‡(
	`sync_¨øy_¥öt_l⁄g_waôs
(&
waôî
, &
£ma
)

1764 && 
£ma
 =
ﬁd_£ma
 && 
	`os_thªad_eq
(
waôî
, 
ﬁd_waôî
)) {

1765 
Áèl_˙t
++;

1766 i‡(
Áèl_˙t
 > 10) {

1768 
	`Ârötf
(
°dîr
,

1773 (
ul⁄g
Ë
§v_Áèl_£m≠h‹e_waô_thªshﬁd
);

1775 
ut_îr‹
;

1778 
Áèl_˙t
 = 0;

1779 
ﬁd_waôî
 = 
waôî
;

1780 
ﬁd_£ma
 = 
£ma
;

1786 
	`fÊush
(
°dîr
);

1788 
sig_cou¡
 = 
	`os_evít_ª£t
(
§v_îr‹_evít
);

1790 
	`os_evít_waô_time_low
(
§v_îr‹_evít
, 1000000, 
sig_cou¡
);

1792 i‡(
§v_shutdown_°©e
 < 
SRV_SHUTDOWN_CLEANUP
) {

1794 
lo›
;

1797 
§v_îr‹_m⁄ô‹_a˘ive
 = 
FALSE
;

1802 
	`os_thªad_exô
(
NULL
);

1804 
OS_THREAD_DUMMY_RETURN
;

1805 
	}
}

1809 
UNIV_INTERN


1811 
	$§v_öc_a˘ivôy_cou¡
()

1814 
§v_sys
->
a˘ivôy_cou¡
.
	`öc
();

1815 
	}
}

1822 
UNIV_INTERN


1823 
§v_thªad_ty≥


1824 
	$§v_gë_a˘ive_thªad_ty≥
()

1827 
§v_thªad_ty≥
 
ªt
 = 
SRV_NONE
;

1829 i‡(
§v_ªad_⁄ly_mode
) {

1830 (
SRV_NONE
);

1833 
	`§v_sys_muãx_íãr
();

1835 
ulöt
 
i
 = 
SRV_WORKER
; i <
SRV_MASTER
; ++i) {

1836 i‡(
§v_sys
->
n_thªads_a˘ive
[
i
] != 0) {

1837 
ªt
 = 
°©ic_ˇ°
<
§v_thªad_ty≥
>(
i
);

1842 
	`§v_sys_muãx_exô
();

1845 i‡(
ªt
 =
SRV_NONE


1846 && 
§v_shutdown_°©e
 !
SRV_SHUTDOWN_NONE


1847 && 
	`åx_purge_°©e
(Ë!
PURGE_STATE_DISABLED


1848 && 
	`åx_purge_°©e
(Ë!
PURGE_STATE_EXIT
) {

1850 
ªt
 = 
SRV_PURGE
;

1853 (
ªt
);

1854 
	}
}

1860 
UNIV_INTERN


1862 
	$§v_™y_background_thªads_¨e_a˘ive
()

1865 c⁄° * 
thªad_a˘ive
 = 
NULL
;

1867 i‡(
§v_ªad_⁄ly_mode
) {

1868 (
NULL
);

1869 } i‡(
§v_îr‹_m⁄ô‹_a˘ive
) {

1870 
thªad_a˘ive
 = "srv_error_monitor_thread";

1871 } i‡(
lock_sys
->
timeout_thªad_a˘ive
) {

1872 
thªad_a˘ive
 = "srv_lock_timeoutÅhread";

1873 } i‡(
§v_m⁄ô‹_a˘ive
) {

1874 
thªad_a˘ive
 = "srv_monitor_thread";

1875 } i‡(
§v_buf_dump_thªad_a˘ive
) {

1876 
thªad_a˘ive
 = "buf_dump_thread";

1877 } i‡(
§v_di˘_°©s_thªad_a˘ive
) {

1878 
thªad_a˘ive
 = "dict_stats_thread";

1881 
	`os_evít_£t
(
§v_îr‹_evít
);

1882 
	`os_evít_£t
(
§v_m⁄ô‹_evít
);

1883 
	`os_evít_£t
(
§v_buf_dump_evít
);

1884 
	`os_evít_£t
(
lock_sys
->
timeout_evít
);

1885 
	`os_evít_£t
(
di˘_°©s_evít
);

1887 (
thªad_a˘ive
);

1888 
	}
}

1896 
UNIV_INTERN


1898 
	$§v_a˘ive_wake_ma°î_thªad
()

1901 i‡(
§v_ªad_⁄ly_mode
) {

1905 
	`ut_ad
(!
	`§v_sys_muãx_own
());

1907 
	`§v_öc_a˘ivôy_cou¡
();

1909 i‡(
§v_sys
->
n_thªads_a˘ive
[
SRV_MASTER
] == 0) {

1910 
§v_¶Ÿ_t
* 
¶Ÿ
;

1912 
	`§v_sys_muãx_íãr
();

1914 
¶Ÿ
 = &
§v_sys
->
sys_thªads
[
SRV_MASTER_SLOT
];

1918 i‡(
¶Ÿ
->
ö_u£
) {

1919 
	`ut_a
(
	`§v_¶Ÿ_gë_ty≥
(
¶Ÿ
Ë=
SRV_MASTER
);

1921 i‡(
¶Ÿ
->
su•íded
) {

1923 
¶Ÿ
->
su•íded
 = 
FALSE
;

1925 ++
§v_sys
->
n_thªads_a˘ive
[
SRV_MASTER
];

1927 
	`os_evít_£t
(
¶Ÿ
->
evít
);

1931 
	`§v_sys_muãx_exô
();

1933 
	}
}

1941 
UNIV_INTERN


1943 
	$§v_wake_purge_thªad_if_nŸ_a˘ive
()

1946 
	`ut_ad
(!
	`§v_sys_muãx_own
());

1948 i‡(
purge_sys
->
°©e
 =
PURGE_STATE_RUN


1949 && 
§v_sys
->
n_thªads_a˘ive
[
SRV_PURGE
] == 0) {

1951 
	`§v_ªÀa£_thªads
(
SRV_PURGE
, 1);

1953 
	}
}

1957 
UNIV_INTERN


1959 
	$§v_wake_ma°î_thªad
()

1962 
	`ut_ad
(!
	`§v_sys_muãx_own
());

1964 
	`§v_öc_a˘ivôy_cou¡
();

1966 
	`§v_ªÀa£_thªads
(
SRV_MASTER
, 1);

1967 
	}
}

1973 
UNIV_INTERN


1974 
ulöt


1975 
	$§v_gë_a˘ivôy_cou¡
()

1978 (
§v_sys
->
a˘ivôy_cou¡
);

1979 
	}
}

1984 
UNIV_INTERN


1985 
iboﬁ


1986 
	$§v_check_a˘ivôy
(

1988 
ulöt
 
ﬁd_a˘ivôy_cou¡
)

1990 (
§v_sys
->
a˘ivôy_cou¡
 !
ﬁd_a˘ivôy_cou¡
);

1991 
	}
}

2000 
	$§v_sync_log_buf„r_ö_background
()

2003 
time_t
 
cuºít_time
 = 
	`time
(
NULL
);

2005 
§v_maö_thªad_›_öfo
 = "flushingÜog";

2006 i‡(
	`dif·ime
(
cuºít_time
, 
§v_œ°_log_Êush_time
)

2007 >
§v_Êush_log_©_timeout
) {

2008 
	`log_buf„r_sync_ö_background
(
TRUE
);

2009 
§v_œ°_log_Êush_time
 = 
cuºít_time
;

2010 
§v_log_wrôes_™d_Êush
++;

2012 
	}
}

2018 
ulöt


2019 
	$§v_ma°î_evi˘_‰om_èbÀ_ˇche
(

2021 
ulöt
 
p˘_check
)

2023 
ulöt
 
n_èbÀs_evi˘ed
 = 0;

2025 
	`rw_lock_x_lock
(&
di˘_›î©i⁄_lock
);

2027 
	`di˘_muãx_íãr_f‹_mysql
();

2029 
n_èbÀs_evi˘ed
 = 
	`di˘_make_room_ö_ˇche
(

2030 
	`önoba£_gë_èbÀ_ˇche_size
(), 
p˘_check
);

2032 
	`di˘_muãx_exô_f‹_mysql
();

2034 
	`rw_lock_x_u∆ock
(&
di˘_›î©i⁄_lock
);

2036 (
n_èbÀs_evi˘ed
);

2037 
	}
}

2044 
	$§v_shutdown_¥öt_ma°î_≥ndög
(

2046 
ib_time_t
* 
œ°_¥öt_time
,

2048 
ulöt
 
n_èbÀs_to_dr›
,

2050 
ulöt
 
n_byãs_mîged
)

2053 
ib_time_t
 
cuºít_time
;

2054 
time_ñ≠£d
;

2056 
cuºít_time
 = 
	`ut_time
();

2057 
time_ñ≠£d
 = 
	`ut_dif·ime
(
cuºít_time
, *
œ°_¥öt_time
);

2059 i‡(
time_ñ≠£d
 > 60) {

2060 *
œ°_¥öt_time
 = 
	`ut_time
();

2062 i‡(
n_èbÀs_to_dr›
) {

2063 
	`ut_¥öt_time°amp
(
°dîr
);

2064 
	`Ârötf
(
°dîr
, " InnoDB: Waiting for "

2066 (
ul⁄g
Ë
n_èbÀs_to_dr›
);

2071 i‡(!
§v_Á°_shutdown
 && 
n_byãs_mîged
) {

2072 
	`ut_¥öt_time°amp
(
°dîr
);

2073 
	`Ârötf
(
°dîr
, " InnoDB: Waiting for change "

2077 
n_byãs_mîged
);

2080 
	}
}

2091 
	$§v_ma°î_do_a˘ive_èsks
()

2094 
ib_time_t
 
cur_time
 = 
	`ut_time
();

2095 
uŒöt
 
cou¡î_time
 = 
	`ut_time_us
(
NULL
);

2100 ++
§v_maö_a˘ive_lo›s
;

2102 
	`MONITOR_INC
(
MONITOR_MASTER_ACTIVE_LOOPS
);

2107 
§v_maö_thªad_›_öfo
 = "doing background dropÅables";

2108 
	`row_dr›_èbÀs_f‹_mysql_ö_background
();

2109 
	`MONITOR_INC_TIME_IN_MICRO_SECS
(

2110 
MONITOR_SRV_BACKGROUND_DROP_TABLE_MICROSECOND
, 
cou¡î_time
);

2112 i‡(
§v_shutdown_°©e
 > 0) {

2118 
§v_maö_thªad_›_öfo
 = "checking freeÜog space";

2119 
	`log_‰ì_check
();

2122 
§v_maö_thªad_›_öfo
 = "doing insert buffer merge";

2123 
cou¡î_time
 = 
	`ut_time_us
(
NULL
);

2124 
	`ibuf_c⁄åa˘_ö_background
(0, 
FALSE
);

2125 
	`MONITOR_INC_TIME_IN_MICRO_SECS
(

2126 
MONITOR_SRV_IBUF_MERGE_MICROSECOND
, 
cou¡î_time
);

2129 
§v_maö_thªad_›_öfo
 = "flushingÜog";

2130 
	`§v_sync_log_buf„r_ö_background
();

2131 
	`MONITOR_INC_TIME_IN_MICRO_SECS
(

2132 
MONITOR_SRV_LOG_FLUSH_MICROSECOND
, 
cou¡î_time
);

2137 #ifde‡
MEM_PERIODIC_CHECK


2140 i‡(
cur_time
 % 
SRV_MASTER_MEM_VALIDATE_INTERVAL
 == 0) {

2141 
	`mem_vÆid©e_Æl_blocks
();

2142 
	`MONITOR_INC_TIME_IN_MICRO_SECS
(

2143 
MONITOR_SRV_MEM_VALIDATE_MICROSECOND
, 
cou¡î_time
);

2146 i‡(
§v_shutdown_°©e
 > 0) {

2150 i‡(
§v_shutdown_°©e
 > 0) {

2154 i‡(
cur_time
 % 
SRV_MASTER_DICT_LRU_INTERVAL
 == 0) {

2155 
§v_maö_thªad_›_öfo
 = "enforcing dict cacheÜimit";

2156 
	`§v_ma°î_evi˘_‰om_èbÀ_ˇche
(50);

2157 
	`MONITOR_INC_TIME_IN_MICRO_SECS
(

2158 
MONITOR_SRV_DICT_LRU_MICROSECOND
, 
cou¡î_time
);

2161 i‡(
§v_shutdown_°©e
 > 0) {

2166 i‡(
cur_time
 % 
SRV_MASTER_CHECKPOINT_INTERVAL
 == 0) {

2167 
§v_maö_thªad_›_öfo
 = "making checkpoint";

2168 
	`log_checkpoöt
(
TRUE
, 
FALSE
);

2169 
	`MONITOR_INC_TIME_IN_MICRO_SECS
(

2170 
MONITOR_SRV_CHECKPOINT_MICROSECOND
, 
cou¡î_time
);

2172 
	}
}

2184 
	$§v_ma°î_do_idÀ_èsks
()

2187 
uŒöt
 
cou¡î_time
;

2189 ++
§v_maö_idÀ_lo›s
;

2191 
	`MONITOR_INC
(
MONITOR_MASTER_IDLE_LOOPS
);

2197 
cou¡î_time
 = 
	`ut_time_us
(
NULL
);

2198 
§v_maö_thªad_›_öfo
 = "doing background dropÅables";

2199 
	`row_dr›_èbÀs_f‹_mysql_ö_background
();

2200 
	`MONITOR_INC_TIME_IN_MICRO_SECS
(

2201 
MONITOR_SRV_BACKGROUND_DROP_TABLE_MICROSECOND
,

2202 
cou¡î_time
);

2204 i‡(
§v_shutdown_°©e
 > 0) {

2210 
§v_maö_thªad_›_öfo
 = "checking freeÜog space";

2211 
	`log_‰ì_check
();

2214 
cou¡î_time
 = 
	`ut_time_us
(
NULL
);

2215 
§v_maö_thªad_›_öfo
 = "doing insert buffer merge";

2216 
	`ibuf_c⁄åa˘_ö_background
(0, 
TRUE
);

2217 
	`MONITOR_INC_TIME_IN_MICRO_SECS
(

2218 
MONITOR_SRV_IBUF_MERGE_MICROSECOND
, 
cou¡î_time
);

2220 i‡(
§v_shutdown_°©e
 > 0) {

2224 
§v_maö_thªad_›_öfo
 = "enforcing dict cacheÜimit";

2225 
	`§v_ma°î_evi˘_‰om_èbÀ_ˇche
(100);

2226 
	`MONITOR_INC_TIME_IN_MICRO_SECS
(

2227 
MONITOR_SRV_DICT_LRU_MICROSECOND
, 
cou¡î_time
);

2230 
	`§v_sync_log_buf„r_ö_background
();

2231 
	`MONITOR_INC_TIME_IN_MICRO_SECS
(

2232 
MONITOR_SRV_LOG_FLUSH_MICROSECOND
, 
cou¡î_time
);

2234 i‡(
§v_shutdown_°©e
 > 0) {

2239 
§v_maö_thªad_›_öfo
 = "making checkpoint";

2240 
	`log_checkpoöt
(
TRUE
, 
FALSE
);

2241 
	`MONITOR_INC_TIME_IN_MICRO_SECS
(
MONITOR_SRV_CHECKPOINT_MICROSECOND
,

2242 
cou¡î_time
);

2243 
	}
}

2254 
iboﬁ


2255 
	$§v_ma°î_do_shutdown_èsks
(

2257 
ib_time_t
* 
œ°_¥öt_time
)

2260 
ulöt
 
n_byãs_mîged
 = 0;

2261 
ulöt
 
n_èbÀs_to_dr›
 = 0;

2263 
	`ut_ad
(!
§v_ªad_⁄ly_mode
);

2265 ++
§v_maö_shutdown_lo›s
;

2267 
	`ut_a
(
§v_shutdown_°©e
 > 0);

2270 i‡(
§v_Á°_shutdown
 == 2) {

2271 (
FALSE
);

2277 
§v_maö_thªad_›_öfo
 = "doing background dropÅables";

2278 
n_èbÀs_to_dr›
 = 
	`row_dr›_èbÀs_f‹_mysql_ö_background
();

2282 
§v_maö_thªad_›_öfo
 = "checking freeÜog space";

2283 
	`log_‰ì_check
();

2286 i‡(
§v_Á°_shutdown
 == 1) {

2287 
func_exô
;

2291 
§v_maö_thªad_›_öfo
 = "doing insert buffer merge";

2292 
n_byãs_mîged
 = 
	`ibuf_c⁄åa˘_ö_background
(0, 
TRUE
);

2295 
	`§v_sync_log_buf„r_ö_background
();

2297 
func_exô
:

2299 
§v_maö_thªad_›_öfo
 = "making checkpoint";

2300 
	`log_checkpoöt
(
TRUE
, 
FALSE
);

2303 i‡(
§v_shutdown_°©e
 > 0 && 
§v_¥öt_vîbo£_log
) {

2304 
	`§v_shutdown_¥öt_ma°î_≥ndög
(

2305 
œ°_¥öt_time
, 
n_èbÀs_to_dr›
, 
n_byãs_mîged
);

2308 (
n_byãs_mîged
 || 
n_èbÀs_to_dr›
);

2309 
	}
}

2317 
	$§v_ma°î_¶ìp
()

2320 
§v_maö_thªad_›_öfo
 = "sleeping";

2321 
	`os_thªad_¶ìp
(1000000);

2322 
§v_maö_thªad_›_öfo
 = "";

2323 
	}
}

2328 "C" 
UNIV_INTERN


2329 
os_thªad_ªt_t


2330 
	$DECLARE_THREAD
(
§v_ma°î_thªad
)(

2332 * 
¨g
 
	`__©åibuã__
((
unu£d
)))

2336 
§v_¶Ÿ_t
* 
¶Ÿ
;

2337 
ulöt
 
ﬁd_a˘ivôy_cou¡
 = 
	`§v_gë_a˘ivôy_cou¡
();

2338 
ib_time_t
 
œ°_¥öt_time
;

2340 
	`ut_ad
(!
§v_ªad_⁄ly_mode
);

2342 #ifde‡
UNIV_DEBUG_THREAD_CREATION


2343 
	`Ârötf
(
°dîr
, "MasterÅhread starts, id %lu\n",

2344 
	`os_thªad_pf
(
	`os_thªad_gë_cuº_id
()));

2347 #ifde‡
UNIV_PFS_THREAD


2348 
	`pfs_ªgi°î_thªad
(
§v_ma°î_thªad_key
);

2351 
§v_maö_thªad_¥o˚ss_no
 = 
	`os_¥oc_gë_numbî
();

2352 
§v_maö_thªad_id
 = 
	`os_thªad_pf
(
	`os_thªad_gë_cuº_id
());

2354 
¶Ÿ
 = 
	`§v_ª£rve_¶Ÿ
(
SRV_MASTER
);

2355 
	`ut_a
(
¶Ÿ
 =
§v_sys
->
sys_thªads
);

2357 
œ°_¥öt_time
 = 
	`ut_time
();

2358 
lo›
:

2359 i‡(
§v_f‹˚_ªcovîy
 >
SRV_FORCE_NO_BACKGROUND
) {

2360 
su•íd_thªad
;

2363 
§v_shutdown_°©e
 =
SRV_SHUTDOWN_NONE
) {

2365 
	`§v_ma°î_¶ìp
();

2367 
	`MONITOR_INC
(
MONITOR_MASTER_THREAD_SLEEP
);

2369 i‡(
	`§v_check_a˘ivôy
(
ﬁd_a˘ivôy_cou¡
)) {

2370 
ﬁd_a˘ivôy_cou¡
 = 
	`§v_gë_a˘ivôy_cou¡
();

2371 
	`§v_ma°î_do_a˘ive_èsks
();

2373 
	`§v_ma°î_do_idÀ_èsks
();

2377 
	`§v_ma°î_do_shutdown_èsks
(&
œ°_¥öt_time
)) {

2380 
	`ut_ad
(
§v_Á°_shutdown
 < 2);

2383 
su•íd_thªad
:

2384 
§v_maö_thªad_›_öfo
 = "suspending";

2386 
	`§v_su•íd_thªad
(
¶Ÿ
);

2392 
§v_maö_thªad_›_öfo
 = "waiting for serveráctivity";

2394 
	`os_evít_waô
(
¶Ÿ
->
evít
);

2396 i‡(
§v_shutdown_°©e
 =
SRV_SHUTDOWN_EXIT_THREADS
) {

2397 
	`os_thªad_exô
(
NULL
);

2400 
lo›
;

2402 
OS_THREAD_DUMMY_RETURN
;

2403 
	}
}

2409 
boﬁ


2410 
	$§v_purge_should_exô
(

2412 
ulöt
 
n_purged
)

2414 
§v_shutdown_°©e
) {

2415 
SRV_SHUTDOWN_NONE
:

2419 
SRV_SHUTDOWN_CLEANUP
:

2420 
SRV_SHUTDOWN_EXIT_THREADS
:

2422 (
§v_Á°_shutdown
 !0 || 
n_purged
 == 0);

2424 
SRV_SHUTDOWN_LAST_PHASE
:

2425 
SRV_SHUTDOWN_FLUSH_PHASE
:

2426 
ut_îr‹
;

2429 (
Ál£
);

2430 
	}
}

2436 
boﬁ


2437 
	$§v_èsk_execuã
()

2440 
que_thr_t
* 
thr
 = 
NULL
;

2442 
	`ut_ad
(!
§v_ªad_⁄ly_mode
);

2443 
	`ut_a
(
§v_f‹˚_ªcovîy
 < 
SRV_FORCE_NO_BACKGROUND
);

2445 
	`muãx_íãr
(&
§v_sys
->
èsks_muãx
);

2447 i‡(
	`UT_LIST_GET_LEN
(
§v_sys
->
èsks
) > 0) {

2449 
thr
 = 
	`UT_LIST_GET_FIRST
(
§v_sys
->
èsks
);

2451 
	`ut_a
(
	`que_node_gë_ty≥
(
thr
->
chûd
Ë=
QUE_NODE_PURGE
);

2453 
	`UT_LIST_REMOVE
(
queue
, 
§v_sys
->
èsks
, 
thr
);

2456 
	`muãx_exô
(&
§v_sys
->
èsks_muãx
);

2458 i‡(
thr
 !
NULL
) {

2460 
	`que_run_thªads
(
thr
);

2462 
	`os_©omic_öc_ulöt
(

2463 &
purge_sys
->
bh_muãx
, &purge_sys->
n_com∂ëed
, 1);

2466 (
thr
 !
NULL
);

2467 
	}
}

2472 "C" 
UNIV_INTERN


2473 
os_thªad_ªt_t


2474 
	$DECLARE_THREAD
(
§v_w‹kî_thªad
)(

2476 * 
¨g
 
	`__©åibuã__
((
unu£d
)))

2479 
§v_¶Ÿ_t
* 
¶Ÿ
;

2481 
	`ut_ad
(!
§v_ªad_⁄ly_mode
);

2482 
	`ut_a
(
§v_f‹˚_ªcovîy
 < 
SRV_FORCE_NO_BACKGROUND
);

2484 #ifde‡
UNIV_DEBUG_THREAD_CREATION


2485 
	`ut_¥öt_time°amp
(
°dîr
);

2486 
	`Ârötf
(
°dîr
, " InnoDB: workerÅhread starting, id %lu\n",

2487 
	`os_thªad_pf
(
	`os_thªad_gë_cuº_id
()));

2490 
¶Ÿ
 = 
	`§v_ª£rve_¶Ÿ
(
SRV_WORKER
);

2492 
	`ut_a
(
§v_n_purge_thªads
 > 1);

2494 
	`§v_sys_muãx_íãr
();

2496 
	`ut_a
(
§v_sys
->
n_thªads_a˘ive
[
SRV_WORKER
] < 
§v_n_purge_thªads
);

2498 
	`§v_sys_muãx_exô
();

2505 
	`§v_su•íd_thªad
(
¶Ÿ
);

2507 
	`os_evít_waô
(
¶Ÿ
->
evít
);

2509 i‡(
	`§v_èsk_execuã
()) {

2514 
	`§v_wake_purge_thªad_if_nŸ_a˘ive
();

2519 } 
purge_sys
->
°©e
 !
PURGE_STATE_EXIT
);

2521 
	`§v_‰ì_¶Ÿ
(
¶Ÿ
);

2523 
	`rw_lock_x_lock
(&
purge_sys
->
œtch
);

2525 
	`ut_a
(!
purge_sys
->
ru¬ög
);

2526 
	`ut_a
(
purge_sys
->
°©e
 =
PURGE_STATE_EXIT
);

2527 
	`ut_a
(
§v_shutdown_°©e
 > 
SRV_SHUTDOWN_NONE
);

2529 
	`rw_lock_x_u∆ock
(&
purge_sys
->
œtch
);

2531 #ifde‡
UNIV_DEBUG_THREAD_CREATION


2532 
	`ut_¥öt_time°amp
(
°dîr
);

2533 
	`Ârötf
(
°dîr
, " InnoDB: Purge workerÅhreadÉxiting, id %lu\n",

2534 
	`os_thªad_pf
(
	`os_thªad_gë_cuº_id
()));

2539 
	`os_thªad_exô
(
NULL
);

2541 
OS_THREAD_DUMMY_RETURN
;

2542 
	}
}

2548 
ulöt


2549 
	$§v_do_purge
(

2551 
ulöt
 
n_thªads
,

2552 
ulöt
* 
n_tŸÆ_purged
)

2554 
ulöt
 
n_∑ges_purged
;

2556 
ulöt
 
cou¡
 = 0;

2557 
ulöt
 
n_u£_thªads
 = 0;

2558 
ulöt
 
r£g_hi°‹y_Àn
 = 0;

2559 
ulöt
 
ﬁd_a˘ivôy_cou¡
 = 
	`§v_gë_a˘ivôy_cou¡
();

2561 
	`ut_a
(
n_thªads
 > 0);

2562 
	`ut_ad
(!
§v_ªad_⁄ly_mode
);

2570 i‡(
n_u£_thªads
 == 0) {

2571 
n_u£_thªads
 = 
n_thªads
;

2575 i‡(
åx_sys
->
r£g_hi°‹y_Àn
 >Ñseg_history_len

2576 || (
§v_max_purge_œg
 > 0

2577 && 
r£g_hi°‹y_Àn
 > 
§v_max_purge_œg
)) {

2582 i‡(
n_u£_thªads
 < 
n_thªads
) {

2583 ++
n_u£_thªads
;

2586 } i‡(
	`§v_check_a˘ivôy
(
ﬁd_a˘ivôy_cou¡
)

2587 && 
n_u£_thªads
 > 1) {

2592 --
n_u£_thªads
;

2594 
ﬁd_a˘ivôy_cou¡
 = 
	`§v_gë_a˘ivôy_cou¡
();

2600 
	`ut_a
(
n_u£_thªads
 > 0);

2601 
	`ut_a
(
n_u£_thªads
 <
n_thªads
);

2604 i‡((
r£g_hi°‹y_Àn
 = 
åx_sys
->rseg_history_len) == 0) {

2608 
n_∑ges_purged
 = 
	`åx_purge
(

2609 
n_u£_thªads
, 
§v_purge_b©ch_size
, 
Ál£
);

2611 i‡(!(
cou¡
++ % 
TRX_SYS_N_RSEGS
)) {

2613 
n_∑ges_purged
 +
	`åx_purge
(

2614 1, 
§v_purge_b©ch_size
, 
åue
);

2617 *
n_tŸÆ_purged
 +
n_∑ges_purged
;

2619 } !
	`§v_purge_should_exô
(
n_∑ges_purged
)

2620 && 
n_∑ges_purged
 > 0

2621 && 
purge_sys
->
°©e
 =
PURGE_STATE_RUN
);

2623 (
r£g_hi°‹y_Àn
);

2624 
	}
}

2630 
	$§v_purge_co‹dö©‹_su•íd
(

2632 
§v_¶Ÿ_t
* 
¶Ÿ
,

2634 
ulöt
 
r£g_hi°‹y_Àn
)

2637 
	`ut_ad
(!
§v_ªad_⁄ly_mode
);

2638 
	`ut_a
(
¶Ÿ
->
ty≥
 =
SRV_PURGE
);

2640 
boﬁ
 
°›
 = 
Ál£
;

2643 c⁄° 
ulöt
 
SRV_PURGE_MAX_TIMEOUT
 = 10000;

2645 
ib_öt64_t
 
sig_cou¡
 = 
	`§v_su•íd_thªad
(
¶Ÿ
);

2648 
ulöt
 
ªt
;

2650 
	`rw_lock_x_lock
(&
purge_sys
->
œtch
);

2652 
purge_sys
->
ru¬ög
 = 
Ál£
;

2654 
	`rw_lock_x_u∆ock
(&
purge_sys
->
œtch
);

2659 i‡(
°›
) {

2660 
	`os_evít_waô_low
(
¶Ÿ
->
evít
, 
sig_cou¡
);

2661 
ªt
 = 0;

2662 } i‡(
r£g_hi°‹y_Àn
 <
åx_sys
->rseg_history_len) {

2663 
ªt
 = 
	`os_evít_waô_time_low
(

2664 
¶Ÿ
->
evít
, 
SRV_PURGE_MAX_TIMEOUT
, 
sig_cou¡
);

2669 
ªt
 = 0;

2672 
	`§v_sys_muãx_íãr
();

2677 i‡(
¶Ÿ
->
su•íded
) {

2678 
¶Ÿ
->
su•íded
 = 
FALSE
;

2679 ++
§v_sys
->
n_thªads_a˘ive
[
¶Ÿ
->
ty≥
];

2680 
	`ut_a
(
§v_sys
->
n_thªads_a˘ive
[
¶Ÿ
->
ty≥
] == 1);

2683 
	`§v_sys_muãx_exô
();

2685 
sig_cou¡
 = 
	`§v_su•íd_thªad
(
¶Ÿ
);

2687 
	`rw_lock_x_lock
(&
purge_sys
->
œtch
);

2689 
°›
 = (
§v_shutdown_°©e
 =
SRV_SHUTDOWN_NONE


2690 && 
purge_sys
->
°©e
 =
PURGE_STATE_STOP
);

2692 i‡(!
°›
) {

2693 
	`ut_a
(
purge_sys
->
n_°›
 == 0);

2694 
purge_sys
->
ru¬ög
 = 
åue
;

2696 
	`ut_a
(
purge_sys
->
n_°›
 > 0);

2699 
	`os_evít_£t
(
purge_sys
->
evít
);

2702 
	`rw_lock_x_u∆ock
(&
purge_sys
->
œtch
);

2704 i‡(
ªt
 =
OS_SYNC_TIME_EXCEEDED
) {

2712 i‡(
r£g_hi°‹y_Àn
 =
åx_sys
->rseg_history_len

2713 && 
åx_sys
->
r£g_hi°‹y_Àn
 < 5000) {

2715 
°›
 = 
åue
;

2719 } 
°›
);

2721 
	`§v_sys_muãx_íãr
();

2723 i‡(
¶Ÿ
->
su•íded
) {

2724 
¶Ÿ
->
su•íded
 = 
FALSE
;

2725 ++
§v_sys
->
n_thªads_a˘ive
[
¶Ÿ
->
ty≥
];

2726 
	`ut_a
(
§v_sys
->
n_thªads_a˘ive
[
¶Ÿ
->
ty≥
] == 1);

2729 
	`§v_sys_muãx_exô
();

2730 
	}
}

2735 "C" 
UNIV_INTERN


2736 
os_thªad_ªt_t


2737 
	$DECLARE_THREAD
(
§v_purge_co‹dö©‹_thªad
)(

2739 * 
¨g
 
	`__©åibuã__
((
unu£d
)))

2742 
§v_¶Ÿ_t
* 
¶Ÿ
;

2743 
ulöt
 
n_tŸÆ_purged
 = 
ULINT_UNDEFINED
;

2745 
	`ut_ad
(!
§v_ªad_⁄ly_mode
);

2746 
	`ut_a
(
§v_n_purge_thªads
 >= 1);

2747 
	`ut_a
(
	`åx_purge_°©e
(Ë=
PURGE_STATE_INIT
);

2748 
	`ut_a
(
§v_f‹˚_ªcovîy
 < 
SRV_FORCE_NO_BACKGROUND
);

2750 
	`rw_lock_x_lock
(&
purge_sys
->
œtch
);

2752 
purge_sys
->
ru¬ög
 = 
åue
;

2753 
purge_sys
->
°©e
 = 
PURGE_STATE_RUN
;

2755 
	`rw_lock_x_u∆ock
(&
purge_sys
->
œtch
);

2757 #ifde‡
UNIV_PFS_THREAD


2758 
	`pfs_ªgi°î_thªad
(
§v_purge_thªad_key
);

2761 #ifde‡
UNIV_DEBUG_THREAD_CREATION


2762 
	`ut_¥öt_time°amp
(
°dîr
);

2763 
	`Ârötf
(
°dîr
, " InnoDB: Purge coordinatorÅhread created, id %lu\n",

2764 
	`os_thªad_pf
(
	`os_thªad_gë_cuº_id
()));

2767 
¶Ÿ
 = 
	`§v_ª£rve_¶Ÿ
(
SRV_PURGE
);

2769 
ulöt
 
r£g_hi°‹y_Àn
 = 
åx_sys
->rseg_history_len;

2775 i‡(
§v_shutdown_°©e
 =
SRV_SHUTDOWN_NONE


2776 && (
purge_sys
->
°©e
 =
PURGE_STATE_STOP


2777 || 
n_tŸÆ_purged
 == 0)) {

2779 
	`§v_purge_co‹dö©‹_su•íd
(
¶Ÿ
, 
r£g_hi°‹y_Àn
);

2782 i‡(
	`§v_purge_should_exô
(
n_tŸÆ_purged
)) {

2783 
	`ut_a
(!
¶Ÿ
->
su•íded
);

2787 
n_tŸÆ_purged
 = 0;

2789 
r£g_hi°‹y_Àn
 = 
	`§v_do_purge
(

2790 
§v_n_purge_thªads
, &
n_tŸÆ_purged
);

2792 } !
	`§v_purge_should_exô
(
n_tŸÆ_purged
));

2797 
	`ut_a
(
	`§v_purge_should_exô
(
n_tŸÆ_purged
));

2799 
ulöt
 
n_∑ges_purged
 = 
ULINT_MAX
;

2804 
§v_Á°_shutdown
 =0 && 
n_∑ges_purged
 > 0) {

2805 
n_∑ges_purged
 = 
	`åx_purge
(1, 
§v_purge_b©ch_size
, 
Ál£
);

2809 
n_∑ges_purged
 = 
	`åx_purge
(1, 
§v_purge_b©ch_size
, 
åue
);

2810 
	`ut_a
(
n_∑ges_purged
 =0 || 
§v_Á°_shutdown
 != 0);

2814 
	`ut_a
(
	`§v_gë_èsk_queue_Àngth
() == 0);

2816 
	`§v_‰ì_¶Ÿ
(
¶Ÿ
);

2819 
	`rw_lock_x_lock
(&
purge_sys
->
œtch
);

2821 
purge_sys
->
°©e
 = 
PURGE_STATE_EXIT
;

2823 
purge_sys
->
ru¬ög
 = 
Ál£
;

2825 
	`rw_lock_x_u∆ock
(&
purge_sys
->
œtch
);

2827 #ifde‡
UNIV_DEBUG_THREAD_CREATION


2828 
	`ut_¥öt_time°amp
(
°dîr
);

2829 
	`Ârötf
(
°dîr
, " InnoDB: Purge coordinatorÉxiting, id %lu\n",

2830 
	`os_thªad_pf
(
	`os_thªad_gë_cuº_id
()));

2834 i‡(
§v_n_purge_thªads
 > 1) {

2835 
	`§v_ªÀa£_thªads
(
SRV_WORKER
, 
§v_n_purge_thªads
 - 1);

2840 
	`os_thªad_exô
(
NULL
);

2842 
OS_THREAD_DUMMY_RETURN
;

2843 
	}
}

2848 
UNIV_INTERN


2850 
	$§v_que_èsk_íqueue_low
(

2852 
que_thr_t
* 
thr
)

2854 
	`ut_ad
(!
§v_ªad_⁄ly_mode
);

2855 
	`muãx_íãr
(&
§v_sys
->
èsks_muãx
);

2857 
	`UT_LIST_ADD_LAST
(
queue
, 
§v_sys
->
èsks
, 
thr
);

2859 
	`muãx_exô
(&
§v_sys
->
èsks_muãx
);

2861 
	`§v_ªÀa£_thªads
(
SRV_WORKER
, 1);

2862 
	}
}

2867 
UNIV_INTERN


2868 
ulöt


2869 
	$§v_gë_èsk_queue_Àngth
()

2872 
ulöt
 
n_èsks
;

2874 
	`ut_ad
(!
§v_ªad_⁄ly_mode
);

2876 
	`muãx_íãr
(&
§v_sys
->
èsks_muãx
);

2878 
n_èsks
 = 
	`UT_LIST_GET_LEN
(
§v_sys
->
èsks
);

2880 
	`muãx_exô
(&
§v_sys
->
èsks_muãx
);

2882 (
n_èsks
);

2883 
	}
}

2887 
UNIV_INTERN


2889 
	$§v_purge_wakeup
()

2892 
	`ut_ad
(!
§v_ªad_⁄ly_mode
);

2894 i‡(
§v_f‹˚_ªcovîy
 < 
SRV_FORCE_NO_BACKGROUND
) {

2896 
	`§v_ªÀa£_thªads
(
SRV_PURGE
, 1);

2898 i‡(
§v_n_purge_thªads
 > 1) {

2899 
ulöt
 
n_w‹kîs
 = 
§v_n_purge_thªads
 - 1;

2901 
	`§v_ªÀa£_thªads
(
SRV_WORKER
, 
n_w‹kîs
);

2904 
	}
}

	@srv0srv.h

41 #i‚de‡
§v0§v_h


42 
	#§v0§v_h


	)

44 
	~"univ.i
"

45 #i‚de‡
UNIV_HOTBACKUP


46 
	~"log0log.h
"

47 
	~"sync0sync.h
"

48 
	~"os0sync.h
"

49 
	~"que0ty≥s.h
"

50 
	~"åx0ty≥s.h
"

51 
	~"§v0c⁄c.h
"

52 
	~"buf0checksum.h
"

53 
	~"ut0cou¡î.h
"

56 
	s§v_°©s_t
 {

57 
	mib_cou¡î_t
<
	tl¢_t
, 1, 
	tsögÀ_ödexî_t
> 
	tl¢_˘r_1_t
;

58 
	mib_cou¡î_t
<
	tulöt
, 1, 
	tsögÀ_ödexî_t
> 
	tulöt_˘r_1_t
;

59 
	mib_cou¡î_t
<
	tlöt
, 1, 
	tsögÀ_ödexî_t
> 
	tlöt_˘r_1_t
;

60 
	mib_cou¡î_t
<
	tulöt
, 64> 
	tulöt_˘r_64_t
;

61 
	mib_cou¡î_t
<
	tib_öt64_t
, 1, 
	tsögÀ_ödexî_t
> 
	tib_öt64_˘r_1_t
;

64 
ulöt_˘r_1_t
 
	md©a_wrôãn
;

67 
ulöt_˘r_1_t
 
	mlog_wrôe_ªque°s
;

70 
ulöt_˘r_1_t
 
	mlog_wrôes
;

73 
l¢_˘r_1_t
 
	mos_log_wrôãn
;

76 
löt_˘r_1_t
 
	mos_log_≥ndög_wrôes
;

80 
ulöt_˘r_1_t
 
	mlog_waôs
;

83 
ulöt_˘r_1_t
 
	mdblwr_wrôes
;

87 
ulöt_˘r_1_t
 
	mdblwr_∑ges_wrôãn
;

90 
ulöt_˘r_1_t
 
	mbuf_poﬁ_wrôe_ªque°s
;

95 
ulöt_˘r_1_t
 
	mbuf_poﬁ_waô_‰ì
;

99 
ulöt_˘r_1_t
 
	mbuf_poﬁ_Êushed
;

103 
ulöt_˘r_1_t
 
	mbuf_poﬁ_ªads
;

106 
ulöt_˘r_1_t
 
	md©a_ªad
;

109 
ib_öt64_˘r_1_t
 
	mn_lock_waô_time
;

112 
ulöt_˘r_1_t
 
	mn_lock_waô_cou¡
;

115 
löt_˘r_1_t
 
	mn_lock_waô_cuºít_cou¡
;

118 
ulöt_˘r_64_t
 
	mn_rows_ªad
;

121 
ulöt_˘r_64_t
 
	mn_rows_upd©ed
;

124 
ulöt_˘r_64_t
 
	mn_rows_dñëed
;

127 
ulöt_˘r_64_t
 
	mn_rows_ö£πed
;

130 c⁄° * 
§v_maö_thªad_›_öfo
;

133 c⁄° 
§v_mysql50_èbÀ_«me_¥efix
[10];

136 
os_evít_t
 
§v_m⁄ô‹_evít
;

139 
os_evít_t
 
§v_îr‹_evít
;

142 
os_evít_t
 
§v_buf_dump_evít
;

145 
	#SRV_BUF_DUMP_FILENAME_DEFAULT
 "ib_buf„r_poﬁ"

	)

146 * 
§v_buf_dump_fûíame
;

150 
§v_buf„r_poﬁ_dump_©_shutdown
;

151 
§v_buf„r_poﬁ_lﬂd_©_°¨tup
;

154 
§v_dißbÀ_s‹t_fûe_ˇche
;

158 
	#SRV_AUTO_EXTEND_INCREMENT
 \

159 (
§v_auto_exãnd_ö¸emít
 * ((1024 * 1024Ë/ 
UNIV_PAGE_SIZE
))

	)

162 
ib_muãx_t
 
§v_m⁄ô‹_fûe_muãx
;

164 
FILE
* 
§v_m⁄ô‹_fûe
;

168 
ib_muãx_t
 
§v_di˘_tmpfûe_muãx
;

170 
FILE
* 
§v_di˘_tmpfûe
;

174 
ib_muãx_t
 
§v_misc_tmpfûe_muãx
;

176 
FILE
* 
§v_misc_tmpfûe
;

180 * 
§v_d©a_home
;

182 #ifde‡
UNIV_LOG_ARCHIVE


183 * 
§v_¨ch_dú
;

189 
my_boﬁ
 
§v_ªad_⁄ly_mode
;

192 
my_boﬁ
 
§v_fûe_≥r_èbÀ
;

194 
ul⁄g
 
§v_thªad_¶ìp_dñay
;

195 #i‡
deföed
(
HAVE_ATOMIC_BUILTINS
)

197 
ul⁄g
 
§v_ad≠tive_max_¶ìp_dñay
;

201 
ulöt
 
§v_fûe_f‹m©
;

205 
ulöt
 
§v_max_fûe_f‹m©_©_°¨tup
;

208 
iboﬁ
 
§v_locks_unß„_f‹_bölog
;

211 
ul⁄g
 
§v_s‹t_buf_size
;

213 
§v_⁄löe_max_size
;

219 
my_boﬁ
 
§v_u£_«tive_aio
;

220 #ifde‡
__WIN__


221 
iboﬁ
 
§v_u£_«tive_c⁄dôi⁄s
;

226 * 
§v_undo_dú
;

229 
ul⁄g
 
§v_undo_èbÀ•a˚s
;

232 
ulöt
 
§v_undo_èbÀ•a˚s_›í
;

235 
ul⁄g
 
§v_undo_logs
;

237 
ulöt
 
§v_n_d©a_fûes
;

238 ** 
§v_d©a_fûe_«mes
;

239 
ulöt
* 
§v_d©a_fûe_sizes
;

240 
ulöt
* 
§v_d©a_fûe_is_øw_∑πôi⁄
;

242 
iboﬁ
 
§v_auto_exãnd_œ°_d©a_fûe
;

243 
ulöt
 
§v_œ°_fûe_size_max
;

244 * 
§v_log_group_home_dú
;

246 #ifde‡
SSD_CACHE_FACE


247 
iboﬁ
 
§v_u£_ssd_ˇche
;

248 * 
§v_ssd_ˇche_fûe
;

249 
ulöt
 
§v_ssd_ˇche_size
;

250 
ulöt
 
§v_ssd_ˇche_tŸÆ_ªf
;

251 
ulöt
 
§v_ssd_ˇche_hô_ªf
;

252 
ulöt
 
§v_ssd_ˇche_sˇn_dïth
;

255 #i‚de‡
UNIV_HOTBACKUP


256 
ul⁄g
 
§v_auto_exãnd_ö¸emít
;

258 
iboﬁ
 
§v_¸óãd_√w_øw
;

261 
	#SRV_N_LOG_FILES_MAX
 100

	)

262 
ul⁄g
 
§v_n_log_fûes
;

263 
ib_uöt64_t
 
§v_log_fûe_size
;

264 
ib_uöt64_t
 
§v_log_fûe_size_ªque°ed
;

265 
ulöt
 
§v_log_buf„r_size
;

266 
ul⁄g
 
§v_Êush_log_©_åx_commô
;

267 
uöt
 
§v_Êush_log_©_timeout
;

268 
§v_ad≠tive_Êushög
;

273 
my_boﬁ
 
§v_lﬂd_c‹ru±ed
;

277 c⁄° 
byã
* 
§v_œtö1_‹dîög
;

278 #i‚de‡
UNIV_HOTBACKUP


279 
my_boﬁ
 
§v_u£_sys_mÆloc
;

281 
iboﬁ
 
§v_u£_sys_mÆloc
;

283 
ulöt
 
§v_buf_poﬁ_size
;

284 
ulöt
 
§v_buf_poﬁ_ö°™˚s
;

285 
ul⁄g
 
§v_n_∑ge_hash_locks
;

287 
ul⁄g
 
§v_LRU_sˇn_dïth
;

289 
ul⁄g
 
§v_Êush_√ighb‹s
;

291 
ulöt
 
§v_buf_poﬁ_ﬁd_size
;

292 
ulöt
 
§v_buf_poﬁ_cuº_size
;

293 
ulöt
 
§v_mem_poﬁ_size
;

294 
ulöt
 
§v_lock_èbÀ_size
;

296 
ulöt
 
§v_n_fûe_io_thªads
;

297 
my_boﬁ
 
§v_øndom_ªad_ahód
;

298 
ul⁄g
 
§v_ªad_ahód_thªshﬁd
;

299 
ulöt
 
§v_n_ªad_io_thªads
;

300 
ulöt
 
§v_n_wrôe_io_thªads
;

303 
ul⁄g
 
§v_io_ˇ∑côy
;

307 
	#SRV_MAX_IO_CAPACITY_DUMMY_DEFAULT
 (~0UL)

	)

308 
	#SRV_MAX_IO_CAPACITY_LIMIT
 (~0UL)

	)

309 
ul⁄g
 
§v_max_io_ˇ∑côy
;

313 
	#PCT_IO
(
p
Ë((
ul⁄g
Ë(
§v_io_ˇ∑côy
 * ((Ë’Ë/ 100.0)))

	)

318 
ul⁄g
 
§v_önodb_°©s_mëhod
;

320 #ifde‡
UNIV_LOG_ARCHIVE


321 
iboﬁ
 
§v_log_¨chive_⁄
;

322 
iboﬁ
 
§v_¨chive_ªcovîy
;

323 
ib_uöt64_t
 
§v_¨chive_ªcovîy_limô_l¢
;

326 * 
§v_fûe_Êush_mëhod_°r
;

327 
ulöt
 
§v_unix_fûe_Êush_mëhod
;

328 
ulöt
 
§v_wö_fûe_Êush_mëhod
;

330 
ulöt
 
§v_max_n_›í_fûes
;

332 
ul⁄g
 
§v_max_dúty_∑ges_p˘
;

333 
ul⁄g
 
§v_max_dúty_∑ges_p˘_lwm
;

335 
ul⁄g
 
§v_ad≠tive_Êushög_lwm
;

336 
ul⁄g
 
§v_Êushög_avg_lo›s
;

338 
ul⁄g
 
§v_f‹˚_ªcovîy
;

339 #i‚de‡
DBUG_OFF


340 
ul⁄g
 
§v_f‹˚_ªcovîy_¸ash
;

343 
ulöt
 
§v_Á°_shutdown
;

350 
iboﬁ
 
§v_önodb_°©us
;

352 
§v_°©s_å™sõ¡_ßm∂e_∑ges
;

353 
my_boﬁ
 
§v_°©s_≥rsi°ít
;

354 
§v_°©s_≥rsi°ít_ßm∂e_∑ges
;

355 
my_boﬁ
 
§v_°©s_auto_ªˇlc
;

357 
iboﬁ
 
§v_u£_doubÀwrôe_buf
;

358 
ul⁄g
 
§v_doubÀwrôe_b©ch_size
;

359 
ul⁄g
 
§v_checksum_Æg‹ôhm
;

361 
ul⁄g
 
§v_max_buf_poﬁ_modifõd_p˘
;

362 
ul⁄g
 
§v_max_purge_œg
;

363 
ul⁄g
 
§v_max_purge_œg_dñay
;

365 
ul⁄g
 
§v_ª∂iˇti⁄_dñay
;

368 
my_boﬁ
 
§v_¥öt_önodb_m⁄ô‹
;

369 
my_boﬁ
 
§v_¥öt_önodb_lock_m⁄ô‹
;

370 
iboﬁ
 
§v_¥öt_önodb_èbÀ•a˚_m⁄ô‹
;

371 
iboﬁ
 
§v_¥öt_vîbo£_log
;

372 
	#DEPRECATED_MSG_INNODB_TABLE_MONITOR
 \

375 "èbÀ†ö°ód, sì " 
REFMAN
 "önodb-i_s-èbÀs.html"

	)

376 
iboﬁ
 
§v_¥öt_önodb_èbÀ_m⁄ô‹
;

378 
iboﬁ
 
§v_m⁄ô‹_a˘ive
;

379 
iboﬁ
 
§v_îr‹_m⁄ô‹_a˘ive
;

382 
iboﬁ
 
§v_buf_dump_thªad_a˘ive
;

385 
iboﬁ
 
§v_di˘_°©s_thªad_a˘ive
;

387 
ul⁄g
 
§v_n_•ö_waô_rounds
;

388 
ul⁄g
 
§v_n_‰ì_tickës_to_íãr
;

389 
ul⁄g
 
§v_thªad_¶ìp_dñay
;

390 
ul⁄g
 
§v_•ö_waô_dñay
;

391 
iboﬁ
 
§v_¥i‹ôy_boo°
;

393 
ulöt
 
§v_åunˇãd_°©us_wrôes
;

394 
ulöt
 
§v_avaûabÀ_undo_logs
;

396 
ulöt
 
§v_mem_poﬁ_size
;

397 
ulöt
 
§v_lock_èbÀ_size
;

399 #ifde‡
UNIV_DEBUG


400 
iboﬁ
 
§v_¥öt_thªad_ªÀa£s
;

401 
iboﬁ
 
§v_¥öt_lock_waôs
;

402 
iboﬁ
 
§v_¥öt_buf_io
;

403 
iboﬁ
 
§v_¥öt_log_io
;

404 
iboﬁ
 
§v_¥öt_œtch_waôs
;

406 
	#§v_¥öt_thªad_ªÀa£s
 
FALSE


	)

407 
	#§v_¥öt_lock_waôs
 
FALSE


	)

408 
	#§v_¥öt_buf_io
 
FALSE


	)

409 
	#§v_¥öt_log_io
 
FALSE


	)

410 
	#§v_¥öt_œtch_waôs
 
FALSE


	)

413 #i‡
deföed
 
UNIV_DEBUG
 || deföed 
UNIV_IBUF_DEBUG


414 
my_boﬁ
 
§v_ibuf_dißbÀ_background_mîge
;

417 #ifde‡
UNIV_DEBUG


418 
my_boﬁ
 
§v_purge_võw_upd©e_⁄ly_debug
;

421 
ulöt
 
§v_Áèl_£m≠h‹e_waô_thªshﬁd
;

422 
	#SRV_SEMAPHORE_WAIT_EXTENSION
 7200

	)

423 
ulöt
 
§v_dml_√eded_dñay
;

425 #i‚de‡
HAVE_ATOMIC_BUILTINS


427 
ib_muãx_t
 
£rvî_muãx
;

430 
	#SRV_MAX_N_IO_THREADS
 130

	)

434 c⁄° * 
§v_io_thªad_›_öfo
[];

435 c⁄° * 
§v_io_thªad_fun˘i⁄
[];

438 
ul⁄g
 
§v_n_purge_thªads
;

441 
ul⁄g
 
§v_purge_b©ch_size
;

444 
ul⁄g
 
§v_sync_¨øy_size
;

447 
my_boﬁ
 
§v_¥öt_Æl_dódlocks
;

449 
my_boﬁ
 
§v_cmp_≥r_ödex_íabÀd
;

452 
exp‹t_v¨_t
 
exp‹t_v¨s
;

455 
§v_°©s_t
 
§v_°©s
;

457 #ifde‡
UNIV_PFS_THREAD


459 
mysql_pfs_key_t
 
buf_∑ge_˛ó√r_thªad_key
;

460 
mysql_pfs_key_t
 
åx_rﬁlback_˛ón_thªad_key
;

461 
mysql_pfs_key_t
 
io_h™dÀr_thªad_key
;

462 
mysql_pfs_key_t
 
§v_lock_timeout_thªad_key
;

463 
mysql_pfs_key_t
 
§v_îr‹_m⁄ô‹_thªad_key
;

464 
mysql_pfs_key_t
 
§v_m⁄ô‹_thªad_key
;

465 
mysql_pfs_key_t
 
§v_ma°î_thªad_key
;

466 
mysql_pfs_key_t
 
§v_purge_thªad_key
;

467 
mysql_pfs_key_t
 
ªcv_wrôî_thªad_key
;

471 
	#pfs_ªgi°î_thªad
(
key
) \

473 
PSI_thªad
* 
psi
 = 
	`PSI_THREAD_CALL
(
√w_thªad
)(
key
, 
NULL
, 0);\

474 
	`PSI_THREAD_CALL
(
£t_thªad
)(
psi
); \

475 } 0)

	)

478 
	#pfs_dñëe_thªad
() \

480 
	`PSI_THREAD_CALL
(
dñëe_cuºít_thªad
)(); \

481 } 0)

	)

488 
	mSRV_NOT_RAW
 = 0,

489 
	mSRV_NEW_RAW
,

491 
	mSRV_OLD_RAW


497 
	mSRV_UNIX_FSYNC
 = 1,

498 
	mSRV_UNIX_O_DSYNC
,

499 
	mSRV_UNIX_LITTLESYNC
,

502 
	mSRV_UNIX_NOSYNC
,

503 
	mSRV_UNIX_O_DIRECT
,

509 
	mSRV_UNIX_O_DIRECT_NO_FSYNC


520 
	mSRV_WIN_IO_NORMAL
 = 1,

521 
	mSRV_WIN_IO_UNBUFFERED


530 
	mSRV_FORCE_IGNORE_CORRUPT
 = 1,

532 
	mSRV_FORCE_NO_BACKGROUND
 = 2,

535 
	mSRV_FORCE_NO_TRX_UNDO
 = 3,

537 
	mSRV_FORCE_NO_IBUF_MERGE
 = 4,

540 
	mSRV_FORCE_NO_UNDO_LOG_SCAN
 = 5,

544 
	mSRV_FORCE_NO_LOG_REDO
 = 6

550 
	e§v_°©s_mëhod_«me_íum
 {

551 
	mSRV_STATS_NULLS_EQUAL
,

554 
	mSRV_STATS_NULLS_UNEQUAL
,

556 
	mSRV_STATS_NULLS_IGNORED


559 
§v_°©s_mëhod_«me_íum
 
	t§v_°©s_mëhod_«me_t
;

561 #i‚de‡
UNIV_HOTBACKUP


563 
	e§v_thªad_ty≥
 {

564 
	mSRV_NONE
,

565 
	mSRV_WORKER
,

568 
	mSRV_PURGE
,

569 
	mSRV_MASTER


575 
UNIV_INTERN


577 
§v_boŸ
();

581 
UNIV_INTERN


583 
§v_öô
();

587 
UNIV_INTERN


589 
§v_‰ì
();

594 
UNIV_INTERN


596 
§v_gíîÆ_öô
();

600 
UNIV_INTERN


602 
§v_£t_io_thªad_›_öfo
(

604 
ulöt
 
i
,

605 c⁄° * 
°r
);

609 
UNIV_INTERN


611 
§v_ª£t_io_thªad_›_öfo
();

619 
UNIV_INTERN


621 
§v_wake_purge_thªad_if_nŸ_a˘ive
();

629 
UNIV_INTERN


631 
§v_a˘ive_wake_ma°î_thªad
();

635 
UNIV_INTERN


637 
§v_wake_ma°î_thªad
();

643 
UNIV_INTERN


644 
iboﬁ


645 
§v_¥ötf_önodb_m⁄ô‹
(

647 
FILE
* 
fûe
,

648 
iboﬁ
 
nowaô
,

650 
ulöt
* 
åx_°¨t
,

652 
ulöt
* 
åx_íd
);

657 
UNIV_INTERN


659 
§v_exp‹t_önodb_°©us
();

665 
UNIV_INTERN


666 
ulöt


667 
§v_gë_a˘ivôy_cou¡
();

672 
UNIV_INTERN


673 
iboﬁ


674 
§v_check_a˘ivôy
(

676 
ulöt
 
ﬁd_a˘ivôy_cou¡
);

679 
UNIV_INTERN


681 
§v_öc_a˘ivôy_cou¡
();

687 
UNIV_INTERN


689 
§v_que_èsk_íqueue_low
(

691 
que_thr_t
* 
thr
);

698 
UNIV_INTERN


699 
§v_thªad_ty≥


700 
§v_gë_a˘ive_thªad_ty≥
();

708 
UNIV_INTERN


709 
os_thªad_ªt_t


710 
DECLARE_THREAD
(
§v_m⁄ô‹_thªad
)(

712 * 
¨g
);

718 
UNIV_INTERN


719 
os_thªad_ªt_t


720 
DECLARE_THREAD
(
§v_ma°î_thªad
)(

722 * 
¨g
);

729 
UNIV_INTERN


730 
os_thªad_ªt_t


731 
DECLARE_THREAD
(
§v_îr‹_m⁄ô‹_thªad
)(

733 * 
¨g
);

739 
UNIV_INTERN


740 
os_thªad_ªt_t


741 
DECLARE_THREAD
(
§v_purge_co‹dö©‹_thªad
)(

743 * 
¨g
 
__©åibuã__
((
unu£d
)));

749 
UNIV_INTERN


750 
os_thªad_ªt_t


751 
DECLARE_THREAD
(
§v_w‹kî_thªad
)(

753 * 
¨g
 
__©åibuã__
((
unu£d
)));

760 
UNIV_INTERN


761 
ulöt


762 
§v_gë_èsk_queue_Àngth
();

770 
UNIV_INTERN


771 
ulöt


772 
§v_ªÀa£_thªads
(

774 
§v_thªad_ty≥
 
ty≥
,

775 
ulöt
 
n
);

781 
UNIV_INTERN


783 
§v_™y_background_thªads_¨e_a˘ive
();

788 
UNIV_INTERN


790 
§v_purge_wakeup
();

794 
	sexp‹t_v¨_t
{

795 
ulöt
 
	mönodb_d©a_≥ndög_ªads
;

796 
ulöt
 
	mönodb_d©a_≥ndög_wrôes
;

797 
ulöt
 
	mönodb_d©a_≥ndög_fsyncs
;

798 
ulöt
 
	mönodb_d©a_fsyncs
;

799 
ulöt
 
	mönodb_d©a_ªad
;

800 
ulöt
 
	mönodb_d©a_wrôes
;

801 
ulöt
 
	mönodb_d©a_wrôãn
;

802 
ulöt
 
	mönodb_d©a_ªads
;

803 
	mönodb_buf„r_poﬁ_dump_°©us
[512];

804 
	mönodb_buf„r_poﬁ_lﬂd_°©us
[512];

805 
ulöt
 
	mönodb_buf„r_poﬁ_∑ges_tŸÆ
;

806 
ulöt
 
	mönodb_buf„r_poﬁ_∑ges_d©a
;

807 
ulöt
 
	mönodb_buf„r_poﬁ_byãs_d©a
;

808 
ulöt
 
	mönodb_buf„r_poﬁ_∑ges_dúty
;

809 
ulöt
 
	mönodb_buf„r_poﬁ_byãs_dúty
;

810 
ulöt
 
	mönodb_buf„r_poﬁ_∑ges_misc
;

811 
ulöt
 
	mönodb_buf„r_poﬁ_∑ges_‰ì
;

812 #ifde‡
UNIV_DEBUG


813 
ulöt
 
	mönodb_buf„r_poﬁ_∑ges_œtched
;

815 
ulöt
 
	mönodb_buf„r_poﬁ_ªad_ªque°s
;

816 
ulöt
 
	mönodb_buf„r_poﬁ_ªads
;

817 
ulöt
 
	mönodb_buf„r_poﬁ_waô_‰ì
;

818 
ulöt
 
	mönodb_buf„r_poﬁ_∑ges_Êushed
;

819 
ulöt
 
	mönodb_buf„r_poﬁ_wrôe_ªque°s
;

820 
ulöt
 
	mönodb_buf„r_poﬁ_ªad_ahód_∫d
;

821 
ulöt
 
	mönodb_buf„r_poﬁ_ªad_ahód
;

822 
ulöt
 
	mönodb_buf„r_poﬁ_ªad_ahód_evi˘ed
;

823 
ulöt
 
	mönodb_dblwr_∑ges_wrôãn
;

824 
ulöt
 
	mönodb_dblwr_wrôes
;

825 
iboﬁ
 
	mönodb_have_©omic_buûtös
;

826 
ulöt
 
	mönodb_log_waôs
;

827 
ulöt
 
	mönodb_log_wrôe_ªque°s
;

828 
ulöt
 
	mönodb_log_wrôes
;

829 
l¢_t
 
	mönodb_os_log_wrôãn
;

830 
ulöt
 
	mönodb_os_log_fsyncs
;

831 
ulöt
 
	mönodb_os_log_≥ndög_wrôes
;

832 
ulöt
 
	mönodb_os_log_≥ndög_fsyncs
;

833 
ulöt
 
	mönodb_∑ge_size
;

834 
ulöt
 
	mönodb_∑ges_¸óãd
;

835 
ulöt
 
	mönodb_∑ges_ªad
;

836 
ulöt
 
	mönodb_∑ges_wrôãn
;

837 
ulöt
 
	mönodb_row_lock_waôs
;

838 
ulöt
 
	mönodb_row_lock_cuºít_waôs
;

839 
ib_öt64_t
 
	mönodb_row_lock_time
;

841 
ulöt
 
	mönodb_row_lock_time_avg
;

844 
ulöt
 
	mönodb_row_lock_time_max
;

846 
ulöt
 
	mönodb_rows_ªad
;

847 
ulöt
 
	mönodb_rows_ö£πed
;

848 
ulöt
 
	mönodb_rows_upd©ed
;

849 
ulöt
 
	mönodb_rows_dñëed
;

850 
ulöt
 
	mönodb_num_›í_fûes
;

851 
ulöt
 
	mönodb_åunˇãd_°©us_wrôes
;

852 
ulöt
 
	mönodb_avaûabÀ_undo_logs
;

853 #ifde‡
UNIV_DEBUG


854 
ulöt
 
	mönodb_purge_åx_id_age
;

855 
ulöt
 
	mönodb_purge_võw_åx_id_age
;

861 
	s§v_¶Ÿ_t
{

862 
§v_thªad_ty≥
 
	mty≥
;

864 
iboﬁ
 
	mö_u£
;

866 
iboﬁ
 
	msu•íded
;

869 
ib_time_t
 
	msu•íd_time
;

873 
ul⁄g
 
	mwaô_timeout
;

878 
os_evít_t
 
	mevít
;

881 
que_thr_t
* 
	mthr
;

886 
	#§v_u£_ad≠tive_hash_ödexes
 
FALSE


	)

887 
	#§v_u£_«tive_aio
 
FALSE


	)

888 
	#§v_f‹˚_ªcovîy
 0UL

	)

889 
	#§v_£t_io_thªad_›_öfo
(
t
,
öfo
Ë((Ë0)

	)

890 
	#§v_ª£t_io_thªad_›_öfo
(Ë((Ë0)

	)

891 
	#§v_is_beög_°¨ãd
 0

	)

892 
	#§v_wö_fûe_Êush_mëhod
 
SRV_WIN_IO_UNBUFFERED


	)

893 
	#§v_unix_fûe_Êush_mëhod
 
SRV_UNIX_O_DSYNC


	)

894 
	#§v_°¨t_øw_disk_ö_u£
 0

	)

895 
	#§v_fûe_≥r_èbÀ
 1

	)

	@srv0start.cc

41 
	~"mysqld.h
"

42 
	~"∑rs0∑rs.h
"

43 
	~"row0·s‹t.h
"

44 
	~"ut0mem.h
"

45 
	~"mem0mem.h
"

46 
	~"d©a0d©a.h
"

47 
	~"d©a0ty≥.h
"

48 
	~"di˘0di˘.h
"

49 
	~"buf0buf.h
"

50 
	~"buf0dump.h
"

51 
	~"os0fûe.h
"

52 
	~"os0thªad.h
"

53 
	~"fû0fû.h
"

54 
	~"f•0f•.h
"

55 
	~"ªm0ªc.h
"

56 
	~"må0må.h
"

57 
	~"log0log.h
"

58 
	~"log0ªcv.h
"

59 
	~"∑ge0∑ge.h
"

60 
	~"∑ge0cur.h
"

61 
	~"åx0åx.h
"

62 
	~"åx0sys.h
"

63 
	~"bå0bå.h
"

64 
	~"bå0cur.h
"

65 
	~"ªm0ªc.h
"

66 
	~"ibuf0ibuf.h
"

67 
	~"§v0°¨t.h
"

68 
	~"§v0§v.h
"

69 #i‚de‡
UNIV_HOTBACKUP


70 
	~"åx0r£g.h
"

71 
	~"os0¥oc.h
"

72 
	~"sync0sync.h
"

73 
	~"buf0Êu.h
"

74 
	~"buf0ªa.h
"

75 
	~"di˘0boŸ.h
"

76 
	~"di˘0lﬂd.h
"

77 
	~"di˘0°©s_bg.h
"

78 
	~"que0que.h
"

79 
	~"u§0£ss.h
"

80 
	~"lock0lock.h
"

81 
	~"åx0rﬁl.h
"

82 
	~"åx0purge.h
"

83 
	~"lock0lock.h
"

84 
	~"∑rs0∑rs.h
"

85 
	~"bå0£a.h
"

86 
	~"ªm0cmp.h
"

87 
	~"di˘0¸ó.h
"

88 
	~"row0ös.h
"

89 
	~"row0£l.h
"

90 
	~"row0upd.h
"

91 
	~"row0row.h
"

92 
	~"row0mysql.h
"

93 
	~"bå0pcur.h
"

94 
	~"os0sync.h
"

95 
	~"zlib.h
"

96 
	~"ut0¸c32.h
"

99 
UNIV_INTERN
 
l¢_t
 
	g§v_°¨t_l¢
;

101 
UNIV_INTERN
 
l¢_t
 
	g§v_shutdown_l¢
;

103 #ifde‡
HAVE_DARWIN_THREADS


104 
	~<sys/ut¢ame.h
>

106 
UNIV_INTERN
 
iboﬁ
 
	g§v_have_fuŒfsync
 = 
FALSE
;

110 
UNIV_INTERN
 
iboﬁ
 
	g§v_°¨t_øw_disk_ö_u£
 = 
FALSE
;

114 
UNIV_INTERN
 
iboﬁ
 
	g§v_°¨tup_is_bef‹e_åx_rﬁlback_pha£
 = 
FALSE
;

116 
UNIV_INTERN
 
iboﬁ
 
	g§v_is_beög_°¨ãd
 = 
FALSE
;

118 
UNIV_INTERN
 
iboﬁ
 
	g§v_was_°¨ãd
 = 
FALSE
;

120 
iboﬁ
 
	g§v_°¨t_has_bìn_ˇŒed
 = 
FALSE
;

124 
UNIV_INTERN
 
§v_shutdown_°©e
 
	g§v_shutdown_°©e
 = 
SRV_SHUTDOWN_NONE
;

127 
os_fûe_t
 
	gfûes
[1000];

130 
ulöt
 
	gn
[
SRV_MAX_N_IO_THREADS
 + 6];

132 
os_thªad_id_t
 
	gthªad_ids
[
SRV_MAX_N_IO_THREADS
 + 6 + 32];

136 
os_Á°_muãx_t
 
	g§v_os_ã°_muãx
;

139 * 
	g§v_m⁄ô‹_fûe_«me
;

143 c⁄° 
ulöt
 
	gSRV_UNDO_TABLESPACE_SIZE_IN_PAGES
 =

144 ((1024 * 1024Ë* 10Ë/ 
UNIV_PAGE_SIZE_DEF
;

147 
	#SRV_N_PENDING_IOS_PER_THREAD
 
OS_AIO_N_PENDING_IOS_PER_THREAD


	)

148 
	#SRV_MAX_N_PENDING_SYNC_IOS
 100

	)

150 #ifde‡
UNIV_PFS_THREAD


152 
UNIV_INTERN
 
mysql_pfs_key_t
 
	gio_h™dÀr_thªad_key
;

153 
UNIV_INTERN
 
mysql_pfs_key_t
 
	g§v_lock_timeout_thªad_key
;

154 
UNIV_INTERN
 
mysql_pfs_key_t
 
	g§v_îr‹_m⁄ô‹_thªad_key
;

155 
UNIV_INTERN
 
mysql_pfs_key_t
 
	g§v_m⁄ô‹_thªad_key
;

156 
UNIV_INTERN
 
mysql_pfs_key_t
 
	g§v_ma°î_thªad_key
;

157 
UNIV_INTERN
 
mysql_pfs_key_t
 
	g§v_purge_thªad_key
;

166 
	$§v_∑r£_megabyãs
(

168 * 
°r
,

169 
ulöt
* 
megs
)

171 * 
ídp
;

172 
ulöt
 
size
;

174 
size
 = 
	`°πoul
(
°r
, &
ídp
, 10);

176 
°r
 = 
ídp
;

178 *
°r
) {

180 
size
 *= 1024;

183 
°r
++;

186 
size
 /= 1024;

187 
°r
++;

190 
size
 /= 1024 * 1024;

194 *
megs
 = 
size
;

195 (
°r
);

196 
	}
}

202 
boﬁ


203 
	$§v_fûe_check_mode
(

205 c⁄° * 
«me
)

207 
os_fûe_°©_t
 
°©
;

209 
	`mem£t
(&
°©
, 0x0, (stat));

211 
dbîr_t
 
îr
 = 
	`os_fûe_gë_°©us
(
«me
, &
°©
, 
åue
);

213 i‡(
îr
 =
DB_FAIL
) {

215 
	`ib_logf
(
IB_LOG_LEVEL_ERROR
,

217 "fûê≥rmissi⁄s", 
«me
);

219 (
Ál£
);

221 } i‡(
îr
 =
DB_SUCCESS
) {

225 i‡(
°©
.
ty≥
 =
OS_FILE_TYPE_FILE
) {

227 i‡(!
°©
.
rw_≥rm
) {

229 
	`ib_logf
(
IB_LOG_LEVEL_ERROR
,

231 
«me
,

232 
§v_ªad_⁄ly_mode


235 (
Ál£
);

240 
	`ib_logf
(
IB_LOG_LEVEL_ERROR
,

241 "'%s'ÇŸáÑeguœ∏fûe.", 
«me
);

243 (
Ál£
);

250 
	`ut_a
(
îr
 =
DB_NOT_FOUND
);

253 (
åue
);

254 
	}
}

260 
UNIV_INTERN


261 
iboﬁ


262 
	$§v_∑r£_d©a_fûe_∑ths_™d_sizes
(

264 * 
°r
)

266 * 
öput_°r
;

267 * 
∑th
;

268 
ulöt
 
size
;

269 
ulöt
 
i
 = 0;

271 
§v_auto_exãnd_œ°_d©a_fûe
 = 
FALSE
;

272 
§v_œ°_fûe_size_max
 = 0;

273 
§v_d©a_fûe_«mes
 = 
NULL
;

274 
§v_d©a_fûe_sizes
 = 
NULL
;

275 
§v_d©a_fûe_is_øw_∑πôi⁄
 = 
NULL
;

277 
öput_°r
 = 
°r
;

283 *
°r
 != '\0') {

284 
∑th
 = 
°r
;

286 (*
°r
 != ':' && *str != '\0')

287 || (*
°r
 == ':'

288 && (*(
°r
 + 1) == '\\' || *(str + 1) == '/'

289 || *(
°r
 + 1) == ':'))) {

290 
°r
++;

293 i‡(*
°r
 == '\0') {

294 (
FALSE
);

297 
°r
++;

299 
°r
 = 
	`§v_∑r£_megabyãs
(°r, &
size
);

301 i‡(0 =
	`°∫cmp
(
°r
, ":autoextend",

304 
°r
 += ( ":autoextend") - 1;

306 i‡(0 =
	`°∫cmp
(
°r
, ":max:",

309 
°r
 += ( ":max:") - 1;

311 
°r
 = 
	`§v_∑r£_megabyãs
(°r, &
size
);

314 i‡(*
°r
 != '\0') {

316 (
FALSE
);

320 i‡(
	`°æí
(
°r
) >= 6

321 && *
°r
 == 'n'

322 && *(
°r
 + 1) == 'e'

323 && *(
°r
 + 2) == 'w') {

324 
°r
 += 3;

327 i‡(*
°r
 == 'r' && *(str + 1) == 'a' && *(str + 2) == 'w') {

328 
°r
 += 3;

331 i‡(
size
 == 0) {

332 (
FALSE
);

335 
i
++;

337 i‡(*
°r
 == ';') {

338 
°r
++;

339 } i‡(*
°r
 != '\0') {

341 (
FALSE
);

345 i‡(
i
 == 0) {

349 (
FALSE
);

352 
§v_d©a_fûe_«mes
 = 
°©ic_ˇ°
<**>(

353 
	`mÆloc
(
i
 *  *
§v_d©a_fûe_«mes
));

355 
§v_d©a_fûe_sizes
 = 
°©ic_ˇ°
<
ulöt
*>(

356 
	`mÆloc
(
i
 *  *
§v_d©a_fûe_sizes
));

358 
§v_d©a_fûe_is_øw_∑πôi⁄
 = 
°©ic_ˇ°
<
ulöt
*>(

359 
	`mÆloc
(
i
 *  *
§v_d©a_fûe_is_øw_∑πôi⁄
));

361 
§v_n_d©a_fûes
 = 
i
;

365 
°r
 = 
öput_°r
;

366 
i
 = 0;

368 *
°r
 != '\0') {

369 
∑th
 = 
°r
;

376 (*
°r
 != ':' && *str != '\0')

377 || (*
°r
 == ':'

378 && (*(
°r
 + 1) == '\\' || *(str + 1) == '/'

379 || *(
°r
 + 1) == ':'))) {

380 
°r
++;

383 i‡(*
°r
 == ':') {

385 *
°r
 = '\0';

386 
°r
++;

389 
°r
 = 
	`§v_∑r£_megabyãs
(°r, &
size
);

391 
§v_d©a_fûe_«mes
[
i
] = 
∑th
;

392 
§v_d©a_fûe_sizes
[
i
] = 
size
;

394 i‡(0 =
	`°∫cmp
(
°r
, ":autoextend",

397 
§v_auto_exãnd_œ°_d©a_fûe
 = 
TRUE
;

399 
°r
 += ( ":autoextend") - 1;

401 i‡(0 =
	`°∫cmp
(
°r
, ":max:",

404 
°r
 += ( ":max:") - 1;

406 
°r
 = 
	`§v_∑r£_megabyãs
(

407 
°r
, &
§v_œ°_fûe_size_max
);

410 i‡(*
°r
 != '\0') {

412 (
FALSE
);

416 (
§v_d©a_fûe_is_øw_∑πôi⁄
)[
i
] = 0;

418 i‡(
	`°æí
(
°r
) >= 6

419 && *
°r
 == 'n'

420 && *(
°r
 + 1) == 'e'

421 && *(
°r
 + 2) == 'w') {

422 
°r
 += 3;

424 (
§v_d©a_fûe_is_øw_∑πôi⁄
)[
i
] =

425 
›t_boŸ°øp
 ? 
SRV_NEW_RAW
 : 
SRV_OLD_RAW
;

428 i‡(*
°r
 == 'r' && *(str + 1) == 'a' && *(str + 2) == 'w') {

429 
°r
 += 3;

432 i‡((
§v_d©a_fûe_is_øw_∑πôi⁄
)[
i
] == 0) {

433 (
§v_d©a_fûe_is_øw_∑πôi⁄
)[
i
] =

434 
›t_boŸ°øp
 ? 
SRV_NEW_RAW
 : 
SRV_OLD_RAW
;

438 
i
++;

440 i‡(*
°r
 == ';') {

441 
°r
++;

445 (
TRUE
);

446 
	}
}

451 
UNIV_INTERN


453 
	$§v_‰ì_∑ths_™d_sizes
()

456 
	`‰ì
(
§v_d©a_fûe_«mes
);

457 
§v_d©a_fûe_«mes
 = 
NULL
;

458 
	`‰ì
(
§v_d©a_fûe_sizes
);

459 
§v_d©a_fûe_sizes
 = 
NULL
;

460 
	`‰ì
(
§v_d©a_fûe_is_øw_∑πôi⁄
);

461 
§v_d©a_fûe_is_øw_∑πôi⁄
 = 
NULL
;

462 
	}
}

464 #i‚de‡
UNIV_HOTBACKUP


468 "C" 
UNIV_INTERN


469 
os_thªad_ªt_t


470 
	$DECLARE_THREAD
(
io_h™dÀr_thªad
)(

472 * 
¨g
)

475 
ulöt
 
£gmít
;

477 
£gmít
 = *((
ulöt
*Ë
¨g
);

479 #ifde‡
UNIV_DEBUG_THREAD_CREATION


480 
	`Ârötf
(
°dîr
, "Iÿh™dÀ∏thªad %lu sèπs, id %lu\n", 
£gmít
,

481 
	`os_thªad_pf
(
	`os_thªad_gë_cuº_id
()));

484 #ifde‡
UNIV_PFS_THREAD


485 
	`pfs_ªgi°î_thªad
(
io_h™dÀr_thªad_key
);

488 
§v_shutdown_°©e
 !
SRV_SHUTDOWN_EXIT_THREADS
) {

489 
	`fû_aio_waô
(
£gmít
);

497 
	`os_thªad_exô
(
NULL
);

499 
OS_THREAD_DUMMY_RETURN
;

500 
	}
}

505 
UNIV_INTERN


507 
§v_n‹mÆize_∑th_f‹_wö
(

509 * 
°r
 
__©åibuã__
((
unu£d
)))

512 #ifde‡
__WIN__


513 ; *
°r
; str++) {

515 i‡(*
°r
 == '/') {

516 *
°r
 = '\\';

522 #i‚de‡
UNIV_HOTBACKUP


526 
__©åibuã__
((
n⁄nuŒ
, 
w¨n_unu£d_ªsu…
))

527 
dbîr_t


528 
	$¸óã_log_fûe
(

530 
os_fûe_t
* 
fûe
,

531 c⁄° * 
«me
)

533 
iboﬁ
 
ªt
;

535 *
fûe
 = 
	`os_fûe_¸óã
(

536 
önodb_fûe_log_key
, 
«me
,

537 
OS_FILE_CREATE
|
OS_FILE_ON_ERROR_NO_EXIT
, 
OS_FILE_NORMAL
,

538 
OS_LOG_FILE
, &
ªt
);

540 i‡(!
ªt
) {

541 
	`ib_logf
(
IB_LOG_LEVEL_ERROR
, "C™nŸ cª©ê%s", 
«me
);

542 (
DB_ERROR
);

545 
	`ib_logf
(
IB_LOG_LEVEL_INFO
,

547 
«me
, (
ul⁄g
Ë
§v_log_fûe_size


548 >> (20 - 
UNIV_PAGE_SIZE_SHIFT
));

550 
ªt
 = 
	`os_fûe_£t_size
(
«me
, *
fûe
,

551 (
os_off£t_t
Ë
§v_log_fûe_size


552 << 
UNIV_PAGE_SIZE_SHIFT
);

553 i‡(!
ªt
) {

554 
	`ib_logf
(
IB_LOG_LEVEL_ERROR
, "Cannot setÜog file"

555 " %†tÿsizê%lu MB", 
«me
, (
ul⁄g
Ë
§v_log_fûe_size


556 >> (20 - 
UNIV_PAGE_SIZE_SHIFT
));

557 (
DB_ERROR
);

560 
ªt
 = 
	`os_fûe_˛o£
(*
fûe
);

561 
	`ut_a
(
ªt
);

563 (
DB_SUCCESS
);

564 
	}
}

567 
	#INIT_LOG_FILE0
 (
SRV_N_LOG_FILES_MAX
 + 1)

	)

569 #ifde‡
DBUG_OFF


570 
	#RECOVERY_CRASH
(
x
Ëdÿ{} 0)

	)

572 
	#RECOVERY_CRASH
(
x
) do { \

573 i‡(
§v_f‹˚_ªcovîy_¸ash
 =
x
) { \

574 
	`Ârötf
(
°dîr
, "innodb_force_recovery_crash=%lu\n", \

575 
§v_f‹˚_ªcovîy_¸ash
); \

576 
	`fÊush
(
°dîr
); \

577 
	`exô
(3); \

579 } 0)

	)

586 
dbîr_t


587 
	$¸óã_log_fûes
(

589 
boﬁ
 
¸óã_√w_db
,

591 * 
logfûíame
,

592 
size_t
 
dú«mñí
,

593 
l¢_t
 
l¢
,

594 *& 
logfûe0
)

596 i‡(
§v_ªad_⁄ly_mode
) {

597 
	`ib_logf
(
IB_LOG_LEVEL_ERROR
,

599 (
DB_READ_ONLY
);

605 i‡(!
¸óã_√w_db
) {

607 
i
 = 0; i <
INIT_LOG_FILE0
; i++) {

608 
	`•rötf
(
logfûíame
 + 
dú«mñí
, "ib_logfûe%u", 
i
);

613 #ifde‡
__WIN__


614 
	`DñëeFûe
((
LPCTSTR
Ë
logfûíame
);

616 
	`u∆ök
(
logfûíame
);

622 
	`RECOVERY_CRASH
(6);

626 
	`ut_ad
(!
	`buf_poﬁ_check_no_≥ndög_io
());

628 
	`RECOVERY_CRASH
(7);

630 
i
 = 0; i < 
§v_n_log_fûes
; i++) {

631 
	`•rötf
(
logfûíame
 + 
dú«mñí
,

632 "ib_logfûe%u", 
i
 ? i : 
INIT_LOG_FILE0
);

634 
dbîr_t
 
îr
 = 
	`¸óã_log_fûe
(&
fûes
[
i
], 
logfûíame
);

636 i‡(
îr
 !
DB_SUCCESS
) {

637 (
îr
);

641 
	`RECOVERY_CRASH
(8);

646 
	`•rötf
(
logfûíame
 + 
dú«mñí
, "ib_logfûe%u", 
INIT_LOG_FILE0
);

648 
	`fû_•a˚_¸óã
(

649 
logfûíame
, 
SRV_LOG_SPACE_FIRST_ID
,

650 
	`f•_Êags_£t_∑ge_size
(0, 
UNIV_PAGE_SIZE
),

651 
FIL_LOG
);

652 
	`ut_a
(
	`fû_vÆid©e
());

654 
logfûe0
 = 
	`fû_node_¸óã
(

655 
logfûíame
, (
ulöt
Ë
§v_log_fûe_size
,

656 
SRV_LOG_SPACE_FIRST_ID
, 
FALSE
);

657 
	`ut_a
(
logfûe0
);

659 
i
 = 1; i < 
§v_n_log_fûes
; i++) {

660 
	`•rötf
(
logfûíame
 + 
dú«mñí
, "ib_logfûe%u", 
i
);

662 i‡(!
	`fû_node_¸óã
(

663 
logfûíame
,

664 (
ulöt
Ë
§v_log_fûe_size
,

665 
SRV_LOG_SPACE_FIRST_ID
, 
FALSE
)) {

666 
ut_îr‹
;

670 
	`log_group_öô
(0, 
§v_n_log_fûes
,

671 
§v_log_fûe_size
 * 
UNIV_PAGE_SIZE
,

672 
SRV_LOG_SPACE_FIRST_ID
,

673 
SRV_LOG_SPACE_FIRST_ID
 + 1);

675 
	`fû_›í_log_™d_sy°em_èbÀ•a˚_fûes
();

678 
	`muãx_íãr
(&
log_sys
->
muãx
);

679 
	`ut_d
(
ªcv_no_log_wrôe
 = 
FALSE
);

680 
	`ªcv_ª£t_logs
(
l¢
);

681 
	`muãx_exô
(&
log_sys
->
muãx
);

683 (
DB_SUCCESS
);

684 
	}
}

690 
	$¸óã_log_fûes_ª«me
(

692 * 
logfûíame
,

693 
size_t
 
dú«mñí
,

694 
l¢_t
 
l¢
,

695 * 
logfûe0
)

699 
	`fû_Êush
(
SRV_LOG_SPACE_FIRST_ID
);

702 
	`fû_˛o£_log_fûes
(
Ál£
);

706 
	`•rötf
(
logfûíame
 + 
dú«mñí
, "ib_logfile%u", 0);

708 
	`RECOVERY_CRASH
(9);

710 
	`ib_logf
(
IB_LOG_LEVEL_INFO
,

711 "RíamögÜog fûê%†tÿ%s", 
logfûe0
, 
logfûíame
);

713 
	`muãx_íãr
(&
log_sys
->
muãx
);

714 
	`ut_ad
(
	`°æí
(
logfûe0
Ë=2 + såÀn(
logfûíame
));

715 
iboﬁ
 
suc˚ss
 = 
	`os_fûe_ª«me
(

716 
önodb_fûe_log_key
, 
logfûe0
, 
logfûíame
);

717 
	`ut_a
(
suc˚ss
);

719 
	`RECOVERY_CRASH
(10);

722 
	`°r˝y
(
logfûe0
, 
logfûíame
);

723 
	`muãx_exô
(&
log_sys
->
muãx
);

725 
	`fû_›í_log_™d_sy°em_èbÀ•a˚_fûes
();

727 
	`ib_logf
(
IB_LOG_LEVEL_WARN
, "NewÜog fûe†¸óãd, LSN=" 
LSN_PF
, 
l¢
);

728 
	}
}

733 
__©åibuã__
((
n⁄nuŒ
, 
w¨n_unu£d_ªsu…
))

734 
dbîr_t


735 
	$›í_log_fûe
(

737 
os_fûe_t
* 
fûe
,

738 c⁄° * 
«me
,

739 
os_off£t_t
* 
size
)

741 
iboﬁ
 
ªt
;

743 *
fûe
 = 
	`os_fûe_¸óã
(
önodb_fûe_log_key
, 
«me
,

744 
OS_FILE_OPEN
, 
OS_FILE_AIO
,

745 
OS_LOG_FILE
, &
ªt
);

746 i‡(!
ªt
) {

747 
	`ib_logf
(
IB_LOG_LEVEL_ERROR
, "U«bÀÅÿ›í '%s'", 
«me
);

748 (
DB_ERROR
);

751 *
size
 = 
	`os_fûe_gë_size
(*
fûe
);

753 
ªt
 = 
	`os_fûe_˛o£
(*
fûe
);

754 
	`ut_a
(
ªt
);

755 (
DB_SUCCESS
);

756 
	}
}

761 
__©åibuã__
((
n⁄nuŒ
, 
w¨n_unu£d_ªsu…
))

762 
dbîr_t


763 
›í_‹_¸óã_d©a_fûes
(

765 
iboﬁ
* 
¸óã_√w_db
,

767 #ifde‡
UNIV_LOG_ARCHIVE


768 
ulöt
* 
mö_¨ch_log_no
,

770 
ulöt
* 
max_¨ch_log_no
,

773 
l¢_t
* 
mö_Êushed_l¢
,

775 
l¢_t
* 
max_Êushed_l¢
,

777 
ulöt
* 
sum_of_√w_sizes
)

780 
iboﬁ
 
ªt
;

781 
ulöt
 
i
;

782 
iboﬁ
 
⁄e_›íed
 = 
FALSE
;

783 
iboﬁ
 
⁄e_¸óãd
 = 
FALSE
;

784 
os_off£t_t
 
size
;

785 
ulöt
 
Êags
;

786 
ulöt
 
•a˚
;

787 
ulöt
 
rounded_size_∑ges
;

788 
«me
[10000];

790 i‡(
§v_n_d©a_fûes
 >= 1000) {

792 
ib_logf
(
IB_LOG_LEVEL_ERROR
,

794 "deföed %lu", (
ul⁄g
Ë
§v_n_d©a_fûes
);

796 (
DB_ERROR
);

799 *
sum_of_√w_sizes
 = 0;

801 *
¸óã_√w_db
 = 
FALSE
;

803 
§v_n‹mÆize_∑th_f‹_wö
(
§v_d©a_home
);

805 
i
 = 0; i < 
§v_n_d©a_fûes
; i++) {

806 
ulöt
 
dú«mñí
;

808 
§v_n‹mÆize_∑th_f‹_wö
(
§v_d©a_fûe_«mes
[
i
]);

809 
dú«mñí
 = 
°æí
(
§v_d©a_home
);

811 
ut_a
(
dú«mñí
 + 
°æí
(
§v_d©a_fûe_«mes
[
i
])

812 < ( 
«me
) - 1);

814 
mem˝y
(
«me
, 
§v_d©a_home
, 
dú«mñí
);

817 i‡(
dú«mñí
 && 
«me
[dú«mñí - 1] !
SRV_PATH_SEPARATOR
) {

818 
«me
[
dú«mñí
++] = 
SRV_PATH_SEPARATOR
;

821 
°r˝y
(
«me
 + 
dú«mñí
, 
§v_d©a_fûe_«mes
[
i
]);

825 i‡(!
§v_fûe_check_mode
(
«me
)) {

827 (
DB_FAIL
);

829 } i‡(
§v_d©a_fûe_is_øw_∑πôi⁄
[
i
] == 0) {

834 
fûes
[
i
] = 
os_fûe_¸óã
(

835 
önodb_fûe_d©a_key
, 
«me
, 
OS_FILE_CREATE
,

836 
OS_FILE_NORMAL
, 
OS_DATA_FILE
, &
ªt
);

838 i‡(
§v_ªad_⁄ly_mode
) {

840 i‡(
ªt
) {

841 
size_check
;

844 
ib_logf
(
IB_LOG_LEVEL_ERROR
,

845 "O≥nög %†Áûed!", 
«me
);

847 (
DB_ERROR
);

849 } i‡(!
ªt


850 && 
os_fûe_gë_œ°_îr‹
(
Ál£
)

851 !
OS_FILE_ALREADY_EXISTS


852 #ifde‡
UNIV_AIX


857 && 
os_fûe_gë_œ°_îr‹
(
Ál£
) != 100

860 
ib_logf
(
IB_LOG_LEVEL_ERROR
,

862 
«me
);

864 (
DB_ERROR
);

867 } i‡(
§v_d©a_fûe_is_øw_∑πôi⁄
[
i
] =
SRV_NEW_RAW
) {

869 
ut_a
(!
§v_ªad_⁄ly_mode
);

874 
§v_°¨t_øw_disk_ö_u£
 = 
TRUE
;

875 
§v_¸óãd_√w_øw
 = 
TRUE
;

877 
fûes
[
i
] = 
os_fûe_¸óã
(

878 
önodb_fûe_d©a_key
, 
«me
, 
OS_FILE_OPEN_RAW
,

879 
OS_FILE_NORMAL
, 
OS_DATA_FILE
, &
ªt
);

881 i‡(!
ªt
) {

882 
ib_logf
(
IB_LOG_LEVEL_ERROR
,

883 "Eº‹ i¿›íög %s", 
«me
);

885 (
DB_ERROR
);

888 c⁄° * 
check_msg
;

889 
check_msg
 = 
fû_ªad_fú°_∑ge
(

890 
fûes
[
i
], 
FALSE
, &
Êags
, &
•a˚
,

891 #ifde‡
UNIV_LOG_ARCHIVE


892 
mö_¨ch_log_no
, 
max_¨ch_log_no
,

894 
mö_Êushed_l¢
, 
max_Êushed_l¢
);

899 i‡(
check_msg
 =
NULL
) {

901 
§v_¸óãd_√w_øw
 = 
FALSE
;

902 
ªt
 = 
FALSE
;

905 } i‡(
§v_d©a_fûe_is_øw_∑πôi⁄
[
i
] =
SRV_OLD_RAW
) {

906 
§v_°¨t_øw_disk_ö_u£
 = 
TRUE
;

908 
ªt
 = 
FALSE
;

910 
ut_a
(0);

913 i‡(
ªt
 =
FALSE
) {

914 c⁄° * 
check_msg
;

917 i‡(
⁄e_¸óãd
) {

918 
ib_logf
(
IB_LOG_LEVEL_ERROR
,

922 
«me
);

923 (
DB_ERROR
);

925 i‡(
§v_d©a_fûe_is_øw_∑πôi⁄
[
i
] =
SRV_OLD_RAW
) {

926 
ut_a
(!
§v_ªad_⁄ly_mode
);

927 
fûes
[
i
] = 
os_fûe_¸óã
(

928 
önodb_fûe_d©a_key
,

929 
«me
, 
OS_FILE_OPEN_RAW
,

930 
OS_FILE_NORMAL
, 
OS_DATA_FILE
, &
ªt
);

931 } i‡(
i
 == 0) {

932 
fûes
[
i
] = 
os_fûe_¸óã
(

933 
önodb_fûe_d©a_key
,

934 
«me
, 
OS_FILE_OPEN_RETRY
,

935 
OS_FILE_NORMAL
, 
OS_DATA_FILE
, &
ªt
);

937 
fûes
[
i
] = 
os_fûe_¸óã
(

938 
önodb_fûe_d©a_key
,

939 
«me
, 
OS_FILE_OPEN
, 
OS_FILE_NORMAL
,

940 
OS_DATA_FILE
, &
ªt
);

943 i‡(!
ªt
) {

945 
os_fûe_gë_œ°_îr‹
(
åue
);

947 
ib_logf
(
IB_LOG_LEVEL_ERROR
,

948 "C™'à›í '%s'", 
«me
);

950 (
DB_ERROR
);

953 i‡(
§v_d©a_fûe_is_øw_∑πôi⁄
[
i
] =
SRV_OLD_RAW
) {

955 
skù_size_check
;

958 
size_check
:

959 
size
 = 
os_fûe_gë_size
(
fûes
[
i
]);

960 
ut_a
(
size
 !(
os_off£t_t
) -1);

963 
rounded_size_∑ges
 = (
ulöt
)

964 (
size
 >> 
UNIV_PAGE_SIZE_SHIFT
);

966 i‡(
i
 =
§v_n_d©a_fûes
 - 1

967 && 
§v_auto_exãnd_œ°_d©a_fûe
) {

969 i‡(
§v_d©a_fûe_sizes
[
i
] > 
rounded_size_∑ges


970 || (
§v_œ°_fûe_size_max
 > 0

971 && 
§v_œ°_fûe_size_max


972 < 
rounded_size_∑ges
)) {

974 
ib_logf
(
IB_LOG_LEVEL_ERROR
,

984 
«me
,

985 (
ul⁄g
Ë
rounded_size_∑ges
,

986 (
ul⁄g
Ë
§v_d©a_fûe_sizes
[
i
],

987 (
ul⁄g
)

988 
§v_œ°_fûe_size_max
);

990 (
DB_ERROR
);

993 
§v_d©a_fûe_sizes
[
i
] = 
rounded_size_∑ges
;

996 i‡(
rounded_size_∑ges
 !
§v_d©a_fûe_sizes
[
i
]) {

998 
ib_logf
(
IB_LOG_LEVEL_ERROR
,

1003 
«me
,

1004 (
ul⁄g
Ë
rounded_size_∑ges
,

1005 (
ul⁄g
Ë
§v_d©a_fûe_sizes
[
i
]);

1007 (
DB_ERROR
);

1009 
skù_size_check
:

1013 i‡(
i
 == 0) {

1014 
buf_dblwr_öô_‹_lﬂd_∑ges
(

1015 
fûes
[
i
], 
§v_d©a_fûe_«mes
[i], 
åue
);

1018 
boﬁ
 
ªåy
 = 
åue
;

1019 
check_fú°_∑ge
:

1020 
check_msg
 = 
fû_ªad_fú°_∑ge
(

1021 
fûes
[
i
], 
⁄e_›íed
, &
Êags
, &
•a˚
,

1022 #ifde‡
UNIV_LOG_ARCHIVE


1023 
mö_¨ch_log_no
, 
max_¨ch_log_no
,

1025 
mö_Êushed_l¢
, 
max_Êushed_l¢
);

1027 i‡(
check_msg
) {

1029 i‡(
ªåy
) {

1030 
f•_›í_öfo
 
f•
;

1031 c⁄° 
ulöt
 
∑ge_no
 = 0;

1033 
ªåy
 = 
Ál£
;

1034 
f•
.
id
 = 0;

1035 
f•
.
fûï©h
 = 
§v_d©a_fûe_«mes
[
i
];

1036 
f•
.
fûe
 = 
fûes
[
i
];

1038 i‡(
fû_u£r_èbÀ•a˚_ª°‹e_∑ge
(

1039 &
f•
, 
∑ge_no
)) {

1040 
check_fú°_∑ge
;

1044 
ib_logf
(
IB_LOG_LEVEL_ERROR
,

1046 
check_msg
, 
«me
);

1047 (
DB_ERROR
);

1053 
ut_a
(
⁄e_›íed
 || 
•a˚
 =
TRX_SYS_SPACE
);

1057 i‡(!
⁄e_›íed


1058 && 
UNIV_PAGE_SIZE


1059 !
f•_Êags_gë_∑ge_size
(
Êags
)) {

1061 
ib_logf
(
IB_LOG_LEVEL_ERROR
,

1065 
«me
,

1066 
f•_Êags_gë_∑ge_size
(
Êags
),

1067 
UNIV_PAGE_SIZE
);

1069 (
DB_ERROR
);

1072 
⁄e_›íed
 = 
TRUE
;

1073 } i‡(!
§v_ªad_⁄ly_mode
) {

1077 
⁄e_¸óãd
 = 
TRUE
;

1079 i‡(
i
 > 0) {

1080 
ib_logf
(
IB_LOG_LEVEL_INFO
,

1083 
«me
);

1085 
ib_logf
(
IB_LOG_LEVEL_INFO
,

1089 
«me
);

1091 *
¸óã_√w_db
 = 
TRUE
;

1094 
ib_logf
(
IB_LOG_LEVEL_INFO
,

1096 
«me
,

1097 (
ul⁄g
Ë(
§v_d©a_fûe_sizes
[
i
]

1098 >> (20 - 
UNIV_PAGE_SIZE_SHIFT
)));

1100 
ib_logf
(
IB_LOG_LEVEL_INFO
,

1104 
ªt
 = 
os_fûe_£t_size
(

1105 
«me
, 
fûes
[
i
],

1106 (
os_off£t_t
Ë
§v_d©a_fûe_sizes
[
i
]

1107 << 
UNIV_PAGE_SIZE_SHIFT
);

1109 i‡(!
ªt
) {

1110 
ib_logf
(
IB_LOG_LEVEL_ERROR
,

1113 
«me
);

1115 (
DB_ERROR
);

1118 *
sum_of_√w_sizes
 +
§v_d©a_fûe_sizes
[
i
];

1121 
ªt
 = 
os_fûe_˛o£
(
fûes
[
i
]);

1122 
ut_a
(
ªt
);

1124 i‡(
i
 == 0) {

1125 
Êags
 = 
f•_Êags_£t_∑ge_size
(0, 
UNIV_PAGE_SIZE
);

1126 
fû_•a˚_¸óã
(
«me
, 0, 
Êags
, 
FIL_TABLESPACE
);

1129 
ut_a
(
fû_vÆid©e
());

1131 i‡(!
fû_node_¸óã
(
«me
, 
§v_d©a_fûe_sizes
[
i
], 0,

1132 
§v_d©a_fûe_is_øw_∑πôi⁄
[
i
] != 0)) {

1133 (
DB_ERROR
);

1137 (
DB_SUCCESS
);

1144 
dbîr_t


1145 
	$§v_undo_èbÀ•a˚_¸óã
(

1147 c⁄° * 
«me
,

1148 
ulöt
 
size
)

1150 
os_fûe_t
 
fh
;

1151 
iboﬁ
 
ªt
;

1152 
dbîr_t
 
îr
 = 
DB_SUCCESS
;

1154 
	`os_fûe_¸óã_subdús_if_√eded
(
«me
);

1156 
fh
 = 
	`os_fûe_¸óã
(

1157 
önodb_fûe_d©a_key
,

1158 
«me
,

1159 
§v_ªad_⁄ly_mode
 ? 
OS_FILE_OPEN
 : 
OS_FILE_CREATE
,

1160 
OS_FILE_NORMAL
, 
OS_DATA_FILE
, &
ªt
);

1162 i‡(
§v_ªad_⁄ly_mode
 && 
ªt
) {

1163 
	`ib_logf
(
IB_LOG_LEVEL_INFO
,

1164 "%†›íed i¿ªad-⁄ly mode", 
«me
);

1165 } i‡(
ªt
 =
FALSE
) {

1166 i‡(
	`os_fûe_gë_œ°_îr‹
(
Ál£
Ë!
OS_FILE_ALREADY_EXISTS


1167 #ifde‡
UNIV_AIX


1171 && 
	`os_fûe_gë_œ°_îr‹
(
Ál£
) != 100

1174 
	`ib_logf
(
IB_LOG_LEVEL_ERROR
,

1175 "C™'à¸óã UNDOÅabÀ•a˚ %s", 
«me
);

1177 
	`ib_logf
(
IB_LOG_LEVEL_ERROR
,

1184 
îr
 = 
DB_ERROR
;

1186 
	`ut_a
(!
§v_ªad_⁄ly_mode
);

1190 
	`ib_logf
(
IB_LOG_LEVEL_INFO
,

1192 
«me
);

1194 
	`ib_logf
(
IB_LOG_LEVEL_INFO
,

1196 
«me
, 
size
 >> (20 - 
UNIV_PAGE_SIZE_SHIFT
));

1198 
	`ib_logf
(
IB_LOG_LEVEL_INFO
,

1201 
ªt
 = 
	`os_fûe_£t_size
(
«me
, 
fh
, 
size
 << 
UNIV_PAGE_SIZE_SHIFT
);

1203 i‡(!
ªt
) {

1204 
	`ib_logf
(
IB_LOG_LEVEL_INFO
,

1206 "disk s∑˚", 
«me
);

1208 
îr
 = 
DB_ERROR
;

1211 
	`os_fûe_˛o£
(
fh
);

1214 (
îr
);

1215 
	}
}

1221 
dbîr_t


1222 
	$§v_undo_èbÀ•a˚_›í
(

1224 c⁄° * 
«me
,

1225 
ulöt
 
•a˚
)

1227 
os_fûe_t
 
fh
;

1228 
dbîr_t
 
îr
 = 
DB_ERROR
;

1229 
iboﬁ
 
ªt
;

1230 
ulöt
 
Êags
;

1232 i‡(!
	`§v_fûe_check_mode
(
«me
)) {

1233 
	`ib_logf
(
IB_LOG_LEVEL_ERROR
,

1235 
§v_ªad_⁄ly_mode
 ? "writable" : "readable");

1237 (
DB_ERROR
);

1240 
fh
 = 
	`os_fûe_¸óã
(

1241 
önodb_fûe_d©a_key
, 
«me
,

1242 
OS_FILE_OPEN_RETRY


1243 | 
OS_FILE_ON_ERROR_NO_EXIT


1244 | 
OS_FILE_ON_ERROR_SILENT
,

1245 
OS_FILE_NORMAL
,

1246 
OS_DATA_FILE
,

1247 &
ªt
);

1251 i‡(
ªt
) {

1252 
os_off£t_t
 
size
;

1254 
size
 = 
	`os_fûe_gë_size
(
fh
);

1255 
	`ut_a
(
size
 !(
os_off£t_t
) -1);

1257 
ªt
 = 
	`os_fûe_˛o£
(
fh
);

1258 
	`ut_a
(
ªt
);

1267 
	`fû_£t_max_•a˚_id_if_biggî
(
•a˚
);

1270 
Êags
 = 
	`f•_Êags_£t_∑ge_size
(0, 
UNIV_PAGE_SIZE
);

1271 
	`fû_•a˚_¸óã
(
«me
, 
•a˚
, 
Êags
, 
FIL_TABLESPACE
);

1273 
	`ut_a
(
	`fû_vÆid©e
());

1275 
os_off£t_t
 
n_∑ges
 = 
size
 / 
UNIV_PAGE_SIZE
;

1281 i‡(
	`fû_node_¸óã
(
«me
, (
ulöt
Ë
n_∑ges
, 
•a˚
, 
FALSE
)) {

1282 
îr
 = 
DB_SUCCESS
;

1286 (
îr
);

1287 
	}
}

1293 
dbîr_t


1294 
	$§v_undo_èbÀ•a˚s_öô
(

1296 
iboﬁ
 
¸óã_√w_db
,

1298 c⁄° 
ulöt
 
n_c⁄f_èbÀ•a˚s
,

1300 
ulöt
* 
n_›íed
)

1304 
ulöt
 
i
;

1305 
dbîr_t
 
îr
 = 
DB_SUCCESS
;

1306 
ulöt
 
¥ev_•a˚_id
 = 0;

1307 
ulöt
 
n_undo_èbÀ•a˚s
;

1308 
ulöt
 
undo_èbÀ•a˚_ids
[
TRX_SYS_N_RSEGS
 + 1];

1310 *
n_›íed
 = 0;

1312 
	`ut_a
(
n_c⁄f_èbÀ•a˚s
 <
TRX_SYS_N_RSEGS
);

1314 
	`mem£t
(
undo_èbÀ•a˚_ids
, 0x0, (undo_tablespace_ids));

1324 
i
 = 0; 
¸óã_√w_db
 && i < 
n_c⁄f_èbÀ•a˚s
; ++i) {

1325 
«me
[
OS_FILE_MAX_PATH
];

1327 
	`ut_¢¥ötf
(

1328 
«me
, (name),

1330 
§v_undo_dú
, 
SRV_PATH_SEPARATOR
, 
i
 + 1);

1333 
îr
 = 
	`§v_undo_èbÀ•a˚_¸óã
(

1334 
«me
, 
SRV_UNDO_TABLESPACE_SIZE_IN_PAGES
);

1336 i‡(
îr
 !
DB_SUCCESS
) {

1338 
	`ib_logf
(
IB_LOG_LEVEL_ERROR
,

1340 
«me
);

1342 (
îr
);

1351 i‡(!
¸óã_√w_db
) {

1352 
n_undo_èbÀ•a˚s
 = 
	`åx_r£g_gë_n_undo_èbÀ•a˚s
(

1353 
undo_èbÀ•a˚_ids
);

1355 
n_undo_èbÀ•a˚s
 = 
n_c⁄f_èbÀ•a˚s
;

1357 
i
 = 1; i <
n_undo_èbÀ•a˚s
; ++i) {

1358 
undo_èbÀ•a˚_ids
[
i
 - 1] = i;

1361 
undo_èbÀ•a˚_ids
[
i
] = 
ULINT_UNDEFINED
;

1369 
i
 = 0; i < 
n_undo_èbÀ•a˚s
; ++i) {

1370 
«me
[
OS_FILE_MAX_PATH
];

1372 
	`ut_¢¥ötf
(

1373 
«me
, (name),

1375 
§v_undo_dú
, 
SRV_PATH_SEPARATOR
,

1376 
undo_èbÀ•a˚_ids
[
i
]);

1379 
	`ut_a
(
¥ev_•a˚_id
 + 1 =
undo_èbÀ•a˚_ids
[
i
]);

1382 
	`ut_a
(
undo_èbÀ•a˚_ids
[
i
] != 0);

1383 
	`ut_a
(
undo_èbÀ•a˚_ids
[
i
] !
ULINT_UNDEFINED
);

1387 
îr
 = 
	`§v_undo_èbÀ•a˚_›í
(
«me
, 
undo_èbÀ•a˚_ids
[
i
]);

1389 i‡(
îr
 !
DB_SUCCESS
) {

1391 
	`ib_logf
(
IB_LOG_LEVEL_ERROR
,

1392 "U«bÀÅÿ›í undÿèbÀ•a˚ '%s'.", 
«me
);

1394 (
îr
);

1397 
¥ev_•a˚_id
 = 
undo_èbÀ•a˚_ids
[
i
];

1399 ++*
n_›íed
;

1407 
i
 = 
¥ev_•a˚_id
 + 1; i < 
TRX_SYS_N_RSEGS
; ++i) {

1408 
«me
[
OS_FILE_MAX_PATH
];

1410 
	`ut_¢¥ötf
(

1411 
«me
, (name),

1412 "%s%cundo%03lu", 
§v_undo_dú
, 
SRV_PATH_SEPARATOR
, 
i
);

1415 
îr
 = 
	`§v_undo_èbÀ•a˚_›í
(
«me
, 
i
);

1417 i‡(
îr
 !
DB_SUCCESS
) {

1421 ++
n_undo_èbÀ•a˚s
;

1423 ++*
n_›íed
;

1430 i‡(
n_c⁄f_èbÀ•a˚s
 > 
n_undo_èbÀ•a˚s
) {

1431 
	`ut_¥öt_time°amp
(
°dîr
);

1432 
	`Ârötf
(
°dîr
,

1435 
n_c⁄f_èbÀ•a˚s
);

1436 
	`ut_¥öt_time°amp
(
°dîr
);

1437 
	`Ârötf
(
°dîr
,

1439 "èbÀ•a˚s.\n", 
n_undo_èbÀ•a˚s
);

1440 
	`ut_¥öt_time°amp
(
°dîr
);

1441 
	`Ârötf
(
°dîr
,

1445 
	`ut_¥öt_time°amp
(
°dîr
);

1446 
	`Ârötf
(
°dîr
,

1448 "vÆuêi†%lu\n", 
n_undo_èbÀ•a˚s
);

1450 (
îr
 !
DB_SUCCESS
 ?Éº : 
DB_ERROR
);

1452 } i‡(
n_undo_èbÀ•a˚s
 > 0) {

1454 
	`ib_logf
(
IB_LOG_LEVEL_INFO
, "Opened %lu undoÅablespaces",

1455 
n_undo_èbÀ•a˚s
);

1457 i‡(
n_c⁄f_èbÀ•a˚s
 == 0) {

1458 
	`ib_logf
(
IB_LOG_LEVEL_WARN
,

1464 i‡(
¸óã_√w_db
) {

1465 
må_t
 
må
;

1467 
	`må_°¨t
(&
må
);

1470 
i
 = 1; i <
n_undo_èbÀ•a˚s
; ++i) {

1472 
	`f•_hódî_öô
(

1473 
i
, 
SRV_UNDO_TABLESPACE_SIZE_IN_PAGES
, &
må
);

1476 
	`må_commô
(&
må
);

1479 (
DB_SUCCESS
);

1480 
	}
}

1486 
	$§v_°¨t_waô_f‹_purge_to_°¨t
()

1491 
purge_°©e_t
 
°©e
 = 
	`åx_purge_°©e
();

1493 
	`ut_a
(
°©e
 !
PURGE_STATE_DISABLED
);

1495 
§v_shutdown_°©e
 =
SRV_SHUTDOWN_NONE


1496 && 
§v_f‹˚_ªcovîy
 < 
SRV_FORCE_NO_BACKGROUND


1497 && 
°©e
 =
PURGE_STATE_INIT
) {

1499 
°©e
 = 
	`åx_purge_°©e
()) {

1500 
PURGE_STATE_RUN
:

1501 
PURGE_STATE_STOP
:

1504 
PURGE_STATE_INIT
:

1505 
	`ib_logf
(
IB_LOG_LEVEL_INFO
,

1508 
	`os_thªad_¶ìp
(50000);

1511 
PURGE_STATE_EXIT
:

1512 
PURGE_STATE_DISABLED
:

1513 
ut_îr‹
;

1516 
	}
}

1522 
UNIV_INTERN


1523 
dbîr_t


1524 
	$önoba£_°¨t_‹_¸óã_f‹_mysql
()

1527 
iboﬁ
 
¸óã_√w_db
;

1528 
l¢_t
 
mö_Êushed_l¢
;

1529 
l¢_t
 
max_Êushed_l¢
;

1530 #ifde‡
UNIV_LOG_ARCHIVE


1531 
ulöt
 
mö_¨ch_log_no
;

1532 
ulöt
 
max_¨ch_log_no
;

1534 
ulöt
 
sum_of_√w_sizes
;

1535 
ulöt
 
sum_of_d©a_fûe_sizes
;

1536 
ulöt
 
èbÀ•a˚_size_ö_hódî
;

1537 
dbîr_t
 
îr
;

1538 
i
;

1539 
ulöt
 
§v_n_log_fûes_found
 = 
§v_n_log_fûes
;

1540 
ulöt
 
io_limô
;

1541 
må_t
 
må
;

1542 
ib_bh_t
* 
ib_bh
;

1543 
ulöt
 
n_ªcovîed_åx
;

1544 
logfûíame
[10000];

1545 * 
logfûe0
 = 
NULL
;

1546 
size_t
 
dú«mñí
;

1548 i‡(
§v_f‹˚_ªcovîy
 > 
SRV_FORCE_NO_TRX_UNDO
) {

1549 
§v_ªad_⁄ly_mode
 = 
åue
;

1552 i‡(
§v_ªad_⁄ly_mode
) {

1553 
	`ib_logf
(
IB_LOG_LEVEL_INFO
, "Started inÑead only mode");

1556 #ifde‡
HAVE_DARWIN_THREADS


1557 #ifde‡
F_FULLFSYNC


1560 
§v_have_fuŒfsync
 = 
TRUE
;

1565 
ut¢ame
 utsname;

1566 i‡(
	`u«me
(&
ut¢ame
)) {

1567 
	`ut_¥öt_time°amp
(
°dîr
);

1568 
	`Âuts
(" I¬oDB: c™nŸ dëîmöêMa¯OS X vîsi⁄!\n", 
°dîr
);

1570 
§v_have_fuŒfsync
 = 
	`°rcmp
(
ut¢ame
.
ªÀa£
, "7.") >= 0;

1572 i‡(!
§v_have_fuŒfsync
) {

1573 
	`ut_¥öt_time°amp
(
°dîr
);

1574 
	`Âuts
(" InnoDB: On Mac OS X, fsync() may be "

1575 "brokí o¿öã∫Æ drives,\n", 
°dîr
);

1576 
	`ut_¥öt_time°amp
(
°dîr
);

1577 
	`Âuts
(" I¬oDB: makögÅønß˘i⁄†unß„!\n", 
°dîr
);

1582 
	`ib_logf
(
IB_LOG_LEVEL_INFO
,

1584 #ifde‡
PAGE_ATOMIC_REF_COUNT


1592 i‡((
ulöt
) != (*)) {

1593 
	`ut_¥öt_time°amp
(
°dîr
);

1594 
	`Ârötf
(
°dîr
,

1596 "buàsizêo‡void*\n", (
ul⁄g
Ë(
ulöt
));

1597 
	`ut_¥öt_time°amp
(
°dîr
);

1598 
	`Ârötf
(
°dîr
,

1601 (
ul⁄g
) (*));

1602 
	`ut_¥öt_time°amp
(
°dîr
);

1603 
	`Ârötf
(
°dîr
,

1608 #ifde‡
UNIV_DEBUG


1609 
	`ut_¥öt_time°amp
(
°dîr
);

1610 
	`Ârötf
(
°dîr
,

1614 #ifde‡
UNIV_IBUF_DEBUG


1615 
	`ut_¥öt_time°amp
(
°dîr
);

1616 
	`Ârötf
(
°dîr
,

1618 #ifde‡
UNIV_IBUF_COUNT_DEBUG


1619 
	`ut_¥öt_time°amp
(
°dîr
);

1620 
	`Ârötf
(
°dîr
,

1623 
	`ut_¥öt_time°amp
(
°dîr
);

1624 
	`Ârötf
(
°dîr
,

1629 #ifde‡
UNIV_BLOB_DEBUG


1630 
	`Ârötf
(
°dîr
,

1635 #ifde‡
UNIV_SYNC_DEBUG


1636 
	`ut_¥öt_time°amp
(
°dîr
);

1637 
	`Ârötf
(
°dîr
,

1641 #ifde‡
UNIV_SEARCH_DEBUG


1642 
	`ut_¥öt_time°amp
(
°dîr
);

1643 
	`Ârötf
(
°dîr
,

1647 #ifde‡
UNIV_LOG_LSN_DEBUG


1648 
	`ut_¥öt_time°amp
(
°dîr
);

1649 
	`Ârötf
(
°dîr
,

1652 #ifde‡
UNIV_MEM_DEBUG


1653 
	`ut_¥öt_time°amp
(
°dîr
);

1654 
	`Ârötf
(
°dîr
,

1658 i‡(
§v_u£_sys_mÆloc
) {

1659 
	`ib_logf
(
IB_LOG_LEVEL_INFO
,

1663 #i‡
	`deföed
(
COMPILER_HINTS_ENABLED
)

1664 
	`ib_logf
(
IB_LOG_LEVEL_INFO
,

1668 
	`ib_logf
(
IB_LOG_LEVEL_INFO
,

1669 "" 
IB_ATOMICS_STARTUP_MSG
 "");

1671 
	`ib_logf
(
IB_LOG_LEVEL_INFO
,

1672 "" 
IB_MEMORY_BARRIER_STARTUP_MSG
 "");

1674 #i‚de‡
HAVE_MEMORY_BARRIER


1675 #i‡
deföed
 
__i386__
 || deföed 
__x86_64__
 || deföed 
_M_IX86
 || deföed 
_M_X64
 || deföed 
__WIN__


1677 
	`ib_logf
(
IB_LOG_LEVEL_WARN
,

1684 
	`ib_logf
(
IB_LOG_LEVEL_INFO
,

1685 "Com¥es£dÅabÀ†u£ zlib " 
ZLIB_VERSION


1686 #ifde‡
UNIV_ZIP_DEBUG


1690 #ifde‡
UNIV_ZIP_COPY


1691 
	`ib_logf
(
IB_LOG_LEVEL_INFO
, "andÉxtra copying");

1700 i‡(
§v_°¨t_has_bìn_ˇŒed
) {

1701 
	`ut_¥öt_time°amp
(
°dîr
);

1702 
	`Ârötf
(
°dîr
, " InnoDB: Error: startup called secondÅime "

1704 
	`ut_¥öt_time°amp
(
°dîr
);

1705 
	`Ârötf
(
°dîr
, " InnoDB:Üifetime. InÅhe MySQL Embedded "

1707 
	`ut_¥öt_time°amp
(
°dîr
);

1708 
	`Ârötf
(
°dîr
, " InnoDB: cannot call server_init() more "

1710 
	`ut_¥öt_time°amp
(
°dîr
);

1711 
	`Ârötf
(
°dîr
, " InnoDB:ÖrocessÜifetime.\n");

1714 
§v_°¨t_has_bìn_ˇŒed
 = 
TRUE
;

1716 #ifde‡
UNIV_DEBUG


1717 
log_do_wrôe
 = 
TRUE
;

1721 
§v_is_beög_°¨ãd
 = 
TRUE
;

1722 
§v_°¨tup_is_bef‹e_åx_rﬁlback_pha£
 = 
TRUE
;

1724 #ifde‡
__WIN__


1725 
	`os_gë_os_vîsi⁄
()) {

1726 
OS_WIN95
:

1727 
OS_WIN31
:

1728 
OS_WINNT
:

1734 
§v_u£_«tive_aio
 = 
FALSE
;

1737 
OS_WIN2000
:

1738 
OS_WINXP
:

1740 
§v_u£_«tive_aio
 = 
TRUE
;

1745 
§v_u£_«tive_aio
 = 
TRUE
;

1746 
§v_u£_«tive_c⁄dôi⁄s
 = 
TRUE
;

1750 #ñi‡
	`deföed
(
LINUX_NATIVE_AIO
)

1752 i‡(
§v_u£_«tive_aio
) {

1753 
	`ib_logf
(
IB_LOG_LEVEL_INFO
, "Using LinuxÇative AIO");

1759 
§v_u£_«tive_aio
 = 
FALSE
;

1762 i‡(
§v_fûe_Êush_mëhod_°r
 =
NULL
) {

1765 
§v_unix_fûe_Êush_mëhod
 = 
SRV_UNIX_FSYNC
;

1767 
§v_wö_fûe_Êush_mëhod
 = 
SRV_WIN_IO_UNBUFFERED
;

1768 #i‚de‡
__WIN__


1769 } i‡(0 =
	`ut_°rcmp
(
§v_fûe_Êush_mëhod_°r
, "fsync")) {

1770 
§v_unix_fûe_Êush_mëhod
 = 
SRV_UNIX_FSYNC
;

1772 } i‡(0 =
	`ut_°rcmp
(
§v_fûe_Êush_mëhod_°r
, "O_DSYNC")) {

1773 
§v_unix_fûe_Êush_mëhod
 = 
SRV_UNIX_O_DSYNC
;

1775 } i‡(0 =
	`ut_°rcmp
(
§v_fûe_Êush_mëhod_°r
, "O_DIRECT")) {

1776 
§v_unix_fûe_Êush_mëhod
 = 
SRV_UNIX_O_DIRECT
;

1778 } i‡(0 =
	`ut_°rcmp
(
§v_fûe_Êush_mëhod_°r
, "O_DIRECT_NO_FSYNC")) {

1779 
§v_unix_fûe_Êush_mëhod
 = 
SRV_UNIX_O_DIRECT_NO_FSYNC
;

1781 } i‡(0 =
	`ut_°rcmp
(
§v_fûe_Êush_mëhod_°r
, "littlesync")) {

1782 
§v_unix_fûe_Êush_mëhod
 = 
SRV_UNIX_LITTLESYNC
;

1784 } i‡(0 =
	`ut_°rcmp
(
§v_fûe_Êush_mëhod_°r
, "nosync")) {

1785 
§v_unix_fûe_Êush_mëhod
 = 
SRV_UNIX_NOSYNC
;

1787 } i‡(0 =
	`ut_°rcmp
(
§v_fûe_Êush_mëhod_°r
, "normal")) {

1788 
§v_wö_fûe_Êush_mëhod
 = 
SRV_WIN_IO_NORMAL
;

1789 
§v_u£_«tive_aio
 = 
FALSE
;

1791 } i‡(0 =
	`ut_°rcmp
(
§v_fûe_Êush_mëhod_°r
, "unbuffered")) {

1792 
§v_wö_fûe_Êush_mëhod
 = 
SRV_WIN_IO_UNBUFFERED
;

1793 
§v_u£_«tive_aio
 = 
FALSE
;

1795 } i‡(0 =
	`ut_°rcmp
(
§v_fûe_Êush_mëhod_°r
,

1797 
§v_wö_fûe_Êush_mëhod
 = 
SRV_WIN_IO_UNBUFFERED
;

1800 
	`ib_logf
(
IB_LOG_LEVEL_ERROR
,

1802 
§v_fûe_Êush_mëhod_°r
);

1803 (
DB_ERROR
);

1814 
	#BUF_POOL_SIZE_THRESHOLD
 (1024 * 1024 * 1024)

	)

1815 
§v_max_n_thªads
 = 1

1830 + 
max_c⁄√˘i⁄s


1831 + 
§v_n_ªad_io_thªads


1832 + 
§v_n_wrôe_io_thªads


1833 + 
§v_n_purge_thªads


1835 + 
·s_s‹t_∂l_degªe
 * 
FTS_NUM_AUX_INDEX


1836 * 
max_c⁄√˘i⁄s
;

1838 i‡(
§v_buf_poﬁ_size
 < 
BUF_POOL_SIZE_THRESHOLD
) {

1841 
§v_buf_poﬁ_ö°™˚s
 = 1;

1844 
	`§v_boŸ
();

1846 
	`ib_logf
(
IB_LOG_LEVEL_INFO
,

1848 
ut_¸c32_s£2_íabÀd
 ? "Using" : "Not using");

1850 i‡(!
§v_ªad_⁄ly_mode
) {

1852 
	`muãx_¸óã
(
§v_m⁄ô‹_fûe_muãx_key
,

1853 &
§v_m⁄ô‹_fûe_muãx
, 
SYNC_NO_ORDER_CHECK
);

1855 i‡(
§v_önodb_°©us
) {

1857 
§v_m⁄ô‹_fûe_«me
 = 
°©ic_ˇ°
<*>(

1858 
	`mem_Æloc
(

1859 
	`°æí
(
fû_∑th_to_mysql_d©adú
)

1862 
	`•rötf
(
§v_m⁄ô‹_fûe_«me
, "%s/innodb_status.%lu",

1863 
fû_∑th_to_mysql_d©adú
,

1864 
	`os_¥oc_gë_numbî
());

1866 
§v_m⁄ô‹_fûe
 = 
	`f›í
(
§v_m⁄ô‹_fûe_«me
, "w+");

1868 i‡(!
§v_m⁄ô‹_fûe
) {

1870 
	`ib_logf
(
IB_LOG_LEVEL_ERROR
,

1872 
§v_m⁄ô‹_fûe_«me
,

1873 
	`°ªº‹
(
î∫o
));

1875 (
DB_ERROR
);

1878 
§v_m⁄ô‹_fûe_«me
 = 
NULL
;

1879 
§v_m⁄ô‹_fûe
 = 
	`os_fûe_¸óã_tmpfûe
();

1881 i‡(!
§v_m⁄ô‹_fûe
) {

1882 (
DB_ERROR
);

1886 
	`muãx_¸óã
(
§v_di˘_tmpfûe_muãx_key
,

1887 &
§v_di˘_tmpfûe_muãx
, 
SYNC_DICT_OPERATION
);

1889 
§v_di˘_tmpfûe
 = 
	`os_fûe_¸óã_tmpfûe
();

1891 i‡(!
§v_di˘_tmpfûe
) {

1892 (
DB_ERROR
);

1895 
	`muãx_¸óã
(
§v_misc_tmpfûe_muãx_key
,

1896 &
§v_misc_tmpfûe_muãx
, 
SYNC_ANY_LATCH
);

1898 
§v_misc_tmpfûe
 = 
	`os_fûe_¸óã_tmpfûe
();

1900 i‡(!
§v_misc_tmpfûe
) {

1901 (
DB_ERROR
);

1908 i‡(
§v_n_fûe_io_thªads
 != 4) {

1909 
	`ib_logf
(
IB_LOG_LEVEL_WARN
,

1916 
§v_n_fûe_io_thªads
 = 
§v_n_ªad_io_thªads
;

1918 i‡(!
§v_ªad_⁄ly_mode
) {

1920 
§v_n_fûe_io_thªads
 += 2;

1921 
§v_n_fûe_io_thªads
 +
§v_n_wrôe_io_thªads
;

1923 
	`ib_logf
(
IB_LOG_LEVEL_INFO
,

1926 
§v_n_wrôe_io_thªads
 = 0;

1929 
	`ut_a
(
§v_n_fûe_io_thªads
 <
SRV_MAX_N_IO_THREADS
);

1931 
io_limô
 = 8 * 
SRV_N_PENDING_IOS_PER_THREAD
;

1936 #ifde‡
__WIN__


1937 i‡(
§v_u£_«tive_aio
) {

1938 
io_limô
 = 
SRV_N_PENDING_IOS_PER_THREAD
;

1942 i‡(!
	`os_aio_öô
(
io_limô
,

1943 
§v_n_ªad_io_thªads
,

1944 
§v_n_wrôe_io_thªads
,

1945 
SRV_MAX_N_PENDING_SYNC_IOS
)) {

1947 
	`ib_logf
(
IB_LOG_LEVEL_ERROR
,

1950 (
DB_ERROR
);

1953 
	`fû_öô
(
§v_fûe_≥r_èbÀ
 ? 50000 : 5000, 
§v_max_n_›í_fûes
);

1955 
size
;

1956 
unô
;

1958 i‡(
§v_buf_poﬁ_size
 >= 1024 * 1024 * 1024) {

1959 
size
 = ((Ë
§v_buf_poﬁ_size
) / (1024 * 1024 * 1024);

1960 
unô
 = 'G';

1962 
size
 = ((Ë
§v_buf_poﬁ_size
) / (1024 * 1024);

1963 
unô
 = 'M';

1967 
	`ib_logf
(
IB_LOG_LEVEL_INFO
,

1968 "Inôülizög buf„∏poﬁ, sizê%.1f%c", 
size
, 
unô
);

1970 #ifde‡
SSD_CACHE_FACE


1971 i‡(
§v_u£_ssd_ˇche
) {

1972 
	`ib_logf
(
IB_LOG_LEVEL_INFO
,

1975 
	`ib_logf
(
IB_LOG_LEVEL_INFO
,

1978 
	`ib_logf
(
IB_LOG_LEVEL_INFO
,

1980 
§v_ssd_ˇche_size
, 
§v_ssd_ˇche_fûe
);

1984 
îr
 = 
	`buf_poﬁ_öô
(
§v_buf_poﬁ_size
, 
§v_buf_poﬁ_ö°™˚s
);

1986 i‡(
îr
 !
DB_SUCCESS
) {

1987 
	`ib_logf
(
IB_LOG_LEVEL_ERROR
,

1990 (
DB_ERROR
);

1993 
	`ib_logf
(
IB_LOG_LEVEL_INFO
,

1996 #ifde‡
UNIV_DEBUG


2000 i‡(
§v_buf_poﬁ_size
 <= 5 * 1024 * 1024) {

2002 
	`ib_logf
(
IB_LOG_LEVEL_INFO
,

2006 
§v_buf_poﬁ_size
 / 1024 / 1024);

2010 
	`f•_öô
();

2011 
	`log_öô
();

2013 
	`lock_sys_¸óã
(
§v_lock_èbÀ_size
);

2017 
i
 = 0; i < 
§v_n_fûe_io_thªads
; ++i) {

2019 
n
[
i
] = i;

2021 
	`os_thªad_¸óã
(
io_h™dÀr_thªad
, 
n
 + 
i
, 
thªad_ids
 + i);

2024 #ifde‡
UNIV_LOG_ARCHIVE


2025 i‡(0 !
	`ut_°rcmp
(
§v_log_group_home_dú
, 
§v_¨ch_dú
)) {

2026 
	`ut_¥öt_time°amp
(
°dîr
);

2027 
	`Ârötf
(
°dîr
, " InnoDB: Error: you must setÅheÜog group home dir in my.cnf\n");

2028 
	`ut_¥öt_time°amp
(
°dîr
);

2029 
	`Ârötf
(
°dîr
, " InnoDB:Åhe sameásÜogárch dir.\n");

2031 (
DB_ERROR
);

2035 i‡(
§v_n_log_fûes
 * 
§v_log_fûe_size
 * 
UNIV_PAGE_SIZE


2042 
	`ib_logf
(
IB_LOG_LEVEL_ERROR
,

2045 (
DB_ERROR
);

2048 i‡(
§v_n_log_fûes
 * 
§v_log_fûe_size
 >
ULINT_MAX
) {

2055 
	`Ârötf
(
°dîr
,

2058 
ULINT_MAX
 / 1073741824 * 
UNIV_PAGE_SIZE
);

2060 (
DB_ERROR
);

2063 
sum_of_√w_sizes
 = 0;

2065 
i
 = 0; i < 
§v_n_d©a_fûes
; i++) {

2066 #i‚de‡
__WIN__


2067 i‡((
off_t
) < 5

2068 && 
§v_d©a_fûe_sizes
[
i
]

2069 >(
ulöt
Ë(1 << (32 - 
UNIV_PAGE_SIZE_SHIFT
))) {

2070 
	`ut_¥öt_time°amp
(
°dîr
);

2071 
	`Ârötf
(
°dîr
,

2074 
	`ut_¥öt_time°amp
(
°dîr
);

2075 
	`Ârötf
(
°dîr
,

2079 (
DB_ERROR
);

2082 
sum_of_√w_sizes
 +
§v_d©a_fûe_sizes
[
i
];

2085 i‡(
sum_of_√w_sizes
 < 10485760 / 
UNIV_PAGE_SIZE
) {

2086 
	`ib_logf
(
IB_LOG_LEVEL_ERROR
,

2089 (
DB_ERROR
);

2092 
	`ªcv_sys_¸óã
();

2093 
	`ªcv_sys_öô
(
	`buf_poﬁ_gë_cuº_size
());

2095 
îr
 = 
	`›í_‹_¸óã_d©a_fûes
(&
¸óã_√w_db
,

2096 #ifde‡
UNIV_LOG_ARCHIVE


2097 &
mö_¨ch_log_no
, &
max_¨ch_log_no
,

2099 &
mö_Êushed_l¢
, &
max_Êushed_l¢
,

2100 &
sum_of_√w_sizes
);

2101 i‡(
îr
 =
DB_FAIL
) {

2103 
	`ib_logf
(
IB_LOG_LEVEL_ERROR
,

2106 (
DB_ERROR
);

2108 } i‡(
îr
 !
DB_SUCCESS
) {

2110 
	`ib_logf
(
IB_LOG_LEVEL_ERROR
,

2121 (
îr
);

2124 #ifde‡
UNIV_LOG_ARCHIVE


2125 
	`§v_n‹mÆize_∑th_f‹_wö
(
§v_¨ch_dú
);

2126 
§v_¨ch_dú
 = 
	`§v_add_∑th_£∑øt‹_if_√eded
(srv_arch_dir);

2129 
dú«mñí
 = 
	`°æí
(
§v_log_group_home_dú
);

2130 
	`ut_a
(
dú«mñí
 < ( 
logfûíame
) - 10 -  "ib_logfile");

2131 
	`mem˝y
(
logfûíame
, 
§v_log_group_home_dú
, 
dú«mñí
);

2134 i‡(
dú«mñí
 && 
logfûíame
[dú«mñí - 1] !
SRV_PATH_SEPARATOR
) {

2135 
logfûíame
[
dú«mñí
++] = 
SRV_PATH_SEPARATOR
;

2138 
§v_log_fûe_size_ªque°ed
 = 
§v_log_fûe_size
;

2140 i‡(
¸óã_√w_db
) {

2141 
boﬁ
 
suc˚ss
 = 
	`buf_Êush_li°
(
ULINT_MAX
, 
LSN_MAX
, 
NULL
);

2142 
	`ut_a
(
suc˚ss
);

2144 
mö_Êushed_l¢
 = 
max_Êushed_l¢
 = 
	`log_gë_l¢
();

2146 
	`buf_Êush_waô_b©ch_íd
(
NULL
, 
BUF_FLUSH_LIST
);

2148 
îr
 = 
	`¸óã_log_fûes
(
¸óã_√w_db
, 
logfûíame
, 
dú«mñí
,

2149 
max_Êushed_l¢
, 
logfûe0
);

2151 i‡(
îr
 !
DB_SUCCESS
) {

2152 (
îr
);

2155 
i
 = 0; i < 
SRV_N_LOG_FILES_MAX
; i++) {

2156 
os_off£t_t
 
size
;

2157 
os_fûe_°©_t
 
°©_öfo
;

2159 
	`•rötf
(
logfûíame
 + 
dú«mñí
,

2160 "ib_logfûe%u", 
i
);

2162 
îr
 = 
	`os_fûe_gë_°©us
(

2163 
logfûíame
, &
°©_öfo
, 
Ál£
);

2165 i‡(
îr
 =
DB_NOT_FOUND
) {

2166 i‡(
i
 == 0) {

2167 i‡(
max_Êushed_l¢


2168 !
mö_Êushed_l¢
) {

2169 
	`ib_logf
(
IB_LOG_LEVEL_ERROR
,

2176 (
DB_ERROR
);

2179 i‡(
max_Êushed_l¢
 < (
l¢_t
) 1000) {

2180 
	`ib_logf
(
IB_LOG_LEVEL_ERROR
,

2189 (
DB_ERROR
);

2192 
îr
 = 
	`¸óã_log_fûes
(

2193 
¸óã_√w_db
, 
logfûíame
,

2194 
dú«mñí
, 
max_Êushed_l¢
,

2195 
logfûe0
);

2197 i‡(
îr
 !
DB_SUCCESS
) {

2198 (
îr
);

2201 
	`¸óã_log_fûes_ª«me
(

2202 
logfûíame
, 
dú«mñí
,

2203 
max_Êushed_l¢
, 
logfûe0
);

2207 
max_Êushed_l¢
 = 
mö_Êushed_l¢


2208 
	`log_gë_l¢
();

2209 
fûes_checked
;

2210 } i‡(
i
 < 2) {

2212 
	`ib_logf
(
IB_LOG_LEVEL_ERROR
,

2214 (
îr
);

2221 i‡(!
	`§v_fûe_check_mode
(
logfûíame
)) {

2222 (
DB_ERROR
);

2225 
îr
 = 
	`›í_log_fûe
(&
fûes
[
i
], 
logfûíame
, &
size
);

2227 i‡(
îr
 !
DB_SUCCESS
) {

2228 (
îr
);

2231 
	`ut_a
(
size
 !(
os_off£t_t
) -1);

2233 i‡(
size
 & ((1 << 
UNIV_PAGE_SIZE_SHIFT
) - 1)) {

2234 
	`ib_logf
(
IB_LOG_LEVEL_ERROR
,

2236 
UINT64PF
 " isÇotá multiple of"

2238 
logfûíame
, 
size
);

2239 (
DB_ERROR
);

2242 
size
 >>
UNIV_PAGE_SIZE_SHIFT
;

2244 i‡(
i
 == 0) {

2245 
§v_log_fûe_size
 = 
size
;

2246 } i‡(
size
 !
§v_log_fûe_size
) {

2247 
	`ib_logf
(
IB_LOG_LEVEL_ERROR
,

2249 " o‡dif„ª¡ sizê" 
UINT64PF
 " bytes"

2251 " fûe†" 
UINT64PF
 " bytes!",

2252 
logfûíame
,

2253 
size
 << 
UNIV_PAGE_SIZE_SHIFT
,

2254 (
os_off£t_t
Ë
§v_log_fûe_size


2255 << 
UNIV_PAGE_SIZE_SHIFT
);

2256 (
DB_ERROR
);

2260 
§v_n_log_fûes_found
 = 
i
;

2264 
	`•rötf
(
logfûíame
 + 
dú«mñí
, "ib_logfile%u", 0);

2266 
	`fû_•a˚_¸óã
(
logfûíame
,

2267 
SRV_LOG_SPACE_FIRST_ID
,

2268 
	`f•_Êags_£t_∑ge_size
(0, 
UNIV_PAGE_SIZE
),

2269 
FIL_LOG
);

2271 
	`ut_a
(
	`fû_vÆid©e
());

2275 
	`ut_a
(
§v_log_fûe_size
 <
ULINT_MAX
);

2277 
j
 = 0; j < 
i
; j++) {

2278 
	`•rötf
(
logfûíame
 + 
dú«mñí
, "ib_logfûe%u", 
j
);

2280 i‡(!
	`fû_node_¸óã
(
logfûíame
,

2281 (
ulöt
Ë
§v_log_fûe_size
,

2282 
SRV_LOG_SPACE_FIRST_ID
, 
FALSE
)) {

2283 (
DB_ERROR
);

2287 #ifde‡
UNIV_LOG_ARCHIVE


2290 
	`fû_•a˚_¸óã
("¨ch_log_•a˚", 
SRV_LOG_SPACE_FIRST_ID
 + 1,

2291 0, 
FIL_LOG
);

2293 
	`log_group_öô
(0, 
i
, 
§v_log_fûe_size
 * 
UNIV_PAGE_SIZE
,

2294 
SRV_LOG_SPACE_FIRST_ID
,

2295 
SRV_LOG_SPACE_FIRST_ID
 + 1);

2298 
fûes_checked
:

2303 
	`fû_›í_log_™d_sy°em_èbÀ•a˚_fûes
();

2305 
îr
 = 
	`§v_undo_èbÀ•a˚s_öô
(

2306 
¸óã_√w_db
,

2307 
§v_undo_èbÀ•a˚s
,

2308 &
§v_undo_èbÀ•a˚s_›í
);

2313 i‡(
îr
 !
DB_SUCCESS


2314 && 
§v_f‹˚_ªcovîy
 < 
SRV_FORCE_NO_UNDO_LOG_SCAN
) {

2316 (
îr
);

2321 i‡(!
§v_ªad_⁄ly_mode
) {

2322 
	`di˘_°©s_thªad_öô
();

2325 
	`åx_sys_fûe_f‹m©_öô
();

2327 
	`åx_sys_¸óã
();

2329 i‡(
¸óã_√w_db
) {

2331 
	`ut_a
(!
§v_ªad_⁄ly_mode
);

2333 
	`må_°¨t
(&
må
);

2335 
	`f•_hódî_öô
(0, 
sum_of_√w_sizes
, &
må
);

2337 
	`må_commô
(&
må
);

2343 
	`åx_sys_¸óã_sys_∑ges
();

2345 
ib_bh
 = 
	`åx_sys_öô_©_db_°¨t
();

2346 
n_ªcovîed_åx
 = 
	`UT_LIST_GET_LEN
(
åx_sys
->
rw_åx_li°
);

2351 
	`åx_purge_sys_¸óã
(
§v_n_purge_thªads
, 
ib_bh
);

2353 
îr
 = 
	`di˘_¸óã
();

2355 i‡(
îr
 !
DB_SUCCESS
) {

2356 (
îr
);

2359 
§v_°¨tup_is_bef‹e_åx_rﬁlback_pha£
 = 
FALSE
;

2361 
boﬁ
 
suc˚ss
 = 
	`buf_Êush_li°
(
ULINT_MAX
, 
LSN_MAX
, 
NULL
);

2362 
	`ut_a
(
suc˚ss
);

2364 
mö_Êushed_l¢
 = 
max_Êushed_l¢
 = 
	`log_gë_l¢
();

2366 
	`buf_Êush_waô_b©ch_íd
(
NULL
, 
BUF_FLUSH_LIST
);

2369 
	`fû_wrôe_Êushed_l¢_to_d©a_fûes
(
max_Êushed_l¢
, 0);

2371 
	`fû_Êush_fûe_•a˚s
(
FIL_TABLESPACE
);

2373 
	`¸óã_log_fûes_ª«me
(
logfûíame
, 
dú«mñí
,

2374 
max_Êushed_l¢
, 
logfûe0
);

2375 #ifde‡
UNIV_LOG_ARCHIVE


2376 } i‡(
§v_¨chive_ªcovîy
) {

2378 
	`ib_logf
(
IB_LOG_LEVEL_INFO
,

2381 
îr
 = 
	`ªcv_ªcovîy_‰om_¨chive_°¨t
(

2382 
mö_Êushed_l¢
, 
§v_¨chive_ªcovîy_limô_l¢
,

2383 
mö_¨ch_log_no
);

2384 i‡(
îr
 !
DB_SUCCESS
) {

2386 (
DB_ERROR
);

2391 
îr
 = 
	`di˘_boŸ
();

2393 i‡(
îr
 !
DB_SUCCESS
) {

2394 (
îr
);

2397 
ib_bh
 = 
	`åx_sys_öô_©_db_°¨t
();

2398 
n_ªcovîed_åx
 = 
	`UT_LIST_GET_LEN
(
åx_sys
->
rw_åx_li°
);

2403 
	`åx_purge_sys_¸óã
(
§v_n_purge_thªads
, 
ib_bh
);

2405 
§v_°¨tup_is_bef‹e_åx_rﬁlback_pha£
 = 
FALSE
;

2407 
	`ªcv_ªcovîy_‰om_¨chive_föish
();

2423 
îr
 = 
	`åx_sys_fûe_f‹m©_max_check
(

2424 
§v_max_fûe_f‹m©_©_°¨tup
);

2426 i‡(
îr
 !
DB_SUCCESS
) {

2427 (
îr
);

2435 
	`buf_poﬁ_övÆid©e
();

2440 
îr
 = 
	`ªcv_ªcovîy_‰om_checkpoöt_°¨t
(

2441 
LOG_CHECKPOINT
, 
LSN_MAX
,

2442 
mö_Êushed_l¢
, 
max_Êushed_l¢
);

2444 i‡(
îr
 !
DB_SUCCESS
) {

2446 (
DB_ERROR
);

2455 
îr
 = 
	`di˘_boŸ
();

2457 i‡(
îr
 !
DB_SUCCESS
) {

2458 (
îr
);

2461 
ib_bh
 = 
	`åx_sys_öô_©_db_°¨t
();

2462 
n_ªcovîed_åx
 = 
	`UT_LIST_GET_LEN
(
åx_sys
->
rw_åx_li°
);

2467 
	`åx_purge_sys_¸óã
(
§v_n_purge_thªads
, 
ib_bh
);

2472 
	`ªcv_ªcovîy_‰om_checkpoöt_föish
();

2474 i‡(
§v_f‹˚_ªcovîy
 < 
SRV_FORCE_NO_IBUF_MERGE
) {

2490 
di˘_check_t
 
di˘_check
;

2492 i‡(
ªcv_√eded_ªcovîy
) {

2493 
di˘_check
 = 
DICT_CHECK_ALL_LOADED
;

2494 } i‡(
n_ªcovîed_åx
) {

2495 
di˘_check
 = 
DICT_CHECK_SOME_LOADED
;

2497 
di˘_check
 = 
DICT_CHECK_NONE_LOADED
;

2500 
	`di˘_check_èbÀ•a˚s_™d_°‹e_max_id
(
di˘_check
);

2503 i‡(!
§v_f‹˚_ªcovîy


2504 && !
ªcv_sys
->
found_c‹ru±_log


2505 && (
§v_log_fûe_size_ªque°ed
 !
§v_log_fûe_size


2506 || 
§v_n_log_fûes_found
 !
§v_n_log_fûes
)) {

2509 i‡(
§v_ªad_⁄ly_mode
) {

2510 
	`ib_logf
(
IB_LOG_LEVEL_ERROR
,

2513 (
DB_READ_ONLY
);

2517 
boﬁ
 
suc˚ss
 = 
	`buf_Êush_li°
(

2518 
ULINT_MAX
, 
LSN_MAX
, 
NULL
);

2519 
	`ut_a
(
suc˚ss
);

2521 
	`RECOVERY_CRASH
(1);

2523 
mö_Êushed_l¢
 = 
max_Êushed_l¢
 = 
	`log_gë_l¢
();

2525 
	`ib_logf
(
IB_LOG_LEVEL_WARN
,

2527 ", LSN=" 
LSN_PF
,

2528 (Ë
i
,

2529 (Ë
§v_log_fûe_size
,

2530 (Ë
§v_n_log_fûes
,

2531 (Ë
§v_log_fûe_size_ªque°ed
,

2532 
max_Êushed_l¢
);

2534 
	`buf_Êush_waô_b©ch_íd
(
NULL
, 
BUF_FLUSH_LIST
);

2536 
	`RECOVERY_CRASH
(2);

2539 
	`log_buf„r_Êush_to_disk
();

2542 
	`fû_Êush
(
SRV_LOG_SPACE_FIRST_ID
);

2544 
	`ut_ad
(
max_Êushed_l¢
 =
	`log_gë_l¢
());

2549 
	`ut_d
(
ªcv_no_log_wrôe
 = 
TRUE
);

2550 
	`ut_ad
(!
	`buf_poﬁ_check_no_≥ndög_io
());

2552 
	`RECOVERY_CRASH
(3);

2555 
	`fû_wrôe_Êushed_l¢_to_d©a_fûes
(

2556 
max_Êushed_l¢
, 0);

2558 
	`fû_Êush_fûe_•a˚s
(
FIL_TABLESPACE
);

2560 
	`RECOVERY_CRASH
(4);

2564 
	`fû_˛o£_log_fûes
(
åue
);

2566 
	`RECOVERY_CRASH
(5);

2569 
	`log_group_˛o£_Æl
();

2571 
	`ib_logf
(
IB_LOG_LEVEL_WARN
,

2574 
§v_log_fûe_size
 = 
§v_log_fûe_size_ªque°ed
;

2576 
îr
 = 
	`¸óã_log_fûes
(
¸óã_√w_db
, 
logfûíame
,

2577 
dú«mñí
, 
max_Êushed_l¢
,

2578 
logfûe0
);

2580 i‡(
îr
 !
DB_SUCCESS
) {

2581 (
îr
);

2584 
	`¸óã_log_fûes_ª«me
(
logfûíame
, 
dú«mñí
,

2585 
max_Êushed_l¢
, 
logfûe0
);

2588 
§v_°¨tup_is_bef‹e_åx_rﬁlback_pha£
 = 
FALSE
;

2589 
	`ªcv_ªcovîy_rﬁlback_a˘ive
();

2596 
	`åx_sys_fûe_f‹m©_èg_öô
();

2599 i‡(!
¸óã_√w_db
 && 
sum_of_√w_sizes
 > 0) {

2601 
	`må_°¨t
(&
må
);

2603 
	`f•_hódî_öc_size
(0, 
sum_of_√w_sizes
, &
må
);

2605 
	`må_commô
(&
må
);

2611 
	`log_buf„r_Êush_to_disk
();

2614 #ifde‡
UNIV_LOG_ARCHIVE


2616 i‡(!
§v_log_¨chive_⁄
) {

2617 
	`ut_a
(
DB_SUCCESS
 =
	`log_¨chive_nﬂrchivñog
());

2619 
	`muãx_íãr
(&(
log_sys
->
muãx
));

2621 
°¨t_¨chive
 = 
FALSE
;

2623 i‡(
log_sys
->
¨chivög_°©e
 =
LOG_ARCH_OFF
) {

2624 
°¨t_¨chive
 = 
TRUE
;

2627 
	`muãx_exô
(&(
log_sys
->
muãx
));

2629 i‡(
°¨t_¨chive
) {

2630 
	`ut_a
(
DB_SUCCESS
 =
	`log_¨chive_¨chivñog
());

2638 i‡(
buf_dblwr
 =
NULL
) {

2641 
	`buf_dblwr_¸óã
();

2657 
	`ut_a
(
§v_undo_logs
 > 0);

2658 
	`ut_a
(
§v_undo_logs
 <
TRX_SYS_N_RSEGS
);

2664 
§v_avaûabÀ_undo_logs
 = 
	`åx_sys_¸óã_r£gs
(

2665 
§v_undo_èbÀ•a˚s
, 
§v_undo_logs
);

2667 i‡(
§v_avaûabÀ_undo_logs
 =
ULINT_UNDEFINED
) {

2669 
	`ut_a
(
§v_ªad_⁄ly_mode
);

2670 
§v_undo_logs
 = 
ULONG_UNDEFINED
;

2673 i‡(!
§v_ªad_⁄ly_mode
) {

2676 
	`os_thªad_¸óã
(

2677 
lock_waô_timeout_thªad
,

2678 
NULL
, 
thªad_ids
 + 2 + 
SRV_MAX_N_IO_THREADS
);

2681 
	`os_thªad_¸óã
(

2682 
§v_îr‹_m⁄ô‹_thªad
,

2683 
NULL
, 
thªad_ids
 + 3 + 
SRV_MAX_N_IO_THREADS
);

2686 
	`os_thªad_¸óã
(

2687 
§v_m⁄ô‹_thªad
,

2688 
NULL
, 
thªad_ids
 + 4 + 
SRV_MAX_N_IO_THREADS
);

2692 
îr
 = 
	`di˘_¸óã_‹_check_f‹eign_c⁄°øöt_èbÀs
();

2693 i‡(
îr
 !
DB_SUCCESS
) {

2694 (
îr
);

2698 
îr
 = 
	`di˘_¸óã_‹_check_sys_èbÀ•a˚
();

2699 i‡(
îr
 !
DB_SUCCESS
) {

2700 (
îr
);

2703 
§v_is_beög_°¨ãd
 = 
FALSE
;

2705 
	`ut_a
(
	`åx_purge_°©e
(Ë=
PURGE_STATE_INIT
);

2710 i‡(!
§v_ªad_⁄ly_mode
) {

2712 
	`os_thªad_¸óã
(

2713 
§v_ma°î_thªad
,

2714 
NULL
, 
thªad_ids
 + (1 + 
SRV_MAX_N_IO_THREADS
));

2717 i‡(!
§v_ªad_⁄ly_mode


2718 && 
§v_f‹˚_ªcovîy
 < 
SRV_FORCE_NO_BACKGROUND
) {

2720 
	`os_thªad_¸óã
(

2721 
§v_purge_co‹dö©‹_thªad
,

2722 
NULL
, 
thªad_ids
 + 5 + 
SRV_MAX_N_IO_THREADS
);

2724 
	`ut_a
(
	`UT_ARR_SIZE
(
thªad_ids
)

2725 > 5 + 
§v_n_purge_thªads
 + 
SRV_MAX_N_IO_THREADS
);

2728 
i
 = 1; i < 
§v_n_purge_thªads
; ++i) {

2729 
	`os_thªad_¸óã
(

2730 
§v_w‹kî_thªad
, 
NULL
,

2731 
thªad_ids
 + 5 + 
i
 + 
SRV_MAX_N_IO_THREADS
);

2734 
	`§v_°¨t_waô_f‹_purge_to_°¨t
();

2737 
purge_sys
->
°©e
 = 
PURGE_STATE_DISABLED
;

2740 i‡(!
§v_ªad_⁄ly_mode
) {

2741 
	`os_thªad_¸óã
(
buf_Êush_∑ge_˛ó√r_thªad
, 
NULL
, NULL);

2744 #ifde‡
UNIV_DEBUG


2747 
sum_of_d©a_fûe_sizes
 = 0;

2749 
i
 = 0; i < 
§v_n_d©a_fûes
; i++) {

2750 
sum_of_d©a_fûe_sizes
 +
§v_d©a_fûe_sizes
[
i
];

2753 
èbÀ•a˚_size_ö_hódî
 = 
	`f•_hódî_gë_èbÀ•a˚_size
();

2755 i‡(!
§v_ªad_⁄ly_mode


2756 && !
§v_auto_exãnd_œ°_d©a_fûe


2757 && 
sum_of_d©a_fûe_sizes
 !
èbÀ•a˚_size_ö_hódî
) {

2759 
	`ut_¥öt_time°amp
(
°dîr
);

2760 
	`Ârötf
(
°dîr
,

2763 (
ul⁄g
Ë
èbÀ•a˚_size_ö_hódî
);

2764 
	`ut_¥öt_time°amp
(
°dîr
);

2765 
	`Ârötf
(
°dîr
,

2767 (
ul⁄g
Ë
sum_of_d©a_fûe_sizes
);

2769 i‡(
§v_f‹˚_ªcovîy
 == 0

2770 && 
sum_of_d©a_fûe_sizes
 < 
èbÀ•a˚_size_ö_hódî
) {

2774 
	`ut_¥öt_time°amp
(
°dîr
);

2775 
	`Ârötf
(
°dîr
,

2778 
	`ut_¥öt_time°amp
(
°dîr
);

2779 
	`Ârötf
(
°dîr
,

2782 
	`ut_¥öt_time°amp
(
°dîr
);

2783 
	`Ârötf
(
°dîr
,

2786 
	`ut_¥öt_time°amp
(
°dîr
);

2787 
	`Ârötf
(
°dîr
,

2790 
	`ut_¥öt_time°amp
(
°dîr
);

2791 
	`Ârötf
(
°dîr
,

2795 (
DB_ERROR
);

2799 i‡(!
§v_ªad_⁄ly_mode


2800 && 
§v_auto_exãnd_œ°_d©a_fûe


2801 && 
sum_of_d©a_fûe_sizes
 < 
èbÀ•a˚_size_ö_hódî
) {

2803 
	`ut_¥öt_time°amp
(
°dîr
);

2804 
	`Ârötf
(
°dîr
,

2807 (
ul⁄g
Ë
èbÀ•a˚_size_ö_hódî
);

2808 
	`ut_¥öt_time°amp
(
°dîr
);

2809 
	`Ârötf
(
°dîr
,

2812 (
ul⁄g
Ë
sum_of_d©a_fûe_sizes
);

2814 i‡(
§v_f‹˚_ªcovîy
 == 0) {

2816 
	`ut_¥öt_time°amp
(
°dîr
);

2817 
	`Ârötf
(
°dîr
,

2820 
	`ut_¥öt_time°amp
(
°dîr
);

2821 
	`Ârötf
(
°dîr
,

2824 
	`ut_¥öt_time°amp
(
°dîr
);

2825 
	`Ârötf
(
°dîr
,

2828 
	`ut_¥öt_time°amp
(
°dîr
);

2829 
	`Ârötf
(
°dîr
,

2832 
	`ut_¥öt_time°amp
(
°dîr
);

2833 
	`Ârötf
(
°dîr
,

2837 (
DB_ERROR
);

2842 
	`os_Á°_muãx_öô
(
PFS_NOT_INSTRUMENTED
, &
§v_os_ã°_muãx
);

2844 i‡(0 !
	`os_Á°_muãx_åylock
(&
§v_os_ã°_muãx
)) {

2845 
	`ut_¥öt_time°amp
(
°dîr
);

2846 
	`Ârötf
(
°dîr
,

2849 
	`ut_¥öt_time°amp
(
°dîr
);

2850 
	`Ârötf
(
°dîr
,

2852 
	`exô
(1);

2855 
	`os_Á°_muãx_u∆ock
(&
§v_os_ã°_muãx
);

2857 
	`os_Á°_muãx_lock
(&
§v_os_ã°_muãx
);

2859 
	`os_Á°_muãx_u∆ock
(&
§v_os_ã°_muãx
);

2861 
	`os_Á°_muãx_‰ì
(&
§v_os_ã°_muãx
);

2863 i‡(
§v_¥öt_vîbo£_log
) {

2864 
	`ib_logf
(
IB_LOG_LEVEL_INFO
,

2865 "%†°¨ãd;Üog sequí˚Çumbî " 
LSN_PF
 "",

2866 
INNODB_VERSION_STR
, 
§v_°¨t_l¢
);

2869 i‡(
§v_f‹˚_ªcovîy
 > 0) {

2870 
	`ib_logf
(
IB_LOG_LEVEL_INFO
,

2872 (
ul⁄g
Ë
§v_f‹˚_ªcovîy
);

2875 i‡(
§v_f‹˚_ªcovîy
 == 0) {

2881 
	`ibuf_upd©e_max_èbÀ•a˚_id
();

2884 i‡(!
§v_ªad_⁄ly_mode
) {

2886 
	`os_thªad_¸óã
(
buf_dump_thªad
, 
NULL
, NULL);

2889 
	`os_thªad_¸óã
(
di˘_°©s_thªad
, 
NULL
, NULL);

2892 
	`·s_›timize_öô
();

2895 
§v_was_°¨ãd
 = 
TRUE
;

2897 (
DB_SUCCESS
);

2898 
	}
}

2905 
	$§v_·s_˛o£
()

2908 
di˘_èbÀ_t
* 
èbÀ
;

2910 
èbÀ
 = 
	`UT_LIST_GET_FIRST
(
di˘_sys
->
èbÀ_LRU
);

2911 
èbÀ
;ÅabÀ = 
	`UT_LIST_GET_NEXT
(
èbÀ_LRU
,Åable)) {

2912 
·s_t
* 
·s
 = 
èbÀ
->fts;

2914 i‡(
·s
 !
NULL
) {

2915 
	`·s_sync_èbÀ
(
èbÀ
);

2919 
èbÀ
 = 
	`UT_LIST_GET_FIRST
(
di˘_sys
->
èbÀ_n⁄_LRU
);

2920 
èbÀ
;ÅabÀ = 
	`UT_LIST_GET_NEXT
(
èbÀ_LRU
,Åable)) {

2921 
·s_t
* 
·s
 = 
èbÀ
->fts;

2923 i‡(
·s
 !
NULL
) {

2924 
	`·s_sync_èbÀ
(
èbÀ
);

2927 
	}
}

2933 
UNIV_INTERN


2934 
dbîr_t


2935 
	$önoba£_shutdown_f‹_mysql
()

2938 
ulöt
 
i
;

2940 i‡(!
§v_was_°¨ãd
) {

2941 i‡(
§v_is_beög_°¨ãd
) {

2942 
	`ib_logf
(
IB_LOG_LEVEL_WARN
,

2947 (
DB_SUCCESS
);

2950 i‡(!
§v_ªad_⁄ly_mode
) {

2952 
	`·s_›timize_°¨t_shutdown
();

2954 
	`·s_›timize_íd
();

2962 
	`logs_em±y_™d_m¨k_fûes_©_shutdown
();

2964 i‡(
	`§v_c⁄c_gë_a˘ive_thªads
() != 0) {

2965 
	`ib_logf
(
IB_LOG_LEVEL_WARN
,

2968 
	`§v_c⁄c_gë_a˘ive_thªads
());

2973 
§v_shutdown_°©e
 = 
SRV_SHUTDOWN_EXIT_THREADS
;

2979 
i
 = 0; i < 1000; i++) {

2983 i‡(!
§v_ªad_⁄ly_mode
) {

2985 
	`os_evít_£t
(
lock_sys
->
timeout_evít
);

2991 
	`§v_wake_ma°î_thªad
();

2994 
	`§v_purge_wakeup
();

2999 
	`os_aio_wake_Æl_thªads_©_shutdown
();

3005 
	`os_muãx_íãr
(
os_sync_muãx
);

3007 i‡(
os_thªad_cou¡
 == 0) {

3016 
	`os_muãx_exô
(
os_sync_muãx
);

3018 
	`os_thªad_¶ìp
(100000);

3023 
	`os_muãx_exô
(
os_sync_muãx
);

3025 
	`os_thªad_¶ìp
(100000);

3028 i‡(
i
 == 1000) {

3029 
	`ib_logf
(
IB_LOG_LEVEL_WARN
,

3032 (
ul⁄g
Ë
os_thªad_cou¡
);

3035 i‡(
§v_m⁄ô‹_fûe
) {

3036 
	`f˛o£
(
§v_m⁄ô‹_fûe
);

3037 
§v_m⁄ô‹_fûe
 = 0;

3038 i‡(
§v_m⁄ô‹_fûe_«me
) {

3039 
	`u∆ök
(
§v_m⁄ô‹_fûe_«me
);

3040 
	`mem_‰ì
(
§v_m⁄ô‹_fûe_«me
);

3044 i‡(
§v_di˘_tmpfûe
) {

3045 
	`f˛o£
(
§v_di˘_tmpfûe
);

3046 
§v_di˘_tmpfûe
 = 0;

3049 i‡(
§v_misc_tmpfûe
) {

3050 
	`f˛o£
(
§v_misc_tmpfûe
);

3051 
§v_misc_tmpfûe
 = 0;

3054 i‡(!
§v_ªad_⁄ly_mode
) {

3055 
	`di˘_°©s_thªad_deöô
();

3060 
	`bå_£¨ch_dißbÀ
();

3062 
	`ibuf_˛o£
();

3063 
	`log_shutdown
();

3064 
	`åx_sys_fûe_f‹m©_˛o£
();

3065 
	`åx_sys_˛o£
();

3066 
	`lock_sys_˛o£
();

3070 i‡(!
§v_ªad_⁄ly_mode
) {

3071 
	`muãx_‰ì
(&
§v_m⁄ô‹_fûe_muãx
);

3072 
	`muãx_‰ì
(&
§v_di˘_tmpfûe_muãx
);

3073 
	`muãx_‰ì
(&
§v_misc_tmpfûe_muãx
);

3076 
	`di˘_˛o£
();

3077 
	`bå_£¨ch_sys_‰ì
();

3081 
	`os_aio_‰ì
();

3082 
	`que_˛o£
();

3083 
	`row_mysql_˛o£
();

3084 
	`§v_m⁄_‰ì
();

3085 
	`sync_˛o£
();

3086 
	`§v_‰ì
();

3087 
	`fû_˛o£
();

3091 
	`os_sync_‰ì
();

3095 
	`∑rs_Àxî_˛o£
();

3096 
	`log_mem_‰ì
();

3097 
	`buf_poﬁ_‰ì
(
§v_buf_poﬁ_ö°™˚s
);

3098 
	`mem_˛o£
();

3103 
	`ut_‰ì_Æl_mem
();

3105 i‡(
os_thªad_cou¡
 != 0

3106 || 
os_evít_cou¡
 != 0

3107 || 
os_muãx_cou¡
 != 0

3108 || 
os_Á°_muãx_cou¡
 != 0) {

3109 
	`ib_logf
(
IB_LOG_LEVEL_WARN
,

3113 (
ul⁄g
Ë
os_thªad_cou¡
, (ul⁄gË
os_evít_cou¡
,

3114 (
ul⁄g
Ë
os_muãx_cou¡
, (ul⁄gË
os_Á°_muãx_cou¡
);

3117 i‡(
di˘_f‹eign_îr_fûe
) {

3118 
	`f˛o£
(
di˘_f‹eign_îr_fûe
);

3121 i‡(
§v_¥öt_vîbo£_log
) {

3122 
	`ib_logf
(
IB_LOG_LEVEL_INFO
,

3123 "Shutdow¿com∂ëed;Üog sequí˚Çumbî " 
LSN_PF
 "",

3124 
§v_shutdown_l¢
);

3127 
§v_was_°¨ãd
 = 
FALSE
;

3128 
§v_°¨t_has_bìn_ˇŒed
 = 
FALSE
;

3130 (
DB_SUCCESS
);

3131 
	}
}

3138 
UNIV_INTERN


3140 
	$§v_shutdown_èbÀ_bg_thªads
()

3143 
di˘_èbÀ_t
* 
èbÀ
;

3144 
di˘_èbÀ_t
* 
fú°
;

3145 
di˘_èbÀ_t
* 
œ°
 = 
NULL
;

3147 
	`muãx_íãr
(&
di˘_sys
->
muãx
);

3150 
èbÀ
 = 
	`UT_LIST_GET_FIRST
(
di˘_sys
->
èbÀ_LRU
);

3151 
fú°
 = 
èbÀ
;

3152 
èbÀ
) {

3153 
di˘_èbÀ_t
* 
√xt
;

3154 
·s_t
* 
·s
 = 
èbÀ
->fts;

3156 i‡(
·s
 !
NULL
) {

3157 
	`·s_°¨t_shutdown
(
èbÀ
, 
·s
);

3160 
√xt
 = 
	`UT_LIST_GET_NEXT
(
èbÀ_LRU
, 
èbÀ
);

3162 i‡(!
√xt
) {

3163 
œ°
 = 
èbÀ
;

3166 
èbÀ
 = 
√xt
;

3187 
	`muãx_exô
(&
di˘_sys
->
muãx
);

3192 
èbÀ
 = 
	`UT_LIST_GET_FIRST
(
di˘_sys
->
èbÀ_LRU
);

3193 
	`ut_a
(
fú°
 =
èbÀ
);

3194 
èbÀ
) {

3195 
di˘_èbÀ_t
* 
√xt
;

3196 
·s_t
* 
·s
 = 
èbÀ
->fts;

3198 i‡(
·s
 !
NULL
) {

3199 
	`·s_shutdown
(
èbÀ
, 
·s
);

3202 
√xt
 = 
	`UT_LIST_GET_NEXT
(
èbÀ_LRU
, 
èbÀ
);

3204 i‡(
èbÀ
 =
œ°
) {

3205 
	`ut_a
(!
√xt
);

3208 
èbÀ
 = 
√xt
;

3210 
	}
}

3214 
UNIV_INTERN


3216 
	$§v_gë_mëa_d©a_fûíame
(

3218 
di˘_èbÀ_t
* 
èbÀ
,

3219 * 
fûíame
,

3220 
ulöt
 
max_Àn
)

3222 
ulöt
 
Àn
;

3223 * 
∑th
;

3224 * 
suffix
;

3225 c⁄° 
ulöt
 
suffix_Àn
 = 
	`°æí
(".cfg");

3227 i‡(
	`DICT_TF_HAS_DATA_DIR
(
èbÀ
->
Êags
)) {

3228 
	`di˘_gë_™d_ßve_d©a_dú_∑th
(
èbÀ
, 
Ál£
);

3229 
	`ut_a
(
èbÀ
->
d©a_dú_∑th
);

3231 
∑th
 = 
	`os_fûe_make_ªmŸe_∑th«me
(

3232 
èbÀ
->
d©a_dú_∑th
,ÅabÀ->
«me
, "cfg");

3234 
∑th
 = 
	`fû_make_ibd_«me
(
èbÀ
->
«me
, 
Ál£
);

3237 
	`ut_a
(
∑th
);

3238 
Àn
 = 
	`ut_°æí
(
∑th
);

3239 
	`ut_a
(
max_Àn
 >
Àn
);

3241 
suffix
 = 
∑th
 + (
Àn
 - 
suffix_Àn
);

3242 i‡(
	`°∫cmp
(
suffix
, ".cfg", 
suffix_Àn
) == 0) {

3243 
	`°r˝y
(
fûíame
, 
∑th
);

3245 
	`ut_ad
(
	`°∫cmp
(
suffix
, ".ibd", 
suffix_Àn
) == 0);

3247 
	`°∫˝y
(
fûíame
, 
∑th
, 
Àn
 - 
suffix_Àn
);

3248 
suffix
 = 
fûíame
 + (
Àn
 - 
suffix_Àn
);

3249 
	`°r˝y
(
suffix
, ".cfg");

3252 
	`mem_‰ì
(
∑th
);

3254 
	`§v_n‹mÆize_∑th_f‹_wö
(
fûíame
);

3255 
	}
}

	@/usr/include/sys/utsname.h

22 #i‚def 
_SYS_UTSNAME_H


23 
	#_SYS_UTSNAME_H
 1

	)

25 
	~<„©uªs.h
>

27 
	g__BEGIN_DECLS


29 
	~<bôs/ut¢ame.h
>

31 #i‚de‡
_UTSNAME_SYSNAME_LENGTH


32 
	#_UTSNAME_SYSNAME_LENGTH
 
_UTSNAME_LENGTH


	)

34 #i‚de‡
_UTSNAME_NODENAME_LENGTH


35 
	#_UTSNAME_NODENAME_LENGTH
 
_UTSNAME_LENGTH


	)

37 #i‚de‡
_UTSNAME_RELEASE_LENGTH


38 
	#_UTSNAME_RELEASE_LENGTH
 
_UTSNAME_LENGTH


	)

40 #i‚de‡
_UTSNAME_VERSION_LENGTH


41 
	#_UTSNAME_VERSION_LENGTH
 
_UTSNAME_LENGTH


	)

43 #i‚de‡
_UTSNAME_MACHINE_LENGTH


44 
	#_UTSNAME_MACHINE_LENGTH
 
_UTSNAME_LENGTH


	)

48 
	sut¢ame


51 
	msy¢ame
[
_UTSNAME_SYSNAME_LENGTH
];

54 
	mnodíame
[
_UTSNAME_NODENAME_LENGTH
];

57 
	mªÀa£
[
_UTSNAME_RELEASE_LENGTH
];

59 
	mvîsi⁄
[
_UTSNAME_VERSION_LENGTH
];

62 
	mmachöe
[
_UTSNAME_MACHINE_LENGTH
];

64 #i‡
_UTSNAME_DOMAIN_LENGTH
 - 0

66 #ifde‡
__USE_GNU


67 
	mdomaö«me
[
_UTSNAME_DOMAIN_LENGTH
];

69 
	m__domaö«me
[
_UTSNAME_DOMAIN_LENGTH
];

74 #ifde‡
__USE_SVID


76 
	#SYS_NMLN
 
_UTSNAME_LENGTH


	)

81 
	$u«me
 (
ut¢ame
 *
__«me
Ë
__THROW
;

84 
__END_DECLS


	@/usr/include/zlib.h

31 #i‚de‡
ZLIB_H


32 
	#ZLIB_H


	)

34 
	~"zc⁄f.h
"

36 #ifde‡
__˝lu•lus


40 
	#ZLIB_VERSION
 "1.2.8"

	)

41 
	#ZLIB_VERNUM
 0x1280

	)

42 
	#ZLIB_VER_MAJOR
 1

	)

43 
	#ZLIB_VER_MINOR
 2

	)

44 
	#ZLIB_VER_REVISION
 8

	)

45 
	#ZLIB_VER_SUBREVISION
 0

	)

80 
voidpf
 (*
	tÆloc_func
Ë
	tOF
((
	tvoidpf
 
	t›aque
, 
	tuI¡
 
	tôems
, uI¡ 
	tsize
));

81 (*
‰ì_func
Ë
	tOF
((
	tvoidpf
 
	t›aque
, voidp‡
	taddªss
));

83 
öã∫Æ_°©e
;

85 
	sz_°ªam_s
 {

86 
z_c⁄°
 
Byãf
 *
√xt_ö
;

87 
uI¡
 
avaû_ö
;

88 
uL⁄g
 
tŸÆ_ö
;

90 
Byãf
 *
√xt_out
;

91 
uI¡
 
avaû_out
;

92 
uL⁄g
 
tŸÆ_out
;

94 
z_c⁄°
 *
msg
;

95 
öã∫Æ_°©e
 
FAR
 *
°©e
;

97 
Æloc_func
 
zÆloc
;

98 
‰ì_func
 
z‰ì
;

99 
voidpf
 
›aque
;

101 
d©a_ty≥
;

102 
uL⁄g
 
adÀr
;

103 
uL⁄g
 
ª£rved
;

104 } 
	tz_°ªam
;

106 
z_°ªam
 
	tFAR
 *
	tz_°ªamp
;

112 
	sgz_hódî_s
 {

113 
ãxt
;

114 
uL⁄g
 
time
;

115 
xÊags
;

116 
os
;

117 
Byãf
 *
exåa
;

118 
uI¡
 
exåa_Àn
;

119 
uI¡
 
exåa_max
;

120 
Byãf
 *
«me
;

121 
uI¡
 
«me_max
;

122 
Byãf
 *
commít
;

123 
uI¡
 
comm_max
;

124 
h¸c
;

125 
d⁄e
;

127 } 
	tgz_hódî
;

129 
gz_hódî
 
	tFAR
 *
	tgz_hódîp
;

164 
	#Z_NO_FLUSH
 0

	)

165 
	#Z_PARTIAL_FLUSH
 1

	)

166 
	#Z_SYNC_FLUSH
 2

	)

167 
	#Z_FULL_FLUSH
 3

	)

168 
	#Z_FINISH
 4

	)

169 
	#Z_BLOCK
 5

	)

170 
	#Z_TREES
 6

	)

173 
	#Z_OK
 0

	)

174 
	#Z_STREAM_END
 1

	)

175 
	#Z_NEED_DICT
 2

	)

176 
	#Z_ERRNO
 (-1)

	)

177 
	#Z_STREAM_ERROR
 (-2)

	)

178 
	#Z_DATA_ERROR
 (-3)

	)

179 
	#Z_MEM_ERROR
 (-4)

	)

180 
	#Z_BUF_ERROR
 (-5)

	)

181 
	#Z_VERSION_ERROR
 (-6)

	)

186 
	#Z_NO_COMPRESSION
 0

	)

187 
	#Z_BEST_SPEED
 1

	)

188 
	#Z_BEST_COMPRESSION
 9

	)

189 
	#Z_DEFAULT_COMPRESSION
 (-1)

	)

192 
	#Z_FILTERED
 1

	)

193 
	#Z_HUFFMAN_ONLY
 2

	)

194 
	#Z_RLE
 3

	)

195 
	#Z_FIXED
 4

	)

196 
	#Z_DEFAULT_STRATEGY
 0

	)

199 
	#Z_BINARY
 0

	)

200 
	#Z_TEXT
 1

	)

201 
	#Z_ASCII
 
Z_TEXT


	)

202 
	#Z_UNKNOWN
 2

	)

205 
	#Z_DEFLATED
 8

	)

208 
	#Z_NULL
 0

	)

210 
	#zlib_vîsi⁄
 
	`zlibVîsi⁄
()

	)

216 
ZEXTERN
 c⁄° * 
ZEXPORT
 
zlibVîsi⁄
 
OF
(());

246 
ZEXTERN
 
ZEXPORT
 
deÊ©e
 
OF
((
z_°ªamp
 
°rm
, 
Êush
));

353 
ZEXTERN
 
ZEXPORT
 
deÊ©eEnd
 
OF
((
z_°ªamp
 
°rm
));

392 
ZEXTERN
 
ZEXPORT
 
öÊ©e
 
OF
((
z_°ªamp
 
°rm
, 
Êush
));

508 
ZEXTERN
 
ZEXPORT
 
öÊ©eEnd
 
OF
((
z_°ªamp
 
°rm
));

587 
ZEXTERN
 
ZEXPORT
 
deÊ©eSëDi˘i⁄¨y
 
OF
((
z_°ªamp
 
°rm
,

588 c⁄° 
Byãf
 *
di˘i⁄¨y
,

589 
uI¡
 
di˘Lígth
));

631 
ZEXTERN
 
ZEXPORT
 
deÊ©eC›y
 
OF
((
z_°ªamp
 
de°
,

632 
z_°ªamp
 
sour˚
));

649 
ZEXTERN
 
ZEXPORT
 
deÊ©eRe£t
 
OF
((
z_°ªamp
 
°rm
));

660 
ZEXTERN
 
ZEXPORT
 
deÊ©eP¨ams
 
OF
((
z_°ªamp
 
°rm
,

661 
Àvñ
,

662 
°øãgy
));

681 
ZEXTERN
 
ZEXPORT
 
deÊ©eTu√
 
OF
((
z_°ªamp
 
°rm
,

682 
good_Àngth
,

683 
max_œzy
,

684 
ni˚_Àngth
,

685 
max_chaö
));

698 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
deÊ©eBound
 
OF
((
z_°ªamp
 
°rm
,

699 
uL⁄g
 
sour˚Lí
));

713 
ZEXTERN
 
ZEXPORT
 
deÊ©ePídög
 
OF
((
z_°ªamp
 
°rm
,

714 *
≥ndög
,

715 *
bôs
));

728 
ZEXTERN
 
ZEXPORT
 
deÊ©ePrime
 
OF
((
z_°ªamp
 
°rm
,

729 
bôs
,

730 
vÆue
));

745 
ZEXTERN
 
ZEXPORT
 
deÊ©eSëHódî
 
OF
((
z_°ªamp
 
°rm
,

746 
gz_hódîp
 
hód
));

819 
ZEXTERN
 
ZEXPORT
 
öÊ©eSëDi˘i⁄¨y
 
OF
((
z_°ªamp
 
°rm
,

820 c⁄° 
Byãf
 *
di˘i⁄¨y
,

821 
uI¡
 
di˘Lígth
));

842 
ZEXTERN
 
ZEXPORT
 
öÊ©eGëDi˘i⁄¨y
 
OF
((
z_°ªamp
 
°rm
,

843 
Byãf
 *
di˘i⁄¨y
,

844 
uI¡
 *
di˘Lígth
));

857 
ZEXTERN
 
ZEXPORT
 
öÊ©eSync
 
OF
((
z_°ªamp
 
°rm
));

876 
ZEXTERN
 
ZEXPORT
 
öÊ©eC›y
 
OF
((
z_°ªamp
 
de°
,

877 
z_°ªamp
 
sour˚
));

892 
ZEXTERN
 
ZEXPORT
 
öÊ©eRe£t
 
OF
((
z_°ªamp
 
°rm
));

902 
ZEXTERN
 
ZEXPORT
 
öÊ©eRe£t2
 
OF
((
z_°ªamp
 
°rm
,

903 
wödowBôs
));

914 
ZEXTERN
 
ZEXPORT
 
öÊ©ePrime
 
OF
((
z_°ªamp
 
°rm
,

915 
bôs
,

916 
vÆue
));

935 
ZEXTERN
 
ZEXPORT
 
öÊ©eM¨k
 
OF
((
z_°ªamp
 
°rm
));

963 
ZEXTERN
 
ZEXPORT
 
öÊ©eGëHódî
 
OF
((
z_°ªamp
 
°rm
,

964 
gz_hódîp
 
hód
));

1025 (*
ö_func
Ë
	tOF
((
	tFAR
 *,

1026 
	tz_c⁄°
 
	tFAR
 * FAR *));

1027 (*
out_func
Ë
	tOF
((
	tFAR
 *, FAR *, ));

1029 
ZEXTERN
 
ZEXPORT
 
öÊ©eBack
 
OF
((
z_°ªamp
 
°rm
,

1030 
ö_func
 
ö
, 
FAR
 *
ö_desc
,

1031 
out_func
 
out
, 
FAR
 *
out_desc
));

1099 
ZEXTERN
 
ZEXPORT
 
öÊ©eBackEnd
 
OF
((
z_°ªamp
 
°rm
));

1107 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
zlibCompûeFœgs
 
OF
(());

1148 #i‚de‡
Z_SOLO


1160 
ZEXTERN
 
ZEXPORT
 
com¥ess
 
OF
((
Byãf
 *
de°
, 
uL⁄gf
 *
de°Lí
,

1161 c⁄° 
Byãf
 *
sour˚
, 
uL⁄g
 
sour˚Lí
));

1174 
ZEXTERN
 
ZEXPORT
 
com¥ess2
 
OF
((
Byãf
 *
de°
, 
uL⁄gf
 *
de°Lí
,

1175 c⁄° 
Byãf
 *
sour˚
, 
uL⁄g
 
sour˚Lí
,

1176 
Àvñ
));

1190 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
com¥essBound
 
OF
((uL⁄g 
sour˚Lí
));

1197 
ZEXTERN
 
ZEXPORT
 
uncom¥ess
 
OF
((
Byãf
 *
de°
, 
uL⁄gf
 *
de°Lí
,

1198 c⁄° 
Byãf
 *
sour˚
, 
uL⁄g
 
sour˚Lí
));

1224 
gzFûe_s
 *
	tgzFûe
;

1264 
ZEXTERN
 
gzFûe
 
ZEXPORT
 
gzd›í
 
OF
((
fd
, c⁄° *
mode
));

1287 
ZEXTERN
 
ZEXPORT
 
gzbuf„r
 
OF
((
gzFûe
 
fûe
, 
size
));

1304 
ZEXTERN
 
ZEXPORT
 
gz£ç¨ams
 
OF
((
gzFûe
 
fûe
, 
Àvñ
, 
°øãgy
));

1313 
ZEXTERN
 
ZEXPORT
 
gzªad
 
OF
((
gzFûe
 
fûe
, 
voidp
 
buf
, 
Àn
));

1341 
ZEXTERN
 
ZEXPORT
 
gzwrôe
 
OF
((
gzFûe
 
fûe
,

1342 
voidpc
 
buf
, 
Àn
));

1349 
ZEXTERN
 
ZEXPORTVA
 
gz¥ötf
 
Z_ARG
((
gzFûe
 
fûe
, c⁄° *
f‹m©
, ...));

1364 
ZEXTERN
 
ZEXPORT
 
gzputs
 
OF
((
gzFûe
 
fûe
, c⁄° *
s
));

1372 
ZEXTERN
 * 
ZEXPORT
 
gzgës
 
OF
((
gzFûe
 
fûe
, *
buf
, 
Àn
));

1385 
ZEXTERN
 
ZEXPORT
 
gzputc
 
OF
((
gzFûe
 
fûe
, 
c
));

1391 
ZEXTERN
 
ZEXPORT
 
gzgëc
 
OF
((
gzFûe
 
fûe
));

1400 
ZEXTERN
 
ZEXPORT
 
gzungëc
 
OF
((
c
, 
gzFûe
 
fûe
));

1412 
ZEXTERN
 
ZEXPORT
 
gzÊush
 
OF
((
gzFûe
 
fûe
, 
Êush
));

1447 
ZEXTERN
 
ZEXPORT
 
gzªwöd
 
OF
((
gzFûe
 
fûe
));

1475 
ZEXTERN
 
ZEXPORT
 
gzeof
 
OF
((
gzFûe
 
fûe
));

1490 
ZEXTERN
 
ZEXPORT
 
gzdúe˘
 
OF
((
gzFûe
 
fûe
));

1511 
ZEXTERN
 
ZEXPORT
 
gz˛o£
 
OF
((
gzFûe
 
fûe
));

1524 
ZEXTERN
 
ZEXPORT
 
gz˛o£_r
 
OF
((
gzFûe
 
fûe
));

1525 
ZEXTERN
 
ZEXPORT
 
gz˛o£_w
 
OF
((
gzFûe
 
fûe
));

1536 
ZEXTERN
 c⁄° * 
ZEXPORT
 
gzîr‹
 
OF
((
gzFûe
 
fûe
, *
î∫um
));

1552 
ZEXTERN
 
ZEXPORT
 
gz˛óªº
 
OF
((
gzFûe
 
fûe
));

1569 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
adÀr32
 
OF
((uL⁄g 
adÀr
, c⁄° 
Byãf
 *
buf
, 
uI¡
 
Àn
));

1600 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
¸c32
 
OF
((uL⁄g 
¸c
, c⁄° 
Byãf
 *
buf
, 
uI¡
 
Àn
));

1633 
ZEXTERN
 
ZEXPORT
 
deÊ©eInô_
 
OF
((
z_°ªamp
 
°rm
, 
Àvñ
,

1634 c⁄° *
vîsi⁄
, 
°ªam_size
));

1635 
ZEXTERN
 
ZEXPORT
 
öÊ©eInô_
 
OF
((
z_°ªamp
 
°rm
,

1636 c⁄° *
vîsi⁄
, 
°ªam_size
));

1637 
ZEXTERN
 
ZEXPORT
 
deÊ©eInô2_
 
OF
((
z_°ªamp
 
°rm
, 
Àvñ
, 
mëhod
,

1638 
wödowBôs
, 
memLevñ
,

1639 
°øãgy
, c⁄° *
vîsi⁄
,

1640 
°ªam_size
));

1641 
ZEXTERN
 
ZEXPORT
 
öÊ©eInô2_
 
OF
((
z_°ªamp
 
°rm
, 
wödowBôs
,

1642 c⁄° *
vîsi⁄
, 
°ªam_size
));

1643 
ZEXTERN
 
ZEXPORT
 
öÊ©eBackInô_
 
OF
((
z_°ªamp
 
°rm
, 
wödowBôs
,

1644 
FAR
 *
wödow
,

1645 c⁄° *
vîsi⁄
,

1646 
°ªam_size
));

1647 
	#deÊ©eInô
(
°rm
, 
Àvñ
) \

1648 
	`deÊ©eInô_
((
°rm
), (
Àvñ
), 
ZLIB_VERSION
, ()(
z_°ªam
))

	)

1649 
	#öÊ©eInô
(
°rm
) \

1650 
	`öÊ©eInô_
((
°rm
), 
ZLIB_VERSION
, ()(
z_°ªam
))

	)

1651 
	#deÊ©eInô2
(
°rm
, 
Àvñ
, 
mëhod
, 
wödowBôs
, 
memLevñ
, 
°øãgy
) \

1652 
	`deÊ©eInô2_
((
°rm
),(
Àvñ
),(
mëhod
),(
wödowBôs
),(
memLevñ
),\

1653 (
°øãgy
), 
ZLIB_VERSION
, ()(
z_°ªam
))

	)

1654 
	#öÊ©eInô2
(
°rm
, 
wödowBôs
) \

1655 
	`öÊ©eInô2_
((
°rm
), (
wödowBôs
), 
ZLIB_VERSION
, \

1656 ()(
z_°ªam
))

	)

1657 
	#öÊ©eBackInô
(
°rm
, 
wödowBôs
, 
wödow
) \

1658 
	`öÊ©eBackInô_
((
°rm
), (
wödowBôs
), (
wödow
), \

1659 
ZLIB_VERSION
, ()(
z_°ªam
))

	)

1661 #i‚de‡
Z_SOLO


1670 
	sgzFûe_s
 {

1671 
have
;

1672 *
√xt
;

1673 
z_off64_t
 
pos
;

1675 
ZEXTERN
 
ZEXPORT
 
gzgëc_
 
OF
((
gzFûe
 
fûe
));

1676 #ifde‡
Z_PREFIX_SET


1677 #unde‡
z_gzgëc


1678 
	#z_gzgëc
(
g
) \

1679 ((
g
)->
have
 ? ((g)->have--, (g)->
pos
++, *((g)->
√xt
)++Ë: 
	`gzgëc
(g))

	)

1681 
	#gzgëc
(
g
) \

1682 ((
g
)->
have
 ? ((g)->have--, (g)->
pos
++, *((g)->
√xt
)++Ë: 
	`gzgëc
(g))

	)

1691 #ifde‡
Z_LARGE64


1692 
ZEXTERN
 
gzFûe
 
ZEXPORT
 
gz›í64
 
OF
((const *, const *));

1693 
ZEXTERN
 
z_off64_t
 
ZEXPORT
 
gz£ek64
 
OF
((
gzFûe
, z_off64_t, ));

1694 
ZEXTERN
 
z_off64_t
 
ZEXPORT
 
gzãŒ64
 
OF
((
gzFûe
));

1695 
ZEXTERN
 
z_off64_t
 
ZEXPORT
 
gzoff£t64
 
OF
((
gzFûe
));

1696 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
adÀr32_comböe64
 
OF
((uL⁄g, uL⁄g, 
z_off64_t
));

1697 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
¸c32_comböe64
 
OF
((uL⁄g, uL⁄g, 
z_off64_t
));

1700 #i‡!
deföed
(
ZLIB_INTERNAL
Ë&& deföed(
Z_WANT64
)

1701 #ifde‡
Z_PREFIX_SET


1702 
	#z_gz›í
 
z_gz›í64


	)

1703 
	#z_gz£ek
 
z_gz£ek64


	)

1704 
	#z_gzãŒ
 
z_gzãŒ64


	)

1705 
	#z_gzoff£t
 
z_gzoff£t64


	)

1706 
	#z_adÀr32_comböe
 
z_adÀr32_comböe64


	)

1707 
	#z_¸c32_comböe
 
z_¸c32_comböe64


	)

1709 
	#gz›í
 
gz›í64


	)

1710 
	#gz£ek
 
gz£ek64


	)

1711 
	#gzãŒ
 
gzãŒ64


	)

1712 
	#gzoff£t
 
gzoff£t64


	)

1713 
	#adÀr32_comböe
 
adÀr32_comböe64


	)

1714 
	#¸c32_comböe
 
¸c32_comböe64


	)

1716 #i‚de‡
Z_LARGE64


1717 
ZEXTERN
 
gzFûe
 
ZEXPORT
 
gz›í64
 
OF
((const *, const *));

1718 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gz£ek64
 
OF
((
gzFûe
, z_off_t, ));

1719 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gzãŒ64
 
OF
((
gzFûe
));

1720 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gzoff£t64
 
OF
((
gzFûe
));

1721 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
adÀr32_comböe64
 
OF
((uL⁄g, uL⁄g, 
z_off_t
));

1722 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
¸c32_comböe64
 
OF
((uL⁄g, uL⁄g, 
z_off_t
));

1725 
ZEXTERN
 
gzFûe
 
ZEXPORT
 
gz›í
 
OF
((const *, const *));

1726 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gz£ek
 
OF
((
gzFûe
, z_off_t, ));

1727 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gzãŒ
 
OF
((
gzFûe
));

1728 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gzoff£t
 
OF
((
gzFûe
));

1729 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
adÀr32_comböe
 
OF
((uL⁄g, uL⁄g, 
z_off_t
));

1730 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
¸c32_comböe
 
OF
((uL⁄g, uL⁄g, 
z_off_t
));

1735 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
adÀr32_comböe
 
OF
((uL⁄g, uL⁄g, 
z_off_t
));

1736 
ZEXTERN
 
uL⁄g
 
ZEXPORT
 
¸c32_comböe
 
OF
((uL⁄g, uL⁄g, 
z_off_t
));

1741 #i‡!
deföed
(
ZUTIL_H
Ë&& !deföed(
NO_DUMMY_DECL
)

1742 
	söã∫Æ_°©e
 {
dummy
;};

1746 
ZEXTERN
 c⁄° * 
ZEXPORT
 
zEº‹
 
OF
(());

1747 
ZEXTERN
 
ZEXPORT
 
öÊ©eSyncPoöt
 
OF
((
z_°ªamp
));

1748 
ZEXTERN
 c⁄° 
z_¸c_t
 
FAR
 * 
ZEXPORT
 
gë_¸c_èbÀ
 
OF
(());

1749 
ZEXTERN
 
ZEXPORT
 
öÊ©eUndîmöe
 
OF
((
z_°ªamp
, ));

1750 
ZEXTERN
 
ZEXPORT
 
öÊ©eRe£tKìp
 
OF
((
z_°ªamp
));

1751 
ZEXTERN
 
ZEXPORT
 
deÊ©eRe£tKìp
 
OF
((
z_°ªamp
));

1752 #i‡
deföed
(
_WIN32
Ë&& !deföed(
Z_SOLO
)

1753 
ZEXTERN
 
gzFûe
 
ZEXPORT
 
gz›í_w
 
OF
((c⁄° 
wch¨_t
 *
∑th
,

1754 c⁄° *
mode
));

1756 #i‡
deföed
(
STDC
Ë|| deföed(
Z_HAVE_STDARG_H
)

1757 #i‚de‡
Z_SOLO


1758 
ZEXTERN
 
ZEXPORTVA
 
gzv¥ötf
 
Z_ARG
((
gzFûe
 
fûe
,

1759 c⁄° *
f‹m©
,

1760 
va_li°
 
va
));

1764 #ifde‡
__˝lu•lus


	@/usr/include/bits/utsname.h

18 #i‚de‡
_SYS_UTSNAME_H


23 
	#_UTSNAME_LENGTH
 65

	)

28 
	#_UTSNAME_DOMAIN_LENGTH
 
_UTSNAME_LENGTH


	)

	@/usr/include/features.h

18 #i‚def 
_FEATURES_H


19 
	#_FEATURES_H
 1

	)

101 #unde‡
__USE_ISOC11


102 #unde‡
__USE_ISOC99


103 #unde‡
__USE_ISOC95


104 #unde‡
__USE_ISOCXX11


105 #unde‡
__USE_POSIX


106 #unde‡
__USE_POSIX2


107 #unde‡
__USE_POSIX199309


108 #unde‡
__USE_POSIX199506


109 #unde‡
__USE_XOPEN


110 #unde‡
__USE_XOPEN_EXTENDED


111 #unde‡
__USE_UNIX98


112 #unde‡
__USE_XOPEN2K


113 #unde‡
__USE_XOPEN2KXSI


114 #unde‡
__USE_XOPEN2K8


115 #unde‡
__USE_XOPEN2K8XSI


116 #unde‡
__USE_LARGEFILE


117 #unde‡
__USE_LARGEFILE64


118 #unde‡
__USE_FILE_OFFSET64


119 #unde‡
__USE_BSD


120 #unde‡
__USE_SVID


121 #unde‡
__USE_MISC


122 #unde‡
__USE_ATFILE


123 #unde‡
__USE_GNU


124 #unde‡
__USE_REENTRANT


125 #unde‡
__USE_FORTIFY_LEVEL


126 #unde‡
__KERNEL_STRICT_NAMES


130 #i‚de‡
_LOOSE_KERNEL_NAMES


131 
	#__KERNEL_STRICT_NAMES


	)

141 #i‡
deföed
 
__GNUC__
 && deföed 
__GNUC_MINOR__


142 
	#__GNUC_PREREQ
(
maj
, 
mö
) \

143 ((
__GNUC__
 << 16Ë+ 
__GNUC_MINOR__
 >((
maj
Ë<< 16Ë+ (
mö
))

	)

145 
	#__GNUC_PREREQ
(
maj
, 
mö
Ë0

	)

150 #ifde‡
_GNU_SOURCE


151 #unde‡
_ISOC95_SOURCE


152 
	#_ISOC95_SOURCE
 1

	)

153 #unde‡
_ISOC99_SOURCE


154 
	#_ISOC99_SOURCE
 1

	)

155 #unde‡
_ISOC11_SOURCE


156 
	#_ISOC11_SOURCE
 1

	)

157 #unde‡
_POSIX_SOURCE


158 
	#_POSIX_SOURCE
 1

	)

159 #unde‡
_POSIX_C_SOURCE


160 
	#_POSIX_C_SOURCE
 200809L

	)

161 #unde‡
_XOPEN_SOURCE


162 
	#_XOPEN_SOURCE
 700

	)

163 #unde‡
_XOPEN_SOURCE_EXTENDED


164 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

165 #unde‡
_LARGEFILE64_SOURCE


166 
	#_LARGEFILE64_SOURCE
 1

	)

167 #unde‡
_DEFAULT_SOURCE


168 
	#_DEFAULT_SOURCE
 1

	)

169 #unde‡
_BSD_SOURCE


170 
	#_BSD_SOURCE
 1

	)

171 #unde‡
_SVID_SOURCE


172 
	#_SVID_SOURCE
 1

	)

173 #unde‡
_ATFILE_SOURCE


174 
	#_ATFILE_SOURCE
 1

	)

179 #i‡(
deföed
 
_DEFAULT_SOURCE
 \

180 || (!
deföed
 
	g__STRICT_ANSI__
 \

181 && !
deföed
 
	g_ISOC99_SOURCE
 \

182 && !
deföed
 
	g_POSIX_SOURCE
 && !deföed 
	g_POSIX_C_SOURCE
 \

183 && !
deföed
 
	g_XOPEN_SOURCE
 \

184 && !
deföed
 
	g_BSD_SOURCE
 && !deföed 
	g_SVID_SOURCE
))

185 #unde‡
_DEFAULT_SOURCE


186 
	#_DEFAULT_SOURCE
 1

	)

187 #unde‡
_BSD_SOURCE


188 
	#_BSD_SOURCE
 1

	)

189 #unde‡
_SVID_SOURCE


190 
	#_SVID_SOURCE
 1

	)

194 #i‡(
deföed
 
_ISOC11_SOURCE
 \

195 || (
deföed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 201112L))

196 
	#__USE_ISOC11
 1

	)

200 #i‡(
deföed
 
_ISOC99_SOURCE
 || deföed 
_ISOC11_SOURCE
 \

201 || (
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

202 
	#__USE_ISOC99
 1

	)

206 #i‡(
deföed
 
_ISOC99_SOURCE
 || deföed 
_ISOC11_SOURCE
 \

207 || (
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

208 
	#__USE_ISOC95
 1

	)

215 #i‡((
deföed
 
__˝lu•lus
 && __cplusplus >= 201103L) \

216 || 
deföed
 
__GXX_EXPERIMENTAL_CXX0X__
)

217 
	#__USE_ISOCXX11
 1

	)

223 #ifde‡
_DEFAULT_SOURCE


224 #i‡!
deföed
 
_POSIX_SOURCE
 && !deföed 
_POSIX_C_SOURCE


225 
	#__USE_POSIX_IMPLICITLY
 1

	)

227 #unde‡
_POSIX_SOURCE


228 
	#_POSIX_SOURCE
 1

	)

229 #unde‡
_POSIX_C_SOURCE


230 
	#_POSIX_C_SOURCE
 200809L

	)

232 #i‡((!
deföed
 
__STRICT_ANSI__
 || (
_XOPEN_SOURCE
 - 0) >= 500) && \

233 !
deföed
 
_POSIX_SOURCE
 && !deföed 
_POSIX_C_SOURCE
)

234 
	#_POSIX_SOURCE
 1

	)

235 #i‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

236 
	#_POSIX_C_SOURCE
 2

	)

237 #ñi‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

238 
	#_POSIX_C_SOURCE
 199506L

	)

239 #ñi‡
deföed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

240 
	#_POSIX_C_SOURCE
 200112L

	)

242 
	#_POSIX_C_SOURCE
 200809L

	)

244 
	#__USE_POSIX_IMPLICITLY
 1

	)

247 #i‡
deföed
 
_POSIX_SOURCE
 || 
_POSIX_C_SOURCE
 >1 || deföed 
_XOPEN_SOURCE


248 
	#__USE_POSIX
 1

	)

251 #i‡
deföed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >2 || deföed 
_XOPEN_SOURCE


252 
	#__USE_POSIX2
 1

	)

255 #i‡(
_POSIX_C_SOURCE
 - 0) >= 199309L

256 
	#__USE_POSIX199309
 1

	)

259 #i‡(
_POSIX_C_SOURCE
 - 0) >= 199506L

260 
	#__USE_POSIX199506
 1

	)

263 #i‡(
_POSIX_C_SOURCE
 - 0) >= 200112L

264 
	#__USE_XOPEN2K
 1

	)

265 #unde‡
__USE_ISOC95


266 
	#__USE_ISOC95
 1

	)

267 #unde‡
__USE_ISOC99


268 
	#__USE_ISOC99
 1

	)

271 #i‡(
_POSIX_C_SOURCE
 - 0) >= 200809L

272 
	#__USE_XOPEN2K8
 1

	)

273 #unde‡
_ATFILE_SOURCE


274 
	#_ATFILE_SOURCE
 1

	)

277 #ifdef 
_XOPEN_SOURCE


278 
	#__USE_XOPEN
 1

	)

279 #i‡(
_XOPEN_SOURCE
 - 0) >= 500

280 
	#__USE_XOPEN_EXTENDED
 1

	)

281 
	#__USE_UNIX98
 1

	)

282 #unde‡
_LARGEFILE_SOURCE


283 
	#_LARGEFILE_SOURCE
 1

	)

284 #i‡(
_XOPEN_SOURCE
 - 0) >= 600

285 #i‡(
_XOPEN_SOURCE
 - 0) >= 700

286 
	#__USE_XOPEN2K8
 1

	)

287 
	#__USE_XOPEN2K8XSI
 1

	)

289 
	#__USE_XOPEN2K
 1

	)

290 
	#__USE_XOPEN2KXSI
 1

	)

291 #unde‡
__USE_ISOC95


292 
	#__USE_ISOC95
 1

	)

293 #unde‡
__USE_ISOC99


294 
	#__USE_ISOC99
 1

	)

297 #ifde‡
_XOPEN_SOURCE_EXTENDED


298 
	#__USE_XOPEN_EXTENDED
 1

	)

303 #ifde‡
_LARGEFILE_SOURCE


304 
	#__USE_LARGEFILE
 1

	)

307 #ifde‡
_LARGEFILE64_SOURCE


308 
	#__USE_LARGEFILE64
 1

	)

311 #i‡
deföed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

312 
	#__USE_FILE_OFFSET64
 1

	)

315 #i‡
deföed
 
_BSD_SOURCE
 || deföed 
_SVID_SOURCE


316 
	#__USE_MISC
 1

	)

319 #ifdef 
_BSD_SOURCE


320 
	#__USE_BSD
 1

	)

323 #ifdef 
_SVID_SOURCE


324 
	#__USE_SVID
 1

	)

327 #ifdef 
_ATFILE_SOURCE


328 
	#__USE_ATFILE
 1

	)

331 #ifdef 
_GNU_SOURCE


332 
	#__USE_GNU
 1

	)

335 #i‡
deföed
 
_REENTRANT
 || deföed 
_THREAD_SAFE


336 
	#__USE_REENTRANT
 1

	)

339 #i‡
deföed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

340 && 
__GNUC_PREREQ
 (4, 1Ë&& 
deföed
 
	g__OPTIMIZE__
 && __OPTIMIZE__ > 0

341 #i‡
_FORTIFY_SOURCE
 > 1

342 
	#__USE_FORTIFY_LEVEL
 2

	)

344 
	#__USE_FORTIFY_LEVEL
 1

	)

347 
	#__USE_FORTIFY_LEVEL
 0

	)

352 
	~<°dc-¥edef.h
>

360 #unde‡
__GNU_LIBRARY__


361 
	#__GNU_LIBRARY__
 6

	)

365 
	#__GLIBC__
 2

	)

366 
	#__GLIBC_MINOR__
 19

	)

368 
	#__GLIBC_PREREQ
(
maj
, 
mö
) \

369 ((
__GLIBC__
 << 16Ë+ 
__GLIBC_MINOR__
 >((
maj
Ë<< 16Ë+ (
mö
))

	)

372 #i‚de‡
__ASSEMBLER__


373 #i‚de‡
_SYS_CDEFS_H


374 
	~<sys/cdefs.h
>

379 #i‡
deföed
 
__USE_FILE_OFFSET64
 && !deföed 
__REDIRECT


380 
	#__USE_LARGEFILE
 1

	)

381 
	#__USE_LARGEFILE64
 1

	)

387 #i‡
__GNUC_PREREQ
 (2, 7Ë&& 
deföed
 
__OPTIMIZE__
 \

388 && !
deföed
 
	g__OPTIMIZE_SIZE__
 && !deföed 
	g__NO_INLINE__
 \

389 && 
deföed
 
	g__exã∫_ölöe


390 
	#__USE_EXTERN_INLINES
 1

	)

398 
	~<gnu/°ubs.h
>

	@/usr/include/gnu/stubs.h

6 #i‡!
deföed
 
__x86_64__


7 
	~<gnu/°ubs-32.h
>

9 #i‡
deföed
 
__x86_64__
 && deföed 
__LP64__


10 
	~<gnu/°ubs-64.h
>

12 #i‡
deföed
 
__x86_64__
 && deföed 
__ILP32__


13 
	~<gnu/°ubs-x32.h
>

	@/usr/include/stdc-predef.h

18 #i‚def 
_STDC_PREDEF_H


19 
	#_STDC_PREDEF_H
 1

	)

36 #ifde‡
__GCC_IEC_559


37 #i‡
__GCC_IEC_559
 > 0

38 
	#__STDC_IEC_559__
 1

	)

41 
	#__STDC_IEC_559__
 1

	)

44 #ifde‡
__GCC_IEC_559_COMPLEX


45 #i‡
__GCC_IEC_559_COMPLEX
 > 0

46 
	#__STDC_IEC_559_COMPLEX__
 1

	)

49 
	#__STDC_IEC_559_COMPLEX__
 1

	)

54 
	#__STDC_ISO_10646__
 201103L

	)

57 
	#__STDC_NO_THREADS__
 1

	)

	@/usr/include/sys/cdefs.h

18 #i‚def 
_SYS_CDEFS_H


19 
	#_SYS_CDEFS_H
 1

	)

22 #i‚de‡
_FEATURES_H


23 
	~<„©uªs.h
>

29 #i‡
deföed
 
__GNUC__
 && !deföed 
__STDC__


34 #unde‡
__P


35 #unde‡
__PMT


37 #ifde‡
__GNUC__


41 #i‡
__GNUC_PREREQ
 (4, 6Ë&& !
deföed
 
_LIBC


42 
	#__LEAF
 , 
__Àaf__


	)

43 
	#__LEAF_ATTR
 
	`__©åibuã__
 ((
__Àaf__
))

	)

45 
	#__LEAF


	)

46 
	#__LEAF_ATTR


	)

54 #i‡!
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (3, 3)

55 
	#__THROW
 
	`__©åibuã__
 ((
__nŸhrow__
 
__LEAF
))

	)

56 
	#__THROWNL
 
	`__©åibuã__
 ((
__nŸhrow__
))

	)

57 
	#__NTH
(
f˘
Ë
	`__©åibuã__
 ((
__nŸhrow__
 
__LEAF
)Ë
	)
fct

59 #i‡
deföed
 
__˝lu•lus
 && 
__GNUC_PREREQ
 (2,8)

60 
	#__THROW
 
	`throw
 ()

	)

61 
	#__THROWNL
 
	`throw
 ()

	)

62 
	#__NTH
(
f˘
Ë
__LEAF_ATTR
 f˘ 
	`throw
 ()

	)

64 
	#__THROW


	)

65 
	#__THROWNL


	)

66 
	#__NTH
(
f˘
Ë
	)
fct

72 
	#__ölöe


	)

74 
	#__THROW


	)

75 
	#__THROWNL


	)

76 
	#__NTH
(
f˘
Ë
	)
fct

82 
	#__P
(
¨gs
Ë
	)
args

83 
	#__PMT
(
¨gs
Ë
	)
args

88 
	#__CONCAT
(
x
,
y
Ëx ## 
	)
y

89 
	#__STRING
(
x
Ë#x

	)

92 
	#__±r_t
 *

	)

93 
	#__l⁄g_doubÀ_t
 

	)

97 #ifdef 
__˝lu•lus


98 
	#__BEGIN_DECLS
 "C" {

	)

99 
	#__END_DECLS
 }

	)

101 
	#__BEGIN_DECLS


	)

102 
	#__END_DECLS


	)

111 #i‡
deföed
 
__˝lu•lus
 && deföed 
_GLIBCPP_USE_NAMESPACES


112 
	#__BEGIN_NAMESPACE_STD
 
«me•a˚
 
°d
 {

	)

113 
	#__END_NAMESPACE_STD
 }

	)

114 
	#__USING_NAMESPACE_STD
(
«me
Ë
usög
 
°d
::«me;

	)

115 
	#__BEGIN_NAMESPACE_C99
 
«me•a˚
 
__c99
 {

	)

116 
	#__END_NAMESPACE_C99
 }

	)

117 
	#__USING_NAMESPACE_C99
(
«me
Ë
usög
 
__c99
::«me;

	)

122 
	#__BEGIN_NAMESPACE_STD


	)

123 
	#__END_NAMESPACE_STD


	)

124 
	#__USING_NAMESPACE_STD
(
«me
)

	)

125 
	#__BEGIN_NAMESPACE_C99


	)

126 
	#__END_NAMESPACE_C99


	)

127 
	#__USING_NAMESPACE_C99
(
«me
)

	)

132 
	#__bos
(
±r
Ë
	`__buûtö_obje˘_size
 (±r, 
__USE_FORTIFY_LEVEL
 > 1)

	)

133 
	#__bos0
(
±r
Ë
	`__buûtö_obje˘_size
 (±r, 0)

	)

134 
	#__f‹tify_fun˘i⁄
 
__exã∫_Æways_ölöe
 
__©åibuã_¨tificül__


	)

136 #i‡
__GNUC_PREREQ
 (4,3)

137 
	#__w¨nde˛
(
«me
, 
msg
) \

138 
	`«me
 (Ë
	`__©åibuã__
((
	`__w¨nög__
 (
msg
)))

	)

139 
	#__w¨«âr
(
msg
Ë
	`__©åibuã__
((
	`__w¨nög__
 (msg)))

	)

140 
	#__îr‹de˛
(
«me
, 
msg
) \

141 
	`«me
 (Ë
	`__©åibuã__
((
	`__îr‹__
 (
msg
)))

	)

143 
	#__w¨nde˛
(
«me
, 
msg
Ë
	`«me
 ()

	)

144 
	#__w¨«âr
(
msg
)

	)

145 
	#__îr‹de˛
(
«me
, 
msg
Ë
	`«me
 ()

	)

149 #i‡
__GNUC_PREREQ
 (2,97)

151 
	#__Êex¨r
 []

	)

153 #ifde‡
__GNUC__


154 
	#__Êex¨r
 [0]

	)

156 #i‡
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

157 
	#__Êex¨r
 []

	)

160 
	#__Êex¨r
 [1]

	)

176 #i‡
deföed
 
__GNUC__
 && __GNUC__ >= 2

178 
	#__REDIRECT
(
«me
, 
¥Ÿo
, 
Æüs
Ë«mê¥Ÿÿ
	`__asm__
 (
	`__ASMNAME
 (#Æüs))

	)

179 #ifde‡
__˝lu•lus


180 
	#__REDIRECT_NTH
(
«me
, 
¥Ÿo
, 
Æüs
) \

181 
«me
 
¥Ÿo
 
__THROW
 
	`__asm__
 (
	`__ASMNAME
 (#Æüs))

	)

182 
	#__REDIRECT_NTHNL
(
«me
, 
¥Ÿo
, 
Æüs
) \

183 
«me
 
¥Ÿo
 
__THROWNL
 
	`__asm__
 (
	`__ASMNAME
 (#Æüs))

	)

185 
	#__REDIRECT_NTH
(
«me
, 
¥Ÿo
, 
Æüs
) \

186 
«me
 
¥Ÿo
 
	`__asm__
 (
	`__ASMNAME
 (#Æüs)Ë
__THROW


	)

187 
	#__REDIRECT_NTHNL
(
«me
, 
¥Ÿo
, 
Æüs
) \

188 
«me
 
¥Ÿo
 
	`__asm__
 (
	`__ASMNAME
 (#Æüs)Ë
__THROWNL


	)

190 
	#__ASMNAME
(
˙ame
Ë
	`__ASMNAME2
 (
__USER_LABEL_PREFIX__
, c«me)

	)

191 
	#__ASMNAME2
(
¥efix
, 
˙ame
Ë
	`__STRING
 (¥efixË
	)
cname

204 #i‡!
deföed
 
__GNUC__
 || __GNUC__ < 2

205 
	#__©åibuã__
(
xyz
Ë

	)

211 #i‡
__GNUC_PREREQ
 (2,96)

212 
	#__©åibuã_mÆloc__
 
	`__©åibuã__
 ((
__mÆloc__
))

	)

214 
	#__©åibuã_mÆloc__


	)

219 #i‡
__GNUC_PREREQ
 (4, 3)

220 
	#__©åibuã_Æloc_size__
(
∑øms
) \

221 
	`__©åibuã__
 ((
__Æloc_size__
 
∑øms
))

	)

223 
	#__©åibuã_Æloc_size__
(
∑øms
Ë

	)

229 #i‡
__GNUC_PREREQ
 (2,96)

230 
	#__©åibuã_puª__
 
	`__©åibuã__
 ((
__puª__
))

	)

232 
	#__©åibuã_puª__


	)

236 #i‡
__GNUC_PREREQ
 (2,5)

237 
	#__©åibuã_c⁄°__
 
	`__©åibuã__
 ((
__c⁄°__
))

	)

239 
	#__©åibuã_c⁄°__


	)

245 #i‡
__GNUC_PREREQ
 (3,1)

246 
	#__©åibuã_u£d__
 
	`__©åibuã__
 ((
__u£d__
))

	)

247 
	#__©åibuã_noölöe__
 
	`__©åibuã__
 ((
__noölöe__
))

	)

249 
	#__©åibuã_u£d__
 
	`__©åibuã__
 ((
__unu£d__
))

	)

250 
	#__©åibuã_noölöe__


	)

254 #i‡
__GNUC_PREREQ
 (3,2)

255 
	#__©åibuã_dïªˇãd__
 
	`__©åibuã__
 ((
__dïªˇãd__
))

	)

257 
	#__©åibuã_dïªˇãd__


	)

266 #i‡
__GNUC_PREREQ
 (2,8)

267 
	#__©åibuã_f‹m©_¨g__
(
x
Ë
	`__©åibuã__
 ((
	`__f‹m©_¨g__
 (x)))

	)

269 
	#__©åibuã_f‹m©_¨g__
(
x
Ë

	)

276 #i‡
__GNUC_PREREQ
 (2,97)

277 
	#__©åibuã_f‹m©_°rfm⁄__
(
a
,
b
) \

278 
	`__©åibuã__
 ((
	`__f‹m©__
 (
__°rfm⁄__
, 
a
, 
b
)))

	)

280 
	#__©åibuã_f‹m©_°rfm⁄__
(
a
,
b
Ë

	)

285 #i‡
__GNUC_PREREQ
 (3,3)

286 
	#__n⁄nuŒ
(
∑øms
Ë
	`__©åibuã__
 ((
__n⁄nuŒ__
Ö¨ams))

	)

288 
	#__n⁄nuŒ
(
∑øms
)

	)

293 #i‡
__GNUC_PREREQ
 (3,4)

294 
	#__©åibuã_w¨n_unu£d_ªsu…__
 \

295 
	`__©åibuã__
 ((
__w¨n_unu£d_ªsu…__
))

	)

296 #i‡
__USE_FORTIFY_LEVEL
 > 0

297 
	#__wur
 
__©åibuã_w¨n_unu£d_ªsu…__


	)

300 
	#__©åibuã_w¨n_unu£d_ªsu…__


	)

302 #i‚de‡
__wur


303 
	#__wur


	)

307 #i‡
__GNUC_PREREQ
 (3,2)

308 
	#__Æways_ölöe
 
__ölöe
 
	`__©åibuã__
 ((
__Æways_ölöe__
))

	)

310 
	#__Æways_ölöe
 
__ölöe


	)

315 #i‡
__GNUC_PREREQ
 (4,3)

316 
	#__©åibuã_¨tificül__
 
	`__©åibuã__
 ((
__¨tificül__
))

	)

318 
	#__©åibuã_¨tificül__


	)

321 #ifde‡
__GNUC__


326 #i‡
deföed
 
__GNUC_STDC_INLINE__
 || deföed 
__GNUC_GNU_INLINE__


327 
	#__exã∫_ölöe
 
__ölöe
 
	`__©åibuã__
 ((
__gnu_ölöe__
))

	)

328 
	#__exã∫_Æways_ölöe
 \

329 
__Æways_ölöe
 
	`__©åibuã__
 ((
__gnu_ölöe__
))

	)

331 
	#__exã∫_ölöe
 
__ölöe


	)

332 
	#__exã∫_Æways_ölöe
 
__Æways_ölöe


	)

335 
	#__exã∫_ölöe


	)

336 
	#__exã∫_Æways_ölöe


	)

341 #i‡
__GNUC_PREREQ
 (4,3)

342 
	#__va_¨g_∑ck
(Ë
	`__buûtö_va_¨g_∑ck
 ()

	)

343 
	#__va_¨g_∑ck_Àn
(Ë
	`__buûtö_va_¨g_∑ck_Àn
 ()

	)

350 #i‡!
__GNUC_PREREQ
 (2,8)

351 
	#__exãnsi⁄__


	)

355 #i‡!
__GNUC_PREREQ
 (2,92)

356 
	#__ª°ri˘


	)

362 #i‡
__GNUC_PREREQ
 (3,1Ë&& !
deföed
 
__GNUG__


363 
	#__ª°ri˘_¨r
 
__ª°ri˘


	)

365 #ifde‡
__GNUC__


366 
	#__ª°ri˘_¨r


	)

368 #i‡
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

369 
	#__ª°ri˘_¨r
 
ª°ri˘


	)

372 
	#__ª°ri˘_¨r


	)

377 #i‡
__GNUC__
 >= 3

378 
	#__glibc_u∆ikñy
(
c⁄d
Ë
	`__buûtö_ex≥˘
 ((c⁄d), 0)

	)

379 
	#__glibc_likñy
(
c⁄d
Ë
	`__buûtö_ex≥˘
 ((c⁄d), 1)

	)

381 
	#__glibc_u∆ikñy
(
c⁄d
Ë(c⁄d)

	)

382 
	#__glibc_likñy
(
c⁄d
Ë(c⁄d)

	)

385 
	~<bôs/w‹dsize.h
>

387 #i‡
deföed
 
__LONG_DOUBLE_MATH_OPTIONAL
 && deföed 
__NO_LONG_DOUBLE_MATH


388 
	#__LDBL_COMPAT
 1

	)

389 #ifde‡
__REDIRECT


390 
	#__LDBL_REDIR1
(
«me
, 
¥Ÿo
, 
Æüs
Ë
	`__REDIRECT
 («me,ÖrŸo,álüs)

	)

391 
	#__LDBL_REDIR
(
«me
, 
¥Ÿo
) \

392 
	`__LDBL_REDIR1
 (
«me
, 
¥Ÿo
, 
__∆dbl_
##«me)

	)

393 
	#__LDBL_REDIR1_NTH
(
«me
, 
¥Ÿo
, 
Æüs
Ë
	`__REDIRECT_NTH
 («me,ÖrŸo,álüs)

	)

394 
	#__LDBL_REDIR_NTH
(
«me
, 
¥Ÿo
) \

395 
	`__LDBL_REDIR1_NTH
 (
«me
, 
¥Ÿo
, 
__∆dbl_
##«me)

	)

396 
	#__LDBL_REDIR1_DECL
(
«me
, 
Æüs
) \

397 
	`__ty≥of
 (
«me
Ë«mê
	`__asm
 (
	`__ASMNAME
 (#Æüs));

	)

398 
	#__LDBL_REDIR_DECL
(
«me
) \

399 
	`__ty≥of
 (
«me
Ë«mê
	`__asm
 (
	`__ASMNAME
 ("__∆dbl_" #«me));

	)

400 
	#__REDIRECT_LDBL
(
«me
, 
¥Ÿo
, 
Æüs
) \

401 
	`__LDBL_REDIR1
 (
«me
, 
¥Ÿo
, 
__∆dbl_
##
Æüs
)

	)

402 
	#__REDIRECT_NTH_LDBL
(
«me
, 
¥Ÿo
, 
Æüs
) \

403 
	`__LDBL_REDIR1_NTH
 (
«me
, 
¥Ÿo
, 
__∆dbl_
##
Æüs
)

	)

406 #i‡!
deföed
 
__LDBL_COMPAT
 || !deföed 
__REDIRECT


407 
	#__LDBL_REDIR1
(
«me
, 
¥Ÿo
, 
Æüs
Ë«mê
	)
proto

408 
	#__LDBL_REDIR
(
«me
, 
¥Ÿo
Ë«mê
	)
proto

409 
	#__LDBL_REDIR1_NTH
(
«me
, 
¥Ÿo
, 
Æüs
Ë«mê¥Ÿÿ
__THROW


	)

410 
	#__LDBL_REDIR_NTH
(
«me
, 
¥Ÿo
Ë«mê¥Ÿÿ
__THROW


	)

411 
	#__LDBL_REDIR_DECL
(
«me
)

	)

412 #ifde‡
__REDIRECT


413 
	#__REDIRECT_LDBL
(
«me
, 
¥Ÿo
, 
Æüs
Ë
	`__REDIRECT
 («me,ÖrŸo,álüs)

	)

414 
	#__REDIRECT_NTH_LDBL
(
«me
, 
¥Ÿo
, 
Æüs
) \

415 
	`__REDIRECT_NTH
 (
«me
, 
¥Ÿo
, 
Æüs
)

	)

	@/usr/include/bits/wordsize.h

3 #i‡
deföed
 
__x86_64__
 && !deföed 
__ILP32__


4 
	#__WORDSIZE
 64

	)

6 
	#__WORDSIZE
 32

	)

9 #ifde‡
__x86_64__


10 
	#__WORDSIZE_TIME64_COMPAT32
 1

	)

12 
	#__SYSCALL_WORDSIZE
 64

	)

	@/usr/include/gnu/stubs-32.h

6 #ifde‡
_LIBC


7 #îr‹ 
Aµliˇti⁄s
 
may
 
nŸ
 
deföe
 
the
 
ma¸o
 
_LIBC


10 
	#__°ub_chÊags


	)

11 
	#__°ub_Áâach


	)

12 
	#__°ub_fchÊags


	)

13 
	#__°ub_fdëach


	)

14 
	#__°ub_gây


	)

15 
	#__°ub_lchmod


	)

16 
	#__°ub_ªvoke


	)

17 
	#__°ub_£éogö


	)

18 
	#__°ub_sigªtu∫


	)

19 
	#__°ub_s°k


	)

20 
	#__°ub_°ty


	)

	@/usr/include/gnu/stubs-64.h

6 #ifde‡
_LIBC


7 #îr‹ 
Aµliˇti⁄s
 
may
 
nŸ
 
deföe
 
the
 
ma¸o
 
_LIBC


10 
	#__°ub_bdÊush


	)

11 
	#__°ub_chÊags


	)

12 
	#__°ub_Áâach


	)

13 
	#__°ub_fchÊags


	)

14 
	#__°ub_fdëach


	)

15 
	#__°ub_gëmsg


	)

16 
	#__°ub_gây


	)

17 
	#__°ub_lchmod


	)

18 
	#__°ub_putmsg


	)

19 
	#__°ub_ªvoke


	)

20 
	#__°ub_£éogö


	)

21 
	#__°ub_sigªtu∫


	)

22 
	#__°ub_s°k


	)

23 
	#__°ub_°ty


	)

	@/usr/include/gnu/stubs-x32.h

6 #ifde‡
_LIBC


7 #îr‹ 
Aµliˇti⁄s
 
may
 
nŸ
 
deföe
 
the
 
ma¸o
 
_LIBC


10 
	#__°ub_bdÊush


	)

11 
	#__°ub_chÊags


	)

12 
	#__°ub_¸óã_moduÀ


	)

13 
	#__°ub_Áâach


	)

14 
	#__°ub_fchÊags


	)

15 
	#__°ub_fdëach


	)

16 
	#__°ub_gë_kî√l_syms


	)

17 
	#__°ub_gëmsg


	)

18 
	#__°ub_gây


	)

19 
	#__°ub_lchmod


	)

20 
	#__°ub_nfs£rv˘l


	)

21 
	#__°ub_putmsg


	)

22 
	#__°ub_quîy_moduÀ


	)

23 
	#__°ub_ªvoke


	)

24 
	#__°ub_£éogö


	)

25 
	#__°ub_sigªtu∫


	)

26 
	#__°ub_s°k


	)

27 
	#__°ub_°ty


	)

28 
	#__°ub_u£lib


	)

	@
1
.
1
/usr/include
15
337
ha_innodb.cc
srv0srv.cc
srv0srv.h
srv0start.cc
/usr/include/sys/utsname.h
/usr/include/zlib.h
/usr/include/bits/utsname.h
/usr/include/features.h
/usr/include/gnu/stubs.h
/usr/include/stdc-predef.h
/usr/include/sys/cdefs.h
/usr/include/bits/wordsize.h
/usr/include/gnu/stubs-32.h
/usr/include/gnu/stubs-64.h
/usr/include/gnu/stubs-x32.h
